[0m18:28:35.684382 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106fd83e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1180b5970>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1180b54c0>]}


============================== 18:28:35.687683 | c8100504-8b4a-48e9-8753-cc5c1dc3d508 ==============================
[0m18:28:35.687683 [info ] [MainThread]: Running with dbt=1.11.4
[0m18:28:35.688005 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'fail_fast': 'False', 'send_anonymous_usage_stats': 'True', 'target_path': 'None', 'partial_parse': 'True', 'log_format': 'default', 'cache_selected_only': 'False', 'empty': 'None', 'profiles_dir': '/Users/hazeldonaldson/.dbt', 'no_print': 'None', 'invocation_command': 'dbt deps', 'version_check': 'True', 'use_colors': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_path': '/Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/logs', 'use_experimental_parser': 'False', 'log_cache_events': 'False', 'indirect_selection': 'eager', 'static_parser': 'True', 'introspect': 'True', 'write_json': 'True', 'warn_error': 'None', 'debug': 'False', 'quiet': 'False'}
[0m18:28:35.749317 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c8100504-8b4a-48e9-8753-cc5c1dc3d508', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x118259220>]}
[0m18:28:35.759881 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m18:28:35.760340 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m18:28:35.766495 [debug] [MainThread]: Resource report: {"command_name": "deps", "command_success": true, "command_wall_clock_time": 0.12895341, "process_in_blocks": "0", "process_kernel_time": 0.14947, "process_mem_max_rss": "109477888", "process_out_blocks": "0", "process_user_time": 0.755405}
[0m18:28:35.766939 [debug] [MainThread]: Command `dbt deps` succeeded at 18:28:35.766833 after 0.13 seconds
[0m18:28:35.767164 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1180b5820>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x118390f50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x118258680>]}
[0m18:28:35.767359 [debug] [MainThread]: Flushing usage events
[0m18:28:35.883623 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m18:30:59.082971 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104ab7890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1053b9bb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1053b9820>]}


============================== 18:30:59.086748 | b3a434f1-3a87-47e4-8502-a982a151edd8 ==============================
[0m18:30:59.086748 [info ] [MainThread]: Running with dbt=1.11.4
[0m18:30:59.087075 [debug] [MainThread]: running dbt with arguments {'write_json': 'True', 'invocation_command': 'dbt run --select staging', 'target_path': 'None', 'partial_parse': 'True', 'log_format': 'default', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_path': '/Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/logs', 'fail_fast': 'False', 'version_check': 'True', 'empty': 'False', 'introspect': 'True', 'use_colors': 'True', 'log_cache_events': 'False', 'send_anonymous_usage_stats': 'True', 'quiet': 'False', 'warn_error': 'None', 'cache_selected_only': 'False', 'use_experimental_parser': 'False', 'indirect_selection': 'eager', 'profiles_dir': '/Users/hazeldonaldson/.dbt', 'no_print': 'None', 'debug': 'False', 'printer_width': '80', 'static_parser': 'True'}
[0m18:30:59.277048 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b3a434f1-3a87-47e4-8502-a982a151edd8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10534e330>]}
[0m18:30:59.305689 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b3a434f1-3a87-47e4-8502-a982a151edd8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104ef3e60>]}
[0m18:30:59.307051 [info ] [MainThread]: Registered adapter: duckdb=1.10.0
[0m18:30:59.360512 [debug] [MainThread]: checksum: 092b177ba87eb6bb3c55954c38aa57900eebac336561eb9ee32218428aa81d43, vars: {}, profile: , target: , version: 1.11.4
[0m18:30:59.361007 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m18:30:59.361216 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'b3a434f1-3a87-47e4-8502-a982a151edd8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1054bfa10>]}
[0m18:30:59.897603 [error] [MainThread]: Encountered an error:
Parsing Error
  Invalid test config given in models/staging/staging.yml:
  	test definition dictionary must have exactly one key, got [('accepted_values', None), ('arguments', {'values': ['whale', 'dolphin', 'minnow', 'non_payer']})] instead (2 keys)
  	@: UnparsedModelUpdate(original_file_path='mode...ne)
[0m18:30:59.900070 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.85475343, "process_in_blocks": "0", "process_kernel_time": 0.183367, "process_mem_max_rss": "134529024", "process_out_blocks": "0", "process_user_time": 1.355789}
[0m18:30:59.900340 [debug] [MainThread]: Command `dbt run` failed at 18:30:59.900291 after 0.86 seconds
[0m18:30:59.900543 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1053b9910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1058c9ee0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105970830>]}
[0m18:30:59.900718 [debug] [MainThread]: Flushing usage events
[0m18:31:00.022384 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m18:32:38.290933 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103188bf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106911c40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106911730>]}


============================== 18:32:38.294289 | d6264e41-957f-4a26-a5ef-42d6cb76b833 ==============================
[0m18:32:38.294289 [info ] [MainThread]: Running with dbt=1.11.4
[0m18:32:38.294625 [debug] [MainThread]: running dbt with arguments {'no_print': 'None', 'version_check': 'True', 'warn_error': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True', 'quiet': 'False', 'invocation_command': 'dbt run --select staging', 'log_path': '/Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/logs', 'profiles_dir': '/Users/hazeldonaldson/.dbt', 'static_parser': 'True', 'debug': 'False', 'log_cache_events': 'False', 'target_path': 'None', 'partial_parse': 'True', 'write_json': 'True', 'empty': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'cache_selected_only': 'False', 'log_format': 'default', 'fail_fast': 'False', 'use_experimental_parser': 'False', 'use_colors': 'True', 'indirect_selection': 'eager', 'printer_width': '80'}
[0m18:32:38.461226 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd6264e41-957f-4a26-a5ef-42d6cb76b833', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106a3ddf0>]}
[0m18:32:38.489796 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd6264e41-957f-4a26-a5ef-42d6cb76b833', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10609d8e0>]}
[0m18:32:38.491065 [info ] [MainThread]: Registered adapter: duckdb=1.10.0
[0m18:32:38.542440 [debug] [MainThread]: checksum: 092b177ba87eb6bb3c55954c38aa57900eebac336561eb9ee32218428aa81d43, vars: {}, profile: , target: , version: 1.11.4
[0m18:32:38.542951 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m18:32:38.543149 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'd6264e41-957f-4a26-a5ef-42d6cb76b833', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106aaf560>]}
[0m18:32:39.206815 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 7 unused configuration paths:
- models.marts
- models.question_kingdom
- models.product
- models.retention
- models.monetization
- models.core
- models.staging
[0m18:32:39.211624 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd6264e41-957f-4a26-a5ef-42d6cb76b833', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106ded6d0>]}
[0m18:32:39.256929 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/manifest.json
[0m18:32:39.258163 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/semantic_manifest.json
[0m18:32:39.271573 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd6264e41-957f-4a26-a5ef-42d6cb76b833', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1071ad220>]}
[0m18:32:39.271849 [info ] [MainThread]: Found 7 models, 34 data tests, 5 sources, 472 macros
[0m18:32:39.272025 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd6264e41-957f-4a26-a5ef-42d6cb76b833', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106e47170>]}
[0m18:32:39.273058 [info ] [MainThread]: 
[0m18:32:39.273236 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m18:32:39.273373 [info ] [MainThread]: 
[0m18:32:39.273601 [debug] [MainThread]: Acquiring new duckdb connection 'master'
[0m18:32:39.275830 [debug] [ThreadPool]: Acquiring new duckdb connection 'list_quest_kingdom'
[0m18:32:39.308933 [debug] [ThreadPool]: Using duckdb connection "list_quest_kingdom"
[0m18:32:39.309188 [debug] [ThreadPool]: On list_quest_kingdom: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "list_quest_kingdom"} */

    
    select schema_name
    from system.information_schema.schemata
    
    where lower(catalog_name) = '"quest_kingdom"'
    
  
  
[0m18:32:39.309344 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:32:39.317294 [debug] [ThreadPool]: DuckDB adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "list_quest_kingdom"} */

    
    select schema_name
    from system.information_schema.schemata
    
    where lower(catalog_name) = '"quest_kingdom"'
    
  
  
[0m18:32:39.317560 [debug] [ThreadPool]: DuckDB adapter: Rolling back transaction.
[0m18:32:39.317961 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:32:39.318107 [debug] [MainThread]: Connection 'list_quest_kingdom' was properly closed.
[0m18:32:39.318247 [info ] [MainThread]: 
[0m18:32:39.318402 [info ] [MainThread]: Finished running  in 0 hours 0 minutes and 0.04 seconds (0.04s).
[0m18:32:39.318636 [error] [MainThread]: Encountered an error:
Runtime Error
  IO Error: Cannot open file "/Users/hazeldonaldson/Documents/quest_kingdom_analytics/quest_kingdom_dbt/quest_kingdom.db": No such file or directory
[0m18:32:39.320421 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 1.0681653, "process_in_blocks": "0", "process_kernel_time": 0.181784, "process_mem_max_rss": "145571840", "process_out_blocks": "0", "process_user_time": 1.537193}
[0m18:32:39.320727 [debug] [MainThread]: Command `dbt run` failed at 18:32:39.320675 after 1.07 seconds
[0m18:32:39.320928 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1067d29c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1072af800>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1072afc50>]}
[0m18:32:39.321108 [debug] [MainThread]: Flushing usage events
[0m18:32:39.441644 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m18:34:32.038873 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105408f20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106db5850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106db5610>]}


============================== 18:34:32.042386 | b0e98b7d-5763-466c-9910-91dd1ac79f8e ==============================
[0m18:34:32.042386 [info ] [MainThread]: Running with dbt=1.11.4
[0m18:34:32.042719 [debug] [MainThread]: running dbt with arguments {'write_json': 'True', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'partial_parse': 'True', 'cache_selected_only': 'False', 'log_path': '/Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/logs', 'fail_fast': 'False', 'warn_error': 'None', 'version_check': 'True', 'invocation_command': 'dbt deps', 'use_colors': 'True', 'use_experimental_parser': 'False', 'debug': 'False', 'printer_width': '80', 'introspect': 'True', 'empty': 'None', 'log_cache_events': 'False', 'no_print': 'None', 'send_anonymous_usage_stats': 'True', 'log_format': 'default', 'static_parser': 'True', 'profiles_dir': '/Users/hazeldonaldson/.dbt', 'indirect_selection': 'eager', 'target_path': 'None'}
[0m18:34:32.105292 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b0e98b7d-5763-466c-9910-91dd1ac79f8e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10231c0b0>]}
[0m18:34:32.115765 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m18:34:32.116395 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m18:34:32.117804 [debug] [MainThread]: Resource report: {"command_name": "deps", "command_success": true, "command_wall_clock_time": 0.1183935, "process_in_blocks": "0", "process_kernel_time": 0.13083, "process_mem_max_rss": "109641728", "process_out_blocks": "0", "process_user_time": 0.731216}
[0m18:34:32.118080 [debug] [MainThread]: Command `dbt deps` succeeded at 18:34:32.118028 after 0.12 seconds
[0m18:34:32.118262 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106e58680>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1070174d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106db5490>]}
[0m18:34:32.118432 [debug] [MainThread]: Flushing usage events
[0m18:34:32.246360 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m18:34:46.987601 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x101e96660>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1048d9af0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1048d9880>]}


============================== 18:34:46.991301 | 7e31efe4-6f66-4fd2-88c5-5115eace90f2 ==============================
[0m18:34:46.991301 [info ] [MainThread]: Running with dbt=1.11.4
[0m18:34:46.991659 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'write_json': 'True', 'no_print': 'None', 'log_cache_events': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt run --select models/staging', 'printer_width': '80', 'log_path': '/Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/logs', 'partial_parse': 'True', 'indirect_selection': 'eager', 'profiles_dir': '/Users/hazeldonaldson/.dbt', 'empty': 'False', 'fail_fast': 'False', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'version_check': 'True', 'debug': 'False', 'send_anonymous_usage_stats': 'True', 'warn_error': 'None', 'use_colors': 'True'}
[0m18:34:47.162521 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '7e31efe4-6f66-4fd2-88c5-5115eace90f2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104ac20c0>]}
[0m18:34:47.191053 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '7e31efe4-6f66-4fd2-88c5-5115eace90f2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103b2da30>]}
[0m18:34:47.193178 [info ] [MainThread]: Registered adapter: duckdb=1.10.0
[0m18:34:47.245857 [debug] [MainThread]: checksum: 092b177ba87eb6bb3c55954c38aa57900eebac336561eb9ee32218428aa81d43, vars: {}, profile: , target: , version: 1.11.4
[0m18:34:47.314566 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m18:34:47.314832 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m18:34:47.314974 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m18:34:47.318366 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 7 unused configuration paths:
- models.core
- models.product
- models.monetization
- models.staging
- models.question_kingdom
- models.marts
- models.retention
[0m18:34:47.339621 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '7e31efe4-6f66-4fd2-88c5-5115eace90f2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104b9aae0>]}
[0m18:34:47.389000 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/manifest.json
[0m18:34:47.390580 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/semantic_manifest.json
[0m18:34:47.408196 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '7e31efe4-6f66-4fd2-88c5-5115eace90f2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104b9a300>]}
[0m18:34:47.408521 [info ] [MainThread]: Found 7 models, 34 data tests, 5 sources, 472 macros
[0m18:34:47.408700 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7e31efe4-6f66-4fd2-88c5-5115eace90f2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104a76f30>]}
[0m18:34:47.410350 [info ] [MainThread]: 
[0m18:34:47.410535 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m18:34:47.410672 [info ] [MainThread]: 
[0m18:34:47.410913 [debug] [MainThread]: Acquiring new duckdb connection 'master'
[0m18:34:47.413179 [debug] [ThreadPool]: Acquiring new duckdb connection 'list_quest_kingdom'
[0m18:34:47.443720 [debug] [ThreadPool]: Using duckdb connection "list_quest_kingdom"
[0m18:34:47.443969 [debug] [ThreadPool]: On list_quest_kingdom: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "list_quest_kingdom"} */

    
    select schema_name
    from system.information_schema.schemata
    
    where lower(catalog_name) = '"quest_kingdom"'
    
  
  
[0m18:34:47.444123 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:34:47.451850 [debug] [ThreadPool]: DuckDB adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "list_quest_kingdom"} */

    
    select schema_name
    from system.information_schema.schemata
    
    where lower(catalog_name) = '"quest_kingdom"'
    
  
  
[0m18:34:47.452095 [debug] [ThreadPool]: DuckDB adapter: Rolling back transaction.
[0m18:34:47.452480 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:34:47.452622 [debug] [MainThread]: Connection 'list_quest_kingdom' was properly closed.
[0m18:34:47.452760 [info ] [MainThread]: 
[0m18:34:47.452913 [info ] [MainThread]: Finished running  in 0 hours 0 minutes and 0.04 seconds (0.04s).
[0m18:34:47.453140 [error] [MainThread]: Encountered an error:
Runtime Error
  IO Error: Cannot open file "/Users/hazeldonaldson/Documents/quest_kingdom_analytics/quest_kingdom_dbt/quest_kingdom.db": No such file or directory
[0m18:34:47.454500 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.5066398, "process_in_blocks": "0", "process_kernel_time": 0.176442, "process_mem_max_rss": "139395072", "process_out_blocks": "0", "process_user_time": 0.980933}
[0m18:34:47.454737 [debug] [MainThread]: Command `dbt run` failed at 18:34:47.454693 after 0.51 seconds
[0m18:34:47.454913 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1048d98e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104f47fb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1052d37a0>]}
[0m18:34:47.455079 [debug] [MainThread]: Flushing usage events
[0m18:34:47.556424 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m18:38:38.035306 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1091dea80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10921dd00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1098957c0>]}


============================== 18:38:38.039824 | b6567743-1d94-4242-bdfe-45e4e4cb55b6 ==============================
[0m18:38:38.039824 [info ] [MainThread]: Running with dbt=1.11.4
[0m18:38:38.040207 [debug] [MainThread]: running dbt with arguments {'fail_fast': 'False', 'write_json': 'True', 'quiet': 'False', 'log_cache_events': 'False', 'indirect_selection': 'eager', 'static_parser': 'True', 'partial_parse': 'True', 'debug': 'False', 'profiles_dir': '/Users/hazeldonaldson/.dbt', 'printer_width': '80', 'version_check': 'True', 'log_format': 'default', 'invocation_command': 'dbt run --select models/staging', 'use_colors': 'True', 'send_anonymous_usage_stats': 'True', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'introspect': 'True', 'log_path': '/Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/logs', 'empty': 'False', 'warn_error': 'None', 'cache_selected_only': 'False', 'target_path': 'None', 'use_experimental_parser': 'False'}
[0m18:38:38.221355 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b6567743-1d94-4242-bdfe-45e4e4cb55b6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10999a570>]}
[0m18:38:38.251827 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b6567743-1d94-4242-bdfe-45e4e4cb55b6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10969f860>]}
[0m18:38:38.253200 [info ] [MainThread]: Registered adapter: duckdb=1.10.0
[0m18:38:38.310037 [debug] [MainThread]: checksum: 092b177ba87eb6bb3c55954c38aa57900eebac336561eb9ee32218428aa81d43, vars: {}, profile: , target: , version: 1.11.4
[0m18:38:38.381129 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m18:38:38.381439 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m18:38:38.381593 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m18:38:38.385058 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 7 unused configuration paths:
- models.core
- models.retention
- models.question_kingdom
- models.monetization
- models.marts
- models.staging
- models.product
[0m18:38:38.408162 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b6567743-1d94-4242-bdfe-45e4e4cb55b6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106f43d70>]}
[0m18:38:38.453744 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/manifest.json
[0m18:38:38.455559 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/semantic_manifest.json
[0m18:38:38.472534 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b6567743-1d94-4242-bdfe-45e4e4cb55b6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109d5f050>]}
[0m18:38:38.472904 [info ] [MainThread]: Found 7 models, 34 data tests, 5 sources, 472 macros
[0m18:38:38.473095 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b6567743-1d94-4242-bdfe-45e4e4cb55b6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109d0e2d0>]}
[0m18:38:38.474768 [info ] [MainThread]: 
[0m18:38:38.474952 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m18:38:38.475096 [info ] [MainThread]: 
[0m18:38:38.475347 [debug] [MainThread]: Acquiring new duckdb connection 'master'
[0m18:38:38.477551 [debug] [ThreadPool]: Acquiring new duckdb connection 'list_quest_kingdom'
[0m18:38:38.507566 [debug] [ThreadPool]: Using duckdb connection "list_quest_kingdom"
[0m18:38:38.507849 [debug] [ThreadPool]: On list_quest_kingdom: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "list_quest_kingdom"} */

    
    select schema_name
    from system.information_schema.schemata
    
    where lower(catalog_name) = '"quest_kingdom"'
    
  
  
[0m18:38:38.508018 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:38:38.517125 [debug] [ThreadPool]: DuckDB adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "list_quest_kingdom"} */

    
    select schema_name
    from system.information_schema.schemata
    
    where lower(catalog_name) = '"quest_kingdom"'
    
  
  
[0m18:38:38.517416 [debug] [ThreadPool]: DuckDB adapter: Rolling back transaction.
[0m18:38:38.517822 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:38:38.517962 [debug] [MainThread]: Connection 'list_quest_kingdom' was properly closed.
[0m18:38:38.518100 [info ] [MainThread]: 
[0m18:38:38.518267 [info ] [MainThread]: Finished running  in 0 hours 0 minutes and 0.04 seconds (0.04s).
[0m18:38:38.518499 [error] [MainThread]: Encountered an error:
Runtime Error
  IO Error: Cannot open file "/Users/hazeldonaldson/Documents/quest_kingdom_analytics/quest_kingdom_dbt/quest_kingdom.db": No such file or directory
[0m18:38:38.520011 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.5273802, "process_in_blocks": "0", "process_kernel_time": 0.211895, "process_mem_max_rss": "136462336", "process_out_blocks": "0", "process_user_time": 1.026423}
[0m18:38:38.520278 [debug] [MainThread]: Command `dbt run` failed at 18:38:38.520229 after 0.53 seconds
[0m18:38:38.520473 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10982dc70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109ed8cb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109ed9f70>]}
[0m18:38:38.520656 [debug] [MainThread]: Flushing usage events
[0m18:38:38.650745 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m18:40:32.411194 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108bb92e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108655310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1093dd760>]}


============================== 18:40:32.414894 | ee53585e-eafe-4f6f-83ec-8d93e70f09fa ==============================
[0m18:40:32.414894 [info ] [MainThread]: Running with dbt=1.11.4
[0m18:40:32.415221 [debug] [MainThread]: running dbt with arguments {'log_path': '/Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/logs', 'printer_width': '80', 'no_print': 'None', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'quiet': 'False', 'use_colors': 'True', 'invocation_command': 'dbt run --select models/staging', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'debug': 'False', 'log_cache_events': 'False', 'static_parser': 'True', 'partial_parse': 'True', 'indirect_selection': 'eager', 'empty': 'False', 'target_path': 'None', 'cache_selected_only': 'False', 'fail_fast': 'False', 'version_check': 'True', 'log_format': 'default', 'warn_error': 'None', 'use_experimental_parser': 'False', 'profiles_dir': '/Users/hazeldonaldson/.dbt'}
[0m18:40:32.586126 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ee53585e-eafe-4f6f-83ec-8d93e70f09fa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10957a7b0>]}
[0m18:40:32.614626 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'ee53585e-eafe-4f6f-83ec-8d93e70f09fa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108a1cc20>]}
[0m18:40:32.615910 [info ] [MainThread]: Registered adapter: duckdb=1.10.0
[0m18:40:32.666927 [debug] [MainThread]: checksum: 092b177ba87eb6bb3c55954c38aa57900eebac336561eb9ee32218428aa81d43, vars: {}, profile: , target: , version: 1.11.4
[0m18:40:32.716078 [info ] [MainThread]: Unable to do partial parsing because profile has changed
[0m18:40:32.716378 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'ee53585e-eafe-4f6f-83ec-8d93e70f09fa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109919a00>]}
[0m18:40:33.356445 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 7 unused configuration paths:
- models.staging
- models.product
- models.monetization
- models.marts
- models.retention
- models.core
- models.question_kingdom
[0m18:40:33.361541 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'ee53585e-eafe-4f6f-83ec-8d93e70f09fa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1098750a0>]}
[0m18:40:33.405368 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/manifest.json
[0m18:40:33.406677 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/semantic_manifest.json
[0m18:40:33.420886 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'ee53585e-eafe-4f6f-83ec-8d93e70f09fa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109d276b0>]}
[0m18:40:33.421196 [info ] [MainThread]: Found 7 models, 34 data tests, 5 sources, 472 macros
[0m18:40:33.421376 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ee53585e-eafe-4f6f-83ec-8d93e70f09fa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109ba0c50>]}
[0m18:40:33.422969 [info ] [MainThread]: 
[0m18:40:33.423161 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m18:40:33.423303 [info ] [MainThread]: 
[0m18:40:33.423530 [debug] [MainThread]: Acquiring new duckdb connection 'master'
[0m18:40:33.425937 [debug] [ThreadPool]: Acquiring new duckdb connection 'list_quest_kingdom'
[0m18:40:33.455280 [debug] [ThreadPool]: Using duckdb connection "list_quest_kingdom"
[0m18:40:33.455526 [debug] [ThreadPool]: On list_quest_kingdom: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "list_quest_kingdom"} */

    
    select schema_name
    from system.information_schema.schemata
    
    where lower(catalog_name) = '"quest_kingdom"'
    
  
  
[0m18:40:33.455680 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:40:33.478279 [debug] [ThreadPool]: SQL status: OK in 0.023 seconds
[0m18:40:33.479516 [debug] [ThreadPool]: On list_quest_kingdom: Close
[0m18:40:33.479907 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_quest_kingdom, now create_quest_kingdom_main)
[0m18:40:33.480138 [debug] [ThreadPool]: Creating schema "database: "quest_kingdom"
schema: "main"
"
[0m18:40:33.483521 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m18:40:33.483705 [debug] [ThreadPool]: On create_quest_kingdom_main: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "create_quest_kingdom_main"} */

    
        select type from duckdb_databases()
        where lower(database_name)='quest_kingdom'
        and type='sqlite'
    
  
[0m18:40:33.483842 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:40:33.484642 [debug] [ThreadPool]: SQL status: OK in 0.001 seconds
[0m18:40:33.485466 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m18:40:33.485614 [debug] [ThreadPool]: On create_quest_kingdom_main: BEGIN
[0m18:40:33.485843 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m18:40:33.485970 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m18:40:33.486093 [debug] [ThreadPool]: On create_quest_kingdom_main: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "create_quest_kingdom_main"} */

    
    
        create schema if not exists "quest_kingdom"."main"
    
[0m18:40:33.486340 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m18:40:33.487326 [debug] [ThreadPool]: On create_quest_kingdom_main: COMMIT
[0m18:40:33.488050 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m18:40:33.488262 [debug] [ThreadPool]: On create_quest_kingdom_main: COMMIT
[0m18:40:33.488562 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m18:40:33.488708 [debug] [ThreadPool]: On create_quest_kingdom_main: Close
[0m18:40:33.489397 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_quest_kingdom_main, now list_quest_kingdom_main)
[0m18:40:33.492265 [debug] [ThreadPool]: Using duckdb connection "list_quest_kingdom_main"
[0m18:40:33.492492 [debug] [ThreadPool]: On list_quest_kingdom_main: BEGIN
[0m18:40:33.492632 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:40:33.492908 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m18:40:33.493037 [debug] [ThreadPool]: Using duckdb connection "list_quest_kingdom_main"
[0m18:40:33.493171 [debug] [ThreadPool]: On list_quest_kingdom_main: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "list_quest_kingdom_main"} */
select
      'quest_kingdom' as database,
      table_name as name,
      table_schema as schema,
      CASE table_type
        WHEN 'BASE TABLE' THEN 'table'
        WHEN 'VIEW' THEN 'view'
        WHEN 'LOCAL TEMPORARY' THEN 'table'
        END as type
    from system.information_schema.tables
    where lower(table_schema) = 'main'
    and lower(table_catalog) = 'quest_kingdom'
  
[0m18:40:33.503241 [debug] [ThreadPool]: SQL status: OK in 0.010 seconds
[0m18:40:33.503991 [debug] [ThreadPool]: On list_quest_kingdom_main: ROLLBACK
[0m18:40:33.504947 [debug] [ThreadPool]: Failed to rollback 'list_quest_kingdom_main'
[0m18:40:33.505101 [debug] [ThreadPool]: On list_quest_kingdom_main: Close
[0m18:40:33.505905 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ee53585e-eafe-4f6f-83ec-8d93e70f09fa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109ce2c00>]}
[0m18:40:33.506124 [debug] [MainThread]: Using duckdb connection "master"
[0m18:40:33.506255 [debug] [MainThread]: On master: BEGIN
[0m18:40:33.506372 [debug] [MainThread]: Opening a new connection, currently in state init
[0m18:40:33.506621 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m18:40:33.506750 [debug] [MainThread]: On master: COMMIT
[0m18:40:33.506872 [debug] [MainThread]: Using duckdb connection "master"
[0m18:40:33.506991 [debug] [MainThread]: On master: COMMIT
[0m18:40:33.507196 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m18:40:33.507324 [debug] [MainThread]: On master: Close
[0m18:40:33.509651 [debug] [Thread-1 (]: Began running node model.quest_kingdom.stg_ad_impressions
[0m18:40:33.509899 [info ] [Thread-1 (]: 1 of 5 START sql view model main.stg_ad_impressions ............................ [RUN]
[0m18:40:33.510101 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_quest_kingdom_main, now model.quest_kingdom.stg_ad_impressions)
[0m18:40:33.510261 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.stg_ad_impressions
[0m18:40:33.513711 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.stg_ad_impressions"
[0m18:40:33.514290 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.stg_ad_impressions
[0m18:40:33.528838 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.stg_ad_impressions"
[0m18:40:33.529539 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_ad_impressions"
[0m18:40:33.529712 [debug] [Thread-1 (]: On model.quest_kingdom.stg_ad_impressions: BEGIN
[0m18:40:33.529860 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:40:33.530214 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:40:33.530365 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_ad_impressions"
[0m18:40:33.530522 [debug] [Thread-1 (]: On model.quest_kingdom.stg_ad_impressions: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.stg_ad_impressions"} */

  
  create view "quest_kingdom"."main"."stg_ad_impressions__dbt_tmp" as (
    with source (
    select * from "quest_kingdom"."main"."ad_impressions"
),

renamed as (
    select 
        ad_id,
        player_id,
        session_id,

        --timestamps
        ad_timestamp::timestamp as shown_at,

        --dimensions
        lower(trim(ad_type)) as ad_type,
        lower(trim(ad_network)) as ad_network,

        --booleans
        clicked,
        --metrics
        revenue_usd,
        --derived
        date_trunc('date', ad_timestamp::timestamp) as ad_date
    from source 
)

select * from renamed
  );

[0m18:40:33.533662 [debug] [Thread-1 (]: DuckDB adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.stg_ad_impressions"} */

  
  create view "quest_kingdom"."main"."stg_ad_impressions__dbt_tmp" as (
    with source (
    select * from "quest_kingdom"."main"."ad_impressions"
),

renamed as (
    select 
        ad_id,
        player_id,
        session_id,

        --timestamps
        ad_timestamp::timestamp as shown_at,

        --dimensions
        lower(trim(ad_type)) as ad_type,
        lower(trim(ad_network)) as ad_network,

        --booleans
        clicked,
        --metrics
        revenue_usd,
        --derived
        date_trunc('date', ad_timestamp::timestamp) as ad_date
    from source 
)

select * from renamed
  );

[0m18:40:33.533875 [debug] [Thread-1 (]: DuckDB adapter: Rolling back transaction.
[0m18:40:33.534093 [debug] [Thread-1 (]: On model.quest_kingdom.stg_ad_impressions: ROLLBACK
[0m18:40:33.538374 [debug] [Thread-1 (]: Failed to rollback 'model.quest_kingdom.stg_ad_impressions'
[0m18:40:33.538553 [debug] [Thread-1 (]: On model.quest_kingdom.stg_ad_impressions: Close
[0m18:40:33.539673 [debug] [Thread-1 (]: Runtime Error in model stg_ad_impressions (models/staging/stg_ad_impressions.sql)
  Parser Error: syntax error at or near "select"
  
  LINE 6:     select * from "quest_kingdom"."main"."ad_impressions"
              ^
[0m18:40:33.540607 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ee53585e-eafe-4f6f-83ec-8d93e70f09fa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109a96f90>]}
[0m18:40:33.540930 [error] [Thread-1 (]: 1 of 5 ERROR creating sql view model main.stg_ad_impressions ................... [[31mERROR[0m in 0.03s]
[0m18:40:33.541204 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.stg_ad_impressions
[0m18:40:33.541393 [debug] [Thread-1 (]: Began running node model.quest_kingdom.stg_events
[0m18:40:33.541624 [debug] [Thread-4 (]: Marking all children of 'model.quest_kingdom.stg_ad_impressions' to be skipped because of status 'error'.  Reason: Runtime Error in model stg_ad_impressions (models/staging/stg_ad_impressions.sql)
  Parser Error: syntax error at or near "select"
  
  LINE 6:     select * from "quest_kingdom"."main"."ad_impressions"
              ^.
[0m18:40:33.541857 [info ] [Thread-1 (]: 2 of 5 START sql view model main.stg_events .................................... [RUN]
[0m18:40:33.542400 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.quest_kingdom.stg_ad_impressions, now model.quest_kingdom.stg_events)
[0m18:40:33.542600 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.stg_events
[0m18:40:33.544115 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.stg_events"
[0m18:40:33.544494 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.stg_events
[0m18:40:33.545986 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.stg_events"
[0m18:40:33.546297 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_events"
[0m18:40:33.546455 [debug] [Thread-1 (]: On model.quest_kingdom.stg_events: BEGIN
[0m18:40:33.546595 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:40:33.546930 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:40:33.547081 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_events"
[0m18:40:33.547236 [debug] [Thread-1 (]: On model.quest_kingdom.stg_events: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.stg_events"} */

  
  create view "quest_kingdom"."main"."stg_events__dbt_tmp" as (
    with source (
    select * from "quest_kingdom"."main"."events"
),

renamed as (
    select 
        event_id,
        player_id,
        session_id,
        --timestamps
        event_timestamp::timestamp as event_at,

        --dimensions
        lower(trim(event_name)) as event_name,

        --json properties
        event_properties
    from source 
)

select * from renamed
  );

[0m18:40:33.547558 [debug] [Thread-1 (]: DuckDB adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.stg_events"} */

  
  create view "quest_kingdom"."main"."stg_events__dbt_tmp" as (
    with source (
    select * from "quest_kingdom"."main"."events"
),

renamed as (
    select 
        event_id,
        player_id,
        session_id,
        --timestamps
        event_timestamp::timestamp as event_at,

        --dimensions
        lower(trim(event_name)) as event_name,

        --json properties
        event_properties
    from source 
)

select * from renamed
  );

[0m18:40:33.547711 [debug] [Thread-1 (]: DuckDB adapter: Rolling back transaction.
[0m18:40:33.547894 [debug] [Thread-1 (]: On model.quest_kingdom.stg_events: ROLLBACK
[0m18:40:33.549348 [debug] [Thread-1 (]: Failed to rollback 'model.quest_kingdom.stg_events'
[0m18:40:33.549545 [debug] [Thread-1 (]: On model.quest_kingdom.stg_events: Close
[0m18:40:33.550813 [debug] [Thread-1 (]: Runtime Error in model stg_events (models/staging/stg_events.sql)
  Parser Error: syntax error at or near "select"
  
  LINE 6:     select * from "quest_kingdom"."main"."events"
              ^
[0m18:40:33.551086 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ee53585e-eafe-4f6f-83ec-8d93e70f09fa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a247d40>]}
[0m18:40:33.551408 [error] [Thread-1 (]: 2 of 5 ERROR creating sql view model main.stg_events ........................... [[31mERROR[0m in 0.01s]
[0m18:40:33.551762 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.stg_events
[0m18:40:33.552014 [debug] [Thread-1 (]: Began running node model.quest_kingdom.stg_iap_transactions
[0m18:40:33.552256 [debug] [Thread-4 (]: Marking all children of 'model.quest_kingdom.stg_events' to be skipped because of status 'error'.  Reason: Runtime Error in model stg_events (models/staging/stg_events.sql)
  Parser Error: syntax error at or near "select"
  
  LINE 6:     select * from "quest_kingdom"."main"."events"
              ^.
[0m18:40:33.552493 [info ] [Thread-1 (]: 3 of 5 START sql view model main.stg_iap_transactions .......................... [RUN]
[0m18:40:33.552775 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.quest_kingdom.stg_events, now model.quest_kingdom.stg_iap_transactions)
[0m18:40:33.552942 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.stg_iap_transactions
[0m18:40:33.554377 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.stg_iap_transactions"
[0m18:40:33.554768 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.stg_iap_transactions
[0m18:40:33.556394 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.stg_iap_transactions"
[0m18:40:33.556753 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_iap_transactions"
[0m18:40:33.556919 [debug] [Thread-1 (]: On model.quest_kingdom.stg_iap_transactions: BEGIN
[0m18:40:33.557096 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:40:33.557520 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:40:33.557689 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_iap_transactions"
[0m18:40:33.557850 [debug] [Thread-1 (]: On model.quest_kingdom.stg_iap_transactions: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.stg_iap_transactions"} */

  
  create view "quest_kingdom"."main"."stg_iap_transactions__dbt_tmp" as (
    with source (
    select * from "quest_kingdom"."main"."iap_transactions"
),

renamed as (
    select 
        transaction_id,
        player_id,
        session_id,

        --timestamps
        transaction_timestamp::timestamp as purchased_at,

        --dimension
        lower(trim(sku)) as sku,
        lower(trim(platform)) as platform,

        --metrics
        price_usd,
        gems_purchased,

        --derived
        date_trunc('date', transaction_timestamp::timestamp) as purchase_date
    from source 
)

select * from renamed
  );

[0m18:40:33.558209 [debug] [Thread-1 (]: DuckDB adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.stg_iap_transactions"} */

  
  create view "quest_kingdom"."main"."stg_iap_transactions__dbt_tmp" as (
    with source (
    select * from "quest_kingdom"."main"."iap_transactions"
),

renamed as (
    select 
        transaction_id,
        player_id,
        session_id,

        --timestamps
        transaction_timestamp::timestamp as purchased_at,

        --dimension
        lower(trim(sku)) as sku,
        lower(trim(platform)) as platform,

        --metrics
        price_usd,
        gems_purchased,

        --derived
        date_trunc('date', transaction_timestamp::timestamp) as purchase_date
    from source 
)

select * from renamed
  );

[0m18:40:33.558403 [debug] [Thread-1 (]: DuckDB adapter: Rolling back transaction.
[0m18:40:33.558611 [debug] [Thread-1 (]: On model.quest_kingdom.stg_iap_transactions: ROLLBACK
[0m18:40:33.560442 [debug] [Thread-1 (]: Failed to rollback 'model.quest_kingdom.stg_iap_transactions'
[0m18:40:33.560687 [debug] [Thread-1 (]: On model.quest_kingdom.stg_iap_transactions: Close
[0m18:40:33.562004 [debug] [Thread-1 (]: Runtime Error in model stg_iap_transactions (models/staging/stg_iap_transactions.sql)
  Parser Error: syntax error at or near "select"
  
  LINE 6:     select * from "quest_kingdom"."main"."iap_transactions"
              ^
[0m18:40:33.562236 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ee53585e-eafe-4f6f-83ec-8d93e70f09fa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a262750>]}
[0m18:40:33.562526 [error] [Thread-1 (]: 3 of 5 ERROR creating sql view model main.stg_iap_transactions ................. [[31mERROR[0m in 0.01s]
[0m18:40:33.562774 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.stg_iap_transactions
[0m18:40:33.562951 [debug] [Thread-1 (]: Began running node model.quest_kingdom.stg_players
[0m18:40:33.563163 [debug] [Thread-4 (]: Marking all children of 'model.quest_kingdom.stg_iap_transactions' to be skipped because of status 'error'.  Reason: Runtime Error in model stg_iap_transactions (models/staging/stg_iap_transactions.sql)
  Parser Error: syntax error at or near "select"
  
  LINE 6:     select * from "quest_kingdom"."main"."iap_transactions"
              ^.
[0m18:40:33.563380 [info ] [Thread-1 (]: 4 of 5 START sql view model main.stg_players ................................... [RUN]
[0m18:40:33.563652 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.quest_kingdom.stg_iap_transactions, now model.quest_kingdom.stg_players)
[0m18:40:33.563817 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.stg_players
[0m18:40:33.565383 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.stg_players"
[0m18:40:33.566298 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.stg_players
[0m18:40:33.567899 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.stg_players"
[0m18:40:33.570066 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_players"
[0m18:40:33.570244 [debug] [Thread-1 (]: On model.quest_kingdom.stg_players: BEGIN
[0m18:40:33.570396 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:40:33.570758 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:40:33.570905 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_players"
[0m18:40:33.571063 [debug] [Thread-1 (]: On model.quest_kingdom.stg_players: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.stg_players"} */

  
  create view "quest_kingdom"."main"."stg_players__dbt_tmp" as (
    with source as (
    select * from "quest_kingdom"."main"."players"
),

renamed as (
    select
        player_id,
        install_date::date as installed_at,
        --dimensions
        lower(trim(attribution_channel)) as attribution_channel,
        lower(trim(country)) as country,
        lower(trim(device_type)) as device_type,
        lower(trim(player_segment)) as player_segment,
        lower(trim(experiment_variant)) as experiment_variant,
        --booleans
        tutorial_completed,
        --metrics
        lifetime_value as lifetime_value_usd
    from source 
)

select * from renamed
  );

[0m18:40:33.571647 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:40:33.575606 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_players"
[0m18:40:33.575830 [debug] [Thread-1 (]: On model.quest_kingdom.stg_players: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.stg_players"} */
alter view "quest_kingdom"."main"."stg_players__dbt_tmp" rename to "stg_players"
[0m18:40:33.610898 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m18:40:33.615656 [debug] [Thread-1 (]: On model.quest_kingdom.stg_players: COMMIT
[0m18:40:33.615855 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_players"
[0m18:40:33.616008 [debug] [Thread-1 (]: On model.quest_kingdom.stg_players: COMMIT
[0m18:40:33.617318 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m18:40:33.619830 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_players"
[0m18:40:33.620004 [debug] [Thread-1 (]: On model.quest_kingdom.stg_players: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.stg_players"} */

      drop view if exists "quest_kingdom"."main"."stg_players__dbt_backup" cascade
    
[0m18:40:33.620463 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:40:33.621713 [debug] [Thread-1 (]: On model.quest_kingdom.stg_players: Close
[0m18:40:33.621987 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ee53585e-eafe-4f6f-83ec-8d93e70f09fa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a289c40>]}
[0m18:40:33.622272 [info ] [Thread-1 (]: 4 of 5 OK created sql view model main.stg_players .............................. [[32mOK[0m in 0.06s]
[0m18:40:33.622606 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.stg_players
[0m18:40:33.622790 [debug] [Thread-1 (]: Began running node model.quest_kingdom.stg_sessions
[0m18:40:33.623002 [info ] [Thread-1 (]: 5 of 5 START sql view model main.stg_sessions .................................. [RUN]
[0m18:40:33.623191 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.quest_kingdom.stg_players, now model.quest_kingdom.stg_sessions)
[0m18:40:33.623349 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.stg_sessions
[0m18:40:33.624584 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.stg_sessions"
[0m18:40:33.624947 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.stg_sessions
[0m18:40:33.626537 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.stg_sessions"
[0m18:40:33.626861 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_sessions"
[0m18:40:33.627023 [debug] [Thread-1 (]: On model.quest_kingdom.stg_sessions: BEGIN
[0m18:40:33.627168 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:40:33.627521 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:40:33.627724 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_sessions"
[0m18:40:33.627944 [debug] [Thread-1 (]: On model.quest_kingdom.stg_sessions: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.stg_sessions"} */

  
  create view "quest_kingdom"."main"."stg_sessions__dbt_tmp" as (
    with source as (
    select * from "quest_kingdom"."main"."sessions"
),

renamed as (
    select 
        session_id,
        player_id,
        --timestamps
        session_start::timestamp as session_started_at,
        session_end::timestamp as session_ended_at,

        --metrics
        session_duration_minutes,
        starting_level,
        ending_level,
        levels_gained,

        --derived metrics
        extract(hour from session_start::timestamp) as session_hour,
        extract(dow from session_start::timestamp) as session_day_of_week,
        date_trunc('date', session_start::timestamp) as session_date 
    from source
)

select * renamed
  );

[0m18:40:33.630216 [debug] [Thread-1 (]: DuckDB adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.stg_sessions"} */

  
  create view "quest_kingdom"."main"."stg_sessions__dbt_tmp" as (
    with source as (
    select * from "quest_kingdom"."main"."sessions"
),

renamed as (
    select 
        session_id,
        player_id,
        --timestamps
        session_start::timestamp as session_started_at,
        session_end::timestamp as session_ended_at,

        --metrics
        session_duration_minutes,
        starting_level,
        ending_level,
        levels_gained,

        --derived metrics
        extract(hour from session_start::timestamp) as session_hour,
        extract(dow from session_start::timestamp) as session_day_of_week,
        date_trunc('date', session_start::timestamp) as session_date 
    from source
)

select * renamed
  );

[0m18:40:33.630397 [debug] [Thread-1 (]: DuckDB adapter: Rolling back transaction.
[0m18:40:33.630593 [debug] [Thread-1 (]: On model.quest_kingdom.stg_sessions: ROLLBACK
[0m18:40:33.631959 [debug] [Thread-1 (]: Failed to rollback 'model.quest_kingdom.stg_sessions'
[0m18:40:33.632119 [debug] [Thread-1 (]: On model.quest_kingdom.stg_sessions: Close
[0m18:40:33.633224 [debug] [Thread-1 (]: Runtime Error in model stg_sessions (models/staging/stg_sessions.sql)
  Conversion Error: extract specifier "date" not recognized
[0m18:40:33.633428 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ee53585e-eafe-4f6f-83ec-8d93e70f09fa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109fdb260>]}
[0m18:40:33.633713 [error] [Thread-1 (]: 5 of 5 ERROR creating sql view model main.stg_sessions ......................... [[31mERROR[0m in 0.01s]
[0m18:40:33.633954 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.stg_sessions
[0m18:40:33.634186 [debug] [Thread-4 (]: Marking all children of 'model.quest_kingdom.stg_sessions' to be skipped because of status 'error'.  Reason: Runtime Error in model stg_sessions (models/staging/stg_sessions.sql)
  Conversion Error: extract specifier "date" not recognized.
[0m18:40:33.634742 [debug] [MainThread]: Using duckdb connection "master"
[0m18:40:33.634888 [debug] [MainThread]: On master: BEGIN
[0m18:40:33.635006 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m18:40:33.635269 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m18:40:33.635396 [debug] [MainThread]: On master: COMMIT
[0m18:40:33.635518 [debug] [MainThread]: Using duckdb connection "master"
[0m18:40:33.635633 [debug] [MainThread]: On master: COMMIT
[0m18:40:33.635820 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m18:40:33.635950 [debug] [MainThread]: On master: Close
[0m18:40:33.636106 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:40:33.636216 [debug] [MainThread]: Connection 'model.quest_kingdom.stg_sessions' was properly closed.
[0m18:40:33.636364 [info ] [MainThread]: 
[0m18:40:33.636496 [info ] [MainThread]: Finished running 5 view models in 0 hours 0 minutes and 0.21 seconds (0.21s).
[0m18:40:33.636988 [debug] [MainThread]: Command end result
[0m18:40:33.651880 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/manifest.json
[0m18:40:33.653057 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/semantic_manifest.json
[0m18:40:33.655729 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/run_results.json
[0m18:40:33.655896 [info ] [MainThread]: 
[0m18:40:33.656073 [info ] [MainThread]: [31mCompleted with 4 errors, 0 partial successes, and 0 warnings:[0m
[0m18:40:33.656211 [info ] [MainThread]: 
[0m18:40:33.656386 [error] [MainThread]: [31mFailure in model stg_ad_impressions (models/staging/stg_ad_impressions.sql)[0m
[0m18:40:33.656552 [error] [MainThread]:   Runtime Error in model stg_ad_impressions (models/staging/stg_ad_impressions.sql)
  Parser Error: syntax error at or near "select"
  
  LINE 6:     select * from "quest_kingdom"."main"."ad_impressions"
              ^
[0m18:40:33.656677 [info ] [MainThread]: 
[0m18:40:33.656826 [info ] [MainThread]:   compiled code at target/compiled/quest_kingdom/models/staging/stg_ad_impressions.sql
[0m18:40:33.656954 [info ] [MainThread]: 
[0m18:40:33.657106 [error] [MainThread]: [31mFailure in model stg_events (models/staging/stg_events.sql)[0m
[0m18:40:33.657259 [error] [MainThread]:   Runtime Error in model stg_events (models/staging/stg_events.sql)
  Parser Error: syntax error at or near "select"
  
  LINE 6:     select * from "quest_kingdom"."main"."events"
              ^
[0m18:40:33.657377 [info ] [MainThread]: 
[0m18:40:33.657523 [info ] [MainThread]:   compiled code at target/compiled/quest_kingdom/models/staging/stg_events.sql
[0m18:40:33.657643 [info ] [MainThread]: 
[0m18:40:33.657792 [error] [MainThread]: [31mFailure in model stg_iap_transactions (models/staging/stg_iap_transactions.sql)[0m
[0m18:40:33.657945 [error] [MainThread]:   Runtime Error in model stg_iap_transactions (models/staging/stg_iap_transactions.sql)
  Parser Error: syntax error at or near "select"
  
  LINE 6:     select * from "quest_kingdom"."main"."iap_transactions"
              ^
[0m18:40:33.658064 [info ] [MainThread]: 
[0m18:40:33.658206 [info ] [MainThread]:   compiled code at target/compiled/quest_kingdom/models/staging/stg_iap_transactions.sql
[0m18:40:33.658389 [info ] [MainThread]: 
[0m18:40:33.658589 [error] [MainThread]: [31mFailure in model stg_sessions (models/staging/stg_sessions.sql)[0m
[0m18:40:33.658761 [error] [MainThread]:   Runtime Error in model stg_sessions (models/staging/stg_sessions.sql)
  Conversion Error: extract specifier "date" not recognized
[0m18:40:33.658889 [info ] [MainThread]: 
[0m18:40:33.659044 [info ] [MainThread]:   compiled code at target/compiled/quest_kingdom/models/staging/stg_sessions.sql
[0m18:40:33.659173 [info ] [MainThread]: 
[0m18:40:33.659323 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=4 SKIP=0 NO-OP=0 TOTAL=5
[0m18:40:33.660810 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 1.2862564, "process_in_blocks": "0", "process_kernel_time": 0.192593, "process_mem_max_rss": "153698304", "process_out_blocks": "0", "process_user_time": 1.723949}
[0m18:40:33.661032 [debug] [MainThread]: Command `dbt run` failed at 18:40:33.660992 after 1.29 seconds
[0m18:40:33.661210 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108973080>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108bb92e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109aef440>]}
[0m18:40:33.661387 [debug] [MainThread]: Flushing usage events
[0m18:40:33.798353 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m18:50:20.750287 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1063f9c10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106a65af0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106a65880>]}


============================== 18:50:20.755188 | cc7cff61-0951-4519-be1c-3f03c80ac37f ==============================
[0m18:50:20.755188 [info ] [MainThread]: Running with dbt=1.11.4
[0m18:50:20.755514 [debug] [MainThread]: running dbt with arguments {'log_format': 'default', 'invocation_command': 'dbt run --select staging', 'fail_fast': 'False', 'partial_parse': 'True', 'write_json': 'True', 'empty': 'False', 'version_check': 'True', 'log_cache_events': 'False', 'printer_width': '80', 'introspect': 'True', 'target_path': 'None', 'cache_selected_only': 'False', 'quiet': 'False', 'indirect_selection': 'eager', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'no_print': 'None', 'use_experimental_parser': 'False', 'warn_error': 'None', 'use_colors': 'True', 'profiles_dir': '/Users/hazeldonaldson/.dbt', 'send_anonymous_usage_stats': 'True', 'log_path': '/Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/logs', 'static_parser': 'True', 'debug': 'False'}
[0m18:50:20.938531 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'cc7cff61-0951-4519-be1c-3f03c80ac37f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106c55d30>]}
[0m18:50:20.967524 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'cc7cff61-0951-4519-be1c-3f03c80ac37f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106a20680>]}
[0m18:50:20.968934 [info ] [MainThread]: Registered adapter: duckdb=1.10.0
[0m18:50:21.020663 [debug] [MainThread]: checksum: 092b177ba87eb6bb3c55954c38aa57900eebac336561eb9ee32218428aa81d43, vars: {}, profile: , target: , version: 1.11.4
[0m18:50:21.092830 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 5 files changed.
[0m18:50:21.093332 [debug] [MainThread]: Partial parsing: updated file: quest_kingdom://models/staging/stg_iap_transactions.sql
[0m18:50:21.093566 [debug] [MainThread]: Partial parsing: updated file: quest_kingdom://models/staging/stg_sessions.sql
[0m18:50:21.093960 [debug] [MainThread]: Partial parsing: updated file: quest_kingdom://models/staging/sources.yml
[0m18:50:21.094132 [debug] [MainThread]: Partial parsing: updated file: quest_kingdom://models/staging/stg_sessions.sql
[0m18:50:21.094280 [debug] [MainThread]: Partial parsing: updated file: quest_kingdom://models/staging/stg_ad_impressions.sql
[0m18:50:21.094419 [debug] [MainThread]: Partial parsing: updated file: quest_kingdom://models/staging/stg_iap_transactions.sql
[0m18:50:21.094547 [debug] [MainThread]: Partial parsing: updated file: quest_kingdom://models/staging/stg_events.sql
[0m18:50:21.407944 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 7 unused configuration paths:
- models.core
- models.staging
- models.marts
- models.product
- models.question_kingdom
- models.monetization
- models.retention
[0m18:50:21.412880 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'cc7cff61-0951-4519-be1c-3f03c80ac37f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1073dfa70>]}
[0m18:50:21.454558 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/manifest.json
[0m18:50:21.456106 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/semantic_manifest.json
[0m18:50:21.473675 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'cc7cff61-0951-4519-be1c-3f03c80ac37f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107267020>]}
[0m18:50:21.473999 [info ] [MainThread]: Found 7 models, 23 data tests, 5 sources, 472 macros
[0m18:50:21.474177 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'cc7cff61-0951-4519-be1c-3f03c80ac37f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10723c200>]}
[0m18:50:21.475289 [info ] [MainThread]: 
[0m18:50:21.475467 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m18:50:21.475601 [info ] [MainThread]: 
[0m18:50:21.475836 [debug] [MainThread]: Acquiring new duckdb connection 'master'
[0m18:50:21.478202 [debug] [ThreadPool]: Acquiring new duckdb connection 'list_quest_kingdom'
[0m18:50:21.506705 [debug] [ThreadPool]: Using duckdb connection "list_quest_kingdom"
[0m18:50:21.506953 [debug] [ThreadPool]: On list_quest_kingdom: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "list_quest_kingdom"} */

    
    select schema_name
    from system.information_schema.schemata
    
    where lower(catalog_name) = '"quest_kingdom"'
    
  
  
[0m18:50:21.507105 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:50:21.524609 [debug] [ThreadPool]: SQL status: OK in 0.017 seconds
[0m18:50:21.525600 [debug] [ThreadPool]: On list_quest_kingdom: Close
[0m18:50:21.525952 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_quest_kingdom, now create_quest_kingdom_main)
[0m18:50:21.526166 [debug] [ThreadPool]: Creating schema "database: "quest_kingdom"
schema: "main"
"
[0m18:50:21.529424 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m18:50:21.529592 [debug] [ThreadPool]: On create_quest_kingdom_main: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "create_quest_kingdom_main"} */

    
        select type from duckdb_databases()
        where lower(database_name)='quest_kingdom'
        and type='sqlite'
    
  
[0m18:50:21.529726 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:50:21.530444 [debug] [ThreadPool]: SQL status: OK in 0.001 seconds
[0m18:50:21.531060 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m18:50:21.531196 [debug] [ThreadPool]: On create_quest_kingdom_main: BEGIN
[0m18:50:21.531534 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m18:50:21.531658 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m18:50:21.531778 [debug] [ThreadPool]: On create_quest_kingdom_main: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "create_quest_kingdom_main"} */

    
    
        create schema if not exists "quest_kingdom"."main"
    
[0m18:50:21.532283 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m18:50:21.532749 [debug] [ThreadPool]: On create_quest_kingdom_main: COMMIT
[0m18:50:21.532906 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m18:50:21.533037 [debug] [ThreadPool]: On create_quest_kingdom_main: COMMIT
[0m18:50:21.533270 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m18:50:21.533407 [debug] [ThreadPool]: On create_quest_kingdom_main: Close
[0m18:50:21.534036 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_quest_kingdom_main, now list_quest_kingdom_main)
[0m18:50:21.536696 [debug] [ThreadPool]: Using duckdb connection "list_quest_kingdom_main"
[0m18:50:21.536852 [debug] [ThreadPool]: On list_quest_kingdom_main: BEGIN
[0m18:50:21.537029 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:50:21.537278 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m18:50:21.537409 [debug] [ThreadPool]: Using duckdb connection "list_quest_kingdom_main"
[0m18:50:21.537544 [debug] [ThreadPool]: On list_quest_kingdom_main: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "list_quest_kingdom_main"} */
select
      'quest_kingdom' as database,
      table_name as name,
      table_schema as schema,
      CASE table_type
        WHEN 'BASE TABLE' THEN 'table'
        WHEN 'VIEW' THEN 'view'
        WHEN 'LOCAL TEMPORARY' THEN 'table'
        END as type
    from system.information_schema.tables
    where lower(table_schema) = 'main'
    and lower(table_catalog) = 'quest_kingdom'
  
[0m18:50:21.548417 [debug] [ThreadPool]: SQL status: OK in 0.011 seconds
[0m18:50:21.549138 [debug] [ThreadPool]: On list_quest_kingdom_main: ROLLBACK
[0m18:50:21.550122 [debug] [ThreadPool]: Failed to rollback 'list_quest_kingdom_main'
[0m18:50:21.550266 [debug] [ThreadPool]: On list_quest_kingdom_main: Close
[0m18:50:21.551007 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'cc7cff61-0951-4519-be1c-3f03c80ac37f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107114650>]}
[0m18:50:21.551236 [debug] [MainThread]: Using duckdb connection "master"
[0m18:50:21.551364 [debug] [MainThread]: On master: BEGIN
[0m18:50:21.551477 [debug] [MainThread]: Opening a new connection, currently in state init
[0m18:50:21.551731 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m18:50:21.551861 [debug] [MainThread]: On master: COMMIT
[0m18:50:21.551984 [debug] [MainThread]: Using duckdb connection "master"
[0m18:50:21.552100 [debug] [MainThread]: On master: COMMIT
[0m18:50:21.552291 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m18:50:21.552415 [debug] [MainThread]: On master: Close
[0m18:50:21.553724 [debug] [Thread-1 (]: Began running node model.quest_kingdom.stg_ad_impressions
[0m18:50:21.553976 [info ] [Thread-1 (]: 1 of 5 START sql view model main.stg_ad_impressions ............................ [RUN]
[0m18:50:21.554185 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_quest_kingdom_main, now model.quest_kingdom.stg_ad_impressions)
[0m18:50:21.554349 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.stg_ad_impressions
[0m18:50:21.558843 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.stg_ad_impressions"
[0m18:50:21.559721 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.stg_ad_impressions
[0m18:50:21.579635 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.stg_ad_impressions"
[0m18:50:21.580350 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_ad_impressions"
[0m18:50:21.580547 [debug] [Thread-1 (]: On model.quest_kingdom.stg_ad_impressions: BEGIN
[0m18:50:21.580704 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:50:21.581072 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:50:21.581225 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_ad_impressions"
[0m18:50:21.581381 [debug] [Thread-1 (]: On model.quest_kingdom.stg_ad_impressions: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.stg_ad_impressions"} */

  
  create view "quest_kingdom"."main"."stg_ad_impressions__dbt_tmp" as (
    select
    -- ids
    ad_id,
    player_id,
    session_id,
    
    -- timestamps
    ad_timestamp::timestamp as shown_at,
    
    -- dimensions
    lower(trim(ad_type)) as ad_type,
    lower(trim(ad_network)) as ad_network,
    
    -- booleans
    clicked,
    
    -- metrics
    revenue_usd,
    
    -- derived
    date_trunc('day', ad_timestamp::timestamp)::date as ad_date

from "quest_kingdom"."main"."ad_impressions"
  );

[0m18:50:21.582031 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:50:21.585250 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_ad_impressions"
[0m18:50:21.585532 [debug] [Thread-1 (]: On model.quest_kingdom.stg_ad_impressions: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.stg_ad_impressions"} */
alter view "quest_kingdom"."main"."stg_ad_impressions__dbt_tmp" rename to "stg_ad_impressions"
[0m18:50:21.586520 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m18:50:21.591277 [debug] [Thread-1 (]: On model.quest_kingdom.stg_ad_impressions: COMMIT
[0m18:50:21.591480 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_ad_impressions"
[0m18:50:21.591638 [debug] [Thread-1 (]: On model.quest_kingdom.stg_ad_impressions: COMMIT
[0m18:50:21.592201 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:50:21.594958 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_ad_impressions"
[0m18:50:21.595144 [debug] [Thread-1 (]: On model.quest_kingdom.stg_ad_impressions: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.stg_ad_impressions"} */

      drop view if exists "quest_kingdom"."main"."stg_ad_impressions__dbt_backup" cascade
    
[0m18:50:21.595626 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:50:21.596748 [debug] [Thread-1 (]: On model.quest_kingdom.stg_ad_impressions: Close
[0m18:50:21.597697 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cc7cff61-0951-4519-be1c-3f03c80ac37f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107620650>]}
[0m18:50:21.597999 [info ] [Thread-1 (]: 1 of 5 OK created sql view model main.stg_ad_impressions ....................... [[32mOK[0m in 0.04s]
[0m18:50:21.598263 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.stg_ad_impressions
[0m18:50:21.598447 [debug] [Thread-1 (]: Began running node model.quest_kingdom.stg_events
[0m18:50:21.598676 [info ] [Thread-1 (]: 2 of 5 START sql view model main.stg_events .................................... [RUN]
[0m18:50:21.598873 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.quest_kingdom.stg_ad_impressions, now model.quest_kingdom.stg_events)
[0m18:50:21.599034 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.stg_events
[0m18:50:21.600343 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.stg_events"
[0m18:50:21.600756 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.stg_events
[0m18:50:21.602546 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.stg_events"
[0m18:50:21.602975 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_events"
[0m18:50:21.603138 [debug] [Thread-1 (]: On model.quest_kingdom.stg_events: BEGIN
[0m18:50:21.603281 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:50:21.603618 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:50:21.603768 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_events"
[0m18:50:21.603923 [debug] [Thread-1 (]: On model.quest_kingdom.stg_events: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.stg_events"} */

  
  create view "quest_kingdom"."main"."stg_events__dbt_tmp" as (
    select
    -- ids
    event_id,
    player_id,
    session_id,
    
    -- timestamps
    event_timestamp::timestamp as event_at,
    
    -- dimensions
    lower(trim(event_name)) as event_name,
    
    -- json properties
    event_properties

from "quest_kingdom"."main"."events"
  );

[0m18:50:21.604455 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:50:21.605985 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_events"
[0m18:50:21.606159 [debug] [Thread-1 (]: On model.quest_kingdom.stg_events: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.stg_events"} */
alter view "quest_kingdom"."main"."stg_events__dbt_tmp" rename to "stg_events"
[0m18:50:21.606454 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:50:21.607094 [debug] [Thread-1 (]: On model.quest_kingdom.stg_events: COMMIT
[0m18:50:21.607249 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_events"
[0m18:50:21.607387 [debug] [Thread-1 (]: On model.quest_kingdom.stg_events: COMMIT
[0m18:50:21.607722 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:50:21.608819 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_events"
[0m18:50:21.608978 [debug] [Thread-1 (]: On model.quest_kingdom.stg_events: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.stg_events"} */

      drop view if exists "quest_kingdom"."main"."stg_events__dbt_backup" cascade
    
[0m18:50:21.609252 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:50:21.609841 [debug] [Thread-1 (]: On model.quest_kingdom.stg_events: Close
[0m18:50:21.610087 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cc7cff61-0951-4519-be1c-3f03c80ac37f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1076d6c30>]}
[0m18:50:21.610365 [info ] [Thread-1 (]: 2 of 5 OK created sql view model main.stg_events ............................... [[32mOK[0m in 0.01s]
[0m18:50:21.610608 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.stg_events
[0m18:50:21.610786 [debug] [Thread-1 (]: Began running node model.quest_kingdom.stg_iap_transactions
[0m18:50:21.611006 [info ] [Thread-1 (]: 3 of 5 START sql view model main.stg_iap_transactions .......................... [RUN]
[0m18:50:21.611192 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.quest_kingdom.stg_events, now model.quest_kingdom.stg_iap_transactions)
[0m18:50:21.611351 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.stg_iap_transactions
[0m18:50:21.613517 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.stg_iap_transactions"
[0m18:50:21.613883 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.stg_iap_transactions
[0m18:50:21.615407 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.stg_iap_transactions"
[0m18:50:21.615861 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_iap_transactions"
[0m18:50:21.616020 [debug] [Thread-1 (]: On model.quest_kingdom.stg_iap_transactions: BEGIN
[0m18:50:21.616167 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:50:21.616473 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:50:21.616626 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_iap_transactions"
[0m18:50:21.616788 [debug] [Thread-1 (]: On model.quest_kingdom.stg_iap_transactions: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.stg_iap_transactions"} */

  
  create view "quest_kingdom"."main"."stg_iap_transactions__dbt_tmp" as (
    select
    -- ids
    transaction_id,
    player_id,
    session_id,
    
    -- timestamps
    transaction_timestamp::timestamp as purchased_at,
    
    -- dimensions
    lower(trim(sku)) as sku,
    lower(trim(platform)) as platform,
    
    -- metrics
    price_usd,
    gems_purchased,
    
    -- derived
    date_trunc('day', transaction_timestamp::timestamp)::date as purchase_date

from "quest_kingdom"."main"."iap_transactions"
  );

[0m18:50:21.617346 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:50:21.619130 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_iap_transactions"
[0m18:50:21.619576 [debug] [Thread-1 (]: On model.quest_kingdom.stg_iap_transactions: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.stg_iap_transactions"} */
alter view "quest_kingdom"."main"."stg_iap_transactions__dbt_tmp" rename to "stg_iap_transactions"
[0m18:50:21.620121 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:50:21.623595 [debug] [Thread-1 (]: On model.quest_kingdom.stg_iap_transactions: COMMIT
[0m18:50:21.623790 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_iap_transactions"
[0m18:50:21.623947 [debug] [Thread-1 (]: On model.quest_kingdom.stg_iap_transactions: COMMIT
[0m18:50:21.624395 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:50:21.625627 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_iap_transactions"
[0m18:50:21.625807 [debug] [Thread-1 (]: On model.quest_kingdom.stg_iap_transactions: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.stg_iap_transactions"} */

      drop view if exists "quest_kingdom"."main"."stg_iap_transactions__dbt_backup" cascade
    
[0m18:50:21.626107 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:50:21.626722 [debug] [Thread-1 (]: On model.quest_kingdom.stg_iap_transactions: Close
[0m18:50:21.626973 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cc7cff61-0951-4519-be1c-3f03c80ac37f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107721910>]}
[0m18:50:21.627252 [info ] [Thread-1 (]: 3 of 5 OK created sql view model main.stg_iap_transactions ..................... [[32mOK[0m in 0.02s]
[0m18:50:21.627498 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.stg_iap_transactions
[0m18:50:21.627675 [debug] [Thread-1 (]: Began running node model.quest_kingdom.stg_players
[0m18:50:21.627897 [info ] [Thread-1 (]: 4 of 5 START sql view model main.stg_players ................................... [RUN]
[0m18:50:21.628084 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.quest_kingdom.stg_iap_transactions, now model.quest_kingdom.stg_players)
[0m18:50:21.628244 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.stg_players
[0m18:50:21.629680 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.stg_players"
[0m18:50:21.630209 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.stg_players
[0m18:50:21.631803 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.stg_players"
[0m18:50:21.632112 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_players"
[0m18:50:21.632262 [debug] [Thread-1 (]: On model.quest_kingdom.stg_players: BEGIN
[0m18:50:21.632400 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:50:21.632682 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:50:21.632829 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_players"
[0m18:50:21.632989 [debug] [Thread-1 (]: On model.quest_kingdom.stg_players: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.stg_players"} */

  
  create view "quest_kingdom"."main"."stg_players__dbt_tmp" as (
    with source as (
    select * from "quest_kingdom"."main"."players"
),

renamed as (
    select
        player_id,
        install_date::date as installed_at,
        --dimensions
        lower(trim(attribution_channel)) as attribution_channel,
        lower(trim(country)) as country,
        lower(trim(device_type)) as device_type,
        lower(trim(player_segment)) as player_segment,
        lower(trim(experiment_variant)) as experiment_variant,
        --booleans
        tutorial_completed,
        --metrics
        lifetime_value as lifetime_value_usd
    from source 
)

select * from renamed
  );

[0m18:50:21.633599 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:50:21.635311 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_players"
[0m18:50:21.635575 [debug] [Thread-1 (]: On model.quest_kingdom.stg_players: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.stg_players"} */
alter view "quest_kingdom"."main"."stg_players" rename to "stg_players__dbt_backup"
[0m18:50:21.636025 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:50:21.637534 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_players"
[0m18:50:21.637706 [debug] [Thread-1 (]: On model.quest_kingdom.stg_players: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.stg_players"} */
alter view "quest_kingdom"."main"."stg_players__dbt_tmp" rename to "stg_players"
[0m18:50:21.638003 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:50:21.639719 [debug] [Thread-1 (]: On model.quest_kingdom.stg_players: COMMIT
[0m18:50:21.639894 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_players"
[0m18:50:21.640040 [debug] [Thread-1 (]: On model.quest_kingdom.stg_players: COMMIT
[0m18:50:21.640452 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:50:21.641553 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_players"
[0m18:50:21.641708 [debug] [Thread-1 (]: On model.quest_kingdom.stg_players: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.stg_players"} */

      drop view if exists "quest_kingdom"."main"."stg_players__dbt_backup" cascade
    
[0m18:50:21.642035 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:50:21.642627 [debug] [Thread-1 (]: On model.quest_kingdom.stg_players: Close
[0m18:50:21.642876 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cc7cff61-0951-4519-be1c-3f03c80ac37f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1076726f0>]}
[0m18:50:21.643159 [info ] [Thread-1 (]: 4 of 5 OK created sql view model main.stg_players .............................. [[32mOK[0m in 0.01s]
[0m18:50:21.643407 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.stg_players
[0m18:50:21.643592 [debug] [Thread-1 (]: Began running node model.quest_kingdom.stg_sessions
[0m18:50:21.643813 [info ] [Thread-1 (]: 5 of 5 START sql view model main.stg_sessions .................................. [RUN]
[0m18:50:21.644001 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.quest_kingdom.stg_players, now model.quest_kingdom.stg_sessions)
[0m18:50:21.644157 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.stg_sessions
[0m18:50:21.645552 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.stg_sessions"
[0m18:50:21.646205 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.stg_sessions
[0m18:50:21.648713 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.stg_sessions"
[0m18:50:21.649023 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_sessions"
[0m18:50:21.649176 [debug] [Thread-1 (]: On model.quest_kingdom.stg_sessions: BEGIN
[0m18:50:21.649315 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:50:21.649618 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:50:21.649765 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_sessions"
[0m18:50:21.649928 [debug] [Thread-1 (]: On model.quest_kingdom.stg_sessions: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.stg_sessions"} */

  
  create view "quest_kingdom"."main"."stg_sessions__dbt_tmp" as (
    with source as (
    select * from "quest_kingdom"."main"."sessions"
),

renamed as (
    select 
        session_id,
        player_id,
        --timestamps
        session_start::timestamp as session_started_at,
        session_end::timestamp as session_ended_at,

        --metrics
        session_duration_minutes,
        starting_level,
        ending_level,
        levels_gained,

        --derived metrics
        extract(hour from session_start::timestamp) as session_hour,
        extract(dow from session_start::timestamp) as session_day_of_week,
        date_trunc('date', session_start::timestamp)::date as session_date 
    from source
)

select * renamed
  );

[0m18:50:21.654035 [debug] [Thread-1 (]: DuckDB adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.stg_sessions"} */

  
  create view "quest_kingdom"."main"."stg_sessions__dbt_tmp" as (
    with source as (
    select * from "quest_kingdom"."main"."sessions"
),

renamed as (
    select 
        session_id,
        player_id,
        --timestamps
        session_start::timestamp as session_started_at,
        session_end::timestamp as session_ended_at,

        --metrics
        session_duration_minutes,
        starting_level,
        ending_level,
        levels_gained,

        --derived metrics
        extract(hour from session_start::timestamp) as session_hour,
        extract(dow from session_start::timestamp) as session_day_of_week,
        date_trunc('date', session_start::timestamp)::date as session_date 
    from source
)

select * renamed
  );

[0m18:50:21.654293 [debug] [Thread-1 (]: DuckDB adapter: Rolling back transaction.
[0m18:50:21.654513 [debug] [Thread-1 (]: On model.quest_kingdom.stg_sessions: ROLLBACK
[0m18:50:21.658777 [debug] [Thread-1 (]: Failed to rollback 'model.quest_kingdom.stg_sessions'
[0m18:50:21.658970 [debug] [Thread-1 (]: On model.quest_kingdom.stg_sessions: Close
[0m18:50:21.660147 [debug] [Thread-1 (]: Runtime Error in model stg_sessions (models/staging/stg_sessions.sql)
  Conversion Error: extract specifier "date" not recognized
[0m18:50:21.660373 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cc7cff61-0951-4519-be1c-3f03c80ac37f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107741ee0>]}
[0m18:50:21.660672 [error] [Thread-1 (]: 5 of 5 ERROR creating sql view model main.stg_sessions ......................... [[31mERROR[0m in 0.02s]
[0m18:50:21.660924 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.stg_sessions
[0m18:50:21.661169 [debug] [Thread-4 (]: Marking all children of 'model.quest_kingdom.stg_sessions' to be skipped because of status 'error'.  Reason: Runtime Error in model stg_sessions (models/staging/stg_sessions.sql)
  Conversion Error: extract specifier "date" not recognized.
[0m18:50:21.662003 [debug] [MainThread]: Using duckdb connection "master"
[0m18:50:21.662148 [debug] [MainThread]: On master: BEGIN
[0m18:50:21.662266 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m18:50:21.662568 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m18:50:21.662695 [debug] [MainThread]: On master: COMMIT
[0m18:50:21.662816 [debug] [MainThread]: Using duckdb connection "master"
[0m18:50:21.662930 [debug] [MainThread]: On master: COMMIT
[0m18:50:21.663128 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m18:50:21.663253 [debug] [MainThread]: On master: Close
[0m18:50:21.663414 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:50:21.663528 [debug] [MainThread]: Connection 'model.quest_kingdom.stg_sessions' was properly closed.
[0m18:50:21.663683 [info ] [MainThread]: 
[0m18:50:21.663818 [info ] [MainThread]: Finished running 5 view models in 0 hours 0 minutes and 0.19 seconds (0.19s).
[0m18:50:21.664310 [debug] [MainThread]: Command end result
[0m18:50:21.677463 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/manifest.json
[0m18:50:21.678524 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/semantic_manifest.json
[0m18:50:21.681449 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/run_results.json
[0m18:50:21.681628 [info ] [MainThread]: 
[0m18:50:21.681810 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m18:50:21.681959 [info ] [MainThread]: 
[0m18:50:21.682143 [error] [MainThread]: [31mFailure in model stg_sessions (models/staging/stg_sessions.sql)[0m
[0m18:50:21.682309 [error] [MainThread]:   Runtime Error in model stg_sessions (models/staging/stg_sessions.sql)
  Conversion Error: extract specifier "date" not recognized
[0m18:50:21.682432 [info ] [MainThread]: 
[0m18:50:21.682577 [info ] [MainThread]:   compiled code at target/compiled/quest_kingdom/models/staging/stg_sessions.sql
[0m18:50:21.682705 [info ] [MainThread]: 
[0m18:50:21.682847 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=5
[0m18:50:21.684224 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.9751828, "process_in_blocks": "0", "process_kernel_time": 0.207678, "process_mem_max_rss": "150339584", "process_out_blocks": "0", "process_user_time": 1.400978}
[0m18:50:21.684428 [debug] [MainThread]: Command `dbt run` failed at 18:50:21.684391 after 0.98 seconds
[0m18:50:21.684596 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106a658b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106a65bb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1067163c0>]}
[0m18:50:21.684754 [debug] [MainThread]: Flushing usage events
[0m18:50:21.815477 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m18:50:58.933742 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106601f40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106cddc40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106cdd9d0>]}


============================== 18:50:58.937078 | 64a175e6-a78f-44f8-8715-fa4efb7b4bd0 ==============================
[0m18:50:58.937078 [info ] [MainThread]: Running with dbt=1.11.4
[0m18:50:58.937408 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_path': '/Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/logs', 'indirect_selection': 'eager', 'introspect': 'True', 'write_json': 'True', 'target_path': 'None', 'use_experimental_parser': 'False', 'partial_parse': 'True', 'profiles_dir': '/Users/hazeldonaldson/.dbt', 'debug': 'False', 'no_print': 'None', 'log_cache_events': 'False', 'use_colors': 'True', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'send_anonymous_usage_stats': 'True', 'invocation_command': 'dbt run --select staging', 'static_parser': 'True', 'empty': 'False', 'log_format': 'default', 'cache_selected_only': 'False', 'quiet': 'False'}
[0m18:50:59.107537 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '64a175e6-a78f-44f8-8715-fa4efb7b4bd0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106e7a990>]}
[0m18:50:59.136368 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '64a175e6-a78f-44f8-8715-fa4efb7b4bd0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106a3dd00>]}
[0m18:50:59.137629 [info ] [MainThread]: Registered adapter: duckdb=1.10.0
[0m18:50:59.189175 [debug] [MainThread]: checksum: 092b177ba87eb6bb3c55954c38aa57900eebac336561eb9ee32218428aa81d43, vars: {}, profile: , target: , version: 1.11.4
[0m18:50:59.255015 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m18:50:59.255437 [debug] [MainThread]: Partial parsing: updated file: quest_kingdom://models/staging/stg_sessions.sql
[0m18:50:59.456170 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 7 unused configuration paths:
- models.staging
- models.question_kingdom
- models.product
- models.core
- models.marts
- models.monetization
- models.retention
[0m18:50:59.463932 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '64a175e6-a78f-44f8-8715-fa4efb7b4bd0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107413410>]}
[0m18:50:59.544437 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/manifest.json
[0m18:50:59.545884 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/semantic_manifest.json
[0m18:50:59.558580 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '64a175e6-a78f-44f8-8715-fa4efb7b4bd0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1075b0aa0>]}
[0m18:50:59.558878 [info ] [MainThread]: Found 7 models, 23 data tests, 5 sources, 472 macros
[0m18:50:59.559055 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '64a175e6-a78f-44f8-8715-fa4efb7b4bd0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10754b590>]}
[0m18:50:59.560069 [info ] [MainThread]: 
[0m18:50:59.560250 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m18:50:59.560385 [info ] [MainThread]: 
[0m18:50:59.560612 [debug] [MainThread]: Acquiring new duckdb connection 'master'
[0m18:50:59.562929 [debug] [ThreadPool]: Acquiring new duckdb connection 'list_quest_kingdom'
[0m18:50:59.591001 [debug] [ThreadPool]: Using duckdb connection "list_quest_kingdom"
[0m18:50:59.591256 [debug] [ThreadPool]: On list_quest_kingdom: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "list_quest_kingdom"} */

    
    select schema_name
    from system.information_schema.schemata
    
    where lower(catalog_name) = '"quest_kingdom"'
    
  
  
[0m18:50:59.591408 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:50:59.609899 [debug] [ThreadPool]: SQL status: OK in 0.018 seconds
[0m18:50:59.611119 [debug] [ThreadPool]: On list_quest_kingdom: Close
[0m18:50:59.611512 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_quest_kingdom, now create_quest_kingdom_main)
[0m18:50:59.611766 [debug] [ThreadPool]: Creating schema "database: "quest_kingdom"
schema: "main"
"
[0m18:50:59.615162 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m18:50:59.615355 [debug] [ThreadPool]: On create_quest_kingdom_main: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "create_quest_kingdom_main"} */

    
        select type from duckdb_databases()
        where lower(database_name)='quest_kingdom'
        and type='sqlite'
    
  
[0m18:50:59.615495 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:50:59.616282 [debug] [ThreadPool]: SQL status: OK in 0.001 seconds
[0m18:50:59.617110 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m18:50:59.617265 [debug] [ThreadPool]: On create_quest_kingdom_main: BEGIN
[0m18:50:59.617506 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m18:50:59.617639 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m18:50:59.617766 [debug] [ThreadPool]: On create_quest_kingdom_main: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "create_quest_kingdom_main"} */

    
    
        create schema if not exists "quest_kingdom"."main"
    
[0m18:50:59.618184 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m18:50:59.618570 [debug] [ThreadPool]: On create_quest_kingdom_main: COMMIT
[0m18:50:59.618707 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m18:50:59.618827 [debug] [ThreadPool]: On create_quest_kingdom_main: COMMIT
[0m18:50:59.619034 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m18:50:59.619257 [debug] [ThreadPool]: On create_quest_kingdom_main: Close
[0m18:50:59.619995 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_quest_kingdom_main, now list_quest_kingdom_main)
[0m18:50:59.622785 [debug] [ThreadPool]: Using duckdb connection "list_quest_kingdom_main"
[0m18:50:59.622951 [debug] [ThreadPool]: On list_quest_kingdom_main: BEGIN
[0m18:50:59.623138 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:50:59.623416 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m18:50:59.623552 [debug] [ThreadPool]: Using duckdb connection "list_quest_kingdom_main"
[0m18:50:59.623688 [debug] [ThreadPool]: On list_quest_kingdom_main: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "list_quest_kingdom_main"} */
select
      'quest_kingdom' as database,
      table_name as name,
      table_schema as schema,
      CASE table_type
        WHEN 'BASE TABLE' THEN 'table'
        WHEN 'VIEW' THEN 'view'
        WHEN 'LOCAL TEMPORARY' THEN 'table'
        END as type
    from system.information_schema.tables
    where lower(table_schema) = 'main'
    and lower(table_catalog) = 'quest_kingdom'
  
[0m18:50:59.634960 [debug] [ThreadPool]: SQL status: OK in 0.011 seconds
[0m18:50:59.635857 [debug] [ThreadPool]: On list_quest_kingdom_main: ROLLBACK
[0m18:50:59.636875 [debug] [ThreadPool]: Failed to rollback 'list_quest_kingdom_main'
[0m18:50:59.637029 [debug] [ThreadPool]: On list_quest_kingdom_main: Close
[0m18:50:59.637862 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '64a175e6-a78f-44f8-8715-fa4efb7b4bd0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107587a70>]}
[0m18:50:59.638140 [debug] [MainThread]: Using duckdb connection "master"
[0m18:50:59.638293 [debug] [MainThread]: On master: BEGIN
[0m18:50:59.638425 [debug] [MainThread]: Opening a new connection, currently in state init
[0m18:50:59.638739 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m18:50:59.638877 [debug] [MainThread]: On master: COMMIT
[0m18:50:59.639005 [debug] [MainThread]: Using duckdb connection "master"
[0m18:50:59.639121 [debug] [MainThread]: On master: COMMIT
[0m18:50:59.639326 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m18:50:59.639455 [debug] [MainThread]: On master: Close
[0m18:50:59.640833 [debug] [Thread-1 (]: Began running node model.quest_kingdom.stg_ad_impressions
[0m18:50:59.641077 [info ] [Thread-1 (]: 1 of 5 START sql view model main.stg_ad_impressions ............................ [RUN]
[0m18:50:59.641282 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_quest_kingdom_main, now model.quest_kingdom.stg_ad_impressions)
[0m18:50:59.641444 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.stg_ad_impressions
[0m18:50:59.645045 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.stg_ad_impressions"
[0m18:50:59.646044 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.stg_ad_impressions
[0m18:50:59.661546 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.stg_ad_impressions"
[0m18:50:59.662113 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_ad_impressions"
[0m18:50:59.662292 [debug] [Thread-1 (]: On model.quest_kingdom.stg_ad_impressions: BEGIN
[0m18:50:59.662444 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:50:59.662802 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:50:59.662949 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_ad_impressions"
[0m18:50:59.663105 [debug] [Thread-1 (]: On model.quest_kingdom.stg_ad_impressions: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.stg_ad_impressions"} */

  
  create view "quest_kingdom"."main"."stg_ad_impressions__dbt_tmp" as (
    select
    -- ids
    ad_id,
    player_id,
    session_id,
    
    -- timestamps
    ad_timestamp::timestamp as shown_at,
    
    -- dimensions
    lower(trim(ad_type)) as ad_type,
    lower(trim(ad_network)) as ad_network,
    
    -- booleans
    clicked,
    
    -- metrics
    revenue_usd,
    
    -- derived
    date_trunc('day', ad_timestamp::timestamp)::date as ad_date

from "quest_kingdom"."main"."ad_impressions"
  );

[0m18:50:59.663808 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m18:50:59.667394 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_ad_impressions"
[0m18:50:59.667751 [debug] [Thread-1 (]: On model.quest_kingdom.stg_ad_impressions: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.stg_ad_impressions"} */
alter view "quest_kingdom"."main"."stg_ad_impressions" rename to "stg_ad_impressions__dbt_backup"
[0m18:50:59.668636 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m18:50:59.673517 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_ad_impressions"
[0m18:50:59.673739 [debug] [Thread-1 (]: On model.quest_kingdom.stg_ad_impressions: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.stg_ad_impressions"} */
alter view "quest_kingdom"."main"."stg_ad_impressions__dbt_tmp" rename to "stg_ad_impressions"
[0m18:50:59.674145 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:50:59.680586 [debug] [Thread-1 (]: On model.quest_kingdom.stg_ad_impressions: COMMIT
[0m18:50:59.680937 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_ad_impressions"
[0m18:50:59.681104 [debug] [Thread-1 (]: On model.quest_kingdom.stg_ad_impressions: COMMIT
[0m18:50:59.681945 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m18:50:59.684772 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_ad_impressions"
[0m18:50:59.684982 [debug] [Thread-1 (]: On model.quest_kingdom.stg_ad_impressions: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.stg_ad_impressions"} */

      drop view if exists "quest_kingdom"."main"."stg_ad_impressions__dbt_backup" cascade
    
[0m18:50:59.685628 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:50:59.686966 [debug] [Thread-1 (]: On model.quest_kingdom.stg_ad_impressions: Close
[0m18:50:59.687980 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '64a175e6-a78f-44f8-8715-fa4efb7b4bd0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107907f20>]}
[0m18:50:59.688313 [info ] [Thread-1 (]: 1 of 5 OK created sql view model main.stg_ad_impressions ....................... [[32mOK[0m in 0.05s]
[0m18:50:59.688590 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.stg_ad_impressions
[0m18:50:59.688783 [debug] [Thread-1 (]: Began running node model.quest_kingdom.stg_events
[0m18:50:59.689021 [info ] [Thread-1 (]: 2 of 5 START sql view model main.stg_events .................................... [RUN]
[0m18:50:59.689225 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.quest_kingdom.stg_ad_impressions, now model.quest_kingdom.stg_events)
[0m18:50:59.689388 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.stg_events
[0m18:50:59.690788 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.stg_events"
[0m18:50:59.691270 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.stg_events
[0m18:50:59.692834 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.stg_events"
[0m18:50:59.693164 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_events"
[0m18:50:59.693325 [debug] [Thread-1 (]: On model.quest_kingdom.stg_events: BEGIN
[0m18:50:59.693473 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:50:59.693848 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:50:59.693997 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_events"
[0m18:50:59.694153 [debug] [Thread-1 (]: On model.quest_kingdom.stg_events: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.stg_events"} */

  
  create view "quest_kingdom"."main"."stg_events__dbt_tmp" as (
    select
    -- ids
    event_id,
    player_id,
    session_id,
    
    -- timestamps
    event_timestamp::timestamp as event_at,
    
    -- dimensions
    lower(trim(event_name)) as event_name,
    
    -- json properties
    event_properties

from "quest_kingdom"."main"."events"
  );

[0m18:50:59.694575 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:50:59.696415 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_events"
[0m18:50:59.696621 [debug] [Thread-1 (]: On model.quest_kingdom.stg_events: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.stg_events"} */
alter view "quest_kingdom"."main"."stg_events" rename to "stg_events__dbt_backup"
[0m18:50:59.697002 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:50:59.698411 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_events"
[0m18:50:59.698578 [debug] [Thread-1 (]: On model.quest_kingdom.stg_events: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.stg_events"} */
alter view "quest_kingdom"."main"."stg_events__dbt_tmp" rename to "stg_events"
[0m18:50:59.698869 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:50:59.699577 [debug] [Thread-1 (]: On model.quest_kingdom.stg_events: COMMIT
[0m18:50:59.699745 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_events"
[0m18:50:59.699894 [debug] [Thread-1 (]: On model.quest_kingdom.stg_events: COMMIT
[0m18:50:59.700311 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:50:59.701442 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_events"
[0m18:50:59.701609 [debug] [Thread-1 (]: On model.quest_kingdom.stg_events: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.stg_events"} */

      drop view if exists "quest_kingdom"."main"."stg_events__dbt_backup" cascade
    
[0m18:50:59.701995 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:50:59.702773 [debug] [Thread-1 (]: On model.quest_kingdom.stg_events: Close
[0m18:50:59.703192 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '64a175e6-a78f-44f8-8715-fa4efb7b4bd0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107879e80>]}
[0m18:50:59.703732 [info ] [Thread-1 (]: 2 of 5 OK created sql view model main.stg_events ............................... [[32mOK[0m in 0.01s]
[0m18:50:59.704249 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.stg_events
[0m18:50:59.704655 [debug] [Thread-1 (]: Began running node model.quest_kingdom.stg_iap_transactions
[0m18:50:59.704980 [info ] [Thread-1 (]: 3 of 5 START sql view model main.stg_iap_transactions .......................... [RUN]
[0m18:50:59.705383 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.quest_kingdom.stg_events, now model.quest_kingdom.stg_iap_transactions)
[0m18:50:59.705609 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.stg_iap_transactions
[0m18:50:59.707118 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.stg_iap_transactions"
[0m18:50:59.707484 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.stg_iap_transactions
[0m18:50:59.709104 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.stg_iap_transactions"
[0m18:50:59.709550 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_iap_transactions"
[0m18:50:59.709708 [debug] [Thread-1 (]: On model.quest_kingdom.stg_iap_transactions: BEGIN
[0m18:50:59.709853 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:50:59.710212 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:50:59.710502 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_iap_transactions"
[0m18:50:59.710697 [debug] [Thread-1 (]: On model.quest_kingdom.stg_iap_transactions: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.stg_iap_transactions"} */

  
  create view "quest_kingdom"."main"."stg_iap_transactions__dbt_tmp" as (
    select
    -- ids
    transaction_id,
    player_id,
    session_id,
    
    -- timestamps
    transaction_timestamp::timestamp as purchased_at,
    
    -- dimensions
    lower(trim(sku)) as sku,
    lower(trim(platform)) as platform,
    
    -- metrics
    price_usd,
    gems_purchased,
    
    -- derived
    date_trunc('day', transaction_timestamp::timestamp)::date as purchase_date

from "quest_kingdom"."main"."iap_transactions"
  );

[0m18:50:59.711199 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:50:59.712778 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_iap_transactions"
[0m18:50:59.712957 [debug] [Thread-1 (]: On model.quest_kingdom.stg_iap_transactions: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.stg_iap_transactions"} */
alter view "quest_kingdom"."main"."stg_iap_transactions" rename to "stg_iap_transactions__dbt_backup"
[0m18:50:59.713268 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:50:59.715624 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_iap_transactions"
[0m18:50:59.715806 [debug] [Thread-1 (]: On model.quest_kingdom.stg_iap_transactions: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.stg_iap_transactions"} */
alter view "quest_kingdom"."main"."stg_iap_transactions__dbt_tmp" rename to "stg_iap_transactions"
[0m18:50:59.716115 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:50:59.716826 [debug] [Thread-1 (]: On model.quest_kingdom.stg_iap_transactions: COMMIT
[0m18:50:59.716999 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_iap_transactions"
[0m18:50:59.717148 [debug] [Thread-1 (]: On model.quest_kingdom.stg_iap_transactions: COMMIT
[0m18:50:59.717524 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:50:59.718586 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_iap_transactions"
[0m18:50:59.718749 [debug] [Thread-1 (]: On model.quest_kingdom.stg_iap_transactions: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.stg_iap_transactions"} */

      drop view if exists "quest_kingdom"."main"."stg_iap_transactions__dbt_backup" cascade
    
[0m18:50:59.719072 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:50:59.719863 [debug] [Thread-1 (]: On model.quest_kingdom.stg_iap_transactions: Close
[0m18:50:59.720402 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '64a175e6-a78f-44f8-8715-fa4efb7b4bd0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10793a8d0>]}
[0m18:50:59.720795 [info ] [Thread-1 (]: 3 of 5 OK created sql view model main.stg_iap_transactions ..................... [[32mOK[0m in 0.02s]
[0m18:50:59.721056 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.stg_iap_transactions
[0m18:50:59.721235 [debug] [Thread-1 (]: Began running node model.quest_kingdom.stg_players
[0m18:50:59.721452 [info ] [Thread-1 (]: 4 of 5 START sql view model main.stg_players ................................... [RUN]
[0m18:50:59.721686 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.quest_kingdom.stg_iap_transactions, now model.quest_kingdom.stg_players)
[0m18:50:59.721873 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.stg_players
[0m18:50:59.723381 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.stg_players"
[0m18:50:59.723787 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.stg_players
[0m18:50:59.725357 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.stg_players"
[0m18:50:59.725948 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_players"
[0m18:50:59.726123 [debug] [Thread-1 (]: On model.quest_kingdom.stg_players: BEGIN
[0m18:50:59.726270 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:50:59.726632 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:50:59.726851 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_players"
[0m18:50:59.727018 [debug] [Thread-1 (]: On model.quest_kingdom.stg_players: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.stg_players"} */

  
  create view "quest_kingdom"."main"."stg_players__dbt_tmp" as (
    with source as (
    select * from "quest_kingdom"."main"."players"
),

renamed as (
    select
        player_id,
        install_date::date as installed_at,
        --dimensions
        lower(trim(attribution_channel)) as attribution_channel,
        lower(trim(country)) as country,
        lower(trim(device_type)) as device_type,
        lower(trim(player_segment)) as player_segment,
        lower(trim(experiment_variant)) as experiment_variant,
        --booleans
        tutorial_completed,
        --metrics
        lifetime_value as lifetime_value_usd
    from source 
)

select * from renamed
  );

[0m18:50:59.727704 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m18:50:59.729457 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_players"
[0m18:50:59.729647 [debug] [Thread-1 (]: On model.quest_kingdom.stg_players: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.stg_players"} */
alter view "quest_kingdom"."main"."stg_players" rename to "stg_players__dbt_backup"
[0m18:50:59.729984 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:50:59.731387 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_players"
[0m18:50:59.731559 [debug] [Thread-1 (]: On model.quest_kingdom.stg_players: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.stg_players"} */
alter view "quest_kingdom"."main"."stg_players__dbt_tmp" rename to "stg_players"
[0m18:50:59.731851 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:50:59.732554 [debug] [Thread-1 (]: On model.quest_kingdom.stg_players: COMMIT
[0m18:50:59.732718 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_players"
[0m18:50:59.732863 [debug] [Thread-1 (]: On model.quest_kingdom.stg_players: COMMIT
[0m18:50:59.733252 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:50:59.734325 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_players"
[0m18:50:59.734480 [debug] [Thread-1 (]: On model.quest_kingdom.stg_players: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.stg_players"} */

      drop view if exists "quest_kingdom"."main"."stg_players__dbt_backup" cascade
    
[0m18:50:59.734807 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:50:59.735396 [debug] [Thread-1 (]: On model.quest_kingdom.stg_players: Close
[0m18:50:59.735650 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '64a175e6-a78f-44f8-8715-fa4efb7b4bd0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1079007a0>]}
[0m18:50:59.736016 [info ] [Thread-1 (]: 4 of 5 OK created sql view model main.stg_players .............................. [[32mOK[0m in 0.01s]
[0m18:50:59.736309 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.stg_players
[0m18:50:59.736501 [debug] [Thread-1 (]: Began running node model.quest_kingdom.stg_sessions
[0m18:50:59.736812 [info ] [Thread-1 (]: 5 of 5 START sql view model main.stg_sessions .................................. [RUN]
[0m18:50:59.737081 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.quest_kingdom.stg_players, now model.quest_kingdom.stg_sessions)
[0m18:50:59.737307 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.stg_sessions
[0m18:50:59.738882 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.stg_sessions"
[0m18:50:59.739526 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.stg_sessions
[0m18:50:59.741146 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.stg_sessions"
[0m18:50:59.741481 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_sessions"
[0m18:50:59.741644 [debug] [Thread-1 (]: On model.quest_kingdom.stg_sessions: BEGIN
[0m18:50:59.741788 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:50:59.742137 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:50:59.742321 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_sessions"
[0m18:50:59.742485 [debug] [Thread-1 (]: On model.quest_kingdom.stg_sessions: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.stg_sessions"} */

  
  create view "quest_kingdom"."main"."stg_sessions__dbt_tmp" as (
    with source as (
    select * from "quest_kingdom"."main"."sessions"
),

renamed as (
    select 
        session_id,
        player_id,
        --timestamps
        session_start::timestamp as session_started_at,
        session_end::timestamp as session_ended_at,

        --metrics
        session_duration_minutes,
        starting_level,
        ending_level,
        levels_gained,

        --derived metrics
        extract(hour from session_start::timestamp) as session_hour,
        extract(dow from session_start::timestamp) as session_day_of_week,
        date_trunc('day', session_start::timestamp)::date as session_date 
    from source
)

select * renamed
  );

[0m18:50:59.745683 [debug] [Thread-1 (]: DuckDB adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.stg_sessions"} */

  
  create view "quest_kingdom"."main"."stg_sessions__dbt_tmp" as (
    with source as (
    select * from "quest_kingdom"."main"."sessions"
),

renamed as (
    select 
        session_id,
        player_id,
        --timestamps
        session_start::timestamp as session_started_at,
        session_end::timestamp as session_ended_at,

        --metrics
        session_duration_minutes,
        starting_level,
        ending_level,
        levels_gained,

        --derived metrics
        extract(hour from session_start::timestamp) as session_hour,
        extract(dow from session_start::timestamp) as session_day_of_week,
        date_trunc('day', session_start::timestamp)::date as session_date 
    from source
)

select * renamed
  );

[0m18:50:59.745898 [debug] [Thread-1 (]: DuckDB adapter: Rolling back transaction.
[0m18:50:59.746116 [debug] [Thread-1 (]: On model.quest_kingdom.stg_sessions: ROLLBACK
[0m18:50:59.750437 [debug] [Thread-1 (]: Failed to rollback 'model.quest_kingdom.stg_sessions'
[0m18:50:59.750623 [debug] [Thread-1 (]: On model.quest_kingdom.stg_sessions: Close
[0m18:50:59.751815 [debug] [Thread-1 (]: Runtime Error in model stg_sessions (models/staging/stg_sessions.sql)
  Binder Error: * expression without FROM clause!
[0m18:50:59.752044 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '64a175e6-a78f-44f8-8715-fa4efb7b4bd0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107699970>]}
[0m18:50:59.752357 [error] [Thread-1 (]: 5 of 5 ERROR creating sql view model main.stg_sessions ......................... [[31mERROR[0m in 0.01s]
[0m18:50:59.752902 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.stg_sessions
[0m18:50:59.753370 [debug] [Thread-4 (]: Marking all children of 'model.quest_kingdom.stg_sessions' to be skipped because of status 'error'.  Reason: Runtime Error in model stg_sessions (models/staging/stg_sessions.sql)
  Binder Error: * expression without FROM clause!.
[0m18:50:59.754522 [debug] [MainThread]: Using duckdb connection "master"
[0m18:50:59.754703 [debug] [MainThread]: On master: BEGIN
[0m18:50:59.754834 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m18:50:59.755204 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m18:50:59.755358 [debug] [MainThread]: On master: COMMIT
[0m18:50:59.755489 [debug] [MainThread]: Using duckdb connection "master"
[0m18:50:59.755610 [debug] [MainThread]: On master: COMMIT
[0m18:50:59.755826 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m18:50:59.755959 [debug] [MainThread]: On master: Close
[0m18:50:59.756131 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:50:59.756252 [debug] [MainThread]: Connection 'model.quest_kingdom.stg_sessions' was properly closed.
[0m18:50:59.756414 [info ] [MainThread]: 
[0m18:50:59.756561 [info ] [MainThread]: Finished running 5 view models in 0 hours 0 minutes and 0.20 seconds (0.20s).
[0m18:50:59.757061 [debug] [MainThread]: Command end result
[0m18:50:59.771165 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/manifest.json
[0m18:50:59.772290 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/semantic_manifest.json
[0m18:50:59.775287 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/run_results.json
[0m18:50:59.775463 [info ] [MainThread]: 
[0m18:50:59.775649 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m18:50:59.775796 [info ] [MainThread]: 
[0m18:50:59.775972 [error] [MainThread]: [31mFailure in model stg_sessions (models/staging/stg_sessions.sql)[0m
[0m18:50:59.776132 [error] [MainThread]:   Runtime Error in model stg_sessions (models/staging/stg_sessions.sql)
  Binder Error: * expression without FROM clause!
[0m18:50:59.776251 [info ] [MainThread]: 
[0m18:50:59.776395 [info ] [MainThread]:   compiled code at target/compiled/quest_kingdom/models/staging/stg_sessions.sql
[0m18:50:59.776522 [info ] [MainThread]: 
[0m18:50:59.776805 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=5
[0m18:50:59.779113 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.88421965, "process_in_blocks": "0", "process_kernel_time": 0.18468, "process_mem_max_rss": "150028288", "process_out_blocks": "0", "process_user_time": 1.316104}
[0m18:50:59.779402 [debug] [MainThread]: Command `dbt run` failed at 18:50:59.779359 after 0.88 seconds
[0m18:50:59.779601 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1078d3170>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106cddac0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106cddaf0>]}
[0m18:50:59.779778 [debug] [MainThread]: Flushing usage events
[0m18:50:59.905615 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m18:51:38.857762 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1043df6e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104c79940>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104c79400>]}


============================== 18:51:38.861607 | 7f539c1b-eadf-4316-b5ff-1e729e815bc3 ==============================
[0m18:51:38.861607 [info ] [MainThread]: Running with dbt=1.11.4
[0m18:51:38.861958 [debug] [MainThread]: running dbt with arguments {'profiles_dir': '/Users/hazeldonaldson/.dbt', 'quiet': 'False', 'fail_fast': 'False', 'log_path': '/Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/logs', 'invocation_command': 'dbt run --select staging', 'write_json': 'True', 'introspect': 'True', 'use_colors': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'no_print': 'None', 'log_format': 'default', 'warn_error': 'None', 'printer_width': '80', 'target_path': 'None', 'static_parser': 'True', 'debug': 'False', 'use_experimental_parser': 'False', 'version_check': 'True', 'cache_selected_only': 'False', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'partial_parse': 'True', 'log_cache_events': 'False', 'empty': 'False'}
[0m18:51:39.025455 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '7f539c1b-eadf-4316-b5ff-1e729e815bc3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104e16870>]}
[0m18:51:39.054160 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '7f539c1b-eadf-4316-b5ff-1e729e815bc3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104b387a0>]}
[0m18:51:39.055475 [info ] [MainThread]: Registered adapter: duckdb=1.10.0
[0m18:51:39.109377 [debug] [MainThread]: checksum: 092b177ba87eb6bb3c55954c38aa57900eebac336561eb9ee32218428aa81d43, vars: {}, profile: , target: , version: 1.11.4
[0m18:51:39.175240 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m18:51:39.175655 [debug] [MainThread]: Partial parsing: updated file: quest_kingdom://models/staging/stg_sessions.sql
[0m18:51:39.370517 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 7 unused configuration paths:
- models.core
- models.staging
- models.monetization
- models.question_kingdom
- models.marts
- models.product
- models.retention
[0m18:51:39.377765 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '7f539c1b-eadf-4316-b5ff-1e729e815bc3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1055536e0>]}
[0m18:51:39.458391 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/manifest.json
[0m18:51:39.459669 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/semantic_manifest.json
[0m18:51:39.472778 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '7f539c1b-eadf-4316-b5ff-1e729e815bc3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1054b5d30>]}
[0m18:51:39.473086 [info ] [MainThread]: Found 7 models, 23 data tests, 5 sources, 472 macros
[0m18:51:39.473263 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7f539c1b-eadf-4316-b5ff-1e729e815bc3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1055524e0>]}
[0m18:51:39.474267 [info ] [MainThread]: 
[0m18:51:39.474446 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m18:51:39.474583 [info ] [MainThread]: 
[0m18:51:39.474811 [debug] [MainThread]: Acquiring new duckdb connection 'master'
[0m18:51:39.477060 [debug] [ThreadPool]: Acquiring new duckdb connection 'list_quest_kingdom'
[0m18:51:39.505940 [debug] [ThreadPool]: Using duckdb connection "list_quest_kingdom"
[0m18:51:39.506191 [debug] [ThreadPool]: On list_quest_kingdom: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "list_quest_kingdom"} */

    
    select schema_name
    from system.information_schema.schemata
    
    where lower(catalog_name) = '"quest_kingdom"'
    
  
  
[0m18:51:39.506342 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:51:39.524744 [debug] [ThreadPool]: SQL status: OK in 0.018 seconds
[0m18:51:39.525786 [debug] [ThreadPool]: On list_quest_kingdom: Close
[0m18:51:39.526159 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_quest_kingdom, now create_quest_kingdom_main)
[0m18:51:39.526418 [debug] [ThreadPool]: Creating schema "database: "quest_kingdom"
schema: "main"
"
[0m18:51:39.530731 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m18:51:39.530959 [debug] [ThreadPool]: On create_quest_kingdom_main: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "create_quest_kingdom_main"} */

    
        select type from duckdb_databases()
        where lower(database_name)='quest_kingdom'
        and type='sqlite'
    
  
[0m18:51:39.531103 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:51:39.532038 [debug] [ThreadPool]: SQL status: OK in 0.001 seconds
[0m18:51:39.532748 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m18:51:39.532903 [debug] [ThreadPool]: On create_quest_kingdom_main: BEGIN
[0m18:51:39.533145 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m18:51:39.533277 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m18:51:39.533405 [debug] [ThreadPool]: On create_quest_kingdom_main: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "create_quest_kingdom_main"} */

    
    
        create schema if not exists "quest_kingdom"."main"
    
[0m18:51:39.533889 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m18:51:39.534289 [debug] [ThreadPool]: On create_quest_kingdom_main: COMMIT
[0m18:51:39.534426 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m18:51:39.534546 [debug] [ThreadPool]: On create_quest_kingdom_main: COMMIT
[0m18:51:39.534747 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m18:51:39.534879 [debug] [ThreadPool]: On create_quest_kingdom_main: Close
[0m18:51:39.535565 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_quest_kingdom_main, now list_quest_kingdom_main)
[0m18:51:39.538517 [debug] [ThreadPool]: Using duckdb connection "list_quest_kingdom_main"
[0m18:51:39.538698 [debug] [ThreadPool]: On list_quest_kingdom_main: BEGIN
[0m18:51:39.538887 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:51:39.539170 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m18:51:39.539299 [debug] [ThreadPool]: Using duckdb connection "list_quest_kingdom_main"
[0m18:51:39.539431 [debug] [ThreadPool]: On list_quest_kingdom_main: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "list_quest_kingdom_main"} */
select
      'quest_kingdom' as database,
      table_name as name,
      table_schema as schema,
      CASE table_type
        WHEN 'BASE TABLE' THEN 'table'
        WHEN 'VIEW' THEN 'view'
        WHEN 'LOCAL TEMPORARY' THEN 'table'
        END as type
    from system.information_schema.tables
    where lower(table_schema) = 'main'
    and lower(table_catalog) = 'quest_kingdom'
  
[0m18:51:39.550785 [debug] [ThreadPool]: SQL status: OK in 0.011 seconds
[0m18:51:39.551679 [debug] [ThreadPool]: On list_quest_kingdom_main: ROLLBACK
[0m18:51:39.552633 [debug] [ThreadPool]: Failed to rollback 'list_quest_kingdom_main'
[0m18:51:39.552800 [debug] [ThreadPool]: On list_quest_kingdom_main: Close
[0m18:51:39.553712 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7f539c1b-eadf-4316-b5ff-1e729e815bc3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10547ff50>]}
[0m18:51:39.553949 [debug] [MainThread]: Using duckdb connection "master"
[0m18:51:39.554082 [debug] [MainThread]: On master: BEGIN
[0m18:51:39.554206 [debug] [MainThread]: Opening a new connection, currently in state init
[0m18:51:39.554504 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m18:51:39.554636 [debug] [MainThread]: On master: COMMIT
[0m18:51:39.554762 [debug] [MainThread]: Using duckdb connection "master"
[0m18:51:39.554880 [debug] [MainThread]: On master: COMMIT
[0m18:51:39.555171 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m18:51:39.555304 [debug] [MainThread]: On master: Close
[0m18:51:39.556666 [debug] [Thread-1 (]: Began running node model.quest_kingdom.stg_ad_impressions
[0m18:51:39.556922 [info ] [Thread-1 (]: 1 of 5 START sql view model main.stg_ad_impressions ............................ [RUN]
[0m18:51:39.557137 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_quest_kingdom_main, now model.quest_kingdom.stg_ad_impressions)
[0m18:51:39.557303 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.stg_ad_impressions
[0m18:51:39.560941 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.stg_ad_impressions"
[0m18:51:39.561925 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.stg_ad_impressions
[0m18:51:39.577856 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.stg_ad_impressions"
[0m18:51:39.578316 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_ad_impressions"
[0m18:51:39.578488 [debug] [Thread-1 (]: On model.quest_kingdom.stg_ad_impressions: BEGIN
[0m18:51:39.578638 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:51:39.579010 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:51:39.579165 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_ad_impressions"
[0m18:51:39.579323 [debug] [Thread-1 (]: On model.quest_kingdom.stg_ad_impressions: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.stg_ad_impressions"} */

  
  create view "quest_kingdom"."main"."stg_ad_impressions__dbt_tmp" as (
    select
    -- ids
    ad_id,
    player_id,
    session_id,
    
    -- timestamps
    ad_timestamp::timestamp as shown_at,
    
    -- dimensions
    lower(trim(ad_type)) as ad_type,
    lower(trim(ad_network)) as ad_network,
    
    -- booleans
    clicked,
    
    -- metrics
    revenue_usd,
    
    -- derived
    date_trunc('day', ad_timestamp::timestamp)::date as ad_date

from "quest_kingdom"."main"."ad_impressions"
  );

[0m18:51:39.580032 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m18:51:39.583424 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_ad_impressions"
[0m18:51:39.587083 [debug] [Thread-1 (]: On model.quest_kingdom.stg_ad_impressions: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.stg_ad_impressions"} */
alter view "quest_kingdom"."main"."stg_ad_impressions" rename to "stg_ad_impressions__dbt_backup"
[0m18:51:39.588044 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m18:51:39.589552 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_ad_impressions"
[0m18:51:39.589720 [debug] [Thread-1 (]: On model.quest_kingdom.stg_ad_impressions: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.stg_ad_impressions"} */
alter view "quest_kingdom"."main"."stg_ad_impressions__dbt_tmp" rename to "stg_ad_impressions"
[0m18:51:39.590016 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:51:39.595509 [debug] [Thread-1 (]: On model.quest_kingdom.stg_ad_impressions: COMMIT
[0m18:51:39.595706 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_ad_impressions"
[0m18:51:39.595865 [debug] [Thread-1 (]: On model.quest_kingdom.stg_ad_impressions: COMMIT
[0m18:51:39.596632 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m18:51:39.599946 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_ad_impressions"
[0m18:51:39.600133 [debug] [Thread-1 (]: On model.quest_kingdom.stg_ad_impressions: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.stg_ad_impressions"} */

      drop view if exists "quest_kingdom"."main"."stg_ad_impressions__dbt_backup" cascade
    
[0m18:51:39.600715 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:51:39.601891 [debug] [Thread-1 (]: On model.quest_kingdom.stg_ad_impressions: Close
[0m18:51:39.602868 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7f539c1b-eadf-4316-b5ff-1e729e815bc3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103ef3380>]}
[0m18:51:39.603183 [info ] [Thread-1 (]: 1 of 5 OK created sql view model main.stg_ad_impressions ....................... [[32mOK[0m in 0.05s]
[0m18:51:39.603556 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.stg_ad_impressions
[0m18:51:39.603752 [debug] [Thread-1 (]: Began running node model.quest_kingdom.stg_events
[0m18:51:39.603998 [info ] [Thread-1 (]: 2 of 5 START sql view model main.stg_events .................................... [RUN]
[0m18:51:39.604213 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.quest_kingdom.stg_ad_impressions, now model.quest_kingdom.stg_events)
[0m18:51:39.604376 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.stg_events
[0m18:51:39.605790 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.stg_events"
[0m18:51:39.606310 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.stg_events
[0m18:51:39.607843 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.stg_events"
[0m18:51:39.608141 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_events"
[0m18:51:39.608289 [debug] [Thread-1 (]: On model.quest_kingdom.stg_events: BEGIN
[0m18:51:39.608428 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:51:39.608829 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:51:39.608980 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_events"
[0m18:51:39.609136 [debug] [Thread-1 (]: On model.quest_kingdom.stg_events: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.stg_events"} */

  
  create view "quest_kingdom"."main"."stg_events__dbt_tmp" as (
    select
    -- ids
    event_id,
    player_id,
    session_id,
    
    -- timestamps
    event_timestamp::timestamp as event_at,
    
    -- dimensions
    lower(trim(event_name)) as event_name,
    
    -- json properties
    event_properties

from "quest_kingdom"."main"."events"
  );

[0m18:51:39.609538 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:51:39.611104 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_events"
[0m18:51:39.611323 [debug] [Thread-1 (]: On model.quest_kingdom.stg_events: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.stg_events"} */
alter view "quest_kingdom"."main"."stg_events" rename to "stg_events__dbt_backup"
[0m18:51:39.611671 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:51:39.613063 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_events"
[0m18:51:39.613231 [debug] [Thread-1 (]: On model.quest_kingdom.stg_events: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.stg_events"} */
alter view "quest_kingdom"."main"."stg_events__dbt_tmp" rename to "stg_events"
[0m18:51:39.613509 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:51:39.614201 [debug] [Thread-1 (]: On model.quest_kingdom.stg_events: COMMIT
[0m18:51:39.614354 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_events"
[0m18:51:39.614494 [debug] [Thread-1 (]: On model.quest_kingdom.stg_events: COMMIT
[0m18:51:39.614846 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:51:39.615909 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_events"
[0m18:51:39.616068 [debug] [Thread-1 (]: On model.quest_kingdom.stg_events: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.stg_events"} */

      drop view if exists "quest_kingdom"."main"."stg_events__dbt_backup" cascade
    
[0m18:51:39.616384 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:51:39.616966 [debug] [Thread-1 (]: On model.quest_kingdom.stg_events: Close
[0m18:51:39.617212 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7f539c1b-eadf-4316-b5ff-1e729e815bc3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1057f1f10>]}
[0m18:51:39.617486 [info ] [Thread-1 (]: 2 of 5 OK created sql view model main.stg_events ............................... [[32mOK[0m in 0.01s]
[0m18:51:39.617726 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.stg_events
[0m18:51:39.617905 [debug] [Thread-1 (]: Began running node model.quest_kingdom.stg_iap_transactions
[0m18:51:39.618118 [info ] [Thread-1 (]: 3 of 5 START sql view model main.stg_iap_transactions .......................... [RUN]
[0m18:51:39.618300 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.quest_kingdom.stg_events, now model.quest_kingdom.stg_iap_transactions)
[0m18:51:39.618460 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.stg_iap_transactions
[0m18:51:39.619776 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.stg_iap_transactions"
[0m18:51:39.620151 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.stg_iap_transactions
[0m18:51:39.621874 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.stg_iap_transactions"
[0m18:51:39.622447 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_iap_transactions"
[0m18:51:39.622636 [debug] [Thread-1 (]: On model.quest_kingdom.stg_iap_transactions: BEGIN
[0m18:51:39.622790 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:51:39.623142 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:51:39.623299 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_iap_transactions"
[0m18:51:39.623455 [debug] [Thread-1 (]: On model.quest_kingdom.stg_iap_transactions: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.stg_iap_transactions"} */

  
  create view "quest_kingdom"."main"."stg_iap_transactions__dbt_tmp" as (
    select
    -- ids
    transaction_id,
    player_id,
    session_id,
    
    -- timestamps
    transaction_timestamp::timestamp as purchased_at,
    
    -- dimensions
    lower(trim(sku)) as sku,
    lower(trim(platform)) as platform,
    
    -- metrics
    price_usd,
    gems_purchased,
    
    -- derived
    date_trunc('day', transaction_timestamp::timestamp)::date as purchase_date

from "quest_kingdom"."main"."iap_transactions"
  );

[0m18:51:39.623915 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:51:39.625449 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_iap_transactions"
[0m18:51:39.625621 [debug] [Thread-1 (]: On model.quest_kingdom.stg_iap_transactions: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.stg_iap_transactions"} */
alter view "quest_kingdom"."main"."stg_iap_transactions" rename to "stg_iap_transactions__dbt_backup"
[0m18:51:39.625926 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:51:39.627290 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_iap_transactions"
[0m18:51:39.627452 [debug] [Thread-1 (]: On model.quest_kingdom.stg_iap_transactions: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.stg_iap_transactions"} */
alter view "quest_kingdom"."main"."stg_iap_transactions__dbt_tmp" rename to "stg_iap_transactions"
[0m18:51:39.627723 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:51:39.628402 [debug] [Thread-1 (]: On model.quest_kingdom.stg_iap_transactions: COMMIT
[0m18:51:39.628557 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_iap_transactions"
[0m18:51:39.628696 [debug] [Thread-1 (]: On model.quest_kingdom.stg_iap_transactions: COMMIT
[0m18:51:39.629082 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:51:39.631007 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_iap_transactions"
[0m18:51:39.631165 [debug] [Thread-1 (]: On model.quest_kingdom.stg_iap_transactions: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.stg_iap_transactions"} */

      drop view if exists "quest_kingdom"."main"."stg_iap_transactions__dbt_backup" cascade
    
[0m18:51:39.631499 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:51:39.632076 [debug] [Thread-1 (]: On model.quest_kingdom.stg_iap_transactions: Close
[0m18:51:39.632326 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7f539c1b-eadf-4316-b5ff-1e729e815bc3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1058f5e20>]}
[0m18:51:39.632701 [info ] [Thread-1 (]: 3 of 5 OK created sql view model main.stg_iap_transactions ..................... [[32mOK[0m in 0.01s]
[0m18:51:39.632976 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.stg_iap_transactions
[0m18:51:39.633164 [debug] [Thread-1 (]: Began running node model.quest_kingdom.stg_players
[0m18:51:39.633396 [info ] [Thread-1 (]: 4 of 5 START sql view model main.stg_players ................................... [RUN]
[0m18:51:39.633610 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.quest_kingdom.stg_iap_transactions, now model.quest_kingdom.stg_players)
[0m18:51:39.633774 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.stg_players
[0m18:51:39.635114 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.stg_players"
[0m18:51:39.635460 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.stg_players
[0m18:51:39.637076 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.stg_players"
[0m18:51:39.637812 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_players"
[0m18:51:39.638036 [debug] [Thread-1 (]: On model.quest_kingdom.stg_players: BEGIN
[0m18:51:39.638192 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:51:39.638546 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:51:39.638743 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_players"
[0m18:51:39.638928 [debug] [Thread-1 (]: On model.quest_kingdom.stg_players: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.stg_players"} */

  
  create view "quest_kingdom"."main"."stg_players__dbt_tmp" as (
    with source as (
    select * from "quest_kingdom"."main"."players"
),

renamed as (
    select
        player_id,
        install_date::date as installed_at,
        --dimensions
        lower(trim(attribution_channel)) as attribution_channel,
        lower(trim(country)) as country,
        lower(trim(device_type)) as device_type,
        lower(trim(player_segment)) as player_segment,
        lower(trim(experiment_variant)) as experiment_variant,
        --booleans
        tutorial_completed,
        --metrics
        lifetime_value as lifetime_value_usd
    from source 
)

select * from renamed
  );

[0m18:51:39.639604 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:51:39.641148 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_players"
[0m18:51:39.641312 [debug] [Thread-1 (]: On model.quest_kingdom.stg_players: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.stg_players"} */
alter view "quest_kingdom"."main"."stg_players" rename to "stg_players__dbt_backup"
[0m18:51:39.641616 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:51:39.642909 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_players"
[0m18:51:39.643066 [debug] [Thread-1 (]: On model.quest_kingdom.stg_players: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.stg_players"} */
alter view "quest_kingdom"."main"."stg_players__dbt_tmp" rename to "stg_players"
[0m18:51:39.643350 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:51:39.644023 [debug] [Thread-1 (]: On model.quest_kingdom.stg_players: COMMIT
[0m18:51:39.644177 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_players"
[0m18:51:39.644315 [debug] [Thread-1 (]: On model.quest_kingdom.stg_players: COMMIT
[0m18:51:39.644698 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:51:39.645736 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_players"
[0m18:51:39.645932 [debug] [Thread-1 (]: On model.quest_kingdom.stg_players: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.stg_players"} */

      drop view if exists "quest_kingdom"."main"."stg_players__dbt_backup" cascade
    
[0m18:51:39.646257 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:51:39.646818 [debug] [Thread-1 (]: On model.quest_kingdom.stg_players: Close
[0m18:51:39.647060 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7f539c1b-eadf-4316-b5ff-1e729e815bc3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1058f6030>]}
[0m18:51:39.647338 [info ] [Thread-1 (]: 4 of 5 OK created sql view model main.stg_players .............................. [[32mOK[0m in 0.01s]
[0m18:51:39.647578 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.stg_players
[0m18:51:39.647754 [debug] [Thread-1 (]: Began running node model.quest_kingdom.stg_sessions
[0m18:51:39.647969 [info ] [Thread-1 (]: 5 of 5 START sql view model main.stg_sessions .................................. [RUN]
[0m18:51:39.648152 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.quest_kingdom.stg_players, now model.quest_kingdom.stg_sessions)
[0m18:51:39.648307 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.stg_sessions
[0m18:51:39.649660 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.stg_sessions"
[0m18:51:39.650268 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.stg_sessions
[0m18:51:39.651744 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.stg_sessions"
[0m18:51:39.652034 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_sessions"
[0m18:51:39.652181 [debug] [Thread-1 (]: On model.quest_kingdom.stg_sessions: BEGIN
[0m18:51:39.652317 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:51:39.652595 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:51:39.652738 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_sessions"
[0m18:51:39.652898 [debug] [Thread-1 (]: On model.quest_kingdom.stg_sessions: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.stg_sessions"} */

  
  create view "quest_kingdom"."main"."stg_sessions__dbt_tmp" as (
    with source as (
    select * from "quest_kingdom"."main"."sessions"
),

renamed as (
    select 
        session_id,
        player_id,
        --timestamps
        session_start::timestamp as session_started_at,
        session_end::timestamp as session_ended_at,

        --metrics
        session_duration_minutes,
        starting_level,
        ending_level,
        levels_gained,

        --derived metrics
        extract(hour from session_start::timestamp) as session_hour,
        extract(dow from session_start::timestamp) as session_day_of_week,
        date_trunc('day', session_start::timestamp)::date as session_date 
    from source
)

select * from renamed
  );

[0m18:51:39.653517 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:51:39.655413 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_sessions"
[0m18:51:39.655615 [debug] [Thread-1 (]: On model.quest_kingdom.stg_sessions: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.stg_sessions"} */
alter view "quest_kingdom"."main"."stg_sessions__dbt_tmp" rename to "stg_sessions"
[0m18:51:39.656000 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:51:39.656634 [debug] [Thread-1 (]: On model.quest_kingdom.stg_sessions: COMMIT
[0m18:51:39.656786 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_sessions"
[0m18:51:39.656922 [debug] [Thread-1 (]: On model.quest_kingdom.stg_sessions: COMMIT
[0m18:51:39.657329 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:51:39.658420 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_sessions"
[0m18:51:39.658580 [debug] [Thread-1 (]: On model.quest_kingdom.stg_sessions: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.stg_sessions"} */

      drop view if exists "quest_kingdom"."main"."stg_sessions__dbt_backup" cascade
    
[0m18:51:39.658845 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:51:39.659438 [debug] [Thread-1 (]: On model.quest_kingdom.stg_sessions: Close
[0m18:51:39.659686 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7f539c1b-eadf-4316-b5ff-1e729e815bc3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1058cac60>]}
[0m18:51:39.659968 [info ] [Thread-1 (]: 5 of 5 OK created sql view model main.stg_sessions ............................. [[32mOK[0m in 0.01s]
[0m18:51:39.660209 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.stg_sessions
[0m18:51:39.660747 [debug] [MainThread]: Using duckdb connection "master"
[0m18:51:39.660916 [debug] [MainThread]: On master: BEGIN
[0m18:51:39.661048 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m18:51:39.661309 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m18:51:39.661441 [debug] [MainThread]: On master: COMMIT
[0m18:51:39.661571 [debug] [MainThread]: Using duckdb connection "master"
[0m18:51:39.661687 [debug] [MainThread]: On master: COMMIT
[0m18:51:39.661883 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m18:51:39.662009 [debug] [MainThread]: On master: Close
[0m18:51:39.662173 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:51:39.662290 [debug] [MainThread]: Connection 'model.quest_kingdom.stg_sessions' was properly closed.
[0m18:51:39.662452 [info ] [MainThread]: 
[0m18:51:39.662599 [info ] [MainThread]: Finished running 5 view models in 0 hours 0 minutes and 0.19 seconds (0.19s).
[0m18:51:39.663082 [debug] [MainThread]: Command end result
[0m18:51:39.676402 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/manifest.json
[0m18:51:39.677394 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/semantic_manifest.json
[0m18:51:39.680330 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/run_results.json
[0m18:51:39.680477 [info ] [MainThread]: 
[0m18:51:39.680643 [info ] [MainThread]: [32mCompleted successfully[0m
[0m18:51:39.680774 [info ] [MainThread]: 
[0m18:51:39.680919 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=5
[0m18:51:39.682292 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 0.8678769, "process_in_blocks": "0", "process_kernel_time": 0.182497, "process_mem_max_rss": "148733952", "process_out_blocks": "0", "process_user_time": 1.307263}
[0m18:51:39.682501 [debug] [MainThread]: Command `dbt run` succeeded at 18:51:39.682463 after 0.87 seconds
[0m18:51:39.682667 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103f27590>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103f24710>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1043df6e0>]}
[0m18:51:39.682824 [debug] [MainThread]: Flushing usage events
[0m18:51:39.820149 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m18:52:23.095080 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105394bf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11c2b5a60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11c2b55e0>]}


============================== 18:52:23.098683 | f128a8b1-73ad-45c1-ba1c-1e817ddfffc7 ==============================
[0m18:52:23.098683 [info ] [MainThread]: Running with dbt=1.11.4
[0m18:52:23.099014 [debug] [MainThread]: running dbt with arguments {'debug': 'False', 'version_check': 'True', 'write_json': 'True', 'introspect': 'True', 'log_path': '/Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/logs', 'fail_fast': 'False', 'send_anonymous_usage_stats': 'True', 'use_experimental_parser': 'False', 'invocation_command': 'dbt test --select staging', 'cache_selected_only': 'False', 'empty': 'None', 'log_cache_events': 'False', 'target_path': 'None', 'printer_width': '80', 'profiles_dir': '/Users/hazeldonaldson/.dbt', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'warn_error': 'None', 'log_format': 'default', 'quiet': 'False', 'partial_parse': 'True', 'no_print': 'None', 'use_colors': 'True', 'indirect_selection': 'eager', 'static_parser': 'True'}
[0m18:52:23.265796 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f128a8b1-73ad-45c1-ba1c-1e817ddfffc7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11a196e10>]}
[0m18:52:23.294330 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f128a8b1-73ad-45c1-ba1c-1e817ddfffc7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11a196e10>]}
[0m18:52:23.295875 [info ] [MainThread]: Registered adapter: duckdb=1.10.0
[0m18:52:23.358177 [debug] [MainThread]: checksum: 092b177ba87eb6bb3c55954c38aa57900eebac336561eb9ee32218428aa81d43, vars: {}, profile: , target: , version: 1.11.4
[0m18:52:23.432472 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m18:52:23.432719 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m18:52:23.432855 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m18:52:23.435938 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 7 unused configuration paths:
- models.core
- models.monetization
- models.product
- models.retention
- models.staging
- models.marts
- models.question_kingdom
[0m18:52:23.455582 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f128a8b1-73ad-45c1-ba1c-1e817ddfffc7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11d288d10>]}
[0m18:52:23.497450 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/manifest.json
[0m18:52:23.498720 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/semantic_manifest.json
[0m18:52:23.517559 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f128a8b1-73ad-45c1-ba1c-1e817ddfffc7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11c776480>]}
[0m18:52:23.517857 [info ] [MainThread]: Found 7 models, 23 data tests, 5 sources, 472 macros
[0m18:52:23.518030 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f128a8b1-73ad-45c1-ba1c-1e817ddfffc7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11c5fadb0>]}
[0m18:52:23.519376 [info ] [MainThread]: 
[0m18:52:23.519579 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m18:52:23.519730 [info ] [MainThread]: 
[0m18:52:23.519985 [debug] [MainThread]: Acquiring new duckdb connection 'master'
[0m18:52:23.522466 [debug] [ThreadPool]: Acquiring new duckdb connection 'list_quest_kingdom_main'
[0m18:52:23.550843 [debug] [ThreadPool]: Using duckdb connection "list_quest_kingdom_main"
[0m18:52:23.551074 [debug] [ThreadPool]: On list_quest_kingdom_main: BEGIN
[0m18:52:23.551217 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:52:23.563270 [debug] [ThreadPool]: SQL status: OK in 0.012 seconds
[0m18:52:23.563522 [debug] [ThreadPool]: Using duckdb connection "list_quest_kingdom_main"
[0m18:52:23.563679 [debug] [ThreadPool]: On list_quest_kingdom_main: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "list_quest_kingdom_main"} */
select
      'quest_kingdom' as database,
      table_name as name,
      table_schema as schema,
      CASE table_type
        WHEN 'BASE TABLE' THEN 'table'
        WHEN 'VIEW' THEN 'view'
        WHEN 'LOCAL TEMPORARY' THEN 'table'
        END as type
    from system.information_schema.tables
    where lower(table_schema) = 'main'
    and lower(table_catalog) = 'quest_kingdom'
  
[0m18:52:23.579384 [debug] [ThreadPool]: SQL status: OK in 0.016 seconds
[0m18:52:23.580311 [debug] [ThreadPool]: On list_quest_kingdom_main: ROLLBACK
[0m18:52:23.581307 [debug] [ThreadPool]: Failed to rollback 'list_quest_kingdom_main'
[0m18:52:23.581480 [debug] [ThreadPool]: On list_quest_kingdom_main: Close
[0m18:52:23.582412 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f128a8b1-73ad-45c1-ba1c-1e817ddfffc7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11c751e80>]}
[0m18:52:23.582642 [debug] [MainThread]: Using duckdb connection "master"
[0m18:52:23.582774 [debug] [MainThread]: On master: BEGIN
[0m18:52:23.582893 [debug] [MainThread]: Opening a new connection, currently in state init
[0m18:52:23.583163 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m18:52:23.583297 [debug] [MainThread]: On master: COMMIT
[0m18:52:23.583422 [debug] [MainThread]: Using duckdb connection "master"
[0m18:52:23.583535 [debug] [MainThread]: On master: COMMIT
[0m18:52:23.583726 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m18:52:23.583851 [debug] [MainThread]: On master: Close
[0m18:52:23.585394 [debug] [Thread-1 (]: Began running node test.quest_kingdom.accepted_values_stg_events_event_name__tutorial_completed__level_completed__boss_defeated.4ed70dcb36
[0m18:52:23.585590 [info ] [Thread-1 (]: 1 of 23 START test accepted_values_stg_events_event_name__tutorial_completed__level_completed__boss_defeated  [RUN]
[0m18:52:23.585789 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_quest_kingdom_main, now test.quest_kingdom.accepted_values_stg_events_event_name__tutorial_completed__level_completed__boss_defeated.4ed70dcb36)
[0m18:52:23.585956 [debug] [Thread-1 (]: Began compiling node test.quest_kingdom.accepted_values_stg_events_event_name__tutorial_completed__level_completed__boss_defeated.4ed70dcb36
[0m18:52:23.594470 [debug] [Thread-1 (]: Writing injected SQL for node "test.quest_kingdom.accepted_values_stg_events_event_name__tutorial_completed__level_completed__boss_defeated.4ed70dcb36"
[0m18:52:23.595207 [debug] [Thread-1 (]: Began executing node test.quest_kingdom.accepted_values_stg_events_event_name__tutorial_completed__level_completed__boss_defeated.4ed70dcb36
[0m18:52:23.603976 [debug] [Thread-1 (]: Writing runtime sql for node "test.quest_kingdom.accepted_values_stg_events_event_name__tutorial_completed__level_completed__boss_defeated.4ed70dcb36"
[0m18:52:23.604464 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.accepted_values_stg_events_event_name__tutorial_completed__level_completed__boss_defeated.4ed70dcb36"
[0m18:52:23.604645 [debug] [Thread-1 (]: On test.quest_kingdom.accepted_values_stg_events_event_name__tutorial_completed__level_completed__boss_defeated.4ed70dcb36: BEGIN
[0m18:52:23.604799 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:52:23.605161 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:52:23.605323 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.accepted_values_stg_events_event_name__tutorial_completed__level_completed__boss_defeated.4ed70dcb36"
[0m18:52:23.605485 [debug] [Thread-1 (]: On test.quest_kingdom.accepted_values_stg_events_event_name__tutorial_completed__level_completed__boss_defeated.4ed70dcb36: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "test.quest_kingdom.accepted_values_stg_events_event_name__tutorial_completed__level_completed__boss_defeated.4ed70dcb36"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

with all_values as (

    select
        event_name as value_field,
        count(*) as n_records

    from "quest_kingdom"."main"."stg_events"
    group by event_name

)

select *
from all_values
where value_field not in (
    'tutorial_completed','level_completed','boss_defeated'
)



  
  
      
    ) dbt_internal_test
[0m18:52:23.610048 [debug] [Thread-1 (]: SQL status: OK in 0.004 seconds
[0m18:52:23.612082 [debug] [Thread-1 (]: On test.quest_kingdom.accepted_values_stg_events_event_name__tutorial_completed__level_completed__boss_defeated.4ed70dcb36: ROLLBACK
[0m18:52:23.612561 [debug] [Thread-1 (]: Failed to rollback 'test.quest_kingdom.accepted_values_stg_events_event_name__tutorial_completed__level_completed__boss_defeated.4ed70dcb36'
[0m18:52:23.612737 [debug] [Thread-1 (]: On test.quest_kingdom.accepted_values_stg_events_event_name__tutorial_completed__level_completed__boss_defeated.4ed70dcb36: Close
[0m18:52:23.613014 [info ] [Thread-1 (]: 1 of 23 PASS accepted_values_stg_events_event_name__tutorial_completed__level_completed__boss_defeated  [[32mPASS[0m in 0.03s]
[0m18:52:23.613265 [debug] [Thread-1 (]: Finished running node test.quest_kingdom.accepted_values_stg_events_event_name__tutorial_completed__level_completed__boss_defeated.4ed70dcb36
[0m18:52:23.613443 [debug] [Thread-1 (]: Began running node test.quest_kingdom.accepted_values_stg_players_device_type__ios__android.14cabc59fd
[0m18:52:23.613635 [info ] [Thread-1 (]: 2 of 23 START test accepted_values_stg_players_device_type__ios__android ....... [RUN]
[0m18:52:23.613821 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.quest_kingdom.accepted_values_stg_events_event_name__tutorial_completed__level_completed__boss_defeated.4ed70dcb36, now test.quest_kingdom.accepted_values_stg_players_device_type__ios__android.14cabc59fd)
[0m18:52:23.613984 [debug] [Thread-1 (]: Began compiling node test.quest_kingdom.accepted_values_stg_players_device_type__ios__android.14cabc59fd
[0m18:52:23.616451 [debug] [Thread-1 (]: Writing injected SQL for node "test.quest_kingdom.accepted_values_stg_players_device_type__ios__android.14cabc59fd"
[0m18:52:23.616823 [debug] [Thread-1 (]: Began executing node test.quest_kingdom.accepted_values_stg_players_device_type__ios__android.14cabc59fd
[0m18:52:23.617945 [debug] [Thread-1 (]: Writing runtime sql for node "test.quest_kingdom.accepted_values_stg_players_device_type__ios__android.14cabc59fd"
[0m18:52:23.618260 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.accepted_values_stg_players_device_type__ios__android.14cabc59fd"
[0m18:52:23.618420 [debug] [Thread-1 (]: On test.quest_kingdom.accepted_values_stg_players_device_type__ios__android.14cabc59fd: BEGIN
[0m18:52:23.618562 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:52:23.618903 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:52:23.619059 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.accepted_values_stg_players_device_type__ios__android.14cabc59fd"
[0m18:52:23.619223 [debug] [Thread-1 (]: On test.quest_kingdom.accepted_values_stg_players_device_type__ios__android.14cabc59fd: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "test.quest_kingdom.accepted_values_stg_players_device_type__ios__android.14cabc59fd"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

with all_values as (

    select
        device_type as value_field,
        count(*) as n_records

    from "quest_kingdom"."main"."stg_players"
    group by device_type

)

select *
from all_values
where value_field not in (
    'ios','android'
)



  
  
      
    ) dbt_internal_test
[0m18:52:23.620756 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m18:52:23.621777 [debug] [Thread-1 (]: On test.quest_kingdom.accepted_values_stg_players_device_type__ios__android.14cabc59fd: ROLLBACK
[0m18:52:23.622320 [debug] [Thread-1 (]: Failed to rollback 'test.quest_kingdom.accepted_values_stg_players_device_type__ios__android.14cabc59fd'
[0m18:52:23.622494 [debug] [Thread-1 (]: On test.quest_kingdom.accepted_values_stg_players_device_type__ios__android.14cabc59fd: Close
[0m18:52:23.622817 [info ] [Thread-1 (]: 2 of 23 PASS accepted_values_stg_players_device_type__ios__android ............. [[32mPASS[0m in 0.01s]
[0m18:52:23.623085 [debug] [Thread-1 (]: Finished running node test.quest_kingdom.accepted_values_stg_players_device_type__ios__android.14cabc59fd
[0m18:52:23.623267 [debug] [Thread-1 (]: Began running node test.quest_kingdom.accepted_values_stg_players_player_segment__whale__dolphin__minnow__non_payer.2fd01d0b8a
[0m18:52:23.623454 [info ] [Thread-1 (]: 3 of 23 START test accepted_values_stg_players_player_segment__whale__dolphin__minnow__non_payer  [RUN]
[0m18:52:23.623641 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.quest_kingdom.accepted_values_stg_players_device_type__ios__android.14cabc59fd, now test.quest_kingdom.accepted_values_stg_players_player_segment__whale__dolphin__minnow__non_payer.2fd01d0b8a)
[0m18:52:23.623802 [debug] [Thread-1 (]: Began compiling node test.quest_kingdom.accepted_values_stg_players_player_segment__whale__dolphin__minnow__non_payer.2fd01d0b8a
[0m18:52:23.626874 [debug] [Thread-1 (]: Writing injected SQL for node "test.quest_kingdom.accepted_values_stg_players_player_segment__whale__dolphin__minnow__non_payer.2fd01d0b8a"
[0m18:52:23.627277 [debug] [Thread-1 (]: Began executing node test.quest_kingdom.accepted_values_stg_players_player_segment__whale__dolphin__minnow__non_payer.2fd01d0b8a
[0m18:52:23.629223 [debug] [Thread-1 (]: Writing runtime sql for node "test.quest_kingdom.accepted_values_stg_players_player_segment__whale__dolphin__minnow__non_payer.2fd01d0b8a"
[0m18:52:23.629643 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.accepted_values_stg_players_player_segment__whale__dolphin__minnow__non_payer.2fd01d0b8a"
[0m18:52:23.629823 [debug] [Thread-1 (]: On test.quest_kingdom.accepted_values_stg_players_player_segment__whale__dolphin__minnow__non_payer.2fd01d0b8a: BEGIN
[0m18:52:23.629979 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:52:23.630381 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:52:23.630588 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.accepted_values_stg_players_player_segment__whale__dolphin__minnow__non_payer.2fd01d0b8a"
[0m18:52:23.630779 [debug] [Thread-1 (]: On test.quest_kingdom.accepted_values_stg_players_player_segment__whale__dolphin__minnow__non_payer.2fd01d0b8a: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "test.quest_kingdom.accepted_values_stg_players_player_segment__whale__dolphin__minnow__non_payer.2fd01d0b8a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

with all_values as (

    select
        player_segment as value_field,
        count(*) as n_records

    from "quest_kingdom"."main"."stg_players"
    group by player_segment

)

select *
from all_values
where value_field not in (
    'whale','dolphin','minnow','non_payer'
)



  
  
      
    ) dbt_internal_test
[0m18:52:23.632060 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m18:52:23.632819 [debug] [Thread-1 (]: On test.quest_kingdom.accepted_values_stg_players_player_segment__whale__dolphin__minnow__non_payer.2fd01d0b8a: ROLLBACK
[0m18:52:23.633294 [debug] [Thread-1 (]: Failed to rollback 'test.quest_kingdom.accepted_values_stg_players_player_segment__whale__dolphin__minnow__non_payer.2fd01d0b8a'
[0m18:52:23.633452 [debug] [Thread-1 (]: On test.quest_kingdom.accepted_values_stg_players_player_segment__whale__dolphin__minnow__non_payer.2fd01d0b8a: Close
[0m18:52:23.633721 [info ] [Thread-1 (]: 3 of 23 PASS accepted_values_stg_players_player_segment__whale__dolphin__minnow__non_payer  [[32mPASS[0m in 0.01s]
[0m18:52:23.633971 [debug] [Thread-1 (]: Finished running node test.quest_kingdom.accepted_values_stg_players_player_segment__whale__dolphin__minnow__non_payer.2fd01d0b8a
[0m18:52:23.634146 [debug] [Thread-1 (]: Began running node test.quest_kingdom.not_null_stg_ad_impressions_ad_id.34d3bb542c
[0m18:52:23.634316 [info ] [Thread-1 (]: 4 of 23 START test not_null_stg_ad_impressions_ad_id ........................... [RUN]
[0m18:52:23.634496 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.quest_kingdom.accepted_values_stg_players_player_segment__whale__dolphin__minnow__non_payer.2fd01d0b8a, now test.quest_kingdom.not_null_stg_ad_impressions_ad_id.34d3bb542c)
[0m18:52:23.634652 [debug] [Thread-1 (]: Began compiling node test.quest_kingdom.not_null_stg_ad_impressions_ad_id.34d3bb542c
[0m18:52:23.637903 [debug] [Thread-1 (]: Writing injected SQL for node "test.quest_kingdom.not_null_stg_ad_impressions_ad_id.34d3bb542c"
[0m18:52:23.638624 [debug] [Thread-1 (]: Began executing node test.quest_kingdom.not_null_stg_ad_impressions_ad_id.34d3bb542c
[0m18:52:23.639972 [debug] [Thread-1 (]: Writing runtime sql for node "test.quest_kingdom.not_null_stg_ad_impressions_ad_id.34d3bb542c"
[0m18:52:23.640428 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.not_null_stg_ad_impressions_ad_id.34d3bb542c"
[0m18:52:23.640618 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_stg_ad_impressions_ad_id.34d3bb542c: BEGIN
[0m18:52:23.640771 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:52:23.641136 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:52:23.641293 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.not_null_stg_ad_impressions_ad_id.34d3bb542c"
[0m18:52:23.641451 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_stg_ad_impressions_ad_id.34d3bb542c: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "test.quest_kingdom.not_null_stg_ad_impressions_ad_id.34d3bb542c"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select ad_id
from "quest_kingdom"."main"."stg_ad_impressions"
where ad_id is null



  
  
      
    ) dbt_internal_test
[0m18:52:23.642078 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:52:23.642832 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_stg_ad_impressions_ad_id.34d3bb542c: ROLLBACK
[0m18:52:23.643283 [debug] [Thread-1 (]: Failed to rollback 'test.quest_kingdom.not_null_stg_ad_impressions_ad_id.34d3bb542c'
[0m18:52:23.643434 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_stg_ad_impressions_ad_id.34d3bb542c: Close
[0m18:52:23.643683 [info ] [Thread-1 (]: 4 of 23 PASS not_null_stg_ad_impressions_ad_id ................................. [[32mPASS[0m in 0.01s]
[0m18:52:23.643924 [debug] [Thread-1 (]: Finished running node test.quest_kingdom.not_null_stg_ad_impressions_ad_id.34d3bb542c
[0m18:52:23.644099 [debug] [Thread-1 (]: Began running node test.quest_kingdom.not_null_stg_ad_impressions_player_id.72385a5e19
[0m18:52:23.644293 [info ] [Thread-1 (]: 5 of 23 START test not_null_stg_ad_impressions_player_id ....................... [RUN]
[0m18:52:23.644516 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.quest_kingdom.not_null_stg_ad_impressions_ad_id.34d3bb542c, now test.quest_kingdom.not_null_stg_ad_impressions_player_id.72385a5e19)
[0m18:52:23.644692 [debug] [Thread-1 (]: Began compiling node test.quest_kingdom.not_null_stg_ad_impressions_player_id.72385a5e19
[0m18:52:23.646614 [debug] [Thread-1 (]: Writing injected SQL for node "test.quest_kingdom.not_null_stg_ad_impressions_player_id.72385a5e19"
[0m18:52:23.646988 [debug] [Thread-1 (]: Began executing node test.quest_kingdom.not_null_stg_ad_impressions_player_id.72385a5e19
[0m18:52:23.648087 [debug] [Thread-1 (]: Writing runtime sql for node "test.quest_kingdom.not_null_stg_ad_impressions_player_id.72385a5e19"
[0m18:52:23.648388 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.not_null_stg_ad_impressions_player_id.72385a5e19"
[0m18:52:23.648542 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_stg_ad_impressions_player_id.72385a5e19: BEGIN
[0m18:52:23.648679 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:52:23.648978 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:52:23.649126 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.not_null_stg_ad_impressions_player_id.72385a5e19"
[0m18:52:23.649274 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_stg_ad_impressions_player_id.72385a5e19: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "test.quest_kingdom.not_null_stg_ad_impressions_player_id.72385a5e19"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select player_id
from "quest_kingdom"."main"."stg_ad_impressions"
where player_id is null



  
  
      
    ) dbt_internal_test
[0m18:52:23.649831 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:52:23.650578 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_stg_ad_impressions_player_id.72385a5e19: ROLLBACK
[0m18:52:23.651045 [debug] [Thread-1 (]: Failed to rollback 'test.quest_kingdom.not_null_stg_ad_impressions_player_id.72385a5e19'
[0m18:52:23.651203 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_stg_ad_impressions_player_id.72385a5e19: Close
[0m18:52:23.651449 [info ] [Thread-1 (]: 5 of 23 PASS not_null_stg_ad_impressions_player_id ............................. [[32mPASS[0m in 0.01s]
[0m18:52:23.651685 [debug] [Thread-1 (]: Finished running node test.quest_kingdom.not_null_stg_ad_impressions_player_id.72385a5e19
[0m18:52:23.651860 [debug] [Thread-1 (]: Began running node test.quest_kingdom.not_null_stg_events_event_id.715b3f7012
[0m18:52:23.652039 [info ] [Thread-1 (]: 6 of 23 START test not_null_stg_events_event_id ................................ [RUN]
[0m18:52:23.652223 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.quest_kingdom.not_null_stg_ad_impressions_player_id.72385a5e19, now test.quest_kingdom.not_null_stg_events_event_id.715b3f7012)
[0m18:52:23.652384 [debug] [Thread-1 (]: Began compiling node test.quest_kingdom.not_null_stg_events_event_id.715b3f7012
[0m18:52:23.654424 [debug] [Thread-1 (]: Writing injected SQL for node "test.quest_kingdom.not_null_stg_events_event_id.715b3f7012"
[0m18:52:23.655188 [debug] [Thread-1 (]: Began executing node test.quest_kingdom.not_null_stg_events_event_id.715b3f7012
[0m18:52:23.656682 [debug] [Thread-1 (]: Writing runtime sql for node "test.quest_kingdom.not_null_stg_events_event_id.715b3f7012"
[0m18:52:23.657166 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.not_null_stg_events_event_id.715b3f7012"
[0m18:52:23.657336 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_stg_events_event_id.715b3f7012: BEGIN
[0m18:52:23.657478 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:52:23.657825 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:52:23.657977 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.not_null_stg_events_event_id.715b3f7012"
[0m18:52:23.658184 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_stg_events_event_id.715b3f7012: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "test.quest_kingdom.not_null_stg_events_event_id.715b3f7012"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select event_id
from "quest_kingdom"."main"."stg_events"
where event_id is null



  
  
      
    ) dbt_internal_test
[0m18:52:23.658826 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:52:23.659596 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_stg_events_event_id.715b3f7012: ROLLBACK
[0m18:52:23.660048 [debug] [Thread-1 (]: Failed to rollback 'test.quest_kingdom.not_null_stg_events_event_id.715b3f7012'
[0m18:52:23.660199 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_stg_events_event_id.715b3f7012: Close
[0m18:52:23.660455 [info ] [Thread-1 (]: 6 of 23 PASS not_null_stg_events_event_id ...................................... [[32mPASS[0m in 0.01s]
[0m18:52:23.660690 [debug] [Thread-1 (]: Finished running node test.quest_kingdom.not_null_stg_events_event_id.715b3f7012
[0m18:52:23.660863 [debug] [Thread-1 (]: Began running node test.quest_kingdom.not_null_stg_events_event_name.682bd9eda3
[0m18:52:23.661049 [info ] [Thread-1 (]: 7 of 23 START test not_null_stg_events_event_name .............................. [RUN]
[0m18:52:23.661251 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.quest_kingdom.not_null_stg_events_event_id.715b3f7012, now test.quest_kingdom.not_null_stg_events_event_name.682bd9eda3)
[0m18:52:23.661409 [debug] [Thread-1 (]: Began compiling node test.quest_kingdom.not_null_stg_events_event_name.682bd9eda3
[0m18:52:23.663379 [debug] [Thread-1 (]: Writing injected SQL for node "test.quest_kingdom.not_null_stg_events_event_name.682bd9eda3"
[0m18:52:23.663776 [debug] [Thread-1 (]: Began executing node test.quest_kingdom.not_null_stg_events_event_name.682bd9eda3
[0m18:52:23.664884 [debug] [Thread-1 (]: Writing runtime sql for node "test.quest_kingdom.not_null_stg_events_event_name.682bd9eda3"
[0m18:52:23.665191 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.not_null_stg_events_event_name.682bd9eda3"
[0m18:52:23.665349 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_stg_events_event_name.682bd9eda3: BEGIN
[0m18:52:23.665490 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:52:23.665799 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:52:23.665944 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.not_null_stg_events_event_name.682bd9eda3"
[0m18:52:23.666096 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_stg_events_event_name.682bd9eda3: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "test.quest_kingdom.not_null_stg_events_event_name.682bd9eda3"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select event_name
from "quest_kingdom"."main"."stg_events"
where event_name is null



  
  
      
    ) dbt_internal_test
[0m18:52:23.666996 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m18:52:23.667747 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_stg_events_event_name.682bd9eda3: ROLLBACK
[0m18:52:23.668197 [debug] [Thread-1 (]: Failed to rollback 'test.quest_kingdom.not_null_stg_events_event_name.682bd9eda3'
[0m18:52:23.668357 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_stg_events_event_name.682bd9eda3: Close
[0m18:52:23.668661 [info ] [Thread-1 (]: 7 of 23 PASS not_null_stg_events_event_name .................................... [[32mPASS[0m in 0.01s]
[0m18:52:23.668912 [debug] [Thread-1 (]: Finished running node test.quest_kingdom.not_null_stg_events_event_name.682bd9eda3
[0m18:52:23.669087 [debug] [Thread-1 (]: Began running node test.quest_kingdom.not_null_stg_events_player_id.588c4cb5e5
[0m18:52:23.669269 [info ] [Thread-1 (]: 8 of 23 START test not_null_stg_events_player_id ............................... [RUN]
[0m18:52:23.669448 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.quest_kingdom.not_null_stg_events_event_name.682bd9eda3, now test.quest_kingdom.not_null_stg_events_player_id.588c4cb5e5)
[0m18:52:23.669608 [debug] [Thread-1 (]: Began compiling node test.quest_kingdom.not_null_stg_events_player_id.588c4cb5e5
[0m18:52:23.671854 [debug] [Thread-1 (]: Writing injected SQL for node "test.quest_kingdom.not_null_stg_events_player_id.588c4cb5e5"
[0m18:52:23.672404 [debug] [Thread-1 (]: Began executing node test.quest_kingdom.not_null_stg_events_player_id.588c4cb5e5
[0m18:52:23.673657 [debug] [Thread-1 (]: Writing runtime sql for node "test.quest_kingdom.not_null_stg_events_player_id.588c4cb5e5"
[0m18:52:23.674029 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.not_null_stg_events_player_id.588c4cb5e5"
[0m18:52:23.674195 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_stg_events_player_id.588c4cb5e5: BEGIN
[0m18:52:23.674336 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:52:23.674698 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:52:23.674848 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.not_null_stg_events_player_id.588c4cb5e5"
[0m18:52:23.675007 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_stg_events_player_id.588c4cb5e5: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "test.quest_kingdom.not_null_stg_events_player_id.588c4cb5e5"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select player_id
from "quest_kingdom"."main"."stg_events"
where player_id is null



  
  
      
    ) dbt_internal_test
[0m18:52:23.675570 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:52:23.676368 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_stg_events_player_id.588c4cb5e5: ROLLBACK
[0m18:52:23.676820 [debug] [Thread-1 (]: Failed to rollback 'test.quest_kingdom.not_null_stg_events_player_id.588c4cb5e5'
[0m18:52:23.676963 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_stg_events_player_id.588c4cb5e5: Close
[0m18:52:23.677232 [info ] [Thread-1 (]: 8 of 23 PASS not_null_stg_events_player_id ..................................... [[32mPASS[0m in 0.01s]
[0m18:52:23.677478 [debug] [Thread-1 (]: Finished running node test.quest_kingdom.not_null_stg_events_player_id.588c4cb5e5
[0m18:52:23.677652 [debug] [Thread-1 (]: Began running node test.quest_kingdom.not_null_stg_iap_transactions_player_id.256115ad9d
[0m18:52:23.677808 [info ] [Thread-1 (]: 9 of 23 START test not_null_stg_iap_transactions_player_id ..................... [RUN]
[0m18:52:23.678061 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.quest_kingdom.not_null_stg_events_player_id.588c4cb5e5, now test.quest_kingdom.not_null_stg_iap_transactions_player_id.256115ad9d)
[0m18:52:23.678237 [debug] [Thread-1 (]: Began compiling node test.quest_kingdom.not_null_stg_iap_transactions_player_id.256115ad9d
[0m18:52:23.681228 [debug] [Thread-1 (]: Writing injected SQL for node "test.quest_kingdom.not_null_stg_iap_transactions_player_id.256115ad9d"
[0m18:52:23.681637 [debug] [Thread-1 (]: Began executing node test.quest_kingdom.not_null_stg_iap_transactions_player_id.256115ad9d
[0m18:52:23.715828 [debug] [Thread-1 (]: Writing runtime sql for node "test.quest_kingdom.not_null_stg_iap_transactions_player_id.256115ad9d"
[0m18:52:23.716490 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.not_null_stg_iap_transactions_player_id.256115ad9d"
[0m18:52:23.716690 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_stg_iap_transactions_player_id.256115ad9d: BEGIN
[0m18:52:23.716845 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:52:23.717200 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:52:23.717361 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.not_null_stg_iap_transactions_player_id.256115ad9d"
[0m18:52:23.717519 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_stg_iap_transactions_player_id.256115ad9d: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "test.quest_kingdom.not_null_stg_iap_transactions_player_id.256115ad9d"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select player_id
from "quest_kingdom"."main"."stg_iap_transactions"
where player_id is null



  
  
      
    ) dbt_internal_test
[0m18:52:23.718162 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:52:23.718889 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_stg_iap_transactions_player_id.256115ad9d: ROLLBACK
[0m18:52:23.719330 [debug] [Thread-1 (]: Failed to rollback 'test.quest_kingdom.not_null_stg_iap_transactions_player_id.256115ad9d'
[0m18:52:23.719476 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_stg_iap_transactions_player_id.256115ad9d: Close
[0m18:52:23.719722 [info ] [Thread-1 (]: 9 of 23 PASS not_null_stg_iap_transactions_player_id ........................... [[32mPASS[0m in 0.04s]
[0m18:52:23.719956 [debug] [Thread-1 (]: Finished running node test.quest_kingdom.not_null_stg_iap_transactions_player_id.256115ad9d
[0m18:52:23.720127 [debug] [Thread-1 (]: Began running node test.quest_kingdom.not_null_stg_iap_transactions_price_usd.613bc29079
[0m18:52:23.720301 [info ] [Thread-1 (]: 10 of 23 START test not_null_stg_iap_transactions_price_usd .................... [RUN]
[0m18:52:23.720472 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.quest_kingdom.not_null_stg_iap_transactions_player_id.256115ad9d, now test.quest_kingdom.not_null_stg_iap_transactions_price_usd.613bc29079)
[0m18:52:23.720623 [debug] [Thread-1 (]: Began compiling node test.quest_kingdom.not_null_stg_iap_transactions_price_usd.613bc29079
[0m18:52:23.722697 [debug] [Thread-1 (]: Writing injected SQL for node "test.quest_kingdom.not_null_stg_iap_transactions_price_usd.613bc29079"
[0m18:52:23.723117 [debug] [Thread-1 (]: Began executing node test.quest_kingdom.not_null_stg_iap_transactions_price_usd.613bc29079
[0m18:52:23.724225 [debug] [Thread-1 (]: Writing runtime sql for node "test.quest_kingdom.not_null_stg_iap_transactions_price_usd.613bc29079"
[0m18:52:23.724550 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.not_null_stg_iap_transactions_price_usd.613bc29079"
[0m18:52:23.724709 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_stg_iap_transactions_price_usd.613bc29079: BEGIN
[0m18:52:23.724854 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:52:23.725182 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:52:23.725334 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.not_null_stg_iap_transactions_price_usd.613bc29079"
[0m18:52:23.725491 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_stg_iap_transactions_price_usd.613bc29079: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "test.quest_kingdom.not_null_stg_iap_transactions_price_usd.613bc29079"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select price_usd
from "quest_kingdom"."main"."stg_iap_transactions"
where price_usd is null



  
  
      
    ) dbt_internal_test
[0m18:52:23.726079 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:52:23.726835 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_stg_iap_transactions_price_usd.613bc29079: ROLLBACK
[0m18:52:23.727300 [debug] [Thread-1 (]: Failed to rollback 'test.quest_kingdom.not_null_stg_iap_transactions_price_usd.613bc29079'
[0m18:52:23.727480 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_stg_iap_transactions_price_usd.613bc29079: Close
[0m18:52:23.727842 [info ] [Thread-1 (]: 10 of 23 PASS not_null_stg_iap_transactions_price_usd .......................... [[32mPASS[0m in 0.01s]
[0m18:52:23.728107 [debug] [Thread-1 (]: Finished running node test.quest_kingdom.not_null_stg_iap_transactions_price_usd.613bc29079
[0m18:52:23.728369 [debug] [Thread-1 (]: Began running node test.quest_kingdom.not_null_stg_iap_transactions_transaction_id.bc4fc23645
[0m18:52:23.728574 [info ] [Thread-1 (]: 11 of 23 START test not_null_stg_iap_transactions_transaction_id ............... [RUN]
[0m18:52:23.728787 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.quest_kingdom.not_null_stg_iap_transactions_price_usd.613bc29079, now test.quest_kingdom.not_null_stg_iap_transactions_transaction_id.bc4fc23645)
[0m18:52:23.728959 [debug] [Thread-1 (]: Began compiling node test.quest_kingdom.not_null_stg_iap_transactions_transaction_id.bc4fc23645
[0m18:52:23.730983 [debug] [Thread-1 (]: Writing injected SQL for node "test.quest_kingdom.not_null_stg_iap_transactions_transaction_id.bc4fc23645"
[0m18:52:23.731376 [debug] [Thread-1 (]: Began executing node test.quest_kingdom.not_null_stg_iap_transactions_transaction_id.bc4fc23645
[0m18:52:23.732469 [debug] [Thread-1 (]: Writing runtime sql for node "test.quest_kingdom.not_null_stg_iap_transactions_transaction_id.bc4fc23645"
[0m18:52:23.732775 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.not_null_stg_iap_transactions_transaction_id.bc4fc23645"
[0m18:52:23.732924 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_stg_iap_transactions_transaction_id.bc4fc23645: BEGIN
[0m18:52:23.733063 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:52:23.733409 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:52:23.733556 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.not_null_stg_iap_transactions_transaction_id.bc4fc23645"
[0m18:52:23.733712 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_stg_iap_transactions_transaction_id.bc4fc23645: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "test.quest_kingdom.not_null_stg_iap_transactions_transaction_id.bc4fc23645"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select transaction_id
from "quest_kingdom"."main"."stg_iap_transactions"
where transaction_id is null



  
  
      
    ) dbt_internal_test
[0m18:52:23.734410 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m18:52:23.735154 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_stg_iap_transactions_transaction_id.bc4fc23645: ROLLBACK
[0m18:52:23.735623 [debug] [Thread-1 (]: Failed to rollback 'test.quest_kingdom.not_null_stg_iap_transactions_transaction_id.bc4fc23645'
[0m18:52:23.735778 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_stg_iap_transactions_transaction_id.bc4fc23645: Close
[0m18:52:23.736027 [info ] [Thread-1 (]: 11 of 23 PASS not_null_stg_iap_transactions_transaction_id ..................... [[32mPASS[0m in 0.01s]
[0m18:52:23.736267 [debug] [Thread-1 (]: Finished running node test.quest_kingdom.not_null_stg_iap_transactions_transaction_id.bc4fc23645
[0m18:52:23.736438 [debug] [Thread-1 (]: Began running node test.quest_kingdom.not_null_stg_players_installed_at.60c4ce69cb
[0m18:52:23.736621 [info ] [Thread-1 (]: 12 of 23 START test not_null_stg_players_installed_at .......................... [RUN]
[0m18:52:23.736827 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.quest_kingdom.not_null_stg_iap_transactions_transaction_id.bc4fc23645, now test.quest_kingdom.not_null_stg_players_installed_at.60c4ce69cb)
[0m18:52:23.736989 [debug] [Thread-1 (]: Began compiling node test.quest_kingdom.not_null_stg_players_installed_at.60c4ce69cb
[0m18:52:23.739547 [debug] [Thread-1 (]: Writing injected SQL for node "test.quest_kingdom.not_null_stg_players_installed_at.60c4ce69cb"
[0m18:52:23.740051 [debug] [Thread-1 (]: Began executing node test.quest_kingdom.not_null_stg_players_installed_at.60c4ce69cb
[0m18:52:23.741422 [debug] [Thread-1 (]: Writing runtime sql for node "test.quest_kingdom.not_null_stg_players_installed_at.60c4ce69cb"
[0m18:52:23.741860 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.not_null_stg_players_installed_at.60c4ce69cb"
[0m18:52:23.742020 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_stg_players_installed_at.60c4ce69cb: BEGIN
[0m18:52:23.742164 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:52:23.742530 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:52:23.742679 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.not_null_stg_players_installed_at.60c4ce69cb"
[0m18:52:23.742830 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_stg_players_installed_at.60c4ce69cb: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "test.quest_kingdom.not_null_stg_players_installed_at.60c4ce69cb"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select installed_at
from "quest_kingdom"."main"."stg_players"
where installed_at is null



  
  
      
    ) dbt_internal_test
[0m18:52:23.743737 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m18:52:23.744578 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_stg_players_installed_at.60c4ce69cb: ROLLBACK
[0m18:52:23.745084 [debug] [Thread-1 (]: Failed to rollback 'test.quest_kingdom.not_null_stg_players_installed_at.60c4ce69cb'
[0m18:52:23.745254 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_stg_players_installed_at.60c4ce69cb: Close
[0m18:52:23.745544 [info ] [Thread-1 (]: 12 of 23 PASS not_null_stg_players_installed_at ................................ [[32mPASS[0m in 0.01s]
[0m18:52:23.745794 [debug] [Thread-1 (]: Finished running node test.quest_kingdom.not_null_stg_players_installed_at.60c4ce69cb
[0m18:52:23.745970 [debug] [Thread-1 (]: Began running node test.quest_kingdom.not_null_stg_players_player_id.702d1d8c7b
[0m18:52:23.746158 [info ] [Thread-1 (]: 13 of 23 START test not_null_stg_players_player_id ............................. [RUN]
[0m18:52:23.746342 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.quest_kingdom.not_null_stg_players_installed_at.60c4ce69cb, now test.quest_kingdom.not_null_stg_players_player_id.702d1d8c7b)
[0m18:52:23.746497 [debug] [Thread-1 (]: Began compiling node test.quest_kingdom.not_null_stg_players_player_id.702d1d8c7b
[0m18:52:23.748662 [debug] [Thread-1 (]: Writing injected SQL for node "test.quest_kingdom.not_null_stg_players_player_id.702d1d8c7b"
[0m18:52:23.749101 [debug] [Thread-1 (]: Began executing node test.quest_kingdom.not_null_stg_players_player_id.702d1d8c7b
[0m18:52:23.750288 [debug] [Thread-1 (]: Writing runtime sql for node "test.quest_kingdom.not_null_stg_players_player_id.702d1d8c7b"
[0m18:52:23.750649 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.not_null_stg_players_player_id.702d1d8c7b"
[0m18:52:23.750810 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_stg_players_player_id.702d1d8c7b: BEGIN
[0m18:52:23.750954 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:52:23.751359 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:52:23.751518 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.not_null_stg_players_player_id.702d1d8c7b"
[0m18:52:23.751673 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_stg_players_player_id.702d1d8c7b: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "test.quest_kingdom.not_null_stg_players_player_id.702d1d8c7b"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select player_id
from "quest_kingdom"."main"."stg_players"
where player_id is null



  
  
      
    ) dbt_internal_test
[0m18:52:23.752684 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m18:52:23.753509 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_stg_players_player_id.702d1d8c7b: ROLLBACK
[0m18:52:23.754071 [debug] [Thread-1 (]: Failed to rollback 'test.quest_kingdom.not_null_stg_players_player_id.702d1d8c7b'
[0m18:52:23.754261 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_stg_players_player_id.702d1d8c7b: Close
[0m18:52:23.754586 [info ] [Thread-1 (]: 13 of 23 PASS not_null_stg_players_player_id ................................... [[32mPASS[0m in 0.01s]
[0m18:52:23.755142 [debug] [Thread-1 (]: Finished running node test.quest_kingdom.not_null_stg_players_player_id.702d1d8c7b
[0m18:52:23.755417 [debug] [Thread-1 (]: Began running node test.quest_kingdom.not_null_stg_sessions_player_id.fa13833b29
[0m18:52:23.755655 [info ] [Thread-1 (]: 14 of 23 START test not_null_stg_sessions_player_id ............................ [RUN]
[0m18:52:23.755894 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.quest_kingdom.not_null_stg_players_player_id.702d1d8c7b, now test.quest_kingdom.not_null_stg_sessions_player_id.fa13833b29)
[0m18:52:23.756065 [debug] [Thread-1 (]: Began compiling node test.quest_kingdom.not_null_stg_sessions_player_id.fa13833b29
[0m18:52:23.758262 [debug] [Thread-1 (]: Writing injected SQL for node "test.quest_kingdom.not_null_stg_sessions_player_id.fa13833b29"
[0m18:52:23.758734 [debug] [Thread-1 (]: Began executing node test.quest_kingdom.not_null_stg_sessions_player_id.fa13833b29
[0m18:52:23.761128 [debug] [Thread-1 (]: Writing runtime sql for node "test.quest_kingdom.not_null_stg_sessions_player_id.fa13833b29"
[0m18:52:23.761639 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.not_null_stg_sessions_player_id.fa13833b29"
[0m18:52:23.761853 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_stg_sessions_player_id.fa13833b29: BEGIN
[0m18:52:23.762022 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:52:23.762408 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:52:23.762565 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.not_null_stg_sessions_player_id.fa13833b29"
[0m18:52:23.762725 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_stg_sessions_player_id.fa13833b29: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "test.quest_kingdom.not_null_stg_sessions_player_id.fa13833b29"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select player_id
from "quest_kingdom"."main"."stg_sessions"
where player_id is null



  
  
      
    ) dbt_internal_test
[0m18:52:23.763615 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m18:52:23.764459 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_stg_sessions_player_id.fa13833b29: ROLLBACK
[0m18:52:23.764953 [debug] [Thread-1 (]: Failed to rollback 'test.quest_kingdom.not_null_stg_sessions_player_id.fa13833b29'
[0m18:52:23.765120 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_stg_sessions_player_id.fa13833b29: Close
[0m18:52:23.765819 [info ] [Thread-1 (]: 14 of 23 PASS not_null_stg_sessions_player_id .................................. [[32mPASS[0m in 0.01s]
[0m18:52:23.766228 [debug] [Thread-1 (]: Finished running node test.quest_kingdom.not_null_stg_sessions_player_id.fa13833b29
[0m18:52:23.767022 [debug] [Thread-1 (]: Began running node test.quest_kingdom.not_null_stg_sessions_session_id.2e872a126d
[0m18:52:23.767305 [info ] [Thread-1 (]: 15 of 23 START test not_null_stg_sessions_session_id ........................... [RUN]
[0m18:52:23.767582 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.quest_kingdom.not_null_stg_sessions_player_id.fa13833b29, now test.quest_kingdom.not_null_stg_sessions_session_id.2e872a126d)
[0m18:52:23.767789 [debug] [Thread-1 (]: Began compiling node test.quest_kingdom.not_null_stg_sessions_session_id.2e872a126d
[0m18:52:23.770155 [debug] [Thread-1 (]: Writing injected SQL for node "test.quest_kingdom.not_null_stg_sessions_session_id.2e872a126d"
[0m18:52:23.770628 [debug] [Thread-1 (]: Began executing node test.quest_kingdom.not_null_stg_sessions_session_id.2e872a126d
[0m18:52:23.772988 [debug] [Thread-1 (]: Writing runtime sql for node "test.quest_kingdom.not_null_stg_sessions_session_id.2e872a126d"
[0m18:52:23.773589 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.not_null_stg_sessions_session_id.2e872a126d"
[0m18:52:23.773769 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_stg_sessions_session_id.2e872a126d: BEGIN
[0m18:52:23.773927 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:52:23.774304 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:52:23.774458 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.not_null_stg_sessions_session_id.2e872a126d"
[0m18:52:23.774616 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_stg_sessions_session_id.2e872a126d: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "test.quest_kingdom.not_null_stg_sessions_session_id.2e872a126d"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select session_id
from "quest_kingdom"."main"."stg_sessions"
where session_id is null



  
  
      
    ) dbt_internal_test
[0m18:52:23.775480 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m18:52:23.776327 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_stg_sessions_session_id.2e872a126d: ROLLBACK
[0m18:52:23.776828 [debug] [Thread-1 (]: Failed to rollback 'test.quest_kingdom.not_null_stg_sessions_session_id.2e872a126d'
[0m18:52:23.777001 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_stg_sessions_session_id.2e872a126d: Close
[0m18:52:23.777300 [info ] [Thread-1 (]: 15 of 23 PASS not_null_stg_sessions_session_id ................................. [[32mPASS[0m in 0.01s]
[0m18:52:23.777556 [debug] [Thread-1 (]: Finished running node test.quest_kingdom.not_null_stg_sessions_session_id.2e872a126d
[0m18:52:23.777733 [debug] [Thread-1 (]: Began running node test.quest_kingdom.not_null_stg_sessions_session_started_at.039a312a09
[0m18:52:23.777923 [info ] [Thread-1 (]: 16 of 23 START test not_null_stg_sessions_session_started_at ................... [RUN]
[0m18:52:23.778109 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.quest_kingdom.not_null_stg_sessions_session_id.2e872a126d, now test.quest_kingdom.not_null_stg_sessions_session_started_at.039a312a09)
[0m18:52:23.778266 [debug] [Thread-1 (]: Began compiling node test.quest_kingdom.not_null_stg_sessions_session_started_at.039a312a09
[0m18:52:23.780479 [debug] [Thread-1 (]: Writing injected SQL for node "test.quest_kingdom.not_null_stg_sessions_session_started_at.039a312a09"
[0m18:52:23.780974 [debug] [Thread-1 (]: Began executing node test.quest_kingdom.not_null_stg_sessions_session_started_at.039a312a09
[0m18:52:23.782202 [debug] [Thread-1 (]: Writing runtime sql for node "test.quest_kingdom.not_null_stg_sessions_session_started_at.039a312a09"
[0m18:52:23.782550 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.not_null_stg_sessions_session_started_at.039a312a09"
[0m18:52:23.782712 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_stg_sessions_session_started_at.039a312a09: BEGIN
[0m18:52:23.782852 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:52:23.783211 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:52:23.783361 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.not_null_stg_sessions_session_started_at.039a312a09"
[0m18:52:23.783517 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_stg_sessions_session_started_at.039a312a09: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "test.quest_kingdom.not_null_stg_sessions_session_started_at.039a312a09"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select session_started_at
from "quest_kingdom"."main"."stg_sessions"
where session_started_at is null



  
  
      
    ) dbt_internal_test
[0m18:52:23.784452 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m18:52:23.785274 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_stg_sessions_session_started_at.039a312a09: ROLLBACK
[0m18:52:23.785756 [debug] [Thread-1 (]: Failed to rollback 'test.quest_kingdom.not_null_stg_sessions_session_started_at.039a312a09'
[0m18:52:23.785914 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_stg_sessions_session_started_at.039a312a09: Close
[0m18:52:23.786180 [info ] [Thread-1 (]: 16 of 23 PASS not_null_stg_sessions_session_started_at ......................... [[32mPASS[0m in 0.01s]
[0m18:52:23.786423 [debug] [Thread-1 (]: Finished running node test.quest_kingdom.not_null_stg_sessions_session_started_at.039a312a09
[0m18:52:23.786605 [debug] [Thread-1 (]: Began running node test.quest_kingdom.relationships_stg_iap_transactions_player_id__player_id__ref_stg_players_.ec3ff36963
[0m18:52:23.786789 [info ] [Thread-1 (]: 17 of 23 START test relationships_stg_iap_transactions_player_id__player_id__ref_stg_players_  [RUN]
[0m18:52:23.786969 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.quest_kingdom.not_null_stg_sessions_session_started_at.039a312a09, now test.quest_kingdom.relationships_stg_iap_transactions_player_id__player_id__ref_stg_players_.ec3ff36963)
[0m18:52:23.787129 [debug] [Thread-1 (]: Began compiling node test.quest_kingdom.relationships_stg_iap_transactions_player_id__player_id__ref_stg_players_.ec3ff36963
[0m18:52:23.791604 [debug] [Thread-1 (]: Writing injected SQL for node "test.quest_kingdom.relationships_stg_iap_transactions_player_id__player_id__ref_stg_players_.ec3ff36963"
[0m18:52:23.792175 [debug] [Thread-1 (]: Began executing node test.quest_kingdom.relationships_stg_iap_transactions_player_id__player_id__ref_stg_players_.ec3ff36963
[0m18:52:23.793485 [debug] [Thread-1 (]: Writing runtime sql for node "test.quest_kingdom.relationships_stg_iap_transactions_player_id__player_id__ref_stg_players_.ec3ff36963"
[0m18:52:23.793892 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.relationships_stg_iap_transactions_player_id__player_id__ref_stg_players_.ec3ff36963"
[0m18:52:23.794062 [debug] [Thread-1 (]: On test.quest_kingdom.relationships_stg_iap_transactions_player_id__player_id__ref_stg_players_.ec3ff36963: BEGIN
[0m18:52:23.794214 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:52:23.794574 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:52:23.794727 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.relationships_stg_iap_transactions_player_id__player_id__ref_stg_players_.ec3ff36963"
[0m18:52:23.794894 [debug] [Thread-1 (]: On test.quest_kingdom.relationships_stg_iap_transactions_player_id__player_id__ref_stg_players_.ec3ff36963: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "test.quest_kingdom.relationships_stg_iap_transactions_player_id__player_id__ref_stg_players_.ec3ff36963"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

with child as (
    select player_id as from_field
    from "quest_kingdom"."main"."stg_iap_transactions"
    where player_id is not null
),

parent as (
    select player_id as to_field
    from "quest_kingdom"."main"."stg_players"
)

select
    from_field

from child
left join parent
    on child.from_field = parent.to_field

where parent.to_field is null



  
  
      
    ) dbt_internal_test
[0m18:52:23.800090 [debug] [Thread-1 (]: SQL status: OK in 0.005 seconds
[0m18:52:23.800940 [debug] [Thread-1 (]: On test.quest_kingdom.relationships_stg_iap_transactions_player_id__player_id__ref_stg_players_.ec3ff36963: ROLLBACK
[0m18:52:23.801407 [debug] [Thread-1 (]: Failed to rollback 'test.quest_kingdom.relationships_stg_iap_transactions_player_id__player_id__ref_stg_players_.ec3ff36963'
[0m18:52:23.801574 [debug] [Thread-1 (]: On test.quest_kingdom.relationships_stg_iap_transactions_player_id__player_id__ref_stg_players_.ec3ff36963: Close
[0m18:52:23.801850 [info ] [Thread-1 (]: 17 of 23 PASS relationships_stg_iap_transactions_player_id__player_id__ref_stg_players_  [[32mPASS[0m in 0.01s]
[0m18:52:23.802097 [debug] [Thread-1 (]: Finished running node test.quest_kingdom.relationships_stg_iap_transactions_player_id__player_id__ref_stg_players_.ec3ff36963
[0m18:52:23.802276 [debug] [Thread-1 (]: Began running node test.quest_kingdom.relationships_stg_sessions_player_id__player_id__ref_stg_players_.6b4c9276ee
[0m18:52:23.802462 [info ] [Thread-1 (]: 18 of 23 START test relationships_stg_sessions_player_id__player_id__ref_stg_players_  [RUN]
[0m18:52:23.802644 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.quest_kingdom.relationships_stg_iap_transactions_player_id__player_id__ref_stg_players_.ec3ff36963, now test.quest_kingdom.relationships_stg_sessions_player_id__player_id__ref_stg_players_.6b4c9276ee)
[0m18:52:23.802805 [debug] [Thread-1 (]: Began compiling node test.quest_kingdom.relationships_stg_sessions_player_id__player_id__ref_stg_players_.6b4c9276ee
[0m18:52:23.805642 [debug] [Thread-1 (]: Writing injected SQL for node "test.quest_kingdom.relationships_stg_sessions_player_id__player_id__ref_stg_players_.6b4c9276ee"
[0m18:52:23.806128 [debug] [Thread-1 (]: Began executing node test.quest_kingdom.relationships_stg_sessions_player_id__player_id__ref_stg_players_.6b4c9276ee
[0m18:52:23.807359 [debug] [Thread-1 (]: Writing runtime sql for node "test.quest_kingdom.relationships_stg_sessions_player_id__player_id__ref_stg_players_.6b4c9276ee"
[0m18:52:23.807728 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.relationships_stg_sessions_player_id__player_id__ref_stg_players_.6b4c9276ee"
[0m18:52:23.807916 [debug] [Thread-1 (]: On test.quest_kingdom.relationships_stg_sessions_player_id__player_id__ref_stg_players_.6b4c9276ee: BEGIN
[0m18:52:23.808070 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:52:23.808508 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:52:23.808660 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.relationships_stg_sessions_player_id__player_id__ref_stg_players_.6b4c9276ee"
[0m18:52:23.808826 [debug] [Thread-1 (]: On test.quest_kingdom.relationships_stg_sessions_player_id__player_id__ref_stg_players_.6b4c9276ee: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "test.quest_kingdom.relationships_stg_sessions_player_id__player_id__ref_stg_players_.6b4c9276ee"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

with child as (
    select player_id as from_field
    from "quest_kingdom"."main"."stg_sessions"
    where player_id is not null
),

parent as (
    select player_id as to_field
    from "quest_kingdom"."main"."stg_players"
)

select
    from_field

from child
left join parent
    on child.from_field = parent.to_field

where parent.to_field is null



  
  
      
    ) dbt_internal_test
[0m18:52:23.811647 [debug] [Thread-1 (]: SQL status: OK in 0.003 seconds
[0m18:52:23.812473 [debug] [Thread-1 (]: On test.quest_kingdom.relationships_stg_sessions_player_id__player_id__ref_stg_players_.6b4c9276ee: ROLLBACK
[0m18:52:23.812956 [debug] [Thread-1 (]: Failed to rollback 'test.quest_kingdom.relationships_stg_sessions_player_id__player_id__ref_stg_players_.6b4c9276ee'
[0m18:52:23.813131 [debug] [Thread-1 (]: On test.quest_kingdom.relationships_stg_sessions_player_id__player_id__ref_stg_players_.6b4c9276ee: Close
[0m18:52:23.813544 [info ] [Thread-1 (]: 18 of 23 PASS relationships_stg_sessions_player_id__player_id__ref_stg_players_  [[32mPASS[0m in 0.01s]
[0m18:52:23.813817 [debug] [Thread-1 (]: Finished running node test.quest_kingdom.relationships_stg_sessions_player_id__player_id__ref_stg_players_.6b4c9276ee
[0m18:52:23.813994 [debug] [Thread-1 (]: Began running node test.quest_kingdom.unique_stg_ad_impressions_ad_id.618068e7ef
[0m18:52:23.814183 [info ] [Thread-1 (]: 19 of 23 START test unique_stg_ad_impressions_ad_id ............................ [RUN]
[0m18:52:23.814396 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.quest_kingdom.relationships_stg_sessions_player_id__player_id__ref_stg_players_.6b4c9276ee, now test.quest_kingdom.unique_stg_ad_impressions_ad_id.618068e7ef)
[0m18:52:23.814564 [debug] [Thread-1 (]: Began compiling node test.quest_kingdom.unique_stg_ad_impressions_ad_id.618068e7ef
[0m18:52:23.817610 [debug] [Thread-1 (]: Writing injected SQL for node "test.quest_kingdom.unique_stg_ad_impressions_ad_id.618068e7ef"
[0m18:52:23.818001 [debug] [Thread-1 (]: Began executing node test.quest_kingdom.unique_stg_ad_impressions_ad_id.618068e7ef
[0m18:52:23.820136 [debug] [Thread-1 (]: Writing runtime sql for node "test.quest_kingdom.unique_stg_ad_impressions_ad_id.618068e7ef"
[0m18:52:23.820636 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.unique_stg_ad_impressions_ad_id.618068e7ef"
[0m18:52:23.820821 [debug] [Thread-1 (]: On test.quest_kingdom.unique_stg_ad_impressions_ad_id.618068e7ef: BEGIN
[0m18:52:23.821018 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:52:23.821512 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:52:23.821715 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.unique_stg_ad_impressions_ad_id.618068e7ef"
[0m18:52:23.821887 [debug] [Thread-1 (]: On test.quest_kingdom.unique_stg_ad_impressions_ad_id.618068e7ef: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "test.quest_kingdom.unique_stg_ad_impressions_ad_id.618068e7ef"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    ad_id as unique_field,
    count(*) as n_records

from "quest_kingdom"."main"."stg_ad_impressions"
where ad_id is not null
group by ad_id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m18:52:23.826823 [debug] [Thread-1 (]: SQL status: OK in 0.005 seconds
[0m18:52:23.827708 [debug] [Thread-1 (]: On test.quest_kingdom.unique_stg_ad_impressions_ad_id.618068e7ef: ROLLBACK
[0m18:52:23.828181 [debug] [Thread-1 (]: Failed to rollback 'test.quest_kingdom.unique_stg_ad_impressions_ad_id.618068e7ef'
[0m18:52:23.828338 [debug] [Thread-1 (]: On test.quest_kingdom.unique_stg_ad_impressions_ad_id.618068e7ef: Close
[0m18:52:23.828610 [info ] [Thread-1 (]: 19 of 23 PASS unique_stg_ad_impressions_ad_id .................................. [[32mPASS[0m in 0.01s]
[0m18:52:23.828853 [debug] [Thread-1 (]: Finished running node test.quest_kingdom.unique_stg_ad_impressions_ad_id.618068e7ef
[0m18:52:23.829028 [debug] [Thread-1 (]: Began running node test.quest_kingdom.unique_stg_events_event_id.66ebb17438
[0m18:52:23.829228 [info ] [Thread-1 (]: 20 of 23 START test unique_stg_events_event_id ................................. [RUN]
[0m18:52:23.829453 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.quest_kingdom.unique_stg_ad_impressions_ad_id.618068e7ef, now test.quest_kingdom.unique_stg_events_event_id.66ebb17438)
[0m18:52:23.829624 [debug] [Thread-1 (]: Began compiling node test.quest_kingdom.unique_stg_events_event_id.66ebb17438
[0m18:52:23.831688 [debug] [Thread-1 (]: Writing injected SQL for node "test.quest_kingdom.unique_stg_events_event_id.66ebb17438"
[0m18:52:23.832094 [debug] [Thread-1 (]: Began executing node test.quest_kingdom.unique_stg_events_event_id.66ebb17438
[0m18:52:23.833273 [debug] [Thread-1 (]: Writing runtime sql for node "test.quest_kingdom.unique_stg_events_event_id.66ebb17438"
[0m18:52:23.833638 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.unique_stg_events_event_id.66ebb17438"
[0m18:52:23.833802 [debug] [Thread-1 (]: On test.quest_kingdom.unique_stg_events_event_id.66ebb17438: BEGIN
[0m18:52:23.833944 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:52:23.834286 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:52:23.834433 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.unique_stg_events_event_id.66ebb17438"
[0m18:52:23.834591 [debug] [Thread-1 (]: On test.quest_kingdom.unique_stg_events_event_id.66ebb17438: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "test.quest_kingdom.unique_stg_events_event_id.66ebb17438"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    event_id as unique_field,
    count(*) as n_records

from "quest_kingdom"."main"."stg_events"
where event_id is not null
group by event_id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m18:52:23.836934 [debug] [Thread-1 (]: SQL status: OK in 0.002 seconds
[0m18:52:23.837811 [debug] [Thread-1 (]: On test.quest_kingdom.unique_stg_events_event_id.66ebb17438: ROLLBACK
[0m18:52:23.838545 [debug] [Thread-1 (]: Failed to rollback 'test.quest_kingdom.unique_stg_events_event_id.66ebb17438'
[0m18:52:23.838783 [debug] [Thread-1 (]: On test.quest_kingdom.unique_stg_events_event_id.66ebb17438: Close
[0m18:52:23.839110 [info ] [Thread-1 (]: 20 of 23 PASS unique_stg_events_event_id ....................................... [[32mPASS[0m in 0.01s]
[0m18:52:23.839371 [debug] [Thread-1 (]: Finished running node test.quest_kingdom.unique_stg_events_event_id.66ebb17438
[0m18:52:23.839549 [debug] [Thread-1 (]: Began running node test.quest_kingdom.unique_stg_iap_transactions_transaction_id.3bff016069
[0m18:52:23.839731 [info ] [Thread-1 (]: 21 of 23 START test unique_stg_iap_transactions_transaction_id ................. [RUN]
[0m18:52:23.839915 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.quest_kingdom.unique_stg_events_event_id.66ebb17438, now test.quest_kingdom.unique_stg_iap_transactions_transaction_id.3bff016069)
[0m18:52:23.840071 [debug] [Thread-1 (]: Began compiling node test.quest_kingdom.unique_stg_iap_transactions_transaction_id.3bff016069
[0m18:52:23.842141 [debug] [Thread-1 (]: Writing injected SQL for node "test.quest_kingdom.unique_stg_iap_transactions_transaction_id.3bff016069"
[0m18:52:23.842572 [debug] [Thread-1 (]: Began executing node test.quest_kingdom.unique_stg_iap_transactions_transaction_id.3bff016069
[0m18:52:23.843678 [debug] [Thread-1 (]: Writing runtime sql for node "test.quest_kingdom.unique_stg_iap_transactions_transaction_id.3bff016069"
[0m18:52:23.843984 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.unique_stg_iap_transactions_transaction_id.3bff016069"
[0m18:52:23.844138 [debug] [Thread-1 (]: On test.quest_kingdom.unique_stg_iap_transactions_transaction_id.3bff016069: BEGIN
[0m18:52:23.844279 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:52:23.844617 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:52:23.844762 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.unique_stg_iap_transactions_transaction_id.3bff016069"
[0m18:52:23.844919 [debug] [Thread-1 (]: On test.quest_kingdom.unique_stg_iap_transactions_transaction_id.3bff016069: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "test.quest_kingdom.unique_stg_iap_transactions_transaction_id.3bff016069"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    transaction_id as unique_field,
    count(*) as n_records

from "quest_kingdom"."main"."stg_iap_transactions"
where transaction_id is not null
group by transaction_id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m18:52:23.846552 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m18:52:23.847515 [debug] [Thread-1 (]: On test.quest_kingdom.unique_stg_iap_transactions_transaction_id.3bff016069: ROLLBACK
[0m18:52:23.848001 [debug] [Thread-1 (]: Failed to rollback 'test.quest_kingdom.unique_stg_iap_transactions_transaction_id.3bff016069'
[0m18:52:23.848161 [debug] [Thread-1 (]: On test.quest_kingdom.unique_stg_iap_transactions_transaction_id.3bff016069: Close
[0m18:52:23.848449 [info ] [Thread-1 (]: 21 of 23 PASS unique_stg_iap_transactions_transaction_id ....................... [[32mPASS[0m in 0.01s]
[0m18:52:23.848702 [debug] [Thread-1 (]: Finished running node test.quest_kingdom.unique_stg_iap_transactions_transaction_id.3bff016069
[0m18:52:23.848881 [debug] [Thread-1 (]: Began running node test.quest_kingdom.unique_stg_players_player_id.a3d551d71d
[0m18:52:23.849068 [info ] [Thread-1 (]: 22 of 23 START test unique_stg_players_player_id ............................... [RUN]
[0m18:52:23.849259 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.quest_kingdom.unique_stg_iap_transactions_transaction_id.3bff016069, now test.quest_kingdom.unique_stg_players_player_id.a3d551d71d)
[0m18:52:23.849417 [debug] [Thread-1 (]: Began compiling node test.quest_kingdom.unique_stg_players_player_id.a3d551d71d
[0m18:52:23.851448 [debug] [Thread-1 (]: Writing injected SQL for node "test.quest_kingdom.unique_stg_players_player_id.a3d551d71d"
[0m18:52:23.851859 [debug] [Thread-1 (]: Began executing node test.quest_kingdom.unique_stg_players_player_id.a3d551d71d
[0m18:52:23.852986 [debug] [Thread-1 (]: Writing runtime sql for node "test.quest_kingdom.unique_stg_players_player_id.a3d551d71d"
[0m18:52:23.853313 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.unique_stg_players_player_id.a3d551d71d"
[0m18:52:23.853471 [debug] [Thread-1 (]: On test.quest_kingdom.unique_stg_players_player_id.a3d551d71d: BEGIN
[0m18:52:23.853619 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:52:23.853997 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:52:23.854189 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.unique_stg_players_player_id.a3d551d71d"
[0m18:52:23.854387 [debug] [Thread-1 (]: On test.quest_kingdom.unique_stg_players_player_id.a3d551d71d: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "test.quest_kingdom.unique_stg_players_player_id.a3d551d71d"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    player_id as unique_field,
    count(*) as n_records

from "quest_kingdom"."main"."stg_players"
where player_id is not null
group by player_id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m18:52:23.856402 [debug] [Thread-1 (]: SQL status: OK in 0.002 seconds
[0m18:52:23.857408 [debug] [Thread-1 (]: On test.quest_kingdom.unique_stg_players_player_id.a3d551d71d: ROLLBACK
[0m18:52:23.857874 [debug] [Thread-1 (]: Failed to rollback 'test.quest_kingdom.unique_stg_players_player_id.a3d551d71d'
[0m18:52:23.858026 [debug] [Thread-1 (]: On test.quest_kingdom.unique_stg_players_player_id.a3d551d71d: Close
[0m18:52:23.858292 [info ] [Thread-1 (]: 22 of 23 PASS unique_stg_players_player_id ..................................... [[32mPASS[0m in 0.01s]
[0m18:52:23.858534 [debug] [Thread-1 (]: Finished running node test.quest_kingdom.unique_stg_players_player_id.a3d551d71d
[0m18:52:23.858706 [debug] [Thread-1 (]: Began running node test.quest_kingdom.unique_stg_sessions_session_id.ce45726d03
[0m18:52:23.858903 [info ] [Thread-1 (]: 23 of 23 START test unique_stg_sessions_session_id ............................. [RUN]
[0m18:52:23.859115 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.quest_kingdom.unique_stg_players_player_id.a3d551d71d, now test.quest_kingdom.unique_stg_sessions_session_id.ce45726d03)
[0m18:52:23.859276 [debug] [Thread-1 (]: Began compiling node test.quest_kingdom.unique_stg_sessions_session_id.ce45726d03
[0m18:52:23.861322 [debug] [Thread-1 (]: Writing injected SQL for node "test.quest_kingdom.unique_stg_sessions_session_id.ce45726d03"
[0m18:52:23.861744 [debug] [Thread-1 (]: Began executing node test.quest_kingdom.unique_stg_sessions_session_id.ce45726d03
[0m18:52:23.862941 [debug] [Thread-1 (]: Writing runtime sql for node "test.quest_kingdom.unique_stg_sessions_session_id.ce45726d03"
[0m18:52:23.863278 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.unique_stg_sessions_session_id.ce45726d03"
[0m18:52:23.863442 [debug] [Thread-1 (]: On test.quest_kingdom.unique_stg_sessions_session_id.ce45726d03: BEGIN
[0m18:52:23.863593 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:52:23.863958 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:52:23.864109 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.unique_stg_sessions_session_id.ce45726d03"
[0m18:52:23.864369 [debug] [Thread-1 (]: On test.quest_kingdom.unique_stg_sessions_session_id.ce45726d03: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "test.quest_kingdom.unique_stg_sessions_session_id.ce45726d03"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    session_id as unique_field,
    count(*) as n_records

from "quest_kingdom"."main"."stg_sessions"
where session_id is not null
group by session_id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m18:52:23.869215 [debug] [Thread-1 (]: SQL status: OK in 0.005 seconds
[0m18:52:23.870122 [debug] [Thread-1 (]: On test.quest_kingdom.unique_stg_sessions_session_id.ce45726d03: ROLLBACK
[0m18:52:23.870597 [debug] [Thread-1 (]: Failed to rollback 'test.quest_kingdom.unique_stg_sessions_session_id.ce45726d03'
[0m18:52:23.870752 [debug] [Thread-1 (]: On test.quest_kingdom.unique_stg_sessions_session_id.ce45726d03: Close
[0m18:52:23.871109 [info ] [Thread-1 (]: 23 of 23 PASS unique_stg_sessions_session_id ................................... [[32mPASS[0m in 0.01s]
[0m18:52:23.871458 [debug] [Thread-1 (]: Finished running node test.quest_kingdom.unique_stg_sessions_session_id.ce45726d03
[0m18:52:23.872206 [debug] [MainThread]: Using duckdb connection "master"
[0m18:52:23.872371 [debug] [MainThread]: On master: BEGIN
[0m18:52:23.872497 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m18:52:23.872827 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m18:52:23.872958 [debug] [MainThread]: On master: COMMIT
[0m18:52:23.873083 [debug] [MainThread]: Using duckdb connection "master"
[0m18:52:23.873200 [debug] [MainThread]: On master: COMMIT
[0m18:52:23.873394 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m18:52:23.873520 [debug] [MainThread]: On master: Close
[0m18:52:23.873682 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:52:23.873799 [debug] [MainThread]: Connection 'test.quest_kingdom.unique_stg_sessions_session_id.ce45726d03' was properly closed.
[0m18:52:23.873938 [info ] [MainThread]: 
[0m18:52:23.874081 [info ] [MainThread]: Finished running 23 data tests in 0 hours 0 minutes and 0.35 seconds (0.35s).
[0m18:52:23.875410 [debug] [MainThread]: Command end result
[0m18:52:23.889397 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/manifest.json
[0m18:52:23.890472 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/semantic_manifest.json
[0m18:52:23.893931 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/run_results.json
[0m18:52:23.894102 [info ] [MainThread]: 
[0m18:52:23.894278 [info ] [MainThread]: [32mCompleted successfully[0m
[0m18:52:23.894421 [info ] [MainThread]: 
[0m18:52:23.894566 [info ] [MainThread]: Done. PASS=23 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=23
[0m18:52:23.895963 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 0.83965135, "process_in_blocks": "0", "process_kernel_time": 0.207982, "process_mem_max_rss": "155631616", "process_out_blocks": "0", "process_user_time": 1.286883}
[0m18:52:23.896192 [debug] [MainThread]: Command `dbt test` succeeded at 18:52:23.896153 after 0.84 seconds
[0m18:52:23.896363 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11c357560>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11d663ce0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11daadb80>]}
[0m18:52:23.896527 [debug] [MainThread]: Flushing usage events
[0m18:52:24.008663 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m18:52:31.893119 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105209850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106cb5cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106cb5a90>]}


============================== 18:52:31.896119 | 27cf6eb4-6a37-4d90-8082-ff4a7cfcd879 ==============================
[0m18:52:31.896119 [info ] [MainThread]: Running with dbt=1.11.4
[0m18:52:31.896428 [debug] [MainThread]: running dbt with arguments {'no_print': 'None', 'write_json': 'True', 'invocation_command': 'dbt docs generate', 'empty': 'None', 'profiles_dir': '/Users/hazeldonaldson/.dbt', 'static_parser': 'True', 'printer_width': '80', 'log_path': '/Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/logs', 'send_anonymous_usage_stats': 'True', 'debug': 'False', 'quiet': 'False', 'log_format': 'default', 'warn_error': 'None', 'use_colors': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'target_path': 'None', 'indirect_selection': 'eager', 'fail_fast': 'False', 'version_check': 'True', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'partial_parse': 'True', 'introspect': 'True', 'log_cache_events': 'False'}
[0m18:52:32.002192 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '27cf6eb4-6a37-4d90-8082-ff4a7cfcd879', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106ee01d0>]}
[0m18:52:32.030103 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '27cf6eb4-6a37-4d90-8082-ff4a7cfcd879', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105294e60>]}
[0m18:52:32.032200 [info ] [MainThread]: Registered adapter: duckdb=1.10.0
[0m18:52:32.080953 [debug] [MainThread]: checksum: 092b177ba87eb6bb3c55954c38aa57900eebac336561eb9ee32218428aa81d43, vars: {}, profile: , target: , version: 1.11.4
[0m18:52:32.144134 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m18:52:32.144388 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m18:52:32.144534 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m18:52:32.147630 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 7 unused configuration paths:
- models.product
- models.monetization
- models.retention
- models.staging
- models.marts
- models.core
- models.question_kingdom
[0m18:52:32.167131 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '27cf6eb4-6a37-4d90-8082-ff4a7cfcd879', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106e8f710>]}
[0m18:52:32.180233 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '27cf6eb4-6a37-4d90-8082-ff4a7cfcd879', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107e4fdd0>]}
[0m18:52:32.180522 [info ] [MainThread]: Found 7 models, 23 data tests, 5 sources, 472 macros
[0m18:52:32.180695 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '27cf6eb4-6a37-4d90-8082-ff4a7cfcd879', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107dc2f90>]}
[0m18:52:32.181987 [info ] [MainThread]: 
[0m18:52:32.182175 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m18:52:32.182316 [info ] [MainThread]: 
[0m18:52:32.182552 [debug] [MainThread]: Acquiring new duckdb connection 'master'
[0m18:52:32.184765 [debug] [ThreadPool]: Acquiring new duckdb connection 'list_quest_kingdom_main'
[0m18:52:32.210313 [debug] [ThreadPool]: Using duckdb connection "list_quest_kingdom_main"
[0m18:52:32.210545 [debug] [ThreadPool]: On list_quest_kingdom_main: BEGIN
[0m18:52:32.210686 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:52:32.218820 [debug] [ThreadPool]: SQL status: OK in 0.008 seconds
[0m18:52:32.219026 [debug] [ThreadPool]: Using duckdb connection "list_quest_kingdom_main"
[0m18:52:32.219177 [debug] [ThreadPool]: On list_quest_kingdom_main: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "list_quest_kingdom_main"} */
select
      'quest_kingdom' as database,
      table_name as name,
      table_schema as schema,
      CASE table_type
        WHEN 'BASE TABLE' THEN 'table'
        WHEN 'VIEW' THEN 'view'
        WHEN 'LOCAL TEMPORARY' THEN 'table'
        END as type
    from system.information_schema.tables
    where lower(table_schema) = 'main'
    and lower(table_catalog) = 'quest_kingdom'
  
[0m18:52:32.226706 [debug] [ThreadPool]: SQL status: OK in 0.007 seconds
[0m18:52:32.227539 [debug] [ThreadPool]: On list_quest_kingdom_main: ROLLBACK
[0m18:52:32.228531 [debug] [ThreadPool]: Failed to rollback 'list_quest_kingdom_main'
[0m18:52:32.228701 [debug] [ThreadPool]: On list_quest_kingdom_main: Close
[0m18:52:32.229575 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '27cf6eb4-6a37-4d90-8082-ff4a7cfcd879', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107e1e900>]}
[0m18:52:32.230897 [debug] [Thread-1 (]: Began running node model.quest_kingdom.stg_ad_impressions
[0m18:52:32.231100 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_quest_kingdom_main, now model.quest_kingdom.stg_ad_impressions)
[0m18:52:32.231260 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.stg_ad_impressions
[0m18:52:32.234942 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.stg_ad_impressions"
[0m18:52:32.235328 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.stg_ad_impressions
[0m18:52:32.235633 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.stg_ad_impressions
[0m18:52:32.235801 [debug] [Thread-1 (]: Began running node model.quest_kingdom.stg_events
[0m18:52:32.235984 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.quest_kingdom.stg_ad_impressions, now model.quest_kingdom.stg_events)
[0m18:52:32.236149 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.stg_events
[0m18:52:32.238188 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.stg_events"
[0m18:52:32.238625 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.stg_events
[0m18:52:32.238960 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.stg_events
[0m18:52:32.239138 [debug] [Thread-1 (]: Began running node model.quest_kingdom.stg_iap_transactions
[0m18:52:32.239381 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.quest_kingdom.stg_events, now model.quest_kingdom.stg_iap_transactions)
[0m18:52:32.239572 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.stg_iap_transactions
[0m18:52:32.240866 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.stg_iap_transactions"
[0m18:52:32.241175 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.stg_iap_transactions
[0m18:52:32.241454 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.stg_iap_transactions
[0m18:52:32.241616 [debug] [Thread-1 (]: Began running node model.quest_kingdom.stg_players
[0m18:52:32.241790 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.quest_kingdom.stg_iap_transactions, now model.quest_kingdom.stg_players)
[0m18:52:32.241960 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.stg_players
[0m18:52:32.243189 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.stg_players"
[0m18:52:32.243479 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.stg_players
[0m18:52:32.243746 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.stg_players
[0m18:52:32.243906 [debug] [Thread-1 (]: Began running node model.quest_kingdom.stg_sessions
[0m18:52:32.244074 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.quest_kingdom.stg_players, now model.quest_kingdom.stg_sessions)
[0m18:52:32.244249 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.stg_sessions
[0m18:52:32.245478 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.stg_sessions"
[0m18:52:32.245775 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.stg_sessions
[0m18:52:32.246046 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.stg_sessions
[0m18:52:32.246212 [debug] [Thread-1 (]: Began running node test.quest_kingdom.not_null_stg_ad_impressions_ad_id.34d3bb542c
[0m18:52:32.246389 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.quest_kingdom.stg_sessions, now test.quest_kingdom.not_null_stg_ad_impressions_ad_id.34d3bb542c)
[0m18:52:32.246575 [debug] [Thread-1 (]: Began compiling node test.quest_kingdom.not_null_stg_ad_impressions_ad_id.34d3bb542c
[0m18:52:32.251793 [debug] [Thread-1 (]: Writing injected SQL for node "test.quest_kingdom.not_null_stg_ad_impressions_ad_id.34d3bb542c"
[0m18:52:32.252114 [debug] [Thread-1 (]: Began executing node test.quest_kingdom.not_null_stg_ad_impressions_ad_id.34d3bb542c
[0m18:52:32.252404 [debug] [Thread-1 (]: Finished running node test.quest_kingdom.not_null_stg_ad_impressions_ad_id.34d3bb542c
[0m18:52:32.252576 [debug] [Thread-1 (]: Began running node test.quest_kingdom.not_null_stg_ad_impressions_player_id.72385a5e19
[0m18:52:32.252742 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.quest_kingdom.not_null_stg_ad_impressions_ad_id.34d3bb542c, now test.quest_kingdom.not_null_stg_ad_impressions_player_id.72385a5e19)
[0m18:52:32.252892 [debug] [Thread-1 (]: Began compiling node test.quest_kingdom.not_null_stg_ad_impressions_player_id.72385a5e19
[0m18:52:32.254686 [debug] [Thread-1 (]: Writing injected SQL for node "test.quest_kingdom.not_null_stg_ad_impressions_player_id.72385a5e19"
[0m18:52:32.254987 [debug] [Thread-1 (]: Began executing node test.quest_kingdom.not_null_stg_ad_impressions_player_id.72385a5e19
[0m18:52:32.255263 [debug] [Thread-1 (]: Finished running node test.quest_kingdom.not_null_stg_ad_impressions_player_id.72385a5e19
[0m18:52:32.255425 [debug] [Thread-1 (]: Began running node test.quest_kingdom.unique_stg_ad_impressions_ad_id.618068e7ef
[0m18:52:32.255592 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.quest_kingdom.not_null_stg_ad_impressions_player_id.72385a5e19, now test.quest_kingdom.unique_stg_ad_impressions_ad_id.618068e7ef)
[0m18:52:32.255740 [debug] [Thread-1 (]: Began compiling node test.quest_kingdom.unique_stg_ad_impressions_ad_id.618068e7ef
[0m18:52:32.258513 [debug] [Thread-1 (]: Writing injected SQL for node "test.quest_kingdom.unique_stg_ad_impressions_ad_id.618068e7ef"
[0m18:52:32.258805 [debug] [Thread-1 (]: Began executing node test.quest_kingdom.unique_stg_ad_impressions_ad_id.618068e7ef
[0m18:52:32.259081 [debug] [Thread-1 (]: Finished running node test.quest_kingdom.unique_stg_ad_impressions_ad_id.618068e7ef
[0m18:52:32.259248 [debug] [Thread-1 (]: Began running node test.quest_kingdom.accepted_values_stg_events_event_name__tutorial_completed__level_completed__boss_defeated.4ed70dcb36
[0m18:52:32.259415 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.quest_kingdom.unique_stg_ad_impressions_ad_id.618068e7ef, now test.quest_kingdom.accepted_values_stg_events_event_name__tutorial_completed__level_completed__boss_defeated.4ed70dcb36)
[0m18:52:32.259569 [debug] [Thread-1 (]: Began compiling node test.quest_kingdom.accepted_values_stg_events_event_name__tutorial_completed__level_completed__boss_defeated.4ed70dcb36
[0m18:52:32.264138 [debug] [Thread-1 (]: Writing injected SQL for node "test.quest_kingdom.accepted_values_stg_events_event_name__tutorial_completed__level_completed__boss_defeated.4ed70dcb36"
[0m18:52:32.264531 [debug] [Thread-1 (]: Began executing node test.quest_kingdom.accepted_values_stg_events_event_name__tutorial_completed__level_completed__boss_defeated.4ed70dcb36
[0m18:52:32.264839 [debug] [Thread-1 (]: Finished running node test.quest_kingdom.accepted_values_stg_events_event_name__tutorial_completed__level_completed__boss_defeated.4ed70dcb36
[0m18:52:32.265007 [debug] [Thread-1 (]: Began running node test.quest_kingdom.not_null_stg_events_event_id.715b3f7012
[0m18:52:32.265192 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.quest_kingdom.accepted_values_stg_events_event_name__tutorial_completed__level_completed__boss_defeated.4ed70dcb36, now test.quest_kingdom.not_null_stg_events_event_id.715b3f7012)
[0m18:52:32.265380 [debug] [Thread-1 (]: Began compiling node test.quest_kingdom.not_null_stg_events_event_id.715b3f7012
[0m18:52:32.267125 [debug] [Thread-1 (]: Writing injected SQL for node "test.quest_kingdom.not_null_stg_events_event_id.715b3f7012"
[0m18:52:32.267406 [debug] [Thread-1 (]: Began executing node test.quest_kingdom.not_null_stg_events_event_id.715b3f7012
[0m18:52:32.267677 [debug] [Thread-1 (]: Finished running node test.quest_kingdom.not_null_stg_events_event_id.715b3f7012
[0m18:52:32.267834 [debug] [Thread-1 (]: Began running node test.quest_kingdom.not_null_stg_events_event_name.682bd9eda3
[0m18:52:32.267997 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.quest_kingdom.not_null_stg_events_event_id.715b3f7012, now test.quest_kingdom.not_null_stg_events_event_name.682bd9eda3)
[0m18:52:32.268141 [debug] [Thread-1 (]: Began compiling node test.quest_kingdom.not_null_stg_events_event_name.682bd9eda3
[0m18:52:32.269821 [debug] [Thread-1 (]: Writing injected SQL for node "test.quest_kingdom.not_null_stg_events_event_name.682bd9eda3"
[0m18:52:32.270102 [debug] [Thread-1 (]: Began executing node test.quest_kingdom.not_null_stg_events_event_name.682bd9eda3
[0m18:52:32.270371 [debug] [Thread-1 (]: Finished running node test.quest_kingdom.not_null_stg_events_event_name.682bd9eda3
[0m18:52:32.270530 [debug] [Thread-1 (]: Began running node test.quest_kingdom.not_null_stg_events_player_id.588c4cb5e5
[0m18:52:32.270691 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.quest_kingdom.not_null_stg_events_event_name.682bd9eda3, now test.quest_kingdom.not_null_stg_events_player_id.588c4cb5e5)
[0m18:52:32.270836 [debug] [Thread-1 (]: Began compiling node test.quest_kingdom.not_null_stg_events_player_id.588c4cb5e5
[0m18:52:32.273358 [debug] [Thread-1 (]: Writing injected SQL for node "test.quest_kingdom.not_null_stg_events_player_id.588c4cb5e5"
[0m18:52:32.273648 [debug] [Thread-1 (]: Began executing node test.quest_kingdom.not_null_stg_events_player_id.588c4cb5e5
[0m18:52:32.273912 [debug] [Thread-1 (]: Finished running node test.quest_kingdom.not_null_stg_events_player_id.588c4cb5e5
[0m18:52:32.274071 [debug] [Thread-1 (]: Began running node test.quest_kingdom.unique_stg_events_event_id.66ebb17438
[0m18:52:32.274232 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.quest_kingdom.not_null_stg_events_player_id.588c4cb5e5, now test.quest_kingdom.unique_stg_events_event_id.66ebb17438)
[0m18:52:32.274378 [debug] [Thread-1 (]: Began compiling node test.quest_kingdom.unique_stg_events_event_id.66ebb17438
[0m18:52:32.276022 [debug] [Thread-1 (]: Writing injected SQL for node "test.quest_kingdom.unique_stg_events_event_id.66ebb17438"
[0m18:52:32.276277 [debug] [Thread-1 (]: Began executing node test.quest_kingdom.unique_stg_events_event_id.66ebb17438
[0m18:52:32.276530 [debug] [Thread-1 (]: Finished running node test.quest_kingdom.unique_stg_events_event_id.66ebb17438
[0m18:52:32.276683 [debug] [Thread-1 (]: Began running node test.quest_kingdom.not_null_stg_iap_transactions_player_id.256115ad9d
[0m18:52:32.276848 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.quest_kingdom.unique_stg_events_event_id.66ebb17438, now test.quest_kingdom.not_null_stg_iap_transactions_player_id.256115ad9d)
[0m18:52:32.277017 [debug] [Thread-1 (]: Began compiling node test.quest_kingdom.not_null_stg_iap_transactions_player_id.256115ad9d
[0m18:52:32.278703 [debug] [Thread-1 (]: Writing injected SQL for node "test.quest_kingdom.not_null_stg_iap_transactions_player_id.256115ad9d"
[0m18:52:32.278983 [debug] [Thread-1 (]: Began executing node test.quest_kingdom.not_null_stg_iap_transactions_player_id.256115ad9d
[0m18:52:32.279240 [debug] [Thread-1 (]: Finished running node test.quest_kingdom.not_null_stg_iap_transactions_player_id.256115ad9d
[0m18:52:32.279396 [debug] [Thread-1 (]: Began running node test.quest_kingdom.not_null_stg_iap_transactions_price_usd.613bc29079
[0m18:52:32.279558 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.quest_kingdom.not_null_stg_iap_transactions_player_id.256115ad9d, now test.quest_kingdom.not_null_stg_iap_transactions_price_usd.613bc29079)
[0m18:52:32.279701 [debug] [Thread-1 (]: Began compiling node test.quest_kingdom.not_null_stg_iap_transactions_price_usd.613bc29079
[0m18:52:32.281420 [debug] [Thread-1 (]: Writing injected SQL for node "test.quest_kingdom.not_null_stg_iap_transactions_price_usd.613bc29079"
[0m18:52:32.281689 [debug] [Thread-1 (]: Began executing node test.quest_kingdom.not_null_stg_iap_transactions_price_usd.613bc29079
[0m18:52:32.281947 [debug] [Thread-1 (]: Finished running node test.quest_kingdom.not_null_stg_iap_transactions_price_usd.613bc29079
[0m18:52:32.282105 [debug] [Thread-1 (]: Began running node test.quest_kingdom.not_null_stg_iap_transactions_transaction_id.bc4fc23645
[0m18:52:32.282261 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.quest_kingdom.not_null_stg_iap_transactions_price_usd.613bc29079, now test.quest_kingdom.not_null_stg_iap_transactions_transaction_id.bc4fc23645)
[0m18:52:32.282404 [debug] [Thread-1 (]: Began compiling node test.quest_kingdom.not_null_stg_iap_transactions_transaction_id.bc4fc23645
[0m18:52:32.284170 [debug] [Thread-1 (]: Writing injected SQL for node "test.quest_kingdom.not_null_stg_iap_transactions_transaction_id.bc4fc23645"
[0m18:52:32.284447 [debug] [Thread-1 (]: Began executing node test.quest_kingdom.not_null_stg_iap_transactions_transaction_id.bc4fc23645
[0m18:52:32.284718 [debug] [Thread-1 (]: Finished running node test.quest_kingdom.not_null_stg_iap_transactions_transaction_id.bc4fc23645
[0m18:52:32.284880 [debug] [Thread-1 (]: Began running node test.quest_kingdom.unique_stg_iap_transactions_transaction_id.3bff016069
[0m18:52:32.285041 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.quest_kingdom.not_null_stg_iap_transactions_transaction_id.bc4fc23645, now test.quest_kingdom.unique_stg_iap_transactions_transaction_id.3bff016069)
[0m18:52:32.285186 [debug] [Thread-1 (]: Began compiling node test.quest_kingdom.unique_stg_iap_transactions_transaction_id.3bff016069
[0m18:52:32.286894 [debug] [Thread-1 (]: Writing injected SQL for node "test.quest_kingdom.unique_stg_iap_transactions_transaction_id.3bff016069"
[0m18:52:32.287179 [debug] [Thread-1 (]: Began executing node test.quest_kingdom.unique_stg_iap_transactions_transaction_id.3bff016069
[0m18:52:32.287437 [debug] [Thread-1 (]: Finished running node test.quest_kingdom.unique_stg_iap_transactions_transaction_id.3bff016069
[0m18:52:32.287627 [debug] [Thread-1 (]: Began running node test.quest_kingdom.accepted_values_stg_players_device_type__ios__android.14cabc59fd
[0m18:52:32.287825 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.quest_kingdom.unique_stg_iap_transactions_transaction_id.3bff016069, now test.quest_kingdom.accepted_values_stg_players_device_type__ios__android.14cabc59fd)
[0m18:52:32.287981 [debug] [Thread-1 (]: Began compiling node test.quest_kingdom.accepted_values_stg_players_device_type__ios__android.14cabc59fd
[0m18:52:32.290189 [debug] [Thread-1 (]: Writing injected SQL for node "test.quest_kingdom.accepted_values_stg_players_device_type__ios__android.14cabc59fd"
[0m18:52:32.290481 [debug] [Thread-1 (]: Began executing node test.quest_kingdom.accepted_values_stg_players_device_type__ios__android.14cabc59fd
[0m18:52:32.290754 [debug] [Thread-1 (]: Finished running node test.quest_kingdom.accepted_values_stg_players_device_type__ios__android.14cabc59fd
[0m18:52:32.290915 [debug] [Thread-1 (]: Began running node test.quest_kingdom.accepted_values_stg_players_player_segment__whale__dolphin__minnow__non_payer.2fd01d0b8a
[0m18:52:32.291074 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.quest_kingdom.accepted_values_stg_players_device_type__ios__android.14cabc59fd, now test.quest_kingdom.accepted_values_stg_players_player_segment__whale__dolphin__minnow__non_payer.2fd01d0b8a)
[0m18:52:32.291225 [debug] [Thread-1 (]: Began compiling node test.quest_kingdom.accepted_values_stg_players_player_segment__whale__dolphin__minnow__non_payer.2fd01d0b8a
[0m18:52:32.294082 [debug] [Thread-1 (]: Writing injected SQL for node "test.quest_kingdom.accepted_values_stg_players_player_segment__whale__dolphin__minnow__non_payer.2fd01d0b8a"
[0m18:52:32.294508 [debug] [Thread-1 (]: Began executing node test.quest_kingdom.accepted_values_stg_players_player_segment__whale__dolphin__minnow__non_payer.2fd01d0b8a
[0m18:52:32.294801 [debug] [Thread-1 (]: Finished running node test.quest_kingdom.accepted_values_stg_players_player_segment__whale__dolphin__minnow__non_payer.2fd01d0b8a
[0m18:52:32.294965 [debug] [Thread-1 (]: Began running node test.quest_kingdom.not_null_stg_players_installed_at.60c4ce69cb
[0m18:52:32.295138 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.quest_kingdom.accepted_values_stg_players_player_segment__whale__dolphin__minnow__non_payer.2fd01d0b8a, now test.quest_kingdom.not_null_stg_players_installed_at.60c4ce69cb)
[0m18:52:32.295287 [debug] [Thread-1 (]: Began compiling node test.quest_kingdom.not_null_stg_players_installed_at.60c4ce69cb
[0m18:52:32.297249 [debug] [Thread-1 (]: Writing injected SQL for node "test.quest_kingdom.not_null_stg_players_installed_at.60c4ce69cb"
[0m18:52:32.297557 [debug] [Thread-1 (]: Began executing node test.quest_kingdom.not_null_stg_players_installed_at.60c4ce69cb
[0m18:52:32.297821 [debug] [Thread-1 (]: Finished running node test.quest_kingdom.not_null_stg_players_installed_at.60c4ce69cb
[0m18:52:32.297981 [debug] [Thread-1 (]: Began running node test.quest_kingdom.not_null_stg_players_player_id.702d1d8c7b
[0m18:52:32.298134 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.quest_kingdom.not_null_stg_players_installed_at.60c4ce69cb, now test.quest_kingdom.not_null_stg_players_player_id.702d1d8c7b)
[0m18:52:32.298304 [debug] [Thread-1 (]: Began compiling node test.quest_kingdom.not_null_stg_players_player_id.702d1d8c7b
[0m18:52:32.300133 [debug] [Thread-1 (]: Writing injected SQL for node "test.quest_kingdom.not_null_stg_players_player_id.702d1d8c7b"
[0m18:52:32.300464 [debug] [Thread-1 (]: Began executing node test.quest_kingdom.not_null_stg_players_player_id.702d1d8c7b
[0m18:52:32.300744 [debug] [Thread-1 (]: Finished running node test.quest_kingdom.not_null_stg_players_player_id.702d1d8c7b
[0m18:52:32.300913 [debug] [Thread-1 (]: Began running node test.quest_kingdom.relationships_stg_iap_transactions_player_id__player_id__ref_stg_players_.ec3ff36963
[0m18:52:32.301086 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.quest_kingdom.not_null_stg_players_player_id.702d1d8c7b, now test.quest_kingdom.relationships_stg_iap_transactions_player_id__player_id__ref_stg_players_.ec3ff36963)
[0m18:52:32.301235 [debug] [Thread-1 (]: Began compiling node test.quest_kingdom.relationships_stg_iap_transactions_player_id__player_id__ref_stg_players_.ec3ff36963
[0m18:52:32.306081 [debug] [Thread-1 (]: Writing injected SQL for node "test.quest_kingdom.relationships_stg_iap_transactions_player_id__player_id__ref_stg_players_.ec3ff36963"
[0m18:52:32.306495 [debug] [Thread-1 (]: Began executing node test.quest_kingdom.relationships_stg_iap_transactions_player_id__player_id__ref_stg_players_.ec3ff36963
[0m18:52:32.306804 [debug] [Thread-1 (]: Finished running node test.quest_kingdom.relationships_stg_iap_transactions_player_id__player_id__ref_stg_players_.ec3ff36963
[0m18:52:32.306974 [debug] [Thread-1 (]: Began running node test.quest_kingdom.unique_stg_players_player_id.a3d551d71d
[0m18:52:32.307157 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.quest_kingdom.relationships_stg_iap_transactions_player_id__player_id__ref_stg_players_.ec3ff36963, now test.quest_kingdom.unique_stg_players_player_id.a3d551d71d)
[0m18:52:32.307314 [debug] [Thread-1 (]: Began compiling node test.quest_kingdom.unique_stg_players_player_id.a3d551d71d
[0m18:52:32.309334 [debug] [Thread-1 (]: Writing injected SQL for node "test.quest_kingdom.unique_stg_players_player_id.a3d551d71d"
[0m18:52:32.309725 [debug] [Thread-1 (]: Began executing node test.quest_kingdom.unique_stg_players_player_id.a3d551d71d
[0m18:52:32.310011 [debug] [Thread-1 (]: Finished running node test.quest_kingdom.unique_stg_players_player_id.a3d551d71d
[0m18:52:32.310179 [debug] [Thread-1 (]: Began running node model.quest_kingdom.dim_players
[0m18:52:32.310357 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.quest_kingdom.unique_stg_players_player_id.a3d551d71d, now model.quest_kingdom.dim_players)
[0m18:52:32.312918 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.dim_players
[0m18:52:32.314967 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.dim_players"
[0m18:52:32.315502 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.dim_players
[0m18:52:32.315809 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.dim_players
[0m18:52:32.315978 [debug] [Thread-1 (]: Began running node model.quest_kingdom.fct_sessions
[0m18:52:32.316158 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.quest_kingdom.dim_players, now model.quest_kingdom.fct_sessions)
[0m18:52:32.316312 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.fct_sessions
[0m18:52:32.317889 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.fct_sessions"
[0m18:52:32.318190 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.fct_sessions
[0m18:52:32.318458 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.fct_sessions
[0m18:52:32.318617 [debug] [Thread-1 (]: Began running node test.quest_kingdom.not_null_stg_sessions_player_id.fa13833b29
[0m18:52:32.318806 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.quest_kingdom.fct_sessions, now test.quest_kingdom.not_null_stg_sessions_player_id.fa13833b29)
[0m18:52:32.318947 [debug] [Thread-1 (]: Began compiling node test.quest_kingdom.not_null_stg_sessions_player_id.fa13833b29
[0m18:52:32.320773 [debug] [Thread-1 (]: Writing injected SQL for node "test.quest_kingdom.not_null_stg_sessions_player_id.fa13833b29"
[0m18:52:32.321119 [debug] [Thread-1 (]: Began executing node test.quest_kingdom.not_null_stg_sessions_player_id.fa13833b29
[0m18:52:32.321395 [debug] [Thread-1 (]: Finished running node test.quest_kingdom.not_null_stg_sessions_player_id.fa13833b29
[0m18:52:32.321556 [debug] [Thread-1 (]: Began running node test.quest_kingdom.not_null_stg_sessions_session_id.2e872a126d
[0m18:52:32.321722 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.quest_kingdom.not_null_stg_sessions_player_id.fa13833b29, now test.quest_kingdom.not_null_stg_sessions_session_id.2e872a126d)
[0m18:52:32.321870 [debug] [Thread-1 (]: Began compiling node test.quest_kingdom.not_null_stg_sessions_session_id.2e872a126d
[0m18:52:32.323605 [debug] [Thread-1 (]: Writing injected SQL for node "test.quest_kingdom.not_null_stg_sessions_session_id.2e872a126d"
[0m18:52:32.323888 [debug] [Thread-1 (]: Began executing node test.quest_kingdom.not_null_stg_sessions_session_id.2e872a126d
[0m18:52:32.324163 [debug] [Thread-1 (]: Finished running node test.quest_kingdom.not_null_stg_sessions_session_id.2e872a126d
[0m18:52:32.324322 [debug] [Thread-1 (]: Began running node test.quest_kingdom.not_null_stg_sessions_session_started_at.039a312a09
[0m18:52:32.324485 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.quest_kingdom.not_null_stg_sessions_session_id.2e872a126d, now test.quest_kingdom.not_null_stg_sessions_session_started_at.039a312a09)
[0m18:52:32.324631 [debug] [Thread-1 (]: Began compiling node test.quest_kingdom.not_null_stg_sessions_session_started_at.039a312a09
[0m18:52:32.326353 [debug] [Thread-1 (]: Writing injected SQL for node "test.quest_kingdom.not_null_stg_sessions_session_started_at.039a312a09"
[0m18:52:32.326629 [debug] [Thread-1 (]: Began executing node test.quest_kingdom.not_null_stg_sessions_session_started_at.039a312a09
[0m18:52:32.326888 [debug] [Thread-1 (]: Finished running node test.quest_kingdom.not_null_stg_sessions_session_started_at.039a312a09
[0m18:52:32.327048 [debug] [Thread-1 (]: Began running node test.quest_kingdom.relationships_stg_sessions_player_id__player_id__ref_stg_players_.6b4c9276ee
[0m18:52:32.327208 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.quest_kingdom.not_null_stg_sessions_session_started_at.039a312a09, now test.quest_kingdom.relationships_stg_sessions_player_id__player_id__ref_stg_players_.6b4c9276ee)
[0m18:52:32.327356 [debug] [Thread-1 (]: Began compiling node test.quest_kingdom.relationships_stg_sessions_player_id__player_id__ref_stg_players_.6b4c9276ee
[0m18:52:32.329535 [debug] [Thread-1 (]: Writing injected SQL for node "test.quest_kingdom.relationships_stg_sessions_player_id__player_id__ref_stg_players_.6b4c9276ee"
[0m18:52:32.329830 [debug] [Thread-1 (]: Began executing node test.quest_kingdom.relationships_stg_sessions_player_id__player_id__ref_stg_players_.6b4c9276ee
[0m18:52:32.330104 [debug] [Thread-1 (]: Finished running node test.quest_kingdom.relationships_stg_sessions_player_id__player_id__ref_stg_players_.6b4c9276ee
[0m18:52:32.330262 [debug] [Thread-1 (]: Began running node test.quest_kingdom.unique_stg_sessions_session_id.ce45726d03
[0m18:52:32.330419 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.quest_kingdom.relationships_stg_sessions_player_id__player_id__ref_stg_players_.6b4c9276ee, now test.quest_kingdom.unique_stg_sessions_session_id.ce45726d03)
[0m18:52:32.330561 [debug] [Thread-1 (]: Began compiling node test.quest_kingdom.unique_stg_sessions_session_id.ce45726d03
[0m18:52:32.332259 [debug] [Thread-1 (]: Writing injected SQL for node "test.quest_kingdom.unique_stg_sessions_session_id.ce45726d03"
[0m18:52:32.332529 [debug] [Thread-1 (]: Began executing node test.quest_kingdom.unique_stg_sessions_session_id.ce45726d03
[0m18:52:32.332790 [debug] [Thread-1 (]: Finished running node test.quest_kingdom.unique_stg_sessions_session_id.ce45726d03
[0m18:52:32.333273 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:52:32.333443 [debug] [MainThread]: Connection 'test.quest_kingdom.unique_stg_sessions_session_id.ce45726d03' was properly closed.
[0m18:52:32.335034 [debug] [MainThread]: Command end result
[0m18:52:32.406489 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/manifest.json
[0m18:52:32.407448 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/semantic_manifest.json
[0m18:52:32.410830 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/run_results.json
[0m18:52:32.412932 [debug] [MainThread]: Acquiring new duckdb connection 'generate_catalog'
[0m18:52:32.413097 [info ] [MainThread]: Building catalog
[0m18:52:32.417776 [debug] [ThreadPool]: Acquiring new duckdb connection 'quest_kingdom.information_schema'
[0m18:52:32.421215 [debug] [ThreadPool]: Using duckdb connection "quest_kingdom.information_schema"
[0m18:52:32.421494 [debug] [ThreadPool]: On quest_kingdom.information_schema: BEGIN
[0m18:52:32.421635 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:52:32.422037 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m18:52:32.422172 [debug] [ThreadPool]: Using duckdb connection "quest_kingdom.information_schema"
[0m18:52:32.422327 [debug] [ThreadPool]: On quest_kingdom.information_schema: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "quest_kingdom.information_schema"} */
with relations AS (
      select
        t.table_name
        , t.database_name
        , t.schema_name
        , 'BASE TABLE' as table_type
        , t.comment as table_comment
      from duckdb_tables() t
      WHERE t.database_name = 'quest_kingdom'
      UNION ALL
      SELECT v.view_name as table_name
      , v.database_name
      , v.schema_name
      , 'VIEW' as table_type
      , v.comment as table_comment
      from duckdb_views() v
      WHERE v.database_name = 'quest_kingdom'
    )
    select
        'quest_kingdom' as table_database,
        r.schema_name as table_schema,
        r.table_name,
        r.table_type,
        r.table_comment,
        c.column_name,
        c.column_index as column_index,
        c.data_type as column_type,
        c.comment as column_comment,
        NULL as table_owner
    FROM relations r JOIN duckdb_columns() c ON r.schema_name = c.schema_name AND r.table_name = c.table_name
    WHERE (upper(r.schema_name) = upper('main'))
    ORDER BY
        r.schema_name,
        r.table_name,
        c.column_index
[0m18:52:32.427364 [debug] [ThreadPool]: SQL status: OK in 0.005 seconds
[0m18:52:32.429874 [debug] [ThreadPool]: On quest_kingdom.information_schema: ROLLBACK
[0m18:52:32.430351 [debug] [ThreadPool]: Failed to rollback 'quest_kingdom.information_schema'
[0m18:52:32.430497 [debug] [ThreadPool]: On quest_kingdom.information_schema: Close
[0m18:52:32.437232 [debug] [MainThread]: Wrote artifact CatalogArtifact to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/catalog.json
[0m18:52:32.450197 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/manifest.json
[0m18:52:32.451135 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/semantic_manifest.json
[0m18:52:32.451290 [info ] [MainThread]: Catalog written to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/catalog.json
[0m18:52:32.452328 [debug] [MainThread]: Resource report: {"command_name": "generate", "command_success": true, "command_wall_clock_time": 0.59714544, "process_in_blocks": "0", "process_kernel_time": 0.155708, "process_mem_max_rss": "149274624", "process_out_blocks": "0", "process_user_time": 1.155317}
[0m18:52:32.452569 [debug] [MainThread]: Command `dbt docs generate` succeeded at 18:52:32.452529 after 0.60 seconds
[0m18:52:32.452713 [debug] [MainThread]: Connection 'generate_catalog' was properly closed.
[0m18:52:32.452828 [debug] [MainThread]: Connection 'quest_kingdom.information_schema' was properly closed.
[0m18:52:32.452972 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106867110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106b74d10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107e1baa0>]}
[0m18:52:32.453144 [debug] [MainThread]: Flushing usage events
[0m18:52:32.552028 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m18:52:40.526146 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10827fcb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108ddeab0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109001850>]}


============================== 18:52:40.529098 | 89e5a51e-99b4-4b50-a099-7e5ac916b949 ==============================
[0m18:52:40.529098 [info ] [MainThread]: Running with dbt=1.11.4
[0m18:52:40.529404 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'no_print': 'None', 'warn_error': 'None', 'use_experimental_parser': 'False', 'indirect_selection': 'eager', 'fail_fast': 'False', 'log_format': 'default', 'printer_width': '80', 'profiles_dir': '/Users/hazeldonaldson/.dbt', 'introspect': 'True', 'send_anonymous_usage_stats': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'debug': 'False', 'log_path': '/Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/logs', 'partial_parse': 'True', 'invocation_command': 'dbt docs serve', 'use_colors': 'True', 'version_check': 'True', 'target_path': 'None', 'cache_selected_only': 'False', 'write_json': 'True', 'empty': 'None', 'log_cache_events': 'False', 'static_parser': 'True'}
[0m18:52:40.635392 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '89e5a51e-99b4-4b50-a099-7e5ac916b949', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109109c10>]}
[0m18:52:40.664394 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '89e5a51e-99b4-4b50-a099-7e5ac916b949', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1085bf0b0>]}
[0m18:53:06.310667 [error] [MainThread]: Encountered an error:

[0m18:53:06.317195 [error] [MainThread]: Traceback (most recent call last):
  File "/opt/miniconda3/envs/dbt-duckdb/lib/python3.12/site-packages/dbt/cli/requires.py", line 182, in wrapper
    result, success = func(*args, **kwargs)
                      ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/dbt-duckdb/lib/python3.12/site-packages/dbt/cli/requires.py", line 128, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/dbt-duckdb/lib/python3.12/site-packages/dbt/cli/requires.py", line 276, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/dbt-duckdb/lib/python3.12/site-packages/dbt/cli/requires.py", line 321, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/dbt-duckdb/lib/python3.12/site-packages/dbt/cli/requires.py", line 368, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/dbt-duckdb/lib/python3.12/site-packages/dbt/cli/main.py", line 307, in docs_serve
    results = task.run()
              ^^^^^^^^^^
  File "/opt/miniconda3/envs/dbt-duckdb/lib/python3.12/site-packages/dbt/task/docs/serve.py", line 29, in run
    httpd.serve_forever()
  File "/opt/miniconda3/envs/dbt-duckdb/lib/python3.12/socketserver.py", line 235, in serve_forever
    ready = selector.select(poll_interval)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/dbt-duckdb/lib/python3.12/selectors.py", line 415, in select
    fd_event_list = self._selector.poll(timeout)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
KeyboardInterrupt

[0m18:53:06.321498 [debug] [MainThread]: Resource report: {"command_name": "serve", "command_success": false, "command_wall_clock_time": 25.829668, "process_in_blocks": "0", "process_kernel_time": 0.120546, "process_mem_max_rss": "127221760", "process_out_blocks": "0", "process_user_time": 0.815987}
[0m18:53:06.322433 [debug] [MainThread]: Command `dbt docs serve` failed at 18:53:06.322316 after 25.83 seconds
[0m18:53:06.323384 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109001af0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109088380>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109070680>]}
[0m18:53:06.323815 [debug] [MainThread]: Flushing usage events
[0m18:53:06.461032 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m18:55:38.481958 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105dfef90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1066b5be0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1066b59d0>]}


============================== 18:55:38.485763 | 8891146b-f07d-43e8-8ed1-e4a69a42163a ==============================
[0m18:55:38.485763 [info ] [MainThread]: Running with dbt=1.11.4
[0m18:55:38.486078 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'debug': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'partial_parse': 'True', 'write_json': 'True', 'indirect_selection': 'eager', 'introspect': 'True', 'send_anonymous_usage_stats': 'True', 'empty': 'False', 'warn_error': 'None', 'printer_width': '80', 'use_experimental_parser': 'False', 'fail_fast': 'False', 'target_path': 'None', 'profiles_dir': '/Users/hazeldonaldson/.dbt', 'invocation_command': 'dbt run', 'log_cache_events': 'False', 'no_print': 'None', 'version_check': 'True', 'log_path': '/Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/logs', 'log_format': 'default', 'cache_selected_only': 'False', 'static_parser': 'True', 'use_colors': 'True'}
[0m18:55:38.658468 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '8891146b-f07d-43e8-8ed1-e4a69a42163a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1067dde20>]}
[0m18:55:38.686563 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '8891146b-f07d-43e8-8ed1-e4a69a42163a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105dff860>]}
[0m18:55:38.687862 [info ] [MainThread]: Registered adapter: duckdb=1.10.0
[0m18:55:38.739841 [debug] [MainThread]: checksum: 092b177ba87eb6bb3c55954c38aa57900eebac336561eb9ee32218428aa81d43, vars: {}, profile: , target: , version: 1.11.4
[0m18:55:38.805988 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m18:55:38.806231 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m18:55:38.806366 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m18:55:38.809600 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 7 unused configuration paths:
- models.question_kingdom
- models.core
- models.marts
- models.product
- models.retention
- models.staging
- models.monetization
[0m18:55:38.829931 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '8891146b-f07d-43e8-8ed1-e4a69a42163a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107a536b0>]}
[0m18:55:38.872333 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/manifest.json
[0m18:55:38.873647 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/semantic_manifest.json
[0m18:55:38.886811 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '8891146b-f07d-43e8-8ed1-e4a69a42163a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110068440>]}
[0m18:55:38.887100 [info ] [MainThread]: Found 7 models, 23 data tests, 5 sources, 472 macros
[0m18:55:38.887270 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8891146b-f07d-43e8-8ed1-e4a69a42163a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110051af0>]}
[0m18:55:38.888385 [info ] [MainThread]: 
[0m18:55:38.888555 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m18:55:38.888690 [info ] [MainThread]: 
[0m18:55:38.888930 [debug] [MainThread]: Acquiring new duckdb connection 'master'
[0m18:55:38.891138 [debug] [ThreadPool]: Acquiring new duckdb connection 'list_quest_kingdom'
[0m18:55:38.921797 [debug] [ThreadPool]: Using duckdb connection "list_quest_kingdom"
[0m18:55:38.922046 [debug] [ThreadPool]: On list_quest_kingdom: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "list_quest_kingdom"} */

    
    select schema_name
    from system.information_schema.schemata
    
    where lower(catalog_name) = '"quest_kingdom"'
    
  
  
[0m18:55:38.922195 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:55:38.939845 [debug] [ThreadPool]: SQL status: OK in 0.018 seconds
[0m18:55:38.940840 [debug] [ThreadPool]: On list_quest_kingdom: Close
[0m18:55:38.941187 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_quest_kingdom, now create_quest_kingdom_main)
[0m18:55:38.941466 [debug] [ThreadPool]: Creating schema "database: "quest_kingdom"
schema: "main"
"
[0m18:55:38.944912 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m18:55:38.945153 [debug] [ThreadPool]: On create_quest_kingdom_main: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "create_quest_kingdom_main"} */

    
        select type from duckdb_databases()
        where lower(database_name)='quest_kingdom'
        and type='sqlite'
    
  
[0m18:55:38.945409 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:55:38.946347 [debug] [ThreadPool]: SQL status: OK in 0.001 seconds
[0m18:55:38.946998 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m18:55:38.947134 [debug] [ThreadPool]: On create_quest_kingdom_main: BEGIN
[0m18:55:38.947345 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m18:55:38.947469 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m18:55:38.947591 [debug] [ThreadPool]: On create_quest_kingdom_main: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "create_quest_kingdom_main"} */

    
    
        create schema if not exists "quest_kingdom"."main"
    
[0m18:55:38.948055 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m18:55:38.948428 [debug] [ThreadPool]: On create_quest_kingdom_main: COMMIT
[0m18:55:38.948563 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m18:55:38.948679 [debug] [ThreadPool]: On create_quest_kingdom_main: COMMIT
[0m18:55:38.948870 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m18:55:38.948997 [debug] [ThreadPool]: On create_quest_kingdom_main: Close
[0m18:55:38.949657 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_quest_kingdom_main, now list_quest_kingdom_main)
[0m18:55:38.953103 [debug] [ThreadPool]: Using duckdb connection "list_quest_kingdom_main"
[0m18:55:38.953266 [debug] [ThreadPool]: On list_quest_kingdom_main: BEGIN
[0m18:55:38.953389 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:55:38.953645 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m18:55:38.953776 [debug] [ThreadPool]: Using duckdb connection "list_quest_kingdom_main"
[0m18:55:38.953909 [debug] [ThreadPool]: On list_quest_kingdom_main: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "list_quest_kingdom_main"} */
select
      'quest_kingdom' as database,
      table_name as name,
      table_schema as schema,
      CASE table_type
        WHEN 'BASE TABLE' THEN 'table'
        WHEN 'VIEW' THEN 'view'
        WHEN 'LOCAL TEMPORARY' THEN 'table'
        END as type
    from system.information_schema.tables
    where lower(table_schema) = 'main'
    and lower(table_catalog) = 'quest_kingdom'
  
[0m18:55:38.965054 [debug] [ThreadPool]: SQL status: OK in 0.011 seconds
[0m18:55:38.965912 [debug] [ThreadPool]: On list_quest_kingdom_main: ROLLBACK
[0m18:55:38.966926 [debug] [ThreadPool]: Failed to rollback 'list_quest_kingdom_main'
[0m18:55:38.967089 [debug] [ThreadPool]: On list_quest_kingdom_main: Close
[0m18:55:38.968062 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8891146b-f07d-43e8-8ed1-e4a69a42163a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106792ba0>]}
[0m18:55:38.968310 [debug] [MainThread]: Using duckdb connection "master"
[0m18:55:38.968448 [debug] [MainThread]: On master: BEGIN
[0m18:55:38.968569 [debug] [MainThread]: Opening a new connection, currently in state init
[0m18:55:38.968845 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m18:55:38.968975 [debug] [MainThread]: On master: COMMIT
[0m18:55:38.969099 [debug] [MainThread]: Using duckdb connection "master"
[0m18:55:38.969216 [debug] [MainThread]: On master: COMMIT
[0m18:55:38.969406 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m18:55:38.969532 [debug] [MainThread]: On master: Close
[0m18:55:38.970869 [debug] [Thread-1 (]: Began running node model.quest_kingdom.stg_ad_impressions
[0m18:55:38.971118 [info ] [Thread-1 (]: 1 of 7 START sql view model main.stg_ad_impressions ............................ [RUN]
[0m18:55:38.971325 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_quest_kingdom_main, now model.quest_kingdom.stg_ad_impressions)
[0m18:55:38.971488 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.stg_ad_impressions
[0m18:55:38.975037 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.stg_ad_impressions"
[0m18:55:38.975958 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.stg_ad_impressions
[0m18:55:38.989976 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.stg_ad_impressions"
[0m18:55:38.990739 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_ad_impressions"
[0m18:55:38.990902 [debug] [Thread-1 (]: On model.quest_kingdom.stg_ad_impressions: BEGIN
[0m18:55:38.991045 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:55:38.991457 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:55:38.991648 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_ad_impressions"
[0m18:55:38.991820 [debug] [Thread-1 (]: On model.quest_kingdom.stg_ad_impressions: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.stg_ad_impressions"} */

  
  create view "quest_kingdom"."main"."stg_ad_impressions__dbt_tmp" as (
    select
    -- ids
    ad_id,
    player_id,
    session_id,
    
    -- timestamps
    ad_timestamp::timestamp as shown_at,
    
    -- dimensions
    lower(trim(ad_type)) as ad_type,
    lower(trim(ad_network)) as ad_network,
    
    -- booleans
    clicked,
    
    -- metrics
    revenue_usd,
    
    -- derived
    date_trunc('day', ad_timestamp::timestamp)::date as ad_date

from "quest_kingdom"."main"."ad_impressions"
  );

[0m18:55:38.992591 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m18:55:38.996156 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_ad_impressions"
[0m18:55:38.996438 [debug] [Thread-1 (]: On model.quest_kingdom.stg_ad_impressions: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.stg_ad_impressions"} */
alter view "quest_kingdom"."main"."stg_ad_impressions" rename to "stg_ad_impressions__dbt_backup"
[0m18:55:38.997477 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m18:55:38.999155 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_ad_impressions"
[0m18:55:38.999355 [debug] [Thread-1 (]: On model.quest_kingdom.stg_ad_impressions: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.stg_ad_impressions"} */
alter view "quest_kingdom"."main"."stg_ad_impressions__dbt_tmp" rename to "stg_ad_impressions"
[0m18:55:38.999726 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:55:39.005395 [debug] [Thread-1 (]: On model.quest_kingdom.stg_ad_impressions: COMMIT
[0m18:55:39.005592 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_ad_impressions"
[0m18:55:39.005745 [debug] [Thread-1 (]: On model.quest_kingdom.stg_ad_impressions: COMMIT
[0m18:55:39.006326 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:55:39.009048 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_ad_impressions"
[0m18:55:39.009244 [debug] [Thread-1 (]: On model.quest_kingdom.stg_ad_impressions: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.stg_ad_impressions"} */

      drop view if exists "quest_kingdom"."main"."stg_ad_impressions__dbt_backup" cascade
    
[0m18:55:39.009860 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:55:39.010972 [debug] [Thread-1 (]: On model.quest_kingdom.stg_ad_impressions: Close
[0m18:55:39.011876 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8891146b-f07d-43e8-8ed1-e4a69a42163a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107b270e0>]}
[0m18:55:39.012181 [info ] [Thread-1 (]: 1 of 7 OK created sql view model main.stg_ad_impressions ....................... [[32mOK[0m in 0.04s]
[0m18:55:39.012441 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.stg_ad_impressions
[0m18:55:39.012627 [debug] [Thread-1 (]: Began running node model.quest_kingdom.stg_events
[0m18:55:39.012853 [info ] [Thread-1 (]: 2 of 7 START sql view model main.stg_events .................................... [RUN]
[0m18:55:39.013050 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.quest_kingdom.stg_ad_impressions, now model.quest_kingdom.stg_events)
[0m18:55:39.013205 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.stg_events
[0m18:55:39.014534 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.stg_events"
[0m18:55:39.014853 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.stg_events
[0m18:55:39.016348 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.stg_events"
[0m18:55:39.016869 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_events"
[0m18:55:39.017043 [debug] [Thread-1 (]: On model.quest_kingdom.stg_events: BEGIN
[0m18:55:39.017194 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:55:39.017506 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:55:39.017656 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_events"
[0m18:55:39.017806 [debug] [Thread-1 (]: On model.quest_kingdom.stg_events: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.stg_events"} */

  
  create view "quest_kingdom"."main"."stg_events__dbt_tmp" as (
    select
    -- ids
    event_id,
    player_id,
    session_id,
    
    -- timestamps
    event_timestamp::timestamp as event_at,
    
    -- dimensions
    lower(trim(event_name)) as event_name,
    
    -- json properties
    event_properties

from "quest_kingdom"."main"."events"
  );

[0m18:55:39.018258 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:55:39.020535 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_events"
[0m18:55:39.020708 [debug] [Thread-1 (]: On model.quest_kingdom.stg_events: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.stg_events"} */
alter view "quest_kingdom"."main"."stg_events" rename to "stg_events__dbt_backup"
[0m18:55:39.021030 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:55:39.022315 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_events"
[0m18:55:39.022465 [debug] [Thread-1 (]: On model.quest_kingdom.stg_events: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.stg_events"} */
alter view "quest_kingdom"."main"."stg_events__dbt_tmp" rename to "stg_events"
[0m18:55:39.022728 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:55:39.023431 [debug] [Thread-1 (]: On model.quest_kingdom.stg_events: COMMIT
[0m18:55:39.023578 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_events"
[0m18:55:39.023715 [debug] [Thread-1 (]: On model.quest_kingdom.stg_events: COMMIT
[0m18:55:39.024058 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:55:39.025216 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_events"
[0m18:55:39.025430 [debug] [Thread-1 (]: On model.quest_kingdom.stg_events: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.stg_events"} */

      drop view if exists "quest_kingdom"."main"."stg_events__dbt_backup" cascade
    
[0m18:55:39.025902 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:55:39.026593 [debug] [Thread-1 (]: On model.quest_kingdom.stg_events: Close
[0m18:55:39.027036 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8891146b-f07d-43e8-8ed1-e4a69a42163a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1107006b0>]}
[0m18:55:39.027612 [info ] [Thread-1 (]: 2 of 7 OK created sql view model main.stg_events ............................... [[32mOK[0m in 0.01s]
[0m18:55:39.027932 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.stg_events
[0m18:55:39.028138 [debug] [Thread-1 (]: Began running node model.quest_kingdom.stg_iap_transactions
[0m18:55:39.028390 [info ] [Thread-1 (]: 3 of 7 START sql view model main.stg_iap_transactions .......................... [RUN]
[0m18:55:39.028631 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.quest_kingdom.stg_events, now model.quest_kingdom.stg_iap_transactions)
[0m18:55:39.028801 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.stg_iap_transactions
[0m18:55:39.030223 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.stg_iap_transactions"
[0m18:55:39.030607 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.stg_iap_transactions
[0m18:55:39.032111 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.stg_iap_transactions"
[0m18:55:39.032417 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_iap_transactions"
[0m18:55:39.032573 [debug] [Thread-1 (]: On model.quest_kingdom.stg_iap_transactions: BEGIN
[0m18:55:39.032711 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:55:39.033053 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:55:39.033200 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_iap_transactions"
[0m18:55:39.033359 [debug] [Thread-1 (]: On model.quest_kingdom.stg_iap_transactions: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.stg_iap_transactions"} */

  
  create view "quest_kingdom"."main"."stg_iap_transactions__dbt_tmp" as (
    select
    -- ids
    transaction_id,
    player_id,
    session_id,
    
    -- timestamps
    transaction_timestamp::timestamp as purchased_at,
    
    -- dimensions
    lower(trim(sku)) as sku,
    lower(trim(platform)) as platform,
    
    -- metrics
    price_usd,
    gems_purchased,
    
    -- derived
    date_trunc('day', transaction_timestamp::timestamp)::date as purchase_date

from "quest_kingdom"."main"."iap_transactions"
  );

[0m18:55:39.033835 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:55:39.035318 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_iap_transactions"
[0m18:55:39.035482 [debug] [Thread-1 (]: On model.quest_kingdom.stg_iap_transactions: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.stg_iap_transactions"} */
alter view "quest_kingdom"."main"."stg_iap_transactions" rename to "stg_iap_transactions__dbt_backup"
[0m18:55:39.035783 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:55:39.037053 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_iap_transactions"
[0m18:55:39.037209 [debug] [Thread-1 (]: On model.quest_kingdom.stg_iap_transactions: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.stg_iap_transactions"} */
alter view "quest_kingdom"."main"."stg_iap_transactions__dbt_tmp" rename to "stg_iap_transactions"
[0m18:55:39.037483 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:55:39.038136 [debug] [Thread-1 (]: On model.quest_kingdom.stg_iap_transactions: COMMIT
[0m18:55:39.038290 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_iap_transactions"
[0m18:55:39.038429 [debug] [Thread-1 (]: On model.quest_kingdom.stg_iap_transactions: COMMIT
[0m18:55:39.038812 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:55:39.039873 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_iap_transactions"
[0m18:55:39.040033 [debug] [Thread-1 (]: On model.quest_kingdom.stg_iap_transactions: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.stg_iap_transactions"} */

      drop view if exists "quest_kingdom"."main"."stg_iap_transactions__dbt_backup" cascade
    
[0m18:55:39.040361 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:55:39.040923 [debug] [Thread-1 (]: On model.quest_kingdom.stg_iap_transactions: Close
[0m18:55:39.041159 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8891146b-f07d-43e8-8ed1-e4a69a42163a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1103e60f0>]}
[0m18:55:39.041540 [info ] [Thread-1 (]: 3 of 7 OK created sql view model main.stg_iap_transactions ..................... [[32mOK[0m in 0.01s]
[0m18:55:39.041796 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.stg_iap_transactions
[0m18:55:39.041980 [debug] [Thread-1 (]: Began running node model.quest_kingdom.stg_players
[0m18:55:39.042207 [info ] [Thread-1 (]: 4 of 7 START sql view model main.stg_players ................................... [RUN]
[0m18:55:39.042448 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.quest_kingdom.stg_iap_transactions, now model.quest_kingdom.stg_players)
[0m18:55:39.042626 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.stg_players
[0m18:55:39.044421 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.stg_players"
[0m18:55:39.045081 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.stg_players
[0m18:55:39.046713 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.stg_players"
[0m18:55:39.047036 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_players"
[0m18:55:39.047192 [debug] [Thread-1 (]: On model.quest_kingdom.stg_players: BEGIN
[0m18:55:39.047331 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:55:39.047728 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:55:39.047908 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_players"
[0m18:55:39.048079 [debug] [Thread-1 (]: On model.quest_kingdom.stg_players: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.stg_players"} */

  
  create view "quest_kingdom"."main"."stg_players__dbt_tmp" as (
    with source as (
    select * from "quest_kingdom"."main"."players"
),

renamed as (
    select
        player_id,
        install_date::date as installed_at,
        --dimensions
        lower(trim(attribution_channel)) as attribution_channel,
        lower(trim(country)) as country,
        lower(trim(device_type)) as device_type,
        lower(trim(player_segment)) as player_segment,
        lower(trim(experiment_variant)) as experiment_variant,
        --booleans
        tutorial_completed,
        --metrics
        lifetime_value as lifetime_value_usd
    from source 
)

select * from renamed
  );

[0m18:55:39.048677 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:55:39.051093 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_players"
[0m18:55:39.051266 [debug] [Thread-1 (]: On model.quest_kingdom.stg_players: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.stg_players"} */
alter view "quest_kingdom"."main"."stg_players" rename to "stg_players__dbt_backup"
[0m18:55:39.051583 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:55:39.083513 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_players"
[0m18:55:39.083754 [debug] [Thread-1 (]: On model.quest_kingdom.stg_players: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.stg_players"} */
alter view "quest_kingdom"."main"."stg_players__dbt_tmp" rename to "stg_players"
[0m18:55:39.084160 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:55:39.084871 [debug] [Thread-1 (]: On model.quest_kingdom.stg_players: COMMIT
[0m18:55:39.085027 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_players"
[0m18:55:39.085167 [debug] [Thread-1 (]: On model.quest_kingdom.stg_players: COMMIT
[0m18:55:39.085579 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:55:39.086632 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_players"
[0m18:55:39.086780 [debug] [Thread-1 (]: On model.quest_kingdom.stg_players: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.stg_players"} */

      drop view if exists "quest_kingdom"."main"."stg_players__dbt_backup" cascade
    
[0m18:55:39.087141 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:55:39.087693 [debug] [Thread-1 (]: On model.quest_kingdom.stg_players: Close
[0m18:55:39.087930 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8891146b-f07d-43e8-8ed1-e4a69a42163a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110744950>]}
[0m18:55:39.088195 [info ] [Thread-1 (]: 4 of 7 OK created sql view model main.stg_players .............................. [[32mOK[0m in 0.05s]
[0m18:55:39.088430 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.stg_players
[0m18:55:39.088596 [debug] [Thread-1 (]: Began running node model.quest_kingdom.stg_sessions
[0m18:55:39.088801 [info ] [Thread-1 (]: 5 of 7 START sql view model main.stg_sessions .................................. [RUN]
[0m18:55:39.088978 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.quest_kingdom.stg_players, now model.quest_kingdom.stg_sessions)
[0m18:55:39.089130 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.stg_sessions
[0m18:55:39.090456 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.stg_sessions"
[0m18:55:39.090819 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.stg_sessions
[0m18:55:39.092462 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.stg_sessions"
[0m18:55:39.092831 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_sessions"
[0m18:55:39.092997 [debug] [Thread-1 (]: On model.quest_kingdom.stg_sessions: BEGIN
[0m18:55:39.093145 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:55:39.093458 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:55:39.093611 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_sessions"
[0m18:55:39.093777 [debug] [Thread-1 (]: On model.quest_kingdom.stg_sessions: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.stg_sessions"} */

  
  create view "quest_kingdom"."main"."stg_sessions__dbt_tmp" as (
    with source as (
    select * from "quest_kingdom"."main"."sessions"
),

renamed as (
    select 
        session_id,
        player_id,
        --timestamps
        session_start::timestamp as session_started_at,
        session_end::timestamp as session_ended_at,

        --metrics
        session_duration_minutes,
        starting_level,
        ending_level,
        levels_gained,

        --derived metrics
        extract(hour from session_start::timestamp) as session_hour,
        extract(dow from session_start::timestamp) as session_day_of_week,
        date_trunc('day', session_start::timestamp)::date as session_date 
    from source
)

select * from renamed
  );

[0m18:55:39.094346 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:55:39.095880 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_sessions"
[0m18:55:39.096090 [debug] [Thread-1 (]: On model.quest_kingdom.stg_sessions: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.stg_sessions"} */
alter view "quest_kingdom"."main"."stg_sessions" rename to "stg_sessions__dbt_backup"
[0m18:55:39.096473 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:55:39.098394 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_sessions"
[0m18:55:39.098624 [debug] [Thread-1 (]: On model.quest_kingdom.stg_sessions: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.stg_sessions"} */
alter view "quest_kingdom"."main"."stg_sessions__dbt_tmp" rename to "stg_sessions"
[0m18:55:39.099064 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:55:39.099823 [debug] [Thread-1 (]: On model.quest_kingdom.stg_sessions: COMMIT
[0m18:55:39.100001 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_sessions"
[0m18:55:39.102750 [debug] [Thread-1 (]: On model.quest_kingdom.stg_sessions: COMMIT
[0m18:55:39.103275 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:55:39.104439 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_sessions"
[0m18:55:39.104598 [debug] [Thread-1 (]: On model.quest_kingdom.stg_sessions: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.stg_sessions"} */

      drop view if exists "quest_kingdom"."main"."stg_sessions__dbt_backup" cascade
    
[0m18:55:39.104957 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:55:39.105552 [debug] [Thread-1 (]: On model.quest_kingdom.stg_sessions: Close
[0m18:55:39.105796 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8891146b-f07d-43e8-8ed1-e4a69a42163a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110437d70>]}
[0m18:55:39.106070 [info ] [Thread-1 (]: 5 of 7 OK created sql view model main.stg_sessions ............................. [[32mOK[0m in 0.02s]
[0m18:55:39.106311 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.stg_sessions
[0m18:55:39.106641 [debug] [Thread-1 (]: Began running node model.quest_kingdom.dim_players
[0m18:55:39.106904 [info ] [Thread-1 (]: 6 of 7 START sql table model main.dim_players .................................. [RUN]
[0m18:55:39.107124 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.quest_kingdom.stg_sessions, now model.quest_kingdom.dim_players)
[0m18:55:39.107296 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.dim_players
[0m18:55:39.109321 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.dim_players"
[0m18:55:39.110110 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.dim_players
[0m18:55:39.119443 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.dim_players"
[0m18:55:39.120023 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.dim_players"
[0m18:55:39.120200 [debug] [Thread-1 (]: On model.quest_kingdom.dim_players: BEGIN
[0m18:55:39.120350 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:55:39.120704 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:55:39.120855 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.dim_players"
[0m18:55:39.121086 [debug] [Thread-1 (]: On model.quest_kingdom.dim_players: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.dim_players"} */

  
    
    

    create  table
      "quest_kingdom"."main"."dim_players__dbt_tmp"
  
    as (
      

with players as (
    select * from "quest_kingdom"."main"."stg_players"
),

sessions as (
    select * from "quest_kingdom"."main"."stg_sessions"
),

transactions as (
    select * from "quest_kingdom"."main"."stg_iap_transactions"
),

ads as (
    select * from "quest_kingdom"."main"."stg_ad_impressions"
),

--aggregate session metrics per player
player_sessions as (
    select 
        player_id,
        count(*) as total_sessions,
        min(session_started_at) as first_session_at,
        max(session_started_at) as last_session_at,
        sum(session_duration_minutes) as total_play_time_minutes,
        avg(session_duration_minutes) as avg_session_duration_minutes,
        max(ending_level) as max_level_reached
    from sessions 
    group by player_id
),

--aggregated IAP metrics per player
player_iap as (
    select
        player_id,
        count(*) as total_purchases,
        sum(price_usd) as total_iap_revenue,
        min(purchased_at) as first_purchase_at,
        avg(price_usd) as avg_purchase_value
    from transactions
    group by player_id 
),

--aggregate ad metrics per player
player_ads as (
    select 
        player_id,
        count(*) as total_ad_impressions,
        sum(revenue_usd) as total_ad_revenue,
        sum(case when clicked then 1 else 0 end) as total_ad_clicks
    from ads
    group by player_id 
),

--combining everything
final (
    select 
        p.player_id,
        p.installed_at,
        p.attribution_channel,
        p.country,
        p.device_type,
        p.player_segment,
        p.experiment_variant,
        p.tutorial_completed,

        --session metrics
        coalesce(ps.total_sessions, 0) as total_sessions,
        ps.first_session_at,
        ps.last_session_at,
        coalesce(ps.total_play_time_minutes, 0) as total_play_time_minutes,
        ps.avg_session_duration_minutes,
        coalesce(ps.max_level_reached, 0) as max_level_reached,

        --monetization metrics
        coalesce(pi.total_purchases, 0) as total_purchases,
        coalesce(pi.total_iap_revenue, 0) as total_iap_revenue,
        pi.first_purchase_at,
        pi.avg_purchase_value,
        coalesce(pa.total_ad_impressions, 0) as total_ad_impressions,
        coalesce(pa.total_ad_revenue, 0) as total_ad_revenue,
        coalesce(pc.total_ad_clicks, 0) as total_ad_clicks,

        --derived total revenue
        coalesce(pi.total_iap_revenue, 0) + coalesce(pc.total_ad_revenue, 0) as total_revenue,
        --derived day metrics
        datediff('day', p.installed_at, current_date) as days_since_install,
        case
            when ps.last_session_at is not null 
            then datediff('day', ps.last_session_at, current_date)
            else null 
        end as days_since_last_session,
        case
            when pi.first_purchase_at is not null
            then datediff('day', p.installed_at, pi.first_purchase_at)
            else null 
        end days_to_first_purchase,

        --derived flags
        coalesce(ps.total_sessions, 0) > 0 as is_activated,
        coalesce(pi.total_purchases, 0) > 0 as is_payer,
        coalesce(pa.total_ad_impressions, 0) > 0 as has_seen_ads
    from players p 
    left join player_sessions ps on p.player_id = ps.player_id
    left join player_iap pi on p.player_id = pi.player_id
    left join player_ads pa on p.player_id = pa.player_id 
)

select * from final
    );
  
  
[0m18:55:39.124074 [debug] [Thread-1 (]: DuckDB adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.dim_players"} */

  
    
    

    create  table
      "quest_kingdom"."main"."dim_players__dbt_tmp"
  
    as (
      

with players as (
    select * from "quest_kingdom"."main"."stg_players"
),

sessions as (
    select * from "quest_kingdom"."main"."stg_sessions"
),

transactions as (
    select * from "quest_kingdom"."main"."stg_iap_transactions"
),

ads as (
    select * from "quest_kingdom"."main"."stg_ad_impressions"
),

--aggregate session metrics per player
player_sessions as (
    select 
        player_id,
        count(*) as total_sessions,
        min(session_started_at) as first_session_at,
        max(session_started_at) as last_session_at,
        sum(session_duration_minutes) as total_play_time_minutes,
        avg(session_duration_minutes) as avg_session_duration_minutes,
        max(ending_level) as max_level_reached
    from sessions 
    group by player_id
),

--aggregated IAP metrics per player
player_iap as (
    select
        player_id,
        count(*) as total_purchases,
        sum(price_usd) as total_iap_revenue,
        min(purchased_at) as first_purchase_at,
        avg(price_usd) as avg_purchase_value
    from transactions
    group by player_id 
),

--aggregate ad metrics per player
player_ads as (
    select 
        player_id,
        count(*) as total_ad_impressions,
        sum(revenue_usd) as total_ad_revenue,
        sum(case when clicked then 1 else 0 end) as total_ad_clicks
    from ads
    group by player_id 
),

--combining everything
final (
    select 
        p.player_id,
        p.installed_at,
        p.attribution_channel,
        p.country,
        p.device_type,
        p.player_segment,
        p.experiment_variant,
        p.tutorial_completed,

        --session metrics
        coalesce(ps.total_sessions, 0) as total_sessions,
        ps.first_session_at,
        ps.last_session_at,
        coalesce(ps.total_play_time_minutes, 0) as total_play_time_minutes,
        ps.avg_session_duration_minutes,
        coalesce(ps.max_level_reached, 0) as max_level_reached,

        --monetization metrics
        coalesce(pi.total_purchases, 0) as total_purchases,
        coalesce(pi.total_iap_revenue, 0) as total_iap_revenue,
        pi.first_purchase_at,
        pi.avg_purchase_value,
        coalesce(pa.total_ad_impressions, 0) as total_ad_impressions,
        coalesce(pa.total_ad_revenue, 0) as total_ad_revenue,
        coalesce(pc.total_ad_clicks, 0) as total_ad_clicks,

        --derived total revenue
        coalesce(pi.total_iap_revenue, 0) + coalesce(pc.total_ad_revenue, 0) as total_revenue,
        --derived day metrics
        datediff('day', p.installed_at, current_date) as days_since_install,
        case
            when ps.last_session_at is not null 
            then datediff('day', ps.last_session_at, current_date)
            else null 
        end as days_since_last_session,
        case
            when pi.first_purchase_at is not null
            then datediff('day', p.installed_at, pi.first_purchase_at)
            else null 
        end days_to_first_purchase,

        --derived flags
        coalesce(ps.total_sessions, 0) > 0 as is_activated,
        coalesce(pi.total_purchases, 0) > 0 as is_payer,
        coalesce(pa.total_ad_impressions, 0) > 0 as has_seen_ads
    from players p 
    left join player_sessions ps on p.player_id = ps.player_id
    left join player_iap pi on p.player_id = pi.player_id
    left join player_ads pa on p.player_id = pa.player_id 
)

select * from final
    );
  
  
[0m18:55:39.124344 [debug] [Thread-1 (]: DuckDB adapter: Rolling back transaction.
[0m18:55:39.124543 [debug] [Thread-1 (]: On model.quest_kingdom.dim_players: ROLLBACK
[0m18:55:39.129093 [debug] [Thread-1 (]: Failed to rollback 'model.quest_kingdom.dim_players'
[0m18:55:39.129316 [debug] [Thread-1 (]: On model.quest_kingdom.dim_players: Close
[0m18:55:39.130461 [debug] [Thread-1 (]: Runtime Error in model dim_players (models/marts/core/dim_players.sql)
  Parser Error: syntax error at or near "select"
  
  LINE 68:     select 
               ^
[0m18:55:39.130682 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8891146b-f07d-43e8-8ed1-e4a69a42163a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110700da0>]}
[0m18:55:39.130975 [error] [Thread-1 (]: 6 of 7 ERROR creating sql table model main.dim_players ......................... [[31mERROR[0m in 0.02s]
[0m18:55:39.131226 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.dim_players
[0m18:55:39.131402 [debug] [Thread-1 (]: Began running node model.quest_kingdom.fct_sessions
[0m18:55:39.131628 [debug] [Thread-4 (]: Marking all children of 'model.quest_kingdom.dim_players' to be skipped because of status 'error'.  Reason: Runtime Error in model dim_players (models/marts/core/dim_players.sql)
  Parser Error: syntax error at or near "select"
  
  LINE 68:     select 
               ^.
[0m18:55:39.131840 [info ] [Thread-1 (]: 7 of 7 START sql table model main.fct_sessions ................................. [RUN]
[0m18:55:39.132388 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.quest_kingdom.dim_players, now model.quest_kingdom.fct_sessions)
[0m18:55:39.132555 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.fct_sessions
[0m18:55:39.135170 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.fct_sessions"
[0m18:55:39.135563 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.fct_sessions
[0m18:55:39.137065 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.fct_sessions"
[0m18:55:39.137451 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.fct_sessions"
[0m18:55:39.137606 [debug] [Thread-1 (]: On model.quest_kingdom.fct_sessions: BEGIN
[0m18:55:39.137747 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:55:39.138093 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:55:39.138241 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.fct_sessions"
[0m18:55:39.138424 [debug] [Thread-1 (]: On model.quest_kingdom.fct_sessions: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.fct_sessions"} */

  
    
    

    create  table
      "quest_kingdom"."main"."fct_sessions__dbt_tmp"
  
    as (
      

with sessions as (
    select * from "quest_kingdom"."main"."stg_sessions"
),

players as (
    select * from "quest_kingdom"."main"."stg_players"
),

final as (
    select 
        s.session_id,
        s.player_id,
        s.session_started_at,
        s.session_ended_at,
        s.session_duration_minutes,
        s.starting_level,
        s.ending_level,
        s.levels_gained,
        s.session_hour,
        s.session_day_of_week,
        s.session_date,

        --player context
        p.installed_at,
        p.attribution_channel,
        p.country,
        p.device_type,
        p.player_segment,
        p.experiment_variant,
        p.tutorial_completed,

        --derived metrics
        datediff('day', p.installed_at, s.session_started_at) as days_since_install,
        --session quality flags
        s.session_duration_minutes >= 5 as is_quality_session,
        s.levels_gained > 0 as has_progression,

        --time of day flags
        case 
            when s.session_hour between 0 and 5 then 'night'
            when s.session_hour between 6 and 11 then 'morning'
            when s.session_hour between 12 and 17 then 'afternoon'
            when s.session_hour between 18 and 23 then 'evening'
        end as time_of_day,

        --weekend flag
        s.session_day_of_week in (0, 6) as is_weekend
    from sessions s 
    left join players p on s.player_id = p.player_id 
)

select * from final
    );
  
  
[0m18:55:39.194272 [debug] [Thread-1 (]: SQL status: OK in 0.056 seconds
[0m18:55:39.196246 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.fct_sessions"
[0m18:55:39.196443 [debug] [Thread-1 (]: On model.quest_kingdom.fct_sessions: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.fct_sessions"} */
alter table "quest_kingdom"."main"."fct_sessions__dbt_tmp" rename to "fct_sessions"
[0m18:55:39.196894 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:55:39.199432 [debug] [Thread-1 (]: On model.quest_kingdom.fct_sessions: COMMIT
[0m18:55:39.199620 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.fct_sessions"
[0m18:55:39.199770 [debug] [Thread-1 (]: On model.quest_kingdom.fct_sessions: COMMIT
[0m18:55:39.214962 [debug] [Thread-1 (]: SQL status: OK in 0.015 seconds
[0m18:55:39.216321 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.fct_sessions"
[0m18:55:39.216485 [debug] [Thread-1 (]: On model.quest_kingdom.fct_sessions: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.fct_sessions"} */

      drop table if exists "quest_kingdom"."main"."fct_sessions__dbt_backup" cascade
    
[0m18:55:39.216808 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:55:39.217475 [debug] [Thread-1 (]: On model.quest_kingdom.fct_sessions: Close
[0m18:55:39.217742 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8891146b-f07d-43e8-8ed1-e4a69a42163a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11008b470>]}
[0m18:55:39.218015 [info ] [Thread-1 (]: 7 of 7 OK created sql table model main.fct_sessions ............................ [[32mOK[0m in 0.09s]
[0m18:55:39.218255 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.fct_sessions
[0m18:55:39.218781 [debug] [MainThread]: Using duckdb connection "master"
[0m18:55:39.218915 [debug] [MainThread]: On master: BEGIN
[0m18:55:39.219033 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m18:55:39.219279 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m18:55:39.219402 [debug] [MainThread]: On master: COMMIT
[0m18:55:39.219520 [debug] [MainThread]: Using duckdb connection "master"
[0m18:55:39.219632 [debug] [MainThread]: On master: COMMIT
[0m18:55:39.219823 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m18:55:39.219940 [debug] [MainThread]: On master: Close
[0m18:55:39.220087 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:55:39.220200 [debug] [MainThread]: Connection 'model.quest_kingdom.fct_sessions' was properly closed.
[0m18:55:39.220356 [info ] [MainThread]: 
[0m18:55:39.220496 [info ] [MainThread]: Finished running 2 table models, 5 view models in 0 hours 0 minutes and 0.33 seconds (0.33s).
[0m18:55:39.221072 [debug] [MainThread]: Command end result
[0m18:55:39.234728 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/manifest.json
[0m18:55:39.235813 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/semantic_manifest.json
[0m18:55:39.239013 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/run_results.json
[0m18:55:39.239179 [info ] [MainThread]: 
[0m18:55:39.239349 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m18:55:39.239489 [info ] [MainThread]: 
[0m18:55:39.239662 [error] [MainThread]: [31mFailure in model dim_players (models/marts/core/dim_players.sql)[0m
[0m18:55:39.239826 [error] [MainThread]:   Runtime Error in model dim_players (models/marts/core/dim_players.sql)
  Parser Error: syntax error at or near "select"
  
  LINE 68:     select 
               ^
[0m18:55:39.239949 [info ] [MainThread]: 
[0m18:55:39.240095 [info ] [MainThread]:   compiled code at target/compiled/quest_kingdom/models/marts/core/dim_players.sql
[0m18:55:39.240225 [info ] [MainThread]: 
[0m18:55:39.240364 [info ] [MainThread]: Done. PASS=6 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=7
[0m18:55:39.241887 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.79725176, "process_in_blocks": "0", "process_kernel_time": 0.203878, "process_mem_max_rss": "182779904", "process_out_blocks": "0", "process_user_time": 1.279305}
[0m18:55:39.242125 [debug] [MainThread]: Command `dbt run` failed at 18:55:39.242084 after 0.80 seconds
[0m18:55:39.242319 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1066b5a90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1066b4b90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1066e1190>]}
[0m18:55:39.242484 [debug] [MainThread]: Flushing usage events
[0m18:55:39.386566 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m18:57:37.039945 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106b6a960>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1071d5b20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1071d57f0>]}


============================== 18:57:37.043193 | b9dcc5c9-21fa-49cc-b4eb-3462807069cd ==============================
[0m18:57:37.043193 [info ] [MainThread]: Running with dbt=1.11.4
[0m18:57:37.043510 [debug] [MainThread]: running dbt with arguments {'no_print': 'None', 'profiles_dir': '/Users/hazeldonaldson/.dbt', 'version_check': 'True', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_format': 'default', 'partial_parse': 'True', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'empty': 'False', 'printer_width': '80', 'quiet': 'False', 'static_parser': 'True', 'write_json': 'True', 'cache_selected_only': 'False', 'introspect': 'True', 'target_path': 'None', 'use_experimental_parser': 'False', 'send_anonymous_usage_stats': 'True', 'invocation_command': 'dbt run', 'log_path': '/Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/logs', 'warn_error': 'None'}
[0m18:57:37.207553 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b9dcc5c9-21fa-49cc-b4eb-3462807069cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1064b6c30>]}
[0m18:57:37.236336 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b9dcc5c9-21fa-49cc-b4eb-3462807069cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106e15b80>]}
[0m18:57:37.237677 [info ] [MainThread]: Registered adapter: duckdb=1.10.0
[0m18:57:37.288860 [debug] [MainThread]: checksum: 092b177ba87eb6bb3c55954c38aa57900eebac336561eb9ee32218428aa81d43, vars: {}, profile: , target: , version: 1.11.4
[0m18:57:37.358404 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m18:57:37.358828 [debug] [MainThread]: Partial parsing: updated file: quest_kingdom://models/marts/core/dim_players.sql
[0m18:57:37.483722 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 7 unused configuration paths:
- models.marts
- models.question_kingdom
- models.core
- models.staging
- models.product
- models.retention
- models.monetization
[0m18:57:37.490593 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b9dcc5c9-21fa-49cc-b4eb-3462807069cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10790a3f0>]}
[0m18:57:37.536119 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/manifest.json
[0m18:57:37.537541 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/semantic_manifest.json
[0m18:57:37.552473 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b9dcc5c9-21fa-49cc-b4eb-3462807069cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107a35e50>]}
[0m18:57:37.552761 [info ] [MainThread]: Found 7 models, 23 data tests, 5 sources, 472 macros
[0m18:57:37.552930 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b9dcc5c9-21fa-49cc-b4eb-3462807069cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1055e0e90>]}
[0m18:57:37.554048 [info ] [MainThread]: 
[0m18:57:37.554231 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m18:57:37.554367 [info ] [MainThread]: 
[0m18:57:37.554599 [debug] [MainThread]: Acquiring new duckdb connection 'master'
[0m18:57:37.556854 [debug] [ThreadPool]: Acquiring new duckdb connection 'list_quest_kingdom'
[0m18:57:37.584314 [debug] [ThreadPool]: Using duckdb connection "list_quest_kingdom"
[0m18:57:37.584552 [debug] [ThreadPool]: On list_quest_kingdom: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "list_quest_kingdom"} */

    
    select schema_name
    from system.information_schema.schemata
    
    where lower(catalog_name) = '"quest_kingdom"'
    
  
  
[0m18:57:37.584704 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:57:37.602245 [debug] [ThreadPool]: SQL status: OK in 0.017 seconds
[0m18:57:37.603027 [debug] [ThreadPool]: On list_quest_kingdom: Close
[0m18:57:37.603367 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_quest_kingdom, now create_quest_kingdom_main)
[0m18:57:37.603586 [debug] [ThreadPool]: Creating schema "database: "quest_kingdom"
schema: "main"
"
[0m18:57:37.606842 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m18:57:37.607014 [debug] [ThreadPool]: On create_quest_kingdom_main: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "create_quest_kingdom_main"} */

    
        select type from duckdb_databases()
        where lower(database_name)='quest_kingdom'
        and type='sqlite'
    
  
[0m18:57:37.607147 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:57:37.607863 [debug] [ThreadPool]: SQL status: OK in 0.001 seconds
[0m18:57:37.608618 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m18:57:37.608750 [debug] [ThreadPool]: On create_quest_kingdom_main: BEGIN
[0m18:57:37.608966 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m18:57:37.609089 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m18:57:37.609210 [debug] [ThreadPool]: On create_quest_kingdom_main: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "create_quest_kingdom_main"} */

    
    
        create schema if not exists "quest_kingdom"."main"
    
[0m18:57:37.609644 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m18:57:37.610232 [debug] [ThreadPool]: On create_quest_kingdom_main: COMMIT
[0m18:57:37.610393 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m18:57:37.610529 [debug] [ThreadPool]: On create_quest_kingdom_main: COMMIT
[0m18:57:37.610797 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m18:57:37.610931 [debug] [ThreadPool]: On create_quest_kingdom_main: Close
[0m18:57:37.611591 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_quest_kingdom_main, now list_quest_kingdom_main)
[0m18:57:37.614243 [debug] [ThreadPool]: Using duckdb connection "list_quest_kingdom_main"
[0m18:57:37.614398 [debug] [ThreadPool]: On list_quest_kingdom_main: BEGIN
[0m18:57:37.614519 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:57:37.614761 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m18:57:37.614888 [debug] [ThreadPool]: Using duckdb connection "list_quest_kingdom_main"
[0m18:57:37.615022 [debug] [ThreadPool]: On list_quest_kingdom_main: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "list_quest_kingdom_main"} */
select
      'quest_kingdom' as database,
      table_name as name,
      table_schema as schema,
      CASE table_type
        WHEN 'BASE TABLE' THEN 'table'
        WHEN 'VIEW' THEN 'view'
        WHEN 'LOCAL TEMPORARY' THEN 'table'
        END as type
    from system.information_schema.tables
    where lower(table_schema) = 'main'
    and lower(table_catalog) = 'quest_kingdom'
  
[0m18:57:37.625817 [debug] [ThreadPool]: SQL status: OK in 0.011 seconds
[0m18:57:37.626563 [debug] [ThreadPool]: On list_quest_kingdom_main: ROLLBACK
[0m18:57:37.627549 [debug] [ThreadPool]: Failed to rollback 'list_quest_kingdom_main'
[0m18:57:37.628475 [debug] [ThreadPool]: On list_quest_kingdom_main: Close
[0m18:57:37.629555 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b9dcc5c9-21fa-49cc-b4eb-3462807069cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107a0b5f0>]}
[0m18:57:37.629817 [debug] [MainThread]: Using duckdb connection "master"
[0m18:57:37.629962 [debug] [MainThread]: On master: BEGIN
[0m18:57:37.630088 [debug] [MainThread]: Opening a new connection, currently in state init
[0m18:57:37.630365 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m18:57:37.630497 [debug] [MainThread]: On master: COMMIT
[0m18:57:37.630618 [debug] [MainThread]: Using duckdb connection "master"
[0m18:57:37.630728 [debug] [MainThread]: On master: COMMIT
[0m18:57:37.630915 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m18:57:37.631038 [debug] [MainThread]: On master: Close
[0m18:57:37.632367 [debug] [Thread-1 (]: Began running node model.quest_kingdom.stg_ad_impressions
[0m18:57:37.632609 [info ] [Thread-1 (]: 1 of 7 START sql view model main.stg_ad_impressions ............................ [RUN]
[0m18:57:37.632808 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_quest_kingdom_main, now model.quest_kingdom.stg_ad_impressions)
[0m18:57:37.632968 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.stg_ad_impressions
[0m18:57:37.668797 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.stg_ad_impressions"
[0m18:57:37.669582 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.stg_ad_impressions
[0m18:57:37.683529 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.stg_ad_impressions"
[0m18:57:37.683964 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_ad_impressions"
[0m18:57:37.684133 [debug] [Thread-1 (]: On model.quest_kingdom.stg_ad_impressions: BEGIN
[0m18:57:37.684282 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:57:37.684646 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:57:37.684802 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_ad_impressions"
[0m18:57:37.684967 [debug] [Thread-1 (]: On model.quest_kingdom.stg_ad_impressions: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.stg_ad_impressions"} */

  
  create view "quest_kingdom"."main"."stg_ad_impressions__dbt_tmp" as (
    select
    -- ids
    ad_id,
    player_id,
    session_id,
    
    -- timestamps
    ad_timestamp::timestamp as shown_at,
    
    -- dimensions
    lower(trim(ad_type)) as ad_type,
    lower(trim(ad_network)) as ad_network,
    
    -- booleans
    clicked,
    
    -- metrics
    revenue_usd,
    
    -- derived
    date_trunc('day', ad_timestamp::timestamp)::date as ad_date

from "quest_kingdom"."main"."ad_impressions"
  );

[0m18:57:37.685674 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m18:57:37.688603 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_ad_impressions"
[0m18:57:37.688788 [debug] [Thread-1 (]: On model.quest_kingdom.stg_ad_impressions: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.stg_ad_impressions"} */
alter view "quest_kingdom"."main"."stg_ad_impressions" rename to "stg_ad_impressions__dbt_backup"
[0m18:57:37.689613 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m18:57:37.691011 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_ad_impressions"
[0m18:57:37.691182 [debug] [Thread-1 (]: On model.quest_kingdom.stg_ad_impressions: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.stg_ad_impressions"} */
alter view "quest_kingdom"."main"."stg_ad_impressions__dbt_tmp" rename to "stg_ad_impressions"
[0m18:57:37.691553 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:57:37.765214 [debug] [Thread-1 (]: On model.quest_kingdom.stg_ad_impressions: COMMIT
[0m18:57:37.765589 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_ad_impressions"
[0m18:57:37.765769 [debug] [Thread-1 (]: On model.quest_kingdom.stg_ad_impressions: COMMIT
[0m18:57:37.767641 [debug] [Thread-1 (]: SQL status: OK in 0.002 seconds
[0m18:57:37.785810 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_ad_impressions"
[0m18:57:37.786165 [debug] [Thread-1 (]: On model.quest_kingdom.stg_ad_impressions: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.stg_ad_impressions"} */

      drop view if exists "quest_kingdom"."main"."stg_ad_impressions__dbt_backup" cascade
    
[0m18:57:37.790970 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m18:57:37.792292 [debug] [Thread-1 (]: On model.quest_kingdom.stg_ad_impressions: Close
[0m18:57:37.793304 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b9dcc5c9-21fa-49cc-b4eb-3462807069cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1077e36b0>]}
[0m18:57:37.793629 [info ] [Thread-1 (]: 1 of 7 OK created sql view model main.stg_ad_impressions ....................... [[32mOK[0m in 0.16s]
[0m18:57:37.793946 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.stg_ad_impressions
[0m18:57:37.794138 [debug] [Thread-1 (]: Began running node model.quest_kingdom.stg_events
[0m18:57:37.794386 [info ] [Thread-1 (]: 2 of 7 START sql view model main.stg_events .................................... [RUN]
[0m18:57:37.794602 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.quest_kingdom.stg_ad_impressions, now model.quest_kingdom.stg_events)
[0m18:57:37.794766 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.stg_events
[0m18:57:37.796294 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.stg_events"
[0m18:57:37.796722 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.stg_events
[0m18:57:37.798421 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.stg_events"
[0m18:57:37.798748 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_events"
[0m18:57:37.798974 [debug] [Thread-1 (]: On model.quest_kingdom.stg_events: BEGIN
[0m18:57:37.799132 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:57:37.799546 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:57:37.799759 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_events"
[0m18:57:37.799949 [debug] [Thread-1 (]: On model.quest_kingdom.stg_events: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.stg_events"} */

  
  create view "quest_kingdom"."main"."stg_events__dbt_tmp" as (
    select
    -- ids
    event_id,
    player_id,
    session_id,
    
    -- timestamps
    event_timestamp::timestamp as event_at,
    
    -- dimensions
    lower(trim(event_name)) as event_name,
    
    -- json properties
    event_properties

from "quest_kingdom"."main"."events"
  );

[0m18:57:37.800417 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:57:37.802369 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_events"
[0m18:57:37.802599 [debug] [Thread-1 (]: On model.quest_kingdom.stg_events: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.stg_events"} */
alter view "quest_kingdom"."main"."stg_events" rename to "stg_events__dbt_backup"
[0m18:57:37.802991 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:57:37.805260 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_events"
[0m18:57:37.805436 [debug] [Thread-1 (]: On model.quest_kingdom.stg_events: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.stg_events"} */
alter view "quest_kingdom"."main"."stg_events__dbt_tmp" rename to "stg_events"
[0m18:57:37.805720 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:57:37.806417 [debug] [Thread-1 (]: On model.quest_kingdom.stg_events: COMMIT
[0m18:57:37.806572 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_events"
[0m18:57:37.806711 [debug] [Thread-1 (]: On model.quest_kingdom.stg_events: COMMIT
[0m18:57:37.807078 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:57:37.808251 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_events"
[0m18:57:37.808413 [debug] [Thread-1 (]: On model.quest_kingdom.stg_events: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.stg_events"} */

      drop view if exists "quest_kingdom"."main"."stg_events__dbt_backup" cascade
    
[0m18:57:37.808756 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:57:37.809358 [debug] [Thread-1 (]: On model.quest_kingdom.stg_events: Close
[0m18:57:37.809614 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b9dcc5c9-21fa-49cc-b4eb-3462807069cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1077f69c0>]}
[0m18:57:37.809891 [info ] [Thread-1 (]: 2 of 7 OK created sql view model main.stg_events ............................... [[32mOK[0m in 0.02s]
[0m18:57:37.810138 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.stg_events
[0m18:57:37.810316 [debug] [Thread-1 (]: Began running node model.quest_kingdom.stg_iap_transactions
[0m18:57:37.810552 [info ] [Thread-1 (]: 3 of 7 START sql view model main.stg_iap_transactions .......................... [RUN]
[0m18:57:37.810795 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.quest_kingdom.stg_events, now model.quest_kingdom.stg_iap_transactions)
[0m18:57:37.810992 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.stg_iap_transactions
[0m18:57:37.812432 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.stg_iap_transactions"
[0m18:57:37.812814 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.stg_iap_transactions
[0m18:57:37.814387 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.stg_iap_transactions"
[0m18:57:37.814704 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_iap_transactions"
[0m18:57:37.814864 [debug] [Thread-1 (]: On model.quest_kingdom.stg_iap_transactions: BEGIN
[0m18:57:37.815012 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:57:37.815414 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:57:37.815623 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_iap_transactions"
[0m18:57:37.815804 [debug] [Thread-1 (]: On model.quest_kingdom.stg_iap_transactions: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.stg_iap_transactions"} */

  
  create view "quest_kingdom"."main"."stg_iap_transactions__dbt_tmp" as (
    select
    -- ids
    transaction_id,
    player_id,
    session_id,
    
    -- timestamps
    transaction_timestamp::timestamp as purchased_at,
    
    -- dimensions
    lower(trim(sku)) as sku,
    lower(trim(platform)) as platform,
    
    -- metrics
    price_usd,
    gems_purchased,
    
    -- derived
    date_trunc('day', transaction_timestamp::timestamp)::date as purchase_date

from "quest_kingdom"."main"."iap_transactions"
  );

[0m18:57:37.816295 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:57:37.817807 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_iap_transactions"
[0m18:57:37.817983 [debug] [Thread-1 (]: On model.quest_kingdom.stg_iap_transactions: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.stg_iap_transactions"} */
alter view "quest_kingdom"."main"."stg_iap_transactions" rename to "stg_iap_transactions__dbt_backup"
[0m18:57:37.818281 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:57:37.819602 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_iap_transactions"
[0m18:57:37.819761 [debug] [Thread-1 (]: On model.quest_kingdom.stg_iap_transactions: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.stg_iap_transactions"} */
alter view "quest_kingdom"."main"."stg_iap_transactions__dbt_tmp" rename to "stg_iap_transactions"
[0m18:57:37.820032 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:57:37.820725 [debug] [Thread-1 (]: On model.quest_kingdom.stg_iap_transactions: COMMIT
[0m18:57:37.820879 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_iap_transactions"
[0m18:57:37.821015 [debug] [Thread-1 (]: On model.quest_kingdom.stg_iap_transactions: COMMIT
[0m18:57:37.821396 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:57:37.822505 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_iap_transactions"
[0m18:57:37.822665 [debug] [Thread-1 (]: On model.quest_kingdom.stg_iap_transactions: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.stg_iap_transactions"} */

      drop view if exists "quest_kingdom"."main"."stg_iap_transactions__dbt_backup" cascade
    
[0m18:57:37.823000 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:57:37.823581 [debug] [Thread-1 (]: On model.quest_kingdom.stg_iap_transactions: Close
[0m18:57:37.823820 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b9dcc5c9-21fa-49cc-b4eb-3462807069cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107d86c60>]}
[0m18:57:37.824085 [info ] [Thread-1 (]: 3 of 7 OK created sql view model main.stg_iap_transactions ..................... [[32mOK[0m in 0.01s]
[0m18:57:37.824322 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.stg_iap_transactions
[0m18:57:37.824492 [debug] [Thread-1 (]: Began running node model.quest_kingdom.stg_players
[0m18:57:37.824703 [info ] [Thread-1 (]: 4 of 7 START sql view model main.stg_players ................................... [RUN]
[0m18:57:37.824881 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.quest_kingdom.stg_iap_transactions, now model.quest_kingdom.stg_players)
[0m18:57:37.825037 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.stg_players
[0m18:57:37.826358 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.stg_players"
[0m18:57:37.826865 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.stg_players
[0m18:57:37.828555 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.stg_players"
[0m18:57:37.829001 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_players"
[0m18:57:37.829160 [debug] [Thread-1 (]: On model.quest_kingdom.stg_players: BEGIN
[0m18:57:37.829309 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:57:37.829859 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m18:57:37.830056 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_players"
[0m18:57:37.830235 [debug] [Thread-1 (]: On model.quest_kingdom.stg_players: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.stg_players"} */

  
  create view "quest_kingdom"."main"."stg_players__dbt_tmp" as (
    with source as (
    select * from "quest_kingdom"."main"."players"
),

renamed as (
    select
        player_id,
        install_date::date as installed_at,
        --dimensions
        lower(trim(attribution_channel)) as attribution_channel,
        lower(trim(country)) as country,
        lower(trim(device_type)) as device_type,
        lower(trim(player_segment)) as player_segment,
        lower(trim(experiment_variant)) as experiment_variant,
        --booleans
        tutorial_completed,
        --metrics
        lifetime_value as lifetime_value_usd
    from source 
)

select * from renamed
  );

[0m18:57:37.830851 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:57:37.832638 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_players"
[0m18:57:37.832808 [debug] [Thread-1 (]: On model.quest_kingdom.stg_players: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.stg_players"} */
alter view "quest_kingdom"."main"."stg_players" rename to "stg_players__dbt_backup"
[0m18:57:37.833121 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:57:37.835385 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_players"
[0m18:57:37.835556 [debug] [Thread-1 (]: On model.quest_kingdom.stg_players: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.stg_players"} */
alter view "quest_kingdom"."main"."stg_players__dbt_tmp" rename to "stg_players"
[0m18:57:37.835844 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:57:37.836543 [debug] [Thread-1 (]: On model.quest_kingdom.stg_players: COMMIT
[0m18:57:37.836700 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_players"
[0m18:57:37.836844 [debug] [Thread-1 (]: On model.quest_kingdom.stg_players: COMMIT
[0m18:57:37.837260 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:57:37.838361 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_players"
[0m18:57:37.838519 [debug] [Thread-1 (]: On model.quest_kingdom.stg_players: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.stg_players"} */

      drop view if exists "quest_kingdom"."main"."stg_players__dbt_backup" cascade
    
[0m18:57:37.838856 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:57:37.839440 [debug] [Thread-1 (]: On model.quest_kingdom.stg_players: Close
[0m18:57:37.839683 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b9dcc5c9-21fa-49cc-b4eb-3462807069cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107e6aba0>]}
[0m18:57:37.839952 [info ] [Thread-1 (]: 4 of 7 OK created sql view model main.stg_players .............................. [[32mOK[0m in 0.01s]
[0m18:57:37.840193 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.stg_players
[0m18:57:37.840366 [debug] [Thread-1 (]: Began running node model.quest_kingdom.stg_sessions
[0m18:57:37.840575 [info ] [Thread-1 (]: 5 of 7 START sql view model main.stg_sessions .................................. [RUN]
[0m18:57:37.840754 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.quest_kingdom.stg_players, now model.quest_kingdom.stg_sessions)
[0m18:57:37.840909 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.stg_sessions
[0m18:57:37.842231 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.stg_sessions"
[0m18:57:37.842596 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.stg_sessions
[0m18:57:37.844173 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.stg_sessions"
[0m18:57:37.844532 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_sessions"
[0m18:57:37.844695 [debug] [Thread-1 (]: On model.quest_kingdom.stg_sessions: BEGIN
[0m18:57:37.844843 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:57:37.845189 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:57:37.845340 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_sessions"
[0m18:57:37.845506 [debug] [Thread-1 (]: On model.quest_kingdom.stg_sessions: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.stg_sessions"} */

  
  create view "quest_kingdom"."main"."stg_sessions__dbt_tmp" as (
    with source as (
    select * from "quest_kingdom"."main"."sessions"
),

renamed as (
    select 
        session_id,
        player_id,
        --timestamps
        session_start::timestamp as session_started_at,
        session_end::timestamp as session_ended_at,

        --metrics
        session_duration_minutes,
        starting_level,
        ending_level,
        levels_gained,

        --derived metrics
        extract(hour from session_start::timestamp) as session_hour,
        extract(dow from session_start::timestamp) as session_day_of_week,
        date_trunc('day', session_start::timestamp)::date as session_date 
    from source
)

select * from renamed
  );

[0m18:57:37.846634 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m18:57:37.848275 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_sessions"
[0m18:57:37.848446 [debug] [Thread-1 (]: On model.quest_kingdom.stg_sessions: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.stg_sessions"} */
alter view "quest_kingdom"."main"."stg_sessions" rename to "stg_sessions__dbt_backup"
[0m18:57:37.848775 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:57:37.850086 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_sessions"
[0m18:57:37.850242 [debug] [Thread-1 (]: On model.quest_kingdom.stg_sessions: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.stg_sessions"} */
alter view "quest_kingdom"."main"."stg_sessions__dbt_tmp" rename to "stg_sessions"
[0m18:57:37.850530 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:57:37.851203 [debug] [Thread-1 (]: On model.quest_kingdom.stg_sessions: COMMIT
[0m18:57:37.851363 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_sessions"
[0m18:57:37.851505 [debug] [Thread-1 (]: On model.quest_kingdom.stg_sessions: COMMIT
[0m18:57:37.851949 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:57:37.853105 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.stg_sessions"
[0m18:57:37.853272 [debug] [Thread-1 (]: On model.quest_kingdom.stg_sessions: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.stg_sessions"} */

      drop view if exists "quest_kingdom"."main"."stg_sessions__dbt_backup" cascade
    
[0m18:57:37.853624 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:57:37.854219 [debug] [Thread-1 (]: On model.quest_kingdom.stg_sessions: Close
[0m18:57:37.854471 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b9dcc5c9-21fa-49cc-b4eb-3462807069cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107e788f0>]}
[0m18:57:37.854752 [info ] [Thread-1 (]: 5 of 7 OK created sql view model main.stg_sessions ............................. [[32mOK[0m in 0.01s]
[0m18:57:37.855000 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.stg_sessions
[0m18:57:37.855329 [debug] [Thread-1 (]: Began running node model.quest_kingdom.dim_players
[0m18:57:37.855576 [info ] [Thread-1 (]: 6 of 7 START sql table model main.dim_players .................................. [RUN]
[0m18:57:37.855794 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.quest_kingdom.stg_sessions, now model.quest_kingdom.dim_players)
[0m18:57:37.855956 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.dim_players
[0m18:57:37.858112 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.dim_players"
[0m18:57:37.858839 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.dim_players
[0m18:57:37.870827 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.dim_players"
[0m18:57:37.871629 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.dim_players"
[0m18:57:37.871828 [debug] [Thread-1 (]: On model.quest_kingdom.dim_players: BEGIN
[0m18:57:37.871987 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:57:37.872426 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:57:37.872585 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.dim_players"
[0m18:57:37.872831 [debug] [Thread-1 (]: On model.quest_kingdom.dim_players: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.dim_players"} */

  
    
    

    create  table
      "quest_kingdom"."main"."dim_players__dbt_tmp"
  
    as (
      

with players as (

    select * from "quest_kingdom"."main"."stg_players"

),

sessions as (

    select * from "quest_kingdom"."main"."stg_sessions"

),

transactions as (

    select * from "quest_kingdom"."main"."stg_iap_transactions"

),

ads as (

    select * from "quest_kingdom"."main"."stg_ad_impressions"

),

-- Aggregate session metrics per player
player_sessions as (

    select
        player_id,
        count(*) as total_sessions,
        min(session_started_at) as first_session_at,
        max(session_started_at) as last_session_at,
        sum(session_duration_minutes) as total_play_time_minutes,
        avg(session_duration_minutes) as avg_session_duration_minutes,
        max(ending_level) as max_level_reached

    from sessions
    group by player_id

),

-- Aggregate IAP metrics per player
player_iap as (

    select
        player_id,
        count(*) as total_purchases,
        sum(price_usd) as total_iap_revenue,
        min(purchased_at) as first_purchase_at,
        avg(price_usd) as avg_purchase_value

    from transactions
    group by player_id

),

-- Aggregate ad metrics per player
player_ads as (

    select
        player_id,
        count(*) as total_ad_impressions,
        sum(revenue_usd) as total_ad_revenue,
        sum(case when clicked then 1 else 0 end) as total_ad_clicks

    from ads
    group by player_id

),

-- Combine everything
final as (

    select
        -- player attributes
        p.player_id,
        p.installed_at,
        p.attribution_channel,
        p.country,
        p.device_type,
        p.player_segment,
        p.experiment_variant,
        p.tutorial_completed,
        
        -- session metrics
        coalesce(ps.total_sessions, 0) as total_sessions,
        ps.first_session_at,
        ps.last_session_at,
        coalesce(ps.total_play_time_minutes, 0) as total_play_time_minutes,
        ps.avg_session_duration_minutes,
        coalesce(ps.max_level_reached, 0) as max_level_reached,
        
        -- monetization metrics
        coalesce(pi.total_purchases, 0) as total_purchases,
        coalesce(pi.total_iap_revenue, 0) as total_iap_revenue,
        pi.first_purchase_at,
        pi.avg_purchase_value,
        
        coalesce(pa.total_ad_impressions, 0) as total_ad_impressions,
        coalesce(pa.total_ad_revenue, 0) as total_ad_revenue,
        coalesce(pa.total_ad_clicks, 0) as total_ad_clicks,
        
        -- derived total revenue
        coalesce(pi.total_iap_revenue, 0) + coalesce(pa.total_ad_revenue, 0) as total_revenue,
        
        -- derived days metrics
        datediff('day', p.installed_at, current_date) as days_since_install,
        case 
            when ps.last_session_at is not null 
            then datediff('day', ps.last_session_at, current_date)
            else null
        end as days_since_last_session,
        case 
            when pi.first_purchase_at is not null 
            then datediff('day', p.installed_at, pi.first_purchase_at)
            else null
        end as days_to_first_purchase,
        
        -- derived flags
        coalesce(ps.total_sessions, 0) > 0 as is_activated,
        coalesce(pi.total_purchases, 0) > 0 as is_payer,
        coalesce(pa.total_ad_impressions, 0) > 0 as has_seen_ads

    from players p
    left join player_sessions ps on p.player_id = ps.player_id
    left join player_iap pi on p.player_id = pi.player_id
    left join player_ads pa on p.player_id = pa.player_id

)

select * from final
    );
  
  
[0m18:57:37.914854 [debug] [Thread-1 (]: SQL status: OK in 0.042 seconds
[0m18:57:37.920181 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.dim_players"
[0m18:57:37.920507 [debug] [Thread-1 (]: On model.quest_kingdom.dim_players: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.dim_players"} */
alter table "quest_kingdom"."main"."dim_players__dbt_tmp" rename to "dim_players"
[0m18:57:37.921107 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:57:37.923776 [debug] [Thread-1 (]: On model.quest_kingdom.dim_players: COMMIT
[0m18:57:37.923965 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.dim_players"
[0m18:57:37.924125 [debug] [Thread-1 (]: On model.quest_kingdom.dim_players: COMMIT
[0m18:57:37.928122 [debug] [Thread-1 (]: SQL status: OK in 0.004 seconds
[0m18:57:37.930446 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.dim_players"
[0m18:57:37.930620 [debug] [Thread-1 (]: On model.quest_kingdom.dim_players: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.dim_players"} */

      drop table if exists "quest_kingdom"."main"."dim_players__dbt_backup" cascade
    
[0m18:57:37.930929 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:57:37.931582 [debug] [Thread-1 (]: On model.quest_kingdom.dim_players: Close
[0m18:57:37.931845 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b9dcc5c9-21fa-49cc-b4eb-3462807069cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107e9ce60>]}
[0m18:57:37.932137 [info ] [Thread-1 (]: 6 of 7 OK created sql table model main.dim_players ............................. [[32mOK[0m in 0.08s]
[0m18:57:37.932394 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.dim_players
[0m18:57:37.932574 [debug] [Thread-1 (]: Began running node model.quest_kingdom.fct_sessions
[0m18:57:37.932801 [info ] [Thread-1 (]: 7 of 7 START sql table model main.fct_sessions ................................. [RUN]
[0m18:57:37.932986 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.quest_kingdom.dim_players, now model.quest_kingdom.fct_sessions)
[0m18:57:37.933142 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.fct_sessions
[0m18:57:37.934757 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.fct_sessions"
[0m18:57:37.935166 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.fct_sessions
[0m18:57:37.936677 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.fct_sessions"
[0m18:57:37.936984 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.fct_sessions"
[0m18:57:37.937138 [debug] [Thread-1 (]: On model.quest_kingdom.fct_sessions: BEGIN
[0m18:57:37.937282 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:57:37.937576 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:57:37.937728 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.fct_sessions"
[0m18:57:37.937919 [debug] [Thread-1 (]: On model.quest_kingdom.fct_sessions: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.fct_sessions"} */

  
    
    

    create  table
      "quest_kingdom"."main"."fct_sessions__dbt_tmp"
  
    as (
      

with sessions as (
    select * from "quest_kingdom"."main"."stg_sessions"
),

players as (
    select * from "quest_kingdom"."main"."stg_players"
),

final as (
    select 
        s.session_id,
        s.player_id,
        s.session_started_at,
        s.session_ended_at,
        s.session_duration_minutes,
        s.starting_level,
        s.ending_level,
        s.levels_gained,
        s.session_hour,
        s.session_day_of_week,
        s.session_date,

        --player context
        p.installed_at,
        p.attribution_channel,
        p.country,
        p.device_type,
        p.player_segment,
        p.experiment_variant,
        p.tutorial_completed,

        --derived metrics
        datediff('day', p.installed_at, s.session_started_at) as days_since_install,
        --session quality flags
        s.session_duration_minutes >= 5 as is_quality_session,
        s.levels_gained > 0 as has_progression,

        --time of day flags
        case 
            when s.session_hour between 0 and 5 then 'night'
            when s.session_hour between 6 and 11 then 'morning'
            when s.session_hour between 12 and 17 then 'afternoon'
            when s.session_hour between 18 and 23 then 'evening'
        end as time_of_day,

        --weekend flag
        s.session_day_of_week in (0, 6) as is_weekend
    from sessions s 
    left join players p on s.player_id = p.player_id 
)

select * from final
    );
  
  
[0m18:57:37.982614 [debug] [Thread-1 (]: SQL status: OK in 0.044 seconds
[0m18:57:37.987407 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.fct_sessions"
[0m18:57:37.987648 [debug] [Thread-1 (]: On model.quest_kingdom.fct_sessions: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.fct_sessions"} */

    SELECT index_name
    FROM duckdb_indexes()
    WHERE schema_name = 'main'
      AND table_name = 'fct_sessions'
  
[0m18:57:37.988236 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:57:37.988922 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.fct_sessions"
[0m18:57:37.989099 [debug] [Thread-1 (]: On model.quest_kingdom.fct_sessions: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.fct_sessions"} */

    SELECT COUNT(*) as remaining_indexes
    FROM duckdb_indexes()
    WHERE schema_name = 'main'
      AND table_name = 'fct_sessions'
  
[0m18:57:37.990986 [debug] [Thread-1 (]: SQL status: OK in 0.002 seconds
[0m18:57:37.993362 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.fct_sessions"
[0m18:57:37.993560 [debug] [Thread-1 (]: On model.quest_kingdom.fct_sessions: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.fct_sessions"} */
alter table "quest_kingdom"."main"."fct_sessions" rename to "fct_sessions__dbt_backup"
[0m18:57:37.994067 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:57:37.995700 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.fct_sessions"
[0m18:57:37.995893 [debug] [Thread-1 (]: On model.quest_kingdom.fct_sessions: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.fct_sessions"} */
alter table "quest_kingdom"."main"."fct_sessions__dbt_tmp" rename to "fct_sessions"
[0m18:57:37.996230 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:57:37.997119 [debug] [Thread-1 (]: On model.quest_kingdom.fct_sessions: COMMIT
[0m18:57:37.997288 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.fct_sessions"
[0m18:57:37.997438 [debug] [Thread-1 (]: On model.quest_kingdom.fct_sessions: COMMIT
[0m18:57:38.016421 [debug] [Thread-1 (]: SQL status: OK in 0.019 seconds
[0m18:57:38.017856 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.fct_sessions"
[0m18:57:38.018041 [debug] [Thread-1 (]: On model.quest_kingdom.fct_sessions: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.fct_sessions"} */

      drop table if exists "quest_kingdom"."main"."fct_sessions__dbt_backup" cascade
    
[0m18:57:38.018737 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m18:57:38.019484 [debug] [Thread-1 (]: On model.quest_kingdom.fct_sessions: Close
[0m18:57:38.019787 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b9dcc5c9-21fa-49cc-b4eb-3462807069cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107d99400>]}
[0m18:57:38.020105 [info ] [Thread-1 (]: 7 of 7 OK created sql table model main.fct_sessions ............................ [[32mOK[0m in 0.09s]
[0m18:57:38.020371 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.fct_sessions
[0m18:57:38.021061 [debug] [MainThread]: Using duckdb connection "master"
[0m18:57:38.021252 [debug] [MainThread]: On master: BEGIN
[0m18:57:38.021403 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m18:57:38.021733 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m18:57:38.021876 [debug] [MainThread]: On master: COMMIT
[0m18:57:38.022009 [debug] [MainThread]: Using duckdb connection "master"
[0m18:57:38.022137 [debug] [MainThread]: On master: COMMIT
[0m18:57:38.022352 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m18:57:38.022480 [debug] [MainThread]: On master: Close
[0m18:57:38.022653 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:57:38.022775 [debug] [MainThread]: Connection 'model.quest_kingdom.fct_sessions' was properly closed.
[0m18:57:38.022959 [info ] [MainThread]: 
[0m18:57:38.023116 [info ] [MainThread]: Finished running 2 table models, 5 view models in 0 hours 0 minutes and 0.47 seconds (0.47s).
[0m18:57:38.024511 [debug] [MainThread]: Command end result
[0m18:57:38.045489 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/manifest.json
[0m18:57:38.046585 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/semantic_manifest.json
[0m18:57:38.049818 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/run_results.json
[0m18:57:38.049995 [info ] [MainThread]: 
[0m18:57:38.050174 [info ] [MainThread]: [32mCompleted successfully[0m
[0m18:57:38.050316 [info ] [MainThread]: 
[0m18:57:38.050475 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=7
[0m18:57:38.051905 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 1.0558699, "process_in_blocks": "0", "process_kernel_time": 0.215149, "process_mem_max_rss": "204636160", "process_out_blocks": "0", "process_user_time": 1.451177}
[0m18:57:38.052120 [debug] [MainThread]: Command `dbt run` succeeded at 18:57:38.052081 after 1.06 seconds
[0m18:57:38.052299 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107a362d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1077d0ad0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10781a270>]}
[0m18:57:38.052463 [debug] [MainThread]: Flushing usage events
[0m18:57:38.188028 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m18:58:06.259453 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106a90620>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108757e90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109518140>]}


============================== 18:58:06.263372 | 4efc26f8-b44b-4c68-8077-27f19fb4a04b ==============================
[0m18:58:06.263372 [info ] [MainThread]: Running with dbt=1.11.4
[0m18:58:06.263724 [debug] [MainThread]: running dbt with arguments {'write_json': 'True', 'no_print': 'None', 'debug': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'version_check': 'True', 'partial_parse': 'True', 'quiet': 'False', 'empty': 'None', 'cache_selected_only': 'False', 'log_path': '/Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/logs', 'invocation_command': 'dbt test', 'indirect_selection': 'eager', 'profiles_dir': '/Users/hazeldonaldson/.dbt', 'log_format': 'default', 'use_colors': 'True', 'use_experimental_parser': 'False', 'printer_width': '80', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'fail_fast': 'False', 'warn_error': 'None', 'target_path': 'None', 'log_cache_events': 'False', 'introspect': 'True'}
[0m18:58:06.451089 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '4efc26f8-b44b-4c68-8077-27f19fb4a04b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1096e2630>]}
[0m18:58:06.479707 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '4efc26f8-b44b-4c68-8077-27f19fb4a04b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1087d72f0>]}
[0m18:58:06.480998 [info ] [MainThread]: Registered adapter: duckdb=1.10.0
[0m18:58:06.534149 [debug] [MainThread]: checksum: 092b177ba87eb6bb3c55954c38aa57900eebac336561eb9ee32218428aa81d43, vars: {}, profile: , target: , version: 1.11.4
[0m18:58:06.606648 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m18:58:06.606906 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m18:58:06.607049 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m18:58:06.610279 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 7 unused configuration paths:
- models.retention
- models.monetization
- models.product
- models.core
- models.question_kingdom
- models.marts
- models.staging
[0m18:58:06.629772 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '4efc26f8-b44b-4c68-8077-27f19fb4a04b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109900980>]}
[0m18:58:06.671680 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/manifest.json
[0m18:58:06.673028 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/semantic_manifest.json
[0m18:58:06.689676 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '4efc26f8-b44b-4c68-8077-27f19fb4a04b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109cd3e00>]}
[0m18:58:06.689977 [info ] [MainThread]: Found 7 models, 23 data tests, 5 sources, 472 macros
[0m18:58:06.690157 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4efc26f8-b44b-4c68-8077-27f19fb4a04b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109ca1c40>]}
[0m18:58:06.695079 [info ] [MainThread]: 
[0m18:58:06.695303 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m18:58:06.695497 [info ] [MainThread]: 
[0m18:58:06.695797 [debug] [MainThread]: Acquiring new duckdb connection 'master'
[0m18:58:06.698692 [debug] [ThreadPool]: Acquiring new duckdb connection 'list_quest_kingdom_main'
[0m18:58:06.726721 [debug] [ThreadPool]: Using duckdb connection "list_quest_kingdom_main"
[0m18:58:06.726956 [debug] [ThreadPool]: On list_quest_kingdom_main: BEGIN
[0m18:58:06.727099 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:58:06.739813 [debug] [ThreadPool]: SQL status: OK in 0.013 seconds
[0m18:58:06.740059 [debug] [ThreadPool]: Using duckdb connection "list_quest_kingdom_main"
[0m18:58:06.740215 [debug] [ThreadPool]: On list_quest_kingdom_main: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "list_quest_kingdom_main"} */
select
      'quest_kingdom' as database,
      table_name as name,
      table_schema as schema,
      CASE table_type
        WHEN 'BASE TABLE' THEN 'table'
        WHEN 'VIEW' THEN 'view'
        WHEN 'LOCAL TEMPORARY' THEN 'table'
        END as type
    from system.information_schema.tables
    where lower(table_schema) = 'main'
    and lower(table_catalog) = 'quest_kingdom'
  
[0m18:58:06.754497 [debug] [ThreadPool]: SQL status: OK in 0.014 seconds
[0m18:58:06.755444 [debug] [ThreadPool]: On list_quest_kingdom_main: ROLLBACK
[0m18:58:06.756396 [debug] [ThreadPool]: Failed to rollback 'list_quest_kingdom_main'
[0m18:58:06.756567 [debug] [ThreadPool]: On list_quest_kingdom_main: Close
[0m18:58:06.757718 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4efc26f8-b44b-4c68-8077-27f19fb4a04b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109900b60>]}
[0m18:58:06.757959 [debug] [MainThread]: Using duckdb connection "master"
[0m18:58:06.758100 [debug] [MainThread]: On master: BEGIN
[0m18:58:06.758223 [debug] [MainThread]: Opening a new connection, currently in state init
[0m18:58:06.758504 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m18:58:06.758640 [debug] [MainThread]: On master: COMMIT
[0m18:58:06.758770 [debug] [MainThread]: Using duckdb connection "master"
[0m18:58:06.758893 [debug] [MainThread]: On master: COMMIT
[0m18:58:06.759096 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m18:58:06.759226 [debug] [MainThread]: On master: Close
[0m18:58:06.760759 [debug] [Thread-1 (]: Began running node test.quest_kingdom.accepted_values_stg_events_event_name__tutorial_completed__level_completed__boss_defeated.4ed70dcb36
[0m18:58:06.760952 [info ] [Thread-1 (]: 1 of 23 START test accepted_values_stg_events_event_name__tutorial_completed__level_completed__boss_defeated  [RUN]
[0m18:58:06.761196 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_quest_kingdom_main, now test.quest_kingdom.accepted_values_stg_events_event_name__tutorial_completed__level_completed__boss_defeated.4ed70dcb36)
[0m18:58:06.761387 [debug] [Thread-1 (]: Began compiling node test.quest_kingdom.accepted_values_stg_events_event_name__tutorial_completed__level_completed__boss_defeated.4ed70dcb36
[0m18:58:06.769633 [debug] [Thread-1 (]: Writing injected SQL for node "test.quest_kingdom.accepted_values_stg_events_event_name__tutorial_completed__level_completed__boss_defeated.4ed70dcb36"
[0m18:58:06.770220 [debug] [Thread-1 (]: Began executing node test.quest_kingdom.accepted_values_stg_events_event_name__tutorial_completed__level_completed__boss_defeated.4ed70dcb36
[0m18:58:06.779208 [debug] [Thread-1 (]: Writing runtime sql for node "test.quest_kingdom.accepted_values_stg_events_event_name__tutorial_completed__level_completed__boss_defeated.4ed70dcb36"
[0m18:58:06.779911 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.accepted_values_stg_events_event_name__tutorial_completed__level_completed__boss_defeated.4ed70dcb36"
[0m18:58:06.780121 [debug] [Thread-1 (]: On test.quest_kingdom.accepted_values_stg_events_event_name__tutorial_completed__level_completed__boss_defeated.4ed70dcb36: BEGIN
[0m18:58:06.780283 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:58:06.780658 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:58:06.780826 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.accepted_values_stg_events_event_name__tutorial_completed__level_completed__boss_defeated.4ed70dcb36"
[0m18:58:06.781004 [debug] [Thread-1 (]: On test.quest_kingdom.accepted_values_stg_events_event_name__tutorial_completed__level_completed__boss_defeated.4ed70dcb36: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "test.quest_kingdom.accepted_values_stg_events_event_name__tutorial_completed__level_completed__boss_defeated.4ed70dcb36"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

with all_values as (

    select
        event_name as value_field,
        count(*) as n_records

    from "quest_kingdom"."main"."stg_events"
    group by event_name

)

select *
from all_values
where value_field not in (
    'tutorial_completed','level_completed','boss_defeated'
)



  
  
      
    ) dbt_internal_test
[0m18:58:06.785728 [debug] [Thread-1 (]: SQL status: OK in 0.005 seconds
[0m18:58:06.787956 [debug] [Thread-1 (]: On test.quest_kingdom.accepted_values_stg_events_event_name__tutorial_completed__level_completed__boss_defeated.4ed70dcb36: ROLLBACK
[0m18:58:06.788437 [debug] [Thread-1 (]: Failed to rollback 'test.quest_kingdom.accepted_values_stg_events_event_name__tutorial_completed__level_completed__boss_defeated.4ed70dcb36'
[0m18:58:06.788605 [debug] [Thread-1 (]: On test.quest_kingdom.accepted_values_stg_events_event_name__tutorial_completed__level_completed__boss_defeated.4ed70dcb36: Close
[0m18:58:06.788884 [info ] [Thread-1 (]: 1 of 23 PASS accepted_values_stg_events_event_name__tutorial_completed__level_completed__boss_defeated  [[32mPASS[0m in 0.03s]
[0m18:58:06.789140 [debug] [Thread-1 (]: Finished running node test.quest_kingdom.accepted_values_stg_events_event_name__tutorial_completed__level_completed__boss_defeated.4ed70dcb36
[0m18:58:06.789324 [debug] [Thread-1 (]: Began running node test.quest_kingdom.accepted_values_stg_players_device_type__ios__android.14cabc59fd
[0m18:58:06.789518 [info ] [Thread-1 (]: 2 of 23 START test accepted_values_stg_players_device_type__ios__android ....... [RUN]
[0m18:58:06.789710 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.quest_kingdom.accepted_values_stg_events_event_name__tutorial_completed__level_completed__boss_defeated.4ed70dcb36, now test.quest_kingdom.accepted_values_stg_players_device_type__ios__android.14cabc59fd)
[0m18:58:06.789869 [debug] [Thread-1 (]: Began compiling node test.quest_kingdom.accepted_values_stg_players_device_type__ios__android.14cabc59fd
[0m18:58:06.792364 [debug] [Thread-1 (]: Writing injected SQL for node "test.quest_kingdom.accepted_values_stg_players_device_type__ios__android.14cabc59fd"
[0m18:58:06.792737 [debug] [Thread-1 (]: Began executing node test.quest_kingdom.accepted_values_stg_players_device_type__ios__android.14cabc59fd
[0m18:58:06.793872 [debug] [Thread-1 (]: Writing runtime sql for node "test.quest_kingdom.accepted_values_stg_players_device_type__ios__android.14cabc59fd"
[0m18:58:06.794336 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.accepted_values_stg_players_device_type__ios__android.14cabc59fd"
[0m18:58:06.794519 [debug] [Thread-1 (]: On test.quest_kingdom.accepted_values_stg_players_device_type__ios__android.14cabc59fd: BEGIN
[0m18:58:06.794685 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:58:06.795111 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:58:06.795270 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.accepted_values_stg_players_device_type__ios__android.14cabc59fd"
[0m18:58:06.795433 [debug] [Thread-1 (]: On test.quest_kingdom.accepted_values_stg_players_device_type__ios__android.14cabc59fd: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "test.quest_kingdom.accepted_values_stg_players_device_type__ios__android.14cabc59fd"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

with all_values as (

    select
        device_type as value_field,
        count(*) as n_records

    from "quest_kingdom"."main"."stg_players"
    group by device_type

)

select *
from all_values
where value_field not in (
    'ios','android'
)



  
  
      
    ) dbt_internal_test
[0m18:58:06.796948 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m18:58:06.797809 [debug] [Thread-1 (]: On test.quest_kingdom.accepted_values_stg_players_device_type__ios__android.14cabc59fd: ROLLBACK
[0m18:58:06.798317 [debug] [Thread-1 (]: Failed to rollback 'test.quest_kingdom.accepted_values_stg_players_device_type__ios__android.14cabc59fd'
[0m18:58:06.798482 [debug] [Thread-1 (]: On test.quest_kingdom.accepted_values_stg_players_device_type__ios__android.14cabc59fd: Close
[0m18:58:06.798770 [info ] [Thread-1 (]: 2 of 23 PASS accepted_values_stg_players_device_type__ios__android ............. [[32mPASS[0m in 0.01s]
[0m18:58:06.799023 [debug] [Thread-1 (]: Finished running node test.quest_kingdom.accepted_values_stg_players_device_type__ios__android.14cabc59fd
[0m18:58:06.799205 [debug] [Thread-1 (]: Began running node test.quest_kingdom.accepted_values_stg_players_player_segment__whale__dolphin__minnow__non_payer.2fd01d0b8a
[0m18:58:06.799397 [info ] [Thread-1 (]: 3 of 23 START test accepted_values_stg_players_player_segment__whale__dolphin__minnow__non_payer  [RUN]
[0m18:58:06.799585 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.quest_kingdom.accepted_values_stg_players_device_type__ios__android.14cabc59fd, now test.quest_kingdom.accepted_values_stg_players_player_segment__whale__dolphin__minnow__non_payer.2fd01d0b8a)
[0m18:58:06.799748 [debug] [Thread-1 (]: Began compiling node test.quest_kingdom.accepted_values_stg_players_player_segment__whale__dolphin__minnow__non_payer.2fd01d0b8a
[0m18:58:06.802882 [debug] [Thread-1 (]: Writing injected SQL for node "test.quest_kingdom.accepted_values_stg_players_player_segment__whale__dolphin__minnow__non_payer.2fd01d0b8a"
[0m18:58:06.803299 [debug] [Thread-1 (]: Began executing node test.quest_kingdom.accepted_values_stg_players_player_segment__whale__dolphin__minnow__non_payer.2fd01d0b8a
[0m18:58:06.805247 [debug] [Thread-1 (]: Writing runtime sql for node "test.quest_kingdom.accepted_values_stg_players_player_segment__whale__dolphin__minnow__non_payer.2fd01d0b8a"
[0m18:58:06.805805 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.accepted_values_stg_players_player_segment__whale__dolphin__minnow__non_payer.2fd01d0b8a"
[0m18:58:06.805980 [debug] [Thread-1 (]: On test.quest_kingdom.accepted_values_stg_players_player_segment__whale__dolphin__minnow__non_payer.2fd01d0b8a: BEGIN
[0m18:58:06.806138 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:58:06.806536 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:58:06.806728 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.accepted_values_stg_players_player_segment__whale__dolphin__minnow__non_payer.2fd01d0b8a"
[0m18:58:06.806910 [debug] [Thread-1 (]: On test.quest_kingdom.accepted_values_stg_players_player_segment__whale__dolphin__minnow__non_payer.2fd01d0b8a: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "test.quest_kingdom.accepted_values_stg_players_player_segment__whale__dolphin__minnow__non_payer.2fd01d0b8a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

with all_values as (

    select
        player_segment as value_field,
        count(*) as n_records

    from "quest_kingdom"."main"."stg_players"
    group by player_segment

)

select *
from all_values
where value_field not in (
    'whale','dolphin','minnow','non_payer'
)



  
  
      
    ) dbt_internal_test
[0m18:58:06.808317 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m18:58:06.809080 [debug] [Thread-1 (]: On test.quest_kingdom.accepted_values_stg_players_player_segment__whale__dolphin__minnow__non_payer.2fd01d0b8a: ROLLBACK
[0m18:58:06.809539 [debug] [Thread-1 (]: Failed to rollback 'test.quest_kingdom.accepted_values_stg_players_player_segment__whale__dolphin__minnow__non_payer.2fd01d0b8a'
[0m18:58:06.809697 [debug] [Thread-1 (]: On test.quest_kingdom.accepted_values_stg_players_player_segment__whale__dolphin__minnow__non_payer.2fd01d0b8a: Close
[0m18:58:06.809983 [info ] [Thread-1 (]: 3 of 23 PASS accepted_values_stg_players_player_segment__whale__dolphin__minnow__non_payer  [[32mPASS[0m in 0.01s]
[0m18:58:06.810239 [debug] [Thread-1 (]: Finished running node test.quest_kingdom.accepted_values_stg_players_player_segment__whale__dolphin__minnow__non_payer.2fd01d0b8a
[0m18:58:06.810416 [debug] [Thread-1 (]: Began running node test.quest_kingdom.not_null_stg_ad_impressions_ad_id.34d3bb542c
[0m18:58:06.810598 [info ] [Thread-1 (]: 4 of 23 START test not_null_stg_ad_impressions_ad_id ........................... [RUN]
[0m18:58:06.810779 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.quest_kingdom.accepted_values_stg_players_player_segment__whale__dolphin__minnow__non_payer.2fd01d0b8a, now test.quest_kingdom.not_null_stg_ad_impressions_ad_id.34d3bb542c)
[0m18:58:06.810932 [debug] [Thread-1 (]: Began compiling node test.quest_kingdom.not_null_stg_ad_impressions_ad_id.34d3bb542c
[0m18:58:06.814990 [debug] [Thread-1 (]: Writing injected SQL for node "test.quest_kingdom.not_null_stg_ad_impressions_ad_id.34d3bb542c"
[0m18:58:06.815618 [debug] [Thread-1 (]: Began executing node test.quest_kingdom.not_null_stg_ad_impressions_ad_id.34d3bb542c
[0m18:58:06.817007 [debug] [Thread-1 (]: Writing runtime sql for node "test.quest_kingdom.not_null_stg_ad_impressions_ad_id.34d3bb542c"
[0m18:58:06.817668 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.not_null_stg_ad_impressions_ad_id.34d3bb542c"
[0m18:58:06.817831 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_stg_ad_impressions_ad_id.34d3bb542c: BEGIN
[0m18:58:06.817975 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:58:06.818327 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:58:06.818476 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.not_null_stg_ad_impressions_ad_id.34d3bb542c"
[0m18:58:06.818634 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_stg_ad_impressions_ad_id.34d3bb542c: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "test.quest_kingdom.not_null_stg_ad_impressions_ad_id.34d3bb542c"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select ad_id
from "quest_kingdom"."main"."stg_ad_impressions"
where ad_id is null



  
  
      
    ) dbt_internal_test
[0m18:58:06.819282 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:58:06.820044 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_stg_ad_impressions_ad_id.34d3bb542c: ROLLBACK
[0m18:58:06.820512 [debug] [Thread-1 (]: Failed to rollback 'test.quest_kingdom.not_null_stg_ad_impressions_ad_id.34d3bb542c'
[0m18:58:06.820661 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_stg_ad_impressions_ad_id.34d3bb542c: Close
[0m18:58:06.820914 [info ] [Thread-1 (]: 4 of 23 PASS not_null_stg_ad_impressions_ad_id ................................. [[32mPASS[0m in 0.01s]
[0m18:58:06.821154 [debug] [Thread-1 (]: Finished running node test.quest_kingdom.not_null_stg_ad_impressions_ad_id.34d3bb542c
[0m18:58:06.821323 [debug] [Thread-1 (]: Began running node test.quest_kingdom.not_null_stg_ad_impressions_player_id.72385a5e19
[0m18:58:06.821503 [info ] [Thread-1 (]: 5 of 23 START test not_null_stg_ad_impressions_player_id ....................... [RUN]
[0m18:58:06.821685 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.quest_kingdom.not_null_stg_ad_impressions_ad_id.34d3bb542c, now test.quest_kingdom.not_null_stg_ad_impressions_player_id.72385a5e19)
[0m18:58:06.821840 [debug] [Thread-1 (]: Began compiling node test.quest_kingdom.not_null_stg_ad_impressions_player_id.72385a5e19
[0m18:58:06.823925 [debug] [Thread-1 (]: Writing injected SQL for node "test.quest_kingdom.not_null_stg_ad_impressions_player_id.72385a5e19"
[0m18:58:06.824335 [debug] [Thread-1 (]: Began executing node test.quest_kingdom.not_null_stg_ad_impressions_player_id.72385a5e19
[0m18:58:06.825460 [debug] [Thread-1 (]: Writing runtime sql for node "test.quest_kingdom.not_null_stg_ad_impressions_player_id.72385a5e19"
[0m18:58:06.825777 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.not_null_stg_ad_impressions_player_id.72385a5e19"
[0m18:58:06.825943 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_stg_ad_impressions_player_id.72385a5e19: BEGIN
[0m18:58:06.826089 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:58:06.826426 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:58:06.826571 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.not_null_stg_ad_impressions_player_id.72385a5e19"
[0m18:58:06.826724 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_stg_ad_impressions_player_id.72385a5e19: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "test.quest_kingdom.not_null_stg_ad_impressions_player_id.72385a5e19"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select player_id
from "quest_kingdom"."main"."stg_ad_impressions"
where player_id is null



  
  
      
    ) dbt_internal_test
[0m18:58:06.827464 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:58:06.828343 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_stg_ad_impressions_player_id.72385a5e19: ROLLBACK
[0m18:58:06.828839 [debug] [Thread-1 (]: Failed to rollback 'test.quest_kingdom.not_null_stg_ad_impressions_player_id.72385a5e19'
[0m18:58:06.828998 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_stg_ad_impressions_player_id.72385a5e19: Close
[0m18:58:06.829287 [info ] [Thread-1 (]: 5 of 23 PASS not_null_stg_ad_impressions_player_id ............................. [[32mPASS[0m in 0.01s]
[0m18:58:06.829534 [debug] [Thread-1 (]: Finished running node test.quest_kingdom.not_null_stg_ad_impressions_player_id.72385a5e19
[0m18:58:06.829833 [debug] [Thread-1 (]: Began running node test.quest_kingdom.not_null_stg_events_event_id.715b3f7012
[0m18:58:06.830074 [info ] [Thread-1 (]: 6 of 23 START test not_null_stg_events_event_id ................................ [RUN]
[0m18:58:06.830404 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.quest_kingdom.not_null_stg_ad_impressions_player_id.72385a5e19, now test.quest_kingdom.not_null_stg_events_event_id.715b3f7012)
[0m18:58:06.830633 [debug] [Thread-1 (]: Began compiling node test.quest_kingdom.not_null_stg_events_event_id.715b3f7012
[0m18:58:06.832752 [debug] [Thread-1 (]: Writing injected SQL for node "test.quest_kingdom.not_null_stg_events_event_id.715b3f7012"
[0m18:58:06.833173 [debug] [Thread-1 (]: Began executing node test.quest_kingdom.not_null_stg_events_event_id.715b3f7012
[0m18:58:06.834325 [debug] [Thread-1 (]: Writing runtime sql for node "test.quest_kingdom.not_null_stg_events_event_id.715b3f7012"
[0m18:58:06.834643 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.not_null_stg_events_event_id.715b3f7012"
[0m18:58:06.834804 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_stg_events_event_id.715b3f7012: BEGIN
[0m18:58:06.834945 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:58:06.835293 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:58:06.835441 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.not_null_stg_events_event_id.715b3f7012"
[0m18:58:06.835598 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_stg_events_event_id.715b3f7012: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "test.quest_kingdom.not_null_stg_events_event_id.715b3f7012"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select event_id
from "quest_kingdom"."main"."stg_events"
where event_id is null



  
  
      
    ) dbt_internal_test
[0m18:58:06.836192 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:58:06.836983 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_stg_events_event_id.715b3f7012: ROLLBACK
[0m18:58:06.837454 [debug] [Thread-1 (]: Failed to rollback 'test.quest_kingdom.not_null_stg_events_event_id.715b3f7012'
[0m18:58:06.837603 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_stg_events_event_id.715b3f7012: Close
[0m18:58:06.837873 [info ] [Thread-1 (]: 6 of 23 PASS not_null_stg_events_event_id ...................................... [[32mPASS[0m in 0.01s]
[0m18:58:06.838115 [debug] [Thread-1 (]: Finished running node test.quest_kingdom.not_null_stg_events_event_id.715b3f7012
[0m18:58:06.838288 [debug] [Thread-1 (]: Began running node test.quest_kingdom.not_null_stg_events_event_name.682bd9eda3
[0m18:58:06.838472 [info ] [Thread-1 (]: 7 of 23 START test not_null_stg_events_event_name .............................. [RUN]
[0m18:58:06.838660 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.quest_kingdom.not_null_stg_events_event_id.715b3f7012, now test.quest_kingdom.not_null_stg_events_event_name.682bd9eda3)
[0m18:58:06.838815 [debug] [Thread-1 (]: Began compiling node test.quest_kingdom.not_null_stg_events_event_name.682bd9eda3
[0m18:58:06.840807 [debug] [Thread-1 (]: Writing injected SQL for node "test.quest_kingdom.not_null_stg_events_event_name.682bd9eda3"
[0m18:58:06.841184 [debug] [Thread-1 (]: Began executing node test.quest_kingdom.not_null_stg_events_event_name.682bd9eda3
[0m18:58:06.842276 [debug] [Thread-1 (]: Writing runtime sql for node "test.quest_kingdom.not_null_stg_events_event_name.682bd9eda3"
[0m18:58:06.842594 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.not_null_stg_events_event_name.682bd9eda3"
[0m18:58:06.842750 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_stg_events_event_name.682bd9eda3: BEGIN
[0m18:58:06.842890 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:58:06.843234 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:58:06.843380 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.not_null_stg_events_event_name.682bd9eda3"
[0m18:58:06.843533 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_stg_events_event_name.682bd9eda3: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "test.quest_kingdom.not_null_stg_events_event_name.682bd9eda3"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select event_name
from "quest_kingdom"."main"."stg_events"
where event_name is null



  
  
      
    ) dbt_internal_test
[0m18:58:06.844723 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m18:58:06.845730 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_stg_events_event_name.682bd9eda3: ROLLBACK
[0m18:58:06.846217 [debug] [Thread-1 (]: Failed to rollback 'test.quest_kingdom.not_null_stg_events_event_name.682bd9eda3'
[0m18:58:06.846378 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_stg_events_event_name.682bd9eda3: Close
[0m18:58:06.846690 [info ] [Thread-1 (]: 7 of 23 PASS not_null_stg_events_event_name .................................... [[32mPASS[0m in 0.01s]
[0m18:58:06.846944 [debug] [Thread-1 (]: Finished running node test.quest_kingdom.not_null_stg_events_event_name.682bd9eda3
[0m18:58:06.847125 [debug] [Thread-1 (]: Began running node test.quest_kingdom.not_null_stg_events_player_id.588c4cb5e5
[0m18:58:06.847334 [info ] [Thread-1 (]: 8 of 23 START test not_null_stg_events_player_id ............................... [RUN]
[0m18:58:06.847562 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.quest_kingdom.not_null_stg_events_event_name.682bd9eda3, now test.quest_kingdom.not_null_stg_events_player_id.588c4cb5e5)
[0m18:58:06.847738 [debug] [Thread-1 (]: Began compiling node test.quest_kingdom.not_null_stg_events_player_id.588c4cb5e5
[0m18:58:06.849776 [debug] [Thread-1 (]: Writing injected SQL for node "test.quest_kingdom.not_null_stg_events_player_id.588c4cb5e5"
[0m18:58:06.850154 [debug] [Thread-1 (]: Began executing node test.quest_kingdom.not_null_stg_events_player_id.588c4cb5e5
[0m18:58:06.851285 [debug] [Thread-1 (]: Writing runtime sql for node "test.quest_kingdom.not_null_stg_events_player_id.588c4cb5e5"
[0m18:58:06.851603 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.not_null_stg_events_player_id.588c4cb5e5"
[0m18:58:06.851759 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_stg_events_player_id.588c4cb5e5: BEGIN
[0m18:58:06.851902 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:58:06.852256 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:58:06.852405 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.not_null_stg_events_player_id.588c4cb5e5"
[0m18:58:06.852562 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_stg_events_player_id.588c4cb5e5: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "test.quest_kingdom.not_null_stg_events_player_id.588c4cb5e5"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select player_id
from "quest_kingdom"."main"."stg_events"
where player_id is null



  
  
      
    ) dbt_internal_test
[0m18:58:06.853206 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:58:06.854005 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_stg_events_player_id.588c4cb5e5: ROLLBACK
[0m18:58:06.854507 [debug] [Thread-1 (]: Failed to rollback 'test.quest_kingdom.not_null_stg_events_player_id.588c4cb5e5'
[0m18:58:06.854663 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_stg_events_player_id.588c4cb5e5: Close
[0m18:58:06.854925 [info ] [Thread-1 (]: 8 of 23 PASS not_null_stg_events_player_id ..................................... [[32mPASS[0m in 0.01s]
[0m18:58:06.855167 [debug] [Thread-1 (]: Finished running node test.quest_kingdom.not_null_stg_events_player_id.588c4cb5e5
[0m18:58:06.855345 [debug] [Thread-1 (]: Began running node test.quest_kingdom.not_null_stg_iap_transactions_player_id.256115ad9d
[0m18:58:06.855553 [info ] [Thread-1 (]: 9 of 23 START test not_null_stg_iap_transactions_player_id ..................... [RUN]
[0m18:58:06.855769 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.quest_kingdom.not_null_stg_events_player_id.588c4cb5e5, now test.quest_kingdom.not_null_stg_iap_transactions_player_id.256115ad9d)
[0m18:58:06.855936 [debug] [Thread-1 (]: Began compiling node test.quest_kingdom.not_null_stg_iap_transactions_player_id.256115ad9d
[0m18:58:06.858783 [debug] [Thread-1 (]: Writing injected SQL for node "test.quest_kingdom.not_null_stg_iap_transactions_player_id.256115ad9d"
[0m18:58:06.859295 [debug] [Thread-1 (]: Began executing node test.quest_kingdom.not_null_stg_iap_transactions_player_id.256115ad9d
[0m18:58:06.893579 [debug] [Thread-1 (]: Writing runtime sql for node "test.quest_kingdom.not_null_stg_iap_transactions_player_id.256115ad9d"
[0m18:58:06.896428 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.not_null_stg_iap_transactions_player_id.256115ad9d"
[0m18:58:06.896646 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_stg_iap_transactions_player_id.256115ad9d: BEGIN
[0m18:58:06.896811 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:58:06.897165 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:58:06.897321 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.not_null_stg_iap_transactions_player_id.256115ad9d"
[0m18:58:06.897481 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_stg_iap_transactions_player_id.256115ad9d: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "test.quest_kingdom.not_null_stg_iap_transactions_player_id.256115ad9d"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select player_id
from "quest_kingdom"."main"."stg_iap_transactions"
where player_id is null



  
  
      
    ) dbt_internal_test
[0m18:58:06.898082 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:58:06.898825 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_stg_iap_transactions_player_id.256115ad9d: ROLLBACK
[0m18:58:06.899288 [debug] [Thread-1 (]: Failed to rollback 'test.quest_kingdom.not_null_stg_iap_transactions_player_id.256115ad9d'
[0m18:58:06.899445 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_stg_iap_transactions_player_id.256115ad9d: Close
[0m18:58:06.899695 [info ] [Thread-1 (]: 9 of 23 PASS not_null_stg_iap_transactions_player_id ........................... [[32mPASS[0m in 0.04s]
[0m18:58:06.899927 [debug] [Thread-1 (]: Finished running node test.quest_kingdom.not_null_stg_iap_transactions_player_id.256115ad9d
[0m18:58:06.900099 [debug] [Thread-1 (]: Began running node test.quest_kingdom.not_null_stg_iap_transactions_price_usd.613bc29079
[0m18:58:06.900276 [info ] [Thread-1 (]: 10 of 23 START test not_null_stg_iap_transactions_price_usd .................... [RUN]
[0m18:58:06.900449 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.quest_kingdom.not_null_stg_iap_transactions_player_id.256115ad9d, now test.quest_kingdom.not_null_stg_iap_transactions_price_usd.613bc29079)
[0m18:58:06.900601 [debug] [Thread-1 (]: Began compiling node test.quest_kingdom.not_null_stg_iap_transactions_price_usd.613bc29079
[0m18:58:06.902554 [debug] [Thread-1 (]: Writing injected SQL for node "test.quest_kingdom.not_null_stg_iap_transactions_price_usd.613bc29079"
[0m18:58:06.902923 [debug] [Thread-1 (]: Began executing node test.quest_kingdom.not_null_stg_iap_transactions_price_usd.613bc29079
[0m18:58:06.904007 [debug] [Thread-1 (]: Writing runtime sql for node "test.quest_kingdom.not_null_stg_iap_transactions_price_usd.613bc29079"
[0m18:58:06.904313 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.not_null_stg_iap_transactions_price_usd.613bc29079"
[0m18:58:06.904469 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_stg_iap_transactions_price_usd.613bc29079: BEGIN
[0m18:58:06.904607 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:58:06.904890 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:58:06.905036 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.not_null_stg_iap_transactions_price_usd.613bc29079"
[0m18:58:06.905189 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_stg_iap_transactions_price_usd.613bc29079: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "test.quest_kingdom.not_null_stg_iap_transactions_price_usd.613bc29079"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select price_usd
from "quest_kingdom"."main"."stg_iap_transactions"
where price_usd is null



  
  
      
    ) dbt_internal_test
[0m18:58:06.905847 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:58:06.906753 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_stg_iap_transactions_price_usd.613bc29079: ROLLBACK
[0m18:58:06.907316 [debug] [Thread-1 (]: Failed to rollback 'test.quest_kingdom.not_null_stg_iap_transactions_price_usd.613bc29079'
[0m18:58:06.907495 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_stg_iap_transactions_price_usd.613bc29079: Close
[0m18:58:06.907793 [info ] [Thread-1 (]: 10 of 23 PASS not_null_stg_iap_transactions_price_usd .......................... [[32mPASS[0m in 0.01s]
[0m18:58:06.908045 [debug] [Thread-1 (]: Finished running node test.quest_kingdom.not_null_stg_iap_transactions_price_usd.613bc29079
[0m18:58:06.908224 [debug] [Thread-1 (]: Began running node test.quest_kingdom.not_null_stg_iap_transactions_transaction_id.bc4fc23645
[0m18:58:06.908429 [info ] [Thread-1 (]: 11 of 23 START test not_null_stg_iap_transactions_transaction_id ............... [RUN]
[0m18:58:06.908653 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.quest_kingdom.not_null_stg_iap_transactions_price_usd.613bc29079, now test.quest_kingdom.not_null_stg_iap_transactions_transaction_id.bc4fc23645)
[0m18:58:06.908822 [debug] [Thread-1 (]: Began compiling node test.quest_kingdom.not_null_stg_iap_transactions_transaction_id.bc4fc23645
[0m18:58:06.910799 [debug] [Thread-1 (]: Writing injected SQL for node "test.quest_kingdom.not_null_stg_iap_transactions_transaction_id.bc4fc23645"
[0m18:58:06.911209 [debug] [Thread-1 (]: Began executing node test.quest_kingdom.not_null_stg_iap_transactions_transaction_id.bc4fc23645
[0m18:58:06.912341 [debug] [Thread-1 (]: Writing runtime sql for node "test.quest_kingdom.not_null_stg_iap_transactions_transaction_id.bc4fc23645"
[0m18:58:06.912665 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.not_null_stg_iap_transactions_transaction_id.bc4fc23645"
[0m18:58:06.912821 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_stg_iap_transactions_transaction_id.bc4fc23645: BEGIN
[0m18:58:06.912963 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:58:06.913308 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:58:06.913455 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.not_null_stg_iap_transactions_transaction_id.bc4fc23645"
[0m18:58:06.913613 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_stg_iap_transactions_transaction_id.bc4fc23645: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "test.quest_kingdom.not_null_stg_iap_transactions_transaction_id.bc4fc23645"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select transaction_id
from "quest_kingdom"."main"."stg_iap_transactions"
where transaction_id is null



  
  
      
    ) dbt_internal_test
[0m18:58:06.914326 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:58:06.915138 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_stg_iap_transactions_transaction_id.bc4fc23645: ROLLBACK
[0m18:58:06.915620 [debug] [Thread-1 (]: Failed to rollback 'test.quest_kingdom.not_null_stg_iap_transactions_transaction_id.bc4fc23645'
[0m18:58:06.915783 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_stg_iap_transactions_transaction_id.bc4fc23645: Close
[0m18:58:06.916042 [info ] [Thread-1 (]: 11 of 23 PASS not_null_stg_iap_transactions_transaction_id ..................... [[32mPASS[0m in 0.01s]
[0m18:58:06.916280 [debug] [Thread-1 (]: Finished running node test.quest_kingdom.not_null_stg_iap_transactions_transaction_id.bc4fc23645
[0m18:58:06.916453 [debug] [Thread-1 (]: Began running node test.quest_kingdom.not_null_stg_players_installed_at.60c4ce69cb
[0m18:58:06.916630 [info ] [Thread-1 (]: 12 of 23 START test not_null_stg_players_installed_at .......................... [RUN]
[0m18:58:06.916804 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.quest_kingdom.not_null_stg_iap_transactions_transaction_id.bc4fc23645, now test.quest_kingdom.not_null_stg_players_installed_at.60c4ce69cb)
[0m18:58:06.916956 [debug] [Thread-1 (]: Began compiling node test.quest_kingdom.not_null_stg_players_installed_at.60c4ce69cb
[0m18:58:06.918991 [debug] [Thread-1 (]: Writing injected SQL for node "test.quest_kingdom.not_null_stg_players_installed_at.60c4ce69cb"
[0m18:58:06.919405 [debug] [Thread-1 (]: Began executing node test.quest_kingdom.not_null_stg_players_installed_at.60c4ce69cb
[0m18:58:06.920507 [debug] [Thread-1 (]: Writing runtime sql for node "test.quest_kingdom.not_null_stg_players_installed_at.60c4ce69cb"
[0m18:58:06.920829 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.not_null_stg_players_installed_at.60c4ce69cb"
[0m18:58:06.920989 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_stg_players_installed_at.60c4ce69cb: BEGIN
[0m18:58:06.921134 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:58:06.921505 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:58:06.921659 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.not_null_stg_players_installed_at.60c4ce69cb"
[0m18:58:06.921818 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_stg_players_installed_at.60c4ce69cb: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "test.quest_kingdom.not_null_stg_players_installed_at.60c4ce69cb"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select installed_at
from "quest_kingdom"."main"."stg_players"
where installed_at is null



  
  
      
    ) dbt_internal_test
[0m18:58:06.922732 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m18:58:06.923575 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_stg_players_installed_at.60c4ce69cb: ROLLBACK
[0m18:58:06.924065 [debug] [Thread-1 (]: Failed to rollback 'test.quest_kingdom.not_null_stg_players_installed_at.60c4ce69cb'
[0m18:58:06.924220 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_stg_players_installed_at.60c4ce69cb: Close
[0m18:58:06.924487 [info ] [Thread-1 (]: 12 of 23 PASS not_null_stg_players_installed_at ................................ [[32mPASS[0m in 0.01s]
[0m18:58:06.924732 [debug] [Thread-1 (]: Finished running node test.quest_kingdom.not_null_stg_players_installed_at.60c4ce69cb
[0m18:58:06.924909 [debug] [Thread-1 (]: Began running node test.quest_kingdom.not_null_stg_players_player_id.702d1d8c7b
[0m18:58:06.925093 [info ] [Thread-1 (]: 13 of 23 START test not_null_stg_players_player_id ............................. [RUN]
[0m18:58:06.925272 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.quest_kingdom.not_null_stg_players_installed_at.60c4ce69cb, now test.quest_kingdom.not_null_stg_players_player_id.702d1d8c7b)
[0m18:58:06.925429 [debug] [Thread-1 (]: Began compiling node test.quest_kingdom.not_null_stg_players_player_id.702d1d8c7b
[0m18:58:06.927515 [debug] [Thread-1 (]: Writing injected SQL for node "test.quest_kingdom.not_null_stg_players_player_id.702d1d8c7b"
[0m18:58:06.929647 [debug] [Thread-1 (]: Began executing node test.quest_kingdom.not_null_stg_players_player_id.702d1d8c7b
[0m18:58:06.931040 [debug] [Thread-1 (]: Writing runtime sql for node "test.quest_kingdom.not_null_stg_players_player_id.702d1d8c7b"
[0m18:58:06.931495 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.not_null_stg_players_player_id.702d1d8c7b"
[0m18:58:06.931686 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_stg_players_player_id.702d1d8c7b: BEGIN
[0m18:58:06.931841 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:58:06.932182 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:58:06.932336 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.not_null_stg_players_player_id.702d1d8c7b"
[0m18:58:06.932496 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_stg_players_player_id.702d1d8c7b: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "test.quest_kingdom.not_null_stg_players_player_id.702d1d8c7b"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select player_id
from "quest_kingdom"."main"."stg_players"
where player_id is null



  
  
      
    ) dbt_internal_test
[0m18:58:06.933230 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m18:58:06.933995 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_stg_players_player_id.702d1d8c7b: ROLLBACK
[0m18:58:06.934453 [debug] [Thread-1 (]: Failed to rollback 'test.quest_kingdom.not_null_stg_players_player_id.702d1d8c7b'
[0m18:58:06.934605 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_stg_players_player_id.702d1d8c7b: Close
[0m18:58:06.934864 [info ] [Thread-1 (]: 13 of 23 PASS not_null_stg_players_player_id ................................... [[32mPASS[0m in 0.01s]
[0m18:58:06.935113 [debug] [Thread-1 (]: Finished running node test.quest_kingdom.not_null_stg_players_player_id.702d1d8c7b
[0m18:58:06.935299 [debug] [Thread-1 (]: Began running node test.quest_kingdom.not_null_stg_sessions_player_id.fa13833b29
[0m18:58:06.935512 [info ] [Thread-1 (]: 14 of 23 START test not_null_stg_sessions_player_id ............................ [RUN]
[0m18:58:06.935761 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.quest_kingdom.not_null_stg_players_player_id.702d1d8c7b, now test.quest_kingdom.not_null_stg_sessions_player_id.fa13833b29)
[0m18:58:06.935940 [debug] [Thread-1 (]: Began compiling node test.quest_kingdom.not_null_stg_sessions_player_id.fa13833b29
[0m18:58:06.938084 [debug] [Thread-1 (]: Writing injected SQL for node "test.quest_kingdom.not_null_stg_sessions_player_id.fa13833b29"
[0m18:58:06.938500 [debug] [Thread-1 (]: Began executing node test.quest_kingdom.not_null_stg_sessions_player_id.fa13833b29
[0m18:58:06.940617 [debug] [Thread-1 (]: Writing runtime sql for node "test.quest_kingdom.not_null_stg_sessions_player_id.fa13833b29"
[0m18:58:06.941020 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.not_null_stg_sessions_player_id.fa13833b29"
[0m18:58:06.941204 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_stg_sessions_player_id.fa13833b29: BEGIN
[0m18:58:06.941358 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:58:06.941723 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:58:06.941875 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.not_null_stg_sessions_player_id.fa13833b29"
[0m18:58:06.942030 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_stg_sessions_player_id.fa13833b29: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "test.quest_kingdom.not_null_stg_sessions_player_id.fa13833b29"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select player_id
from "quest_kingdom"."main"."stg_sessions"
where player_id is null



  
  
      
    ) dbt_internal_test
[0m18:58:06.942866 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m18:58:06.943685 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_stg_sessions_player_id.fa13833b29: ROLLBACK
[0m18:58:06.944173 [debug] [Thread-1 (]: Failed to rollback 'test.quest_kingdom.not_null_stg_sessions_player_id.fa13833b29'
[0m18:58:06.944336 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_stg_sessions_player_id.fa13833b29: Close
[0m18:58:06.944691 [info ] [Thread-1 (]: 14 of 23 PASS not_null_stg_sessions_player_id .................................. [[32mPASS[0m in 0.01s]
[0m18:58:06.944976 [debug] [Thread-1 (]: Finished running node test.quest_kingdom.not_null_stg_sessions_player_id.fa13833b29
[0m18:58:06.945181 [debug] [Thread-1 (]: Began running node test.quest_kingdom.not_null_stg_sessions_session_id.2e872a126d
[0m18:58:06.945416 [info ] [Thread-1 (]: 15 of 23 START test not_null_stg_sessions_session_id ........................... [RUN]
[0m18:58:06.945976 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.quest_kingdom.not_null_stg_sessions_player_id.fa13833b29, now test.quest_kingdom.not_null_stg_sessions_session_id.2e872a126d)
[0m18:58:06.946167 [debug] [Thread-1 (]: Began compiling node test.quest_kingdom.not_null_stg_sessions_session_id.2e872a126d
[0m18:58:06.948226 [debug] [Thread-1 (]: Writing injected SQL for node "test.quest_kingdom.not_null_stg_sessions_session_id.2e872a126d"
[0m18:58:06.948623 [debug] [Thread-1 (]: Began executing node test.quest_kingdom.not_null_stg_sessions_session_id.2e872a126d
[0m18:58:06.949800 [debug] [Thread-1 (]: Writing runtime sql for node "test.quest_kingdom.not_null_stg_sessions_session_id.2e872a126d"
[0m18:58:06.950110 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.not_null_stg_sessions_session_id.2e872a126d"
[0m18:58:06.950266 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_stg_sessions_session_id.2e872a126d: BEGIN
[0m18:58:06.950409 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:58:06.950782 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:58:06.950933 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.not_null_stg_sessions_session_id.2e872a126d"
[0m18:58:06.951092 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_stg_sessions_session_id.2e872a126d: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "test.quest_kingdom.not_null_stg_sessions_session_id.2e872a126d"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select session_id
from "quest_kingdom"."main"."stg_sessions"
where session_id is null



  
  
      
    ) dbt_internal_test
[0m18:58:06.951999 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m18:58:06.952836 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_stg_sessions_session_id.2e872a126d: ROLLBACK
[0m18:58:06.953317 [debug] [Thread-1 (]: Failed to rollback 'test.quest_kingdom.not_null_stg_sessions_session_id.2e872a126d'
[0m18:58:06.953474 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_stg_sessions_session_id.2e872a126d: Close
[0m18:58:06.953742 [info ] [Thread-1 (]: 15 of 23 PASS not_null_stg_sessions_session_id ................................. [[32mPASS[0m in 0.01s]
[0m18:58:06.953994 [debug] [Thread-1 (]: Finished running node test.quest_kingdom.not_null_stg_sessions_session_id.2e872a126d
[0m18:58:06.954175 [debug] [Thread-1 (]: Began running node test.quest_kingdom.not_null_stg_sessions_session_started_at.039a312a09
[0m18:58:06.954356 [info ] [Thread-1 (]: 16 of 23 START test not_null_stg_sessions_session_started_at ................... [RUN]
[0m18:58:06.954539 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.quest_kingdom.not_null_stg_sessions_session_id.2e872a126d, now test.quest_kingdom.not_null_stg_sessions_session_started_at.039a312a09)
[0m18:58:06.954702 [debug] [Thread-1 (]: Began compiling node test.quest_kingdom.not_null_stg_sessions_session_started_at.039a312a09
[0m18:58:06.956704 [debug] [Thread-1 (]: Writing injected SQL for node "test.quest_kingdom.not_null_stg_sessions_session_started_at.039a312a09"
[0m18:58:06.957087 [debug] [Thread-1 (]: Began executing node test.quest_kingdom.not_null_stg_sessions_session_started_at.039a312a09
[0m18:58:06.958180 [debug] [Thread-1 (]: Writing runtime sql for node "test.quest_kingdom.not_null_stg_sessions_session_started_at.039a312a09"
[0m18:58:06.958491 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.not_null_stg_sessions_session_started_at.039a312a09"
[0m18:58:06.958648 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_stg_sessions_session_started_at.039a312a09: BEGIN
[0m18:58:06.958791 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:58:06.959108 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:58:06.959255 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.not_null_stg_sessions_session_started_at.039a312a09"
[0m18:58:06.959416 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_stg_sessions_session_started_at.039a312a09: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "test.quest_kingdom.not_null_stg_sessions_session_started_at.039a312a09"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select session_started_at
from "quest_kingdom"."main"."stg_sessions"
where session_started_at is null



  
  
      
    ) dbt_internal_test
[0m18:58:06.960306 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m18:58:06.961188 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_stg_sessions_session_started_at.039a312a09: ROLLBACK
[0m18:58:06.961746 [debug] [Thread-1 (]: Failed to rollback 'test.quest_kingdom.not_null_stg_sessions_session_started_at.039a312a09'
[0m18:58:06.962035 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_stg_sessions_session_started_at.039a312a09: Close
[0m18:58:06.962368 [info ] [Thread-1 (]: 16 of 23 PASS not_null_stg_sessions_session_started_at ......................... [[32mPASS[0m in 0.01s]
[0m18:58:06.962623 [debug] [Thread-1 (]: Finished running node test.quest_kingdom.not_null_stg_sessions_session_started_at.039a312a09
[0m18:58:06.962806 [debug] [Thread-1 (]: Began running node test.quest_kingdom.relationships_stg_iap_transactions_player_id__player_id__ref_stg_players_.ec3ff36963
[0m18:58:06.962992 [info ] [Thread-1 (]: 17 of 23 START test relationships_stg_iap_transactions_player_id__player_id__ref_stg_players_  [RUN]
[0m18:58:06.963175 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.quest_kingdom.not_null_stg_sessions_session_started_at.039a312a09, now test.quest_kingdom.relationships_stg_iap_transactions_player_id__player_id__ref_stg_players_.ec3ff36963)
[0m18:58:06.963337 [debug] [Thread-1 (]: Began compiling node test.quest_kingdom.relationships_stg_iap_transactions_player_id__player_id__ref_stg_players_.ec3ff36963
[0m18:58:06.967379 [debug] [Thread-1 (]: Writing injected SQL for node "test.quest_kingdom.relationships_stg_iap_transactions_player_id__player_id__ref_stg_players_.ec3ff36963"
[0m18:58:06.967889 [debug] [Thread-1 (]: Began executing node test.quest_kingdom.relationships_stg_iap_transactions_player_id__player_id__ref_stg_players_.ec3ff36963
[0m18:58:06.969178 [debug] [Thread-1 (]: Writing runtime sql for node "test.quest_kingdom.relationships_stg_iap_transactions_player_id__player_id__ref_stg_players_.ec3ff36963"
[0m18:58:06.969714 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.relationships_stg_iap_transactions_player_id__player_id__ref_stg_players_.ec3ff36963"
[0m18:58:06.969899 [debug] [Thread-1 (]: On test.quest_kingdom.relationships_stg_iap_transactions_player_id__player_id__ref_stg_players_.ec3ff36963: BEGIN
[0m18:58:06.970051 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:58:06.970413 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:58:06.970568 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.relationships_stg_iap_transactions_player_id__player_id__ref_stg_players_.ec3ff36963"
[0m18:58:06.970738 [debug] [Thread-1 (]: On test.quest_kingdom.relationships_stg_iap_transactions_player_id__player_id__ref_stg_players_.ec3ff36963: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "test.quest_kingdom.relationships_stg_iap_transactions_player_id__player_id__ref_stg_players_.ec3ff36963"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

with child as (
    select player_id as from_field
    from "quest_kingdom"."main"."stg_iap_transactions"
    where player_id is not null
),

parent as (
    select player_id as to_field
    from "quest_kingdom"."main"."stg_players"
)

select
    from_field

from child
left join parent
    on child.from_field = parent.to_field

where parent.to_field is null



  
  
      
    ) dbt_internal_test
[0m18:58:06.976560 [debug] [Thread-1 (]: SQL status: OK in 0.006 seconds
[0m18:58:06.977831 [debug] [Thread-1 (]: On test.quest_kingdom.relationships_stg_iap_transactions_player_id__player_id__ref_stg_players_.ec3ff36963: ROLLBACK
[0m18:58:06.978383 [debug] [Thread-1 (]: Failed to rollback 'test.quest_kingdom.relationships_stg_iap_transactions_player_id__player_id__ref_stg_players_.ec3ff36963'
[0m18:58:06.978573 [debug] [Thread-1 (]: On test.quest_kingdom.relationships_stg_iap_transactions_player_id__player_id__ref_stg_players_.ec3ff36963: Close
[0m18:58:06.978998 [info ] [Thread-1 (]: 17 of 23 PASS relationships_stg_iap_transactions_player_id__player_id__ref_stg_players_  [[32mPASS[0m in 0.02s]
[0m18:58:06.979368 [debug] [Thread-1 (]: Finished running node test.quest_kingdom.relationships_stg_iap_transactions_player_id__player_id__ref_stg_players_.ec3ff36963
[0m18:58:06.979585 [debug] [Thread-1 (]: Began running node test.quest_kingdom.relationships_stg_sessions_player_id__player_id__ref_stg_players_.6b4c9276ee
[0m18:58:06.979817 [info ] [Thread-1 (]: 18 of 23 START test relationships_stg_sessions_player_id__player_id__ref_stg_players_  [RUN]
[0m18:58:06.980089 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.quest_kingdom.relationships_stg_iap_transactions_player_id__player_id__ref_stg_players_.ec3ff36963, now test.quest_kingdom.relationships_stg_sessions_player_id__player_id__ref_stg_players_.6b4c9276ee)
[0m18:58:06.980283 [debug] [Thread-1 (]: Began compiling node test.quest_kingdom.relationships_stg_sessions_player_id__player_id__ref_stg_players_.6b4c9276ee
[0m18:58:06.982935 [debug] [Thread-1 (]: Writing injected SQL for node "test.quest_kingdom.relationships_stg_sessions_player_id__player_id__ref_stg_players_.6b4c9276ee"
[0m18:58:06.984902 [debug] [Thread-1 (]: Began executing node test.quest_kingdom.relationships_stg_sessions_player_id__player_id__ref_stg_players_.6b4c9276ee
[0m18:58:06.986299 [debug] [Thread-1 (]: Writing runtime sql for node "test.quest_kingdom.relationships_stg_sessions_player_id__player_id__ref_stg_players_.6b4c9276ee"
[0m18:58:06.986765 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.relationships_stg_sessions_player_id__player_id__ref_stg_players_.6b4c9276ee"
[0m18:58:06.986933 [debug] [Thread-1 (]: On test.quest_kingdom.relationships_stg_sessions_player_id__player_id__ref_stg_players_.6b4c9276ee: BEGIN
[0m18:58:06.987080 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:58:06.987466 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:58:06.987621 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.relationships_stg_sessions_player_id__player_id__ref_stg_players_.6b4c9276ee"
[0m18:58:06.987792 [debug] [Thread-1 (]: On test.quest_kingdom.relationships_stg_sessions_player_id__player_id__ref_stg_players_.6b4c9276ee: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "test.quest_kingdom.relationships_stg_sessions_player_id__player_id__ref_stg_players_.6b4c9276ee"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

with child as (
    select player_id as from_field
    from "quest_kingdom"."main"."stg_sessions"
    where player_id is not null
),

parent as (
    select player_id as to_field
    from "quest_kingdom"."main"."stg_players"
)

select
    from_field

from child
left join parent
    on child.from_field = parent.to_field

where parent.to_field is null



  
  
      
    ) dbt_internal_test
[0m18:58:06.990571 [debug] [Thread-1 (]: SQL status: OK in 0.003 seconds
[0m18:58:06.991454 [debug] [Thread-1 (]: On test.quest_kingdom.relationships_stg_sessions_player_id__player_id__ref_stg_players_.6b4c9276ee: ROLLBACK
[0m18:58:06.991953 [debug] [Thread-1 (]: Failed to rollback 'test.quest_kingdom.relationships_stg_sessions_player_id__player_id__ref_stg_players_.6b4c9276ee'
[0m18:58:06.992122 [debug] [Thread-1 (]: On test.quest_kingdom.relationships_stg_sessions_player_id__player_id__ref_stg_players_.6b4c9276ee: Close
[0m18:58:06.992410 [info ] [Thread-1 (]: 18 of 23 PASS relationships_stg_sessions_player_id__player_id__ref_stg_players_  [[32mPASS[0m in 0.01s]
[0m18:58:06.992663 [debug] [Thread-1 (]: Finished running node test.quest_kingdom.relationships_stg_sessions_player_id__player_id__ref_stg_players_.6b4c9276ee
[0m18:58:06.992841 [debug] [Thread-1 (]: Began running node test.quest_kingdom.unique_stg_ad_impressions_ad_id.618068e7ef
[0m18:58:06.993027 [info ] [Thread-1 (]: 19 of 23 START test unique_stg_ad_impressions_ad_id ............................ [RUN]
[0m18:58:06.993214 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.quest_kingdom.relationships_stg_sessions_player_id__player_id__ref_stg_players_.6b4c9276ee, now test.quest_kingdom.unique_stg_ad_impressions_ad_id.618068e7ef)
[0m18:58:06.993374 [debug] [Thread-1 (]: Began compiling node test.quest_kingdom.unique_stg_ad_impressions_ad_id.618068e7ef
[0m18:58:06.996868 [debug] [Thread-1 (]: Writing injected SQL for node "test.quest_kingdom.unique_stg_ad_impressions_ad_id.618068e7ef"
[0m18:58:06.997343 [debug] [Thread-1 (]: Began executing node test.quest_kingdom.unique_stg_ad_impressions_ad_id.618068e7ef
[0m18:58:06.999667 [debug] [Thread-1 (]: Writing runtime sql for node "test.quest_kingdom.unique_stg_ad_impressions_ad_id.618068e7ef"
[0m18:58:07.000081 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.unique_stg_ad_impressions_ad_id.618068e7ef"
[0m18:58:07.000246 [debug] [Thread-1 (]: On test.quest_kingdom.unique_stg_ad_impressions_ad_id.618068e7ef: BEGIN
[0m18:58:07.000394 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:58:07.000764 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:58:07.000920 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.unique_stg_ad_impressions_ad_id.618068e7ef"
[0m18:58:07.001080 [debug] [Thread-1 (]: On test.quest_kingdom.unique_stg_ad_impressions_ad_id.618068e7ef: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "test.quest_kingdom.unique_stg_ad_impressions_ad_id.618068e7ef"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    ad_id as unique_field,
    count(*) as n_records

from "quest_kingdom"."main"."stg_ad_impressions"
where ad_id is not null
group by ad_id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m18:58:07.006980 [debug] [Thread-1 (]: SQL status: OK in 0.006 seconds
[0m18:58:07.007896 [debug] [Thread-1 (]: On test.quest_kingdom.unique_stg_ad_impressions_ad_id.618068e7ef: ROLLBACK
[0m18:58:07.008364 [debug] [Thread-1 (]: Failed to rollback 'test.quest_kingdom.unique_stg_ad_impressions_ad_id.618068e7ef'
[0m18:58:07.008521 [debug] [Thread-1 (]: On test.quest_kingdom.unique_stg_ad_impressions_ad_id.618068e7ef: Close
[0m18:58:07.008797 [info ] [Thread-1 (]: 19 of 23 PASS unique_stg_ad_impressions_ad_id .................................. [[32mPASS[0m in 0.02s]
[0m18:58:07.009046 [debug] [Thread-1 (]: Finished running node test.quest_kingdom.unique_stg_ad_impressions_ad_id.618068e7ef
[0m18:58:07.009223 [debug] [Thread-1 (]: Began running node test.quest_kingdom.unique_stg_events_event_id.66ebb17438
[0m18:58:07.009419 [info ] [Thread-1 (]: 20 of 23 START test unique_stg_events_event_id ................................. [RUN]
[0m18:58:07.009643 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.quest_kingdom.unique_stg_ad_impressions_ad_id.618068e7ef, now test.quest_kingdom.unique_stg_events_event_id.66ebb17438)
[0m18:58:07.009812 [debug] [Thread-1 (]: Began compiling node test.quest_kingdom.unique_stg_events_event_id.66ebb17438
[0m18:58:07.012006 [debug] [Thread-1 (]: Writing injected SQL for node "test.quest_kingdom.unique_stg_events_event_id.66ebb17438"
[0m18:58:07.012597 [debug] [Thread-1 (]: Began executing node test.quest_kingdom.unique_stg_events_event_id.66ebb17438
[0m18:58:07.013956 [debug] [Thread-1 (]: Writing runtime sql for node "test.quest_kingdom.unique_stg_events_event_id.66ebb17438"
[0m18:58:07.014354 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.unique_stg_events_event_id.66ebb17438"
[0m18:58:07.014522 [debug] [Thread-1 (]: On test.quest_kingdom.unique_stg_events_event_id.66ebb17438: BEGIN
[0m18:58:07.014678 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:58:07.015115 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:58:07.015316 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.unique_stg_events_event_id.66ebb17438"
[0m18:58:07.015486 [debug] [Thread-1 (]: On test.quest_kingdom.unique_stg_events_event_id.66ebb17438: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "test.quest_kingdom.unique_stg_events_event_id.66ebb17438"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    event_id as unique_field,
    count(*) as n_records

from "quest_kingdom"."main"."stg_events"
where event_id is not null
group by event_id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m18:58:07.018013 [debug] [Thread-1 (]: SQL status: OK in 0.002 seconds
[0m18:58:07.018900 [debug] [Thread-1 (]: On test.quest_kingdom.unique_stg_events_event_id.66ebb17438: ROLLBACK
[0m18:58:07.019376 [debug] [Thread-1 (]: Failed to rollback 'test.quest_kingdom.unique_stg_events_event_id.66ebb17438'
[0m18:58:07.019542 [debug] [Thread-1 (]: On test.quest_kingdom.unique_stg_events_event_id.66ebb17438: Close
[0m18:58:07.019816 [info ] [Thread-1 (]: 20 of 23 PASS unique_stg_events_event_id ....................................... [[32mPASS[0m in 0.01s]
[0m18:58:07.020062 [debug] [Thread-1 (]: Finished running node test.quest_kingdom.unique_stg_events_event_id.66ebb17438
[0m18:58:07.020240 [debug] [Thread-1 (]: Began running node test.quest_kingdom.unique_stg_iap_transactions_transaction_id.3bff016069
[0m18:58:07.020426 [info ] [Thread-1 (]: 21 of 23 START test unique_stg_iap_transactions_transaction_id ................. [RUN]
[0m18:58:07.020613 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.quest_kingdom.unique_stg_events_event_id.66ebb17438, now test.quest_kingdom.unique_stg_iap_transactions_transaction_id.3bff016069)
[0m18:58:07.020771 [debug] [Thread-1 (]: Began compiling node test.quest_kingdom.unique_stg_iap_transactions_transaction_id.3bff016069
[0m18:58:07.022808 [debug] [Thread-1 (]: Writing injected SQL for node "test.quest_kingdom.unique_stg_iap_transactions_transaction_id.3bff016069"
[0m18:58:07.023212 [debug] [Thread-1 (]: Began executing node test.quest_kingdom.unique_stg_iap_transactions_transaction_id.3bff016069
[0m18:58:07.024346 [debug] [Thread-1 (]: Writing runtime sql for node "test.quest_kingdom.unique_stg_iap_transactions_transaction_id.3bff016069"
[0m18:58:07.024657 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.unique_stg_iap_transactions_transaction_id.3bff016069"
[0m18:58:07.024816 [debug] [Thread-1 (]: On test.quest_kingdom.unique_stg_iap_transactions_transaction_id.3bff016069: BEGIN
[0m18:58:07.024962 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:58:07.025298 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:58:07.025445 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.unique_stg_iap_transactions_transaction_id.3bff016069"
[0m18:58:07.025599 [debug] [Thread-1 (]: On test.quest_kingdom.unique_stg_iap_transactions_transaction_id.3bff016069: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "test.quest_kingdom.unique_stg_iap_transactions_transaction_id.3bff016069"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    transaction_id as unique_field,
    count(*) as n_records

from "quest_kingdom"."main"."stg_iap_transactions"
where transaction_id is not null
group by transaction_id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m18:58:07.027146 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m18:58:07.028012 [debug] [Thread-1 (]: On test.quest_kingdom.unique_stg_iap_transactions_transaction_id.3bff016069: ROLLBACK
[0m18:58:07.028513 [debug] [Thread-1 (]: Failed to rollback 'test.quest_kingdom.unique_stg_iap_transactions_transaction_id.3bff016069'
[0m18:58:07.028895 [debug] [Thread-1 (]: On test.quest_kingdom.unique_stg_iap_transactions_transaction_id.3bff016069: Close
[0m18:58:07.029286 [info ] [Thread-1 (]: 21 of 23 PASS unique_stg_iap_transactions_transaction_id ....................... [[32mPASS[0m in 0.01s]
[0m18:58:07.029561 [debug] [Thread-1 (]: Finished running node test.quest_kingdom.unique_stg_iap_transactions_transaction_id.3bff016069
[0m18:58:07.029745 [debug] [Thread-1 (]: Began running node test.quest_kingdom.unique_stg_players_player_id.a3d551d71d
[0m18:58:07.029930 [info ] [Thread-1 (]: 22 of 23 START test unique_stg_players_player_id ............................... [RUN]
[0m18:58:07.030126 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.quest_kingdom.unique_stg_iap_transactions_transaction_id.3bff016069, now test.quest_kingdom.unique_stg_players_player_id.a3d551d71d)
[0m18:58:07.030281 [debug] [Thread-1 (]: Began compiling node test.quest_kingdom.unique_stg_players_player_id.a3d551d71d
[0m18:58:07.032407 [debug] [Thread-1 (]: Writing injected SQL for node "test.quest_kingdom.unique_stg_players_player_id.a3d551d71d"
[0m18:58:07.032838 [debug] [Thread-1 (]: Began executing node test.quest_kingdom.unique_stg_players_player_id.a3d551d71d
[0m18:58:07.034027 [debug] [Thread-1 (]: Writing runtime sql for node "test.quest_kingdom.unique_stg_players_player_id.a3d551d71d"
[0m18:58:07.034360 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.unique_stg_players_player_id.a3d551d71d"
[0m18:58:07.034519 [debug] [Thread-1 (]: On test.quest_kingdom.unique_stg_players_player_id.a3d551d71d: BEGIN
[0m18:58:07.034664 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:58:07.035027 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:58:07.035172 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.unique_stg_players_player_id.a3d551d71d"
[0m18:58:07.035330 [debug] [Thread-1 (]: On test.quest_kingdom.unique_stg_players_player_id.a3d551d71d: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "test.quest_kingdom.unique_stg_players_player_id.a3d551d71d"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    player_id as unique_field,
    count(*) as n_records

from "quest_kingdom"."main"."stg_players"
where player_id is not null
group by player_id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m18:58:07.036962 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m18:58:07.037892 [debug] [Thread-1 (]: On test.quest_kingdom.unique_stg_players_player_id.a3d551d71d: ROLLBACK
[0m18:58:07.038375 [debug] [Thread-1 (]: Failed to rollback 'test.quest_kingdom.unique_stg_players_player_id.a3d551d71d'
[0m18:58:07.038528 [debug] [Thread-1 (]: On test.quest_kingdom.unique_stg_players_player_id.a3d551d71d: Close
[0m18:58:07.038794 [info ] [Thread-1 (]: 22 of 23 PASS unique_stg_players_player_id ..................................... [[32mPASS[0m in 0.01s]
[0m18:58:07.039033 [debug] [Thread-1 (]: Finished running node test.quest_kingdom.unique_stg_players_player_id.a3d551d71d
[0m18:58:07.039209 [debug] [Thread-1 (]: Began running node test.quest_kingdom.unique_stg_sessions_session_id.ce45726d03
[0m18:58:07.039388 [info ] [Thread-1 (]: 23 of 23 START test unique_stg_sessions_session_id ............................. [RUN]
[0m18:58:07.039570 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.quest_kingdom.unique_stg_players_player_id.a3d551d71d, now test.quest_kingdom.unique_stg_sessions_session_id.ce45726d03)
[0m18:58:07.039730 [debug] [Thread-1 (]: Began compiling node test.quest_kingdom.unique_stg_sessions_session_id.ce45726d03
[0m18:58:07.041734 [debug] [Thread-1 (]: Writing injected SQL for node "test.quest_kingdom.unique_stg_sessions_session_id.ce45726d03"
[0m18:58:07.042100 [debug] [Thread-1 (]: Began executing node test.quest_kingdom.unique_stg_sessions_session_id.ce45726d03
[0m18:58:07.043203 [debug] [Thread-1 (]: Writing runtime sql for node "test.quest_kingdom.unique_stg_sessions_session_id.ce45726d03"
[0m18:58:07.043505 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.unique_stg_sessions_session_id.ce45726d03"
[0m18:58:07.043664 [debug] [Thread-1 (]: On test.quest_kingdom.unique_stg_sessions_session_id.ce45726d03: BEGIN
[0m18:58:07.043804 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:58:07.044115 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m18:58:07.044270 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.unique_stg_sessions_session_id.ce45726d03"
[0m18:58:07.044428 [debug] [Thread-1 (]: On test.quest_kingdom.unique_stg_sessions_session_id.ce45726d03: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "test.quest_kingdom.unique_stg_sessions_session_id.ce45726d03"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    session_id as unique_field,
    count(*) as n_records

from "quest_kingdom"."main"."stg_sessions"
where session_id is not null
group by session_id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m18:58:07.049515 [debug] [Thread-1 (]: SQL status: OK in 0.005 seconds
[0m18:58:07.050429 [debug] [Thread-1 (]: On test.quest_kingdom.unique_stg_sessions_session_id.ce45726d03: ROLLBACK
[0m18:58:07.050916 [debug] [Thread-1 (]: Failed to rollback 'test.quest_kingdom.unique_stg_sessions_session_id.ce45726d03'
[0m18:58:07.051069 [debug] [Thread-1 (]: On test.quest_kingdom.unique_stg_sessions_session_id.ce45726d03: Close
[0m18:58:07.051347 [info ] [Thread-1 (]: 23 of 23 PASS unique_stg_sessions_session_id ................................... [[32mPASS[0m in 0.01s]
[0m18:58:07.051592 [debug] [Thread-1 (]: Finished running node test.quest_kingdom.unique_stg_sessions_session_id.ce45726d03
[0m18:58:07.052192 [debug] [MainThread]: Using duckdb connection "master"
[0m18:58:07.052373 [debug] [MainThread]: On master: BEGIN
[0m18:58:07.052509 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m18:58:07.052806 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m18:58:07.052950 [debug] [MainThread]: On master: COMMIT
[0m18:58:07.053084 [debug] [MainThread]: Using duckdb connection "master"
[0m18:58:07.053211 [debug] [MainThread]: On master: COMMIT
[0m18:58:07.053410 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m18:58:07.053541 [debug] [MainThread]: On master: Close
[0m18:58:07.053709 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:58:07.053830 [debug] [MainThread]: Connection 'test.quest_kingdom.unique_stg_sessions_session_id.ce45726d03' was properly closed.
[0m18:58:07.053969 [info ] [MainThread]: 
[0m18:58:07.054109 [info ] [MainThread]: Finished running 23 data tests in 0 hours 0 minutes and 0.36 seconds (0.36s).
[0m18:58:07.055419 [debug] [MainThread]: Command end result
[0m18:58:07.069655 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/manifest.json
[0m18:58:07.070816 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/semantic_manifest.json
[0m18:58:07.074916 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/run_results.json
[0m18:58:07.075103 [info ] [MainThread]: 
[0m18:58:07.075287 [info ] [MainThread]: [32mCompleted successfully[0m
[0m18:58:07.075430 [info ] [MainThread]: 
[0m18:58:07.075581 [info ] [MainThread]: Done. PASS=23 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=23
[0m18:58:07.077012 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 0.85656697, "process_in_blocks": "0", "process_kernel_time": 0.207709, "process_mem_max_rss": "163643392", "process_out_blocks": "0", "process_user_time": 1.30049}
[0m18:58:07.077230 [debug] [MainThread]: Command `dbt test` succeeded at 18:58:07.077191 after 0.86 seconds
[0m18:58:07.077406 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106a90620>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109164ec0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1087d4b90>]}
[0m18:58:07.077577 [debug] [MainThread]: Flushing usage events
[0m18:58:07.197452 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m18:58:15.817816 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1046ff2f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1054adc10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1054ada00>]}


============================== 18:58:15.821061 | d723f29b-97b1-4ba1-ab67-5d4e18a3099a ==============================
[0m18:58:15.821061 [info ] [MainThread]: Running with dbt=1.11.4
[0m18:58:15.821391 [debug] [MainThread]: running dbt with arguments {'use_experimental_parser': 'False', 'use_colors': 'True', 'introspect': 'True', 'debug': 'False', 'invocation_command': 'dbt docs generate', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'static_parser': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/hazeldonaldson/.dbt', 'target_path': 'None', 'warn_error': 'None', 'partial_parse': 'True', 'version_check': 'True', 'indirect_selection': 'eager', 'write_json': 'True', 'no_print': 'None', 'log_format': 'default', 'log_path': '/Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/logs', 'quiet': 'False', 'empty': 'None', 'log_cache_events': 'False', 'printer_width': '80', 'send_anonymous_usage_stats': 'True', 'fail_fast': 'False'}
[0m18:58:15.941465 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd723f29b-97b1-4ba1-ab67-5d4e18a3099a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1047e1e80>]}
[0m18:58:15.972135 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd723f29b-97b1-4ba1-ab67-5d4e18a3099a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1055347a0>]}
[0m18:58:15.973591 [info ] [MainThread]: Registered adapter: duckdb=1.10.0
[0m18:58:16.025000 [debug] [MainThread]: checksum: 092b177ba87eb6bb3c55954c38aa57900eebac336561eb9ee32218428aa81d43, vars: {}, profile: , target: , version: 1.11.4
[0m18:58:16.102480 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m18:58:16.102759 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m18:58:16.102904 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m18:58:16.106209 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 7 unused configuration paths:
- models.retention
- models.product
- models.question_kingdom
- models.staging
- models.marts
- models.core
- models.monetization
[0m18:58:16.127490 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd723f29b-97b1-4ba1-ab67-5d4e18a3099a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10551bbf0>]}
[0m18:58:16.142049 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd723f29b-97b1-4ba1-ab67-5d4e18a3099a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105b47fb0>]}
[0m18:58:16.142366 [info ] [MainThread]: Found 7 models, 23 data tests, 5 sources, 472 macros
[0m18:58:16.142546 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd723f29b-97b1-4ba1-ab67-5d4e18a3099a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1055b27e0>]}
[0m18:58:16.143984 [info ] [MainThread]: 
[0m18:58:16.144210 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m18:58:16.144359 [info ] [MainThread]: 
[0m18:58:16.144607 [debug] [MainThread]: Acquiring new duckdb connection 'master'
[0m18:58:16.147064 [debug] [ThreadPool]: Acquiring new duckdb connection 'list_quest_kingdom_main'
[0m18:58:16.174953 [debug] [ThreadPool]: Using duckdb connection "list_quest_kingdom_main"
[0m18:58:16.175196 [debug] [ThreadPool]: On list_quest_kingdom_main: BEGIN
[0m18:58:16.175344 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:58:16.184754 [debug] [ThreadPool]: SQL status: OK in 0.009 seconds
[0m18:58:16.185011 [debug] [ThreadPool]: Using duckdb connection "list_quest_kingdom_main"
[0m18:58:16.185170 [debug] [ThreadPool]: On list_quest_kingdom_main: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "list_quest_kingdom_main"} */
select
      'quest_kingdom' as database,
      table_name as name,
      table_schema as schema,
      CASE table_type
        WHEN 'BASE TABLE' THEN 'table'
        WHEN 'VIEW' THEN 'view'
        WHEN 'LOCAL TEMPORARY' THEN 'table'
        END as type
    from system.information_schema.tables
    where lower(table_schema) = 'main'
    and lower(table_catalog) = 'quest_kingdom'
  
[0m18:58:16.192871 [debug] [ThreadPool]: SQL status: OK in 0.008 seconds
[0m18:58:16.193787 [debug] [ThreadPool]: On list_quest_kingdom_main: ROLLBACK
[0m18:58:16.194884 [debug] [ThreadPool]: Failed to rollback 'list_quest_kingdom_main'
[0m18:58:16.195038 [debug] [ThreadPool]: On list_quest_kingdom_main: Close
[0m18:58:16.196098 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd723f29b-97b1-4ba1-ab67-5d4e18a3099a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105b136b0>]}
[0m18:58:16.198179 [debug] [Thread-1 (]: Began running node model.quest_kingdom.stg_ad_impressions
[0m18:58:16.198509 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_quest_kingdom_main, now model.quest_kingdom.stg_ad_impressions)
[0m18:58:16.198708 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.stg_ad_impressions
[0m18:58:16.202877 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.stg_ad_impressions"
[0m18:58:16.203597 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.stg_ad_impressions
[0m18:58:16.203961 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.stg_ad_impressions
[0m18:58:16.204152 [debug] [Thread-1 (]: Began running node model.quest_kingdom.stg_events
[0m18:58:16.204361 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.quest_kingdom.stg_ad_impressions, now model.quest_kingdom.stg_events)
[0m18:58:16.204546 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.stg_events
[0m18:58:16.206605 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.stg_events"
[0m18:58:16.206995 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.stg_events
[0m18:58:16.207299 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.stg_events
[0m18:58:16.207473 [debug] [Thread-1 (]: Began running node model.quest_kingdom.stg_iap_transactions
[0m18:58:16.207664 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.quest_kingdom.stg_events, now model.quest_kingdom.stg_iap_transactions)
[0m18:58:16.207848 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.stg_iap_transactions
[0m18:58:16.209125 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.stg_iap_transactions"
[0m18:58:16.209430 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.stg_iap_transactions
[0m18:58:16.209707 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.stg_iap_transactions
[0m18:58:16.209872 [debug] [Thread-1 (]: Began running node model.quest_kingdom.stg_players
[0m18:58:16.210047 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.quest_kingdom.stg_iap_transactions, now model.quest_kingdom.stg_players)
[0m18:58:16.210220 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.stg_players
[0m18:58:16.211515 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.stg_players"
[0m18:58:16.211816 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.stg_players
[0m18:58:16.212087 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.stg_players
[0m18:58:16.212252 [debug] [Thread-1 (]: Began running node model.quest_kingdom.stg_sessions
[0m18:58:16.212423 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.quest_kingdom.stg_players, now model.quest_kingdom.stg_sessions)
[0m18:58:16.212598 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.stg_sessions
[0m18:58:16.213872 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.stg_sessions"
[0m18:58:16.214150 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.stg_sessions
[0m18:58:16.214414 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.stg_sessions
[0m18:58:16.214579 [debug] [Thread-1 (]: Began running node test.quest_kingdom.not_null_stg_ad_impressions_ad_id.34d3bb542c
[0m18:58:16.214753 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.quest_kingdom.stg_sessions, now test.quest_kingdom.not_null_stg_ad_impressions_ad_id.34d3bb542c)
[0m18:58:16.214936 [debug] [Thread-1 (]: Began compiling node test.quest_kingdom.not_null_stg_ad_impressions_ad_id.34d3bb542c
[0m18:58:16.220449 [debug] [Thread-1 (]: Writing injected SQL for node "test.quest_kingdom.not_null_stg_ad_impressions_ad_id.34d3bb542c"
[0m18:58:16.221035 [debug] [Thread-1 (]: Began executing node test.quest_kingdom.not_null_stg_ad_impressions_ad_id.34d3bb542c
[0m18:58:16.221351 [debug] [Thread-1 (]: Finished running node test.quest_kingdom.not_null_stg_ad_impressions_ad_id.34d3bb542c
[0m18:58:16.221522 [debug] [Thread-1 (]: Began running node test.quest_kingdom.not_null_stg_ad_impressions_player_id.72385a5e19
[0m18:58:16.221703 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.quest_kingdom.not_null_stg_ad_impressions_ad_id.34d3bb542c, now test.quest_kingdom.not_null_stg_ad_impressions_player_id.72385a5e19)
[0m18:58:16.221857 [debug] [Thread-1 (]: Began compiling node test.quest_kingdom.not_null_stg_ad_impressions_player_id.72385a5e19
[0m18:58:16.223709 [debug] [Thread-1 (]: Writing injected SQL for node "test.quest_kingdom.not_null_stg_ad_impressions_player_id.72385a5e19"
[0m18:58:16.224010 [debug] [Thread-1 (]: Began executing node test.quest_kingdom.not_null_stg_ad_impressions_player_id.72385a5e19
[0m18:58:16.224287 [debug] [Thread-1 (]: Finished running node test.quest_kingdom.not_null_stg_ad_impressions_player_id.72385a5e19
[0m18:58:16.224451 [debug] [Thread-1 (]: Began running node test.quest_kingdom.unique_stg_ad_impressions_ad_id.618068e7ef
[0m18:58:16.224614 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.quest_kingdom.not_null_stg_ad_impressions_player_id.72385a5e19, now test.quest_kingdom.unique_stg_ad_impressions_ad_id.618068e7ef)
[0m18:58:16.224761 [debug] [Thread-1 (]: Began compiling node test.quest_kingdom.unique_stg_ad_impressions_ad_id.618068e7ef
[0m18:58:16.227533 [debug] [Thread-1 (]: Writing injected SQL for node "test.quest_kingdom.unique_stg_ad_impressions_ad_id.618068e7ef"
[0m18:58:16.227887 [debug] [Thread-1 (]: Began executing node test.quest_kingdom.unique_stg_ad_impressions_ad_id.618068e7ef
[0m18:58:16.228212 [debug] [Thread-1 (]: Finished running node test.quest_kingdom.unique_stg_ad_impressions_ad_id.618068e7ef
[0m18:58:16.228398 [debug] [Thread-1 (]: Began running node test.quest_kingdom.accepted_values_stg_events_event_name__tutorial_completed__level_completed__boss_defeated.4ed70dcb36
[0m18:58:16.228588 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.quest_kingdom.unique_stg_ad_impressions_ad_id.618068e7ef, now test.quest_kingdom.accepted_values_stg_events_event_name__tutorial_completed__level_completed__boss_defeated.4ed70dcb36)
[0m18:58:16.228751 [debug] [Thread-1 (]: Began compiling node test.quest_kingdom.accepted_values_stg_events_event_name__tutorial_completed__level_completed__boss_defeated.4ed70dcb36
[0m18:58:16.233557 [debug] [Thread-1 (]: Writing injected SQL for node "test.quest_kingdom.accepted_values_stg_events_event_name__tutorial_completed__level_completed__boss_defeated.4ed70dcb36"
[0m18:58:16.234075 [debug] [Thread-1 (]: Began executing node test.quest_kingdom.accepted_values_stg_events_event_name__tutorial_completed__level_completed__boss_defeated.4ed70dcb36
[0m18:58:16.234461 [debug] [Thread-1 (]: Finished running node test.quest_kingdom.accepted_values_stg_events_event_name__tutorial_completed__level_completed__boss_defeated.4ed70dcb36
[0m18:58:16.234838 [debug] [Thread-1 (]: Began running node test.quest_kingdom.not_null_stg_events_event_id.715b3f7012
[0m18:58:16.235065 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.quest_kingdom.accepted_values_stg_events_event_name__tutorial_completed__level_completed__boss_defeated.4ed70dcb36, now test.quest_kingdom.not_null_stg_events_event_id.715b3f7012)
[0m18:58:16.235234 [debug] [Thread-1 (]: Began compiling node test.quest_kingdom.not_null_stg_events_event_id.715b3f7012
[0m18:58:16.237291 [debug] [Thread-1 (]: Writing injected SQL for node "test.quest_kingdom.not_null_stg_events_event_id.715b3f7012"
[0m18:58:16.238934 [debug] [Thread-1 (]: Began executing node test.quest_kingdom.not_null_stg_events_event_id.715b3f7012
[0m18:58:16.239289 [debug] [Thread-1 (]: Finished running node test.quest_kingdom.not_null_stg_events_event_id.715b3f7012
[0m18:58:16.239482 [debug] [Thread-1 (]: Began running node test.quest_kingdom.not_null_stg_events_event_name.682bd9eda3
[0m18:58:16.239673 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.quest_kingdom.not_null_stg_events_event_id.715b3f7012, now test.quest_kingdom.not_null_stg_events_event_name.682bd9eda3)
[0m18:58:16.239833 [debug] [Thread-1 (]: Began compiling node test.quest_kingdom.not_null_stg_events_event_name.682bd9eda3
[0m18:58:16.241733 [debug] [Thread-1 (]: Writing injected SQL for node "test.quest_kingdom.not_null_stg_events_event_name.682bd9eda3"
[0m18:58:16.242095 [debug] [Thread-1 (]: Began executing node test.quest_kingdom.not_null_stg_events_event_name.682bd9eda3
[0m18:58:16.242378 [debug] [Thread-1 (]: Finished running node test.quest_kingdom.not_null_stg_events_event_name.682bd9eda3
[0m18:58:16.242546 [debug] [Thread-1 (]: Began running node test.quest_kingdom.not_null_stg_events_player_id.588c4cb5e5
[0m18:58:16.242715 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.quest_kingdom.not_null_stg_events_event_name.682bd9eda3, now test.quest_kingdom.not_null_stg_events_player_id.588c4cb5e5)
[0m18:58:16.242868 [debug] [Thread-1 (]: Began compiling node test.quest_kingdom.not_null_stg_events_player_id.588c4cb5e5
[0m18:58:16.245588 [debug] [Thread-1 (]: Writing injected SQL for node "test.quest_kingdom.not_null_stg_events_player_id.588c4cb5e5"
[0m18:58:16.245939 [debug] [Thread-1 (]: Began executing node test.quest_kingdom.not_null_stg_events_player_id.588c4cb5e5
[0m18:58:16.246234 [debug] [Thread-1 (]: Finished running node test.quest_kingdom.not_null_stg_events_player_id.588c4cb5e5
[0m18:58:16.246407 [debug] [Thread-1 (]: Began running node test.quest_kingdom.unique_stg_events_event_id.66ebb17438
[0m18:58:16.246591 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.quest_kingdom.not_null_stg_events_player_id.588c4cb5e5, now test.quest_kingdom.unique_stg_events_event_id.66ebb17438)
[0m18:58:16.246765 [debug] [Thread-1 (]: Began compiling node test.quest_kingdom.unique_stg_events_event_id.66ebb17438
[0m18:58:16.248522 [debug] [Thread-1 (]: Writing injected SQL for node "test.quest_kingdom.unique_stg_events_event_id.66ebb17438"
[0m18:58:16.248827 [debug] [Thread-1 (]: Began executing node test.quest_kingdom.unique_stg_events_event_id.66ebb17438
[0m18:58:16.249102 [debug] [Thread-1 (]: Finished running node test.quest_kingdom.unique_stg_events_event_id.66ebb17438
[0m18:58:16.249267 [debug] [Thread-1 (]: Began running node test.quest_kingdom.not_null_stg_iap_transactions_player_id.256115ad9d
[0m18:58:16.249434 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.quest_kingdom.unique_stg_events_event_id.66ebb17438, now test.quest_kingdom.not_null_stg_iap_transactions_player_id.256115ad9d)
[0m18:58:16.249589 [debug] [Thread-1 (]: Began compiling node test.quest_kingdom.not_null_stg_iap_transactions_player_id.256115ad9d
[0m18:58:16.251349 [debug] [Thread-1 (]: Writing injected SQL for node "test.quest_kingdom.not_null_stg_iap_transactions_player_id.256115ad9d"
[0m18:58:16.251675 [debug] [Thread-1 (]: Began executing node test.quest_kingdom.not_null_stg_iap_transactions_player_id.256115ad9d
[0m18:58:16.251958 [debug] [Thread-1 (]: Finished running node test.quest_kingdom.not_null_stg_iap_transactions_player_id.256115ad9d
[0m18:58:16.252129 [debug] [Thread-1 (]: Began running node test.quest_kingdom.not_null_stg_iap_transactions_price_usd.613bc29079
[0m18:58:16.252298 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.quest_kingdom.not_null_stg_iap_transactions_player_id.256115ad9d, now test.quest_kingdom.not_null_stg_iap_transactions_price_usd.613bc29079)
[0m18:58:16.252452 [debug] [Thread-1 (]: Began compiling node test.quest_kingdom.not_null_stg_iap_transactions_price_usd.613bc29079
[0m18:58:16.254218 [debug] [Thread-1 (]: Writing injected SQL for node "test.quest_kingdom.not_null_stg_iap_transactions_price_usd.613bc29079"
[0m18:58:16.254502 [debug] [Thread-1 (]: Began executing node test.quest_kingdom.not_null_stg_iap_transactions_price_usd.613bc29079
[0m18:58:16.254777 [debug] [Thread-1 (]: Finished running node test.quest_kingdom.not_null_stg_iap_transactions_price_usd.613bc29079
[0m18:58:16.254944 [debug] [Thread-1 (]: Began running node test.quest_kingdom.not_null_stg_iap_transactions_transaction_id.bc4fc23645
[0m18:58:16.255109 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.quest_kingdom.not_null_stg_iap_transactions_price_usd.613bc29079, now test.quest_kingdom.not_null_stg_iap_transactions_transaction_id.bc4fc23645)
[0m18:58:16.255259 [debug] [Thread-1 (]: Began compiling node test.quest_kingdom.not_null_stg_iap_transactions_transaction_id.bc4fc23645
[0m18:58:16.257136 [debug] [Thread-1 (]: Writing injected SQL for node "test.quest_kingdom.not_null_stg_iap_transactions_transaction_id.bc4fc23645"
[0m18:58:16.257475 [debug] [Thread-1 (]: Began executing node test.quest_kingdom.not_null_stg_iap_transactions_transaction_id.bc4fc23645
[0m18:58:16.257763 [debug] [Thread-1 (]: Finished running node test.quest_kingdom.not_null_stg_iap_transactions_transaction_id.bc4fc23645
[0m18:58:16.257933 [debug] [Thread-1 (]: Began running node test.quest_kingdom.unique_stg_iap_transactions_transaction_id.3bff016069
[0m18:58:16.258105 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.quest_kingdom.not_null_stg_iap_transactions_transaction_id.bc4fc23645, now test.quest_kingdom.unique_stg_iap_transactions_transaction_id.3bff016069)
[0m18:58:16.258257 [debug] [Thread-1 (]: Began compiling node test.quest_kingdom.unique_stg_iap_transactions_transaction_id.3bff016069
[0m18:58:16.260018 [debug] [Thread-1 (]: Writing injected SQL for node "test.quest_kingdom.unique_stg_iap_transactions_transaction_id.3bff016069"
[0m18:58:16.260328 [debug] [Thread-1 (]: Began executing node test.quest_kingdom.unique_stg_iap_transactions_transaction_id.3bff016069
[0m18:58:16.260602 [debug] [Thread-1 (]: Finished running node test.quest_kingdom.unique_stg_iap_transactions_transaction_id.3bff016069
[0m18:58:16.260768 [debug] [Thread-1 (]: Began running node test.quest_kingdom.accepted_values_stg_players_device_type__ios__android.14cabc59fd
[0m18:58:16.260932 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.quest_kingdom.unique_stg_iap_transactions_transaction_id.3bff016069, now test.quest_kingdom.accepted_values_stg_players_device_type__ios__android.14cabc59fd)
[0m18:58:16.261084 [debug] [Thread-1 (]: Began compiling node test.quest_kingdom.accepted_values_stg_players_device_type__ios__android.14cabc59fd
[0m18:58:16.263564 [debug] [Thread-1 (]: Writing injected SQL for node "test.quest_kingdom.accepted_values_stg_players_device_type__ios__android.14cabc59fd"
[0m18:58:16.263911 [debug] [Thread-1 (]: Began executing node test.quest_kingdom.accepted_values_stg_players_device_type__ios__android.14cabc59fd
[0m18:58:16.264192 [debug] [Thread-1 (]: Finished running node test.quest_kingdom.accepted_values_stg_players_device_type__ios__android.14cabc59fd
[0m18:58:16.264359 [debug] [Thread-1 (]: Began running node test.quest_kingdom.accepted_values_stg_players_player_segment__whale__dolphin__minnow__non_payer.2fd01d0b8a
[0m18:58:16.264531 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.quest_kingdom.accepted_values_stg_players_device_type__ios__android.14cabc59fd, now test.quest_kingdom.accepted_values_stg_players_player_segment__whale__dolphin__minnow__non_payer.2fd01d0b8a)
[0m18:58:16.264686 [debug] [Thread-1 (]: Began compiling node test.quest_kingdom.accepted_values_stg_players_player_segment__whale__dolphin__minnow__non_payer.2fd01d0b8a
[0m18:58:16.267540 [debug] [Thread-1 (]: Writing injected SQL for node "test.quest_kingdom.accepted_values_stg_players_player_segment__whale__dolphin__minnow__non_payer.2fd01d0b8a"
[0m18:58:16.267862 [debug] [Thread-1 (]: Began executing node test.quest_kingdom.accepted_values_stg_players_player_segment__whale__dolphin__minnow__non_payer.2fd01d0b8a
[0m18:58:16.268142 [debug] [Thread-1 (]: Finished running node test.quest_kingdom.accepted_values_stg_players_player_segment__whale__dolphin__minnow__non_payer.2fd01d0b8a
[0m18:58:16.268309 [debug] [Thread-1 (]: Began running node test.quest_kingdom.not_null_stg_players_installed_at.60c4ce69cb
[0m18:58:16.268492 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.quest_kingdom.accepted_values_stg_players_player_segment__whale__dolphin__minnow__non_payer.2fd01d0b8a, now test.quest_kingdom.not_null_stg_players_installed_at.60c4ce69cb)
[0m18:58:16.268685 [debug] [Thread-1 (]: Began compiling node test.quest_kingdom.not_null_stg_players_installed_at.60c4ce69cb
[0m18:58:16.270462 [debug] [Thread-1 (]: Writing injected SQL for node "test.quest_kingdom.not_null_stg_players_installed_at.60c4ce69cb"
[0m18:58:16.271382 [debug] [Thread-1 (]: Began executing node test.quest_kingdom.not_null_stg_players_installed_at.60c4ce69cb
[0m18:58:16.271671 [debug] [Thread-1 (]: Finished running node test.quest_kingdom.not_null_stg_players_installed_at.60c4ce69cb
[0m18:58:16.271840 [debug] [Thread-1 (]: Began running node test.quest_kingdom.not_null_stg_players_player_id.702d1d8c7b
[0m18:58:16.272020 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.quest_kingdom.not_null_stg_players_installed_at.60c4ce69cb, now test.quest_kingdom.not_null_stg_players_player_id.702d1d8c7b)
[0m18:58:16.272174 [debug] [Thread-1 (]: Began compiling node test.quest_kingdom.not_null_stg_players_player_id.702d1d8c7b
[0m18:58:16.273989 [debug] [Thread-1 (]: Writing injected SQL for node "test.quest_kingdom.not_null_stg_players_player_id.702d1d8c7b"
[0m18:58:16.274373 [debug] [Thread-1 (]: Began executing node test.quest_kingdom.not_null_stg_players_player_id.702d1d8c7b
[0m18:58:16.274658 [debug] [Thread-1 (]: Finished running node test.quest_kingdom.not_null_stg_players_player_id.702d1d8c7b
[0m18:58:16.274834 [debug] [Thread-1 (]: Began running node test.quest_kingdom.relationships_stg_iap_transactions_player_id__player_id__ref_stg_players_.ec3ff36963
[0m18:58:16.275012 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.quest_kingdom.not_null_stg_players_player_id.702d1d8c7b, now test.quest_kingdom.relationships_stg_iap_transactions_player_id__player_id__ref_stg_players_.ec3ff36963)
[0m18:58:16.275169 [debug] [Thread-1 (]: Began compiling node test.quest_kingdom.relationships_stg_iap_transactions_player_id__player_id__ref_stg_players_.ec3ff36963
[0m18:58:16.280306 [debug] [Thread-1 (]: Writing injected SQL for node "test.quest_kingdom.relationships_stg_iap_transactions_player_id__player_id__ref_stg_players_.ec3ff36963"
[0m18:58:16.280782 [debug] [Thread-1 (]: Began executing node test.quest_kingdom.relationships_stg_iap_transactions_player_id__player_id__ref_stg_players_.ec3ff36963
[0m18:58:16.281098 [debug] [Thread-1 (]: Finished running node test.quest_kingdom.relationships_stg_iap_transactions_player_id__player_id__ref_stg_players_.ec3ff36963
[0m18:58:16.281274 [debug] [Thread-1 (]: Began running node test.quest_kingdom.unique_stg_players_player_id.a3d551d71d
[0m18:58:16.281455 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.quest_kingdom.relationships_stg_iap_transactions_player_id__player_id__ref_stg_players_.ec3ff36963, now test.quest_kingdom.unique_stg_players_player_id.a3d551d71d)
[0m18:58:16.281609 [debug] [Thread-1 (]: Began compiling node test.quest_kingdom.unique_stg_players_player_id.a3d551d71d
[0m18:58:16.283481 [debug] [Thread-1 (]: Writing injected SQL for node "test.quest_kingdom.unique_stg_players_player_id.a3d551d71d"
[0m18:58:16.283842 [debug] [Thread-1 (]: Began executing node test.quest_kingdom.unique_stg_players_player_id.a3d551d71d
[0m18:58:16.284131 [debug] [Thread-1 (]: Finished running node test.quest_kingdom.unique_stg_players_player_id.a3d551d71d
[0m18:58:16.284312 [debug] [Thread-1 (]: Began running node model.quest_kingdom.dim_players
[0m18:58:16.284482 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.quest_kingdom.unique_stg_players_player_id.a3d551d71d, now model.quest_kingdom.dim_players)
[0m18:58:16.284637 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.dim_players
[0m18:58:16.286533 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.dim_players"
[0m18:58:16.286870 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.dim_players
[0m18:58:16.287156 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.dim_players
[0m18:58:16.287329 [debug] [Thread-1 (]: Began running node model.quest_kingdom.fct_sessions
[0m18:58:16.287518 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.quest_kingdom.dim_players, now model.quest_kingdom.fct_sessions)
[0m18:58:16.287720 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.fct_sessions
[0m18:58:16.289266 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.fct_sessions"
[0m18:58:16.289600 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.fct_sessions
[0m18:58:16.289889 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.fct_sessions
[0m18:58:16.290057 [debug] [Thread-1 (]: Began running node test.quest_kingdom.not_null_stg_sessions_player_id.fa13833b29
[0m18:58:16.290231 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.quest_kingdom.fct_sessions, now test.quest_kingdom.not_null_stg_sessions_player_id.fa13833b29)
[0m18:58:16.290380 [debug] [Thread-1 (]: Began compiling node test.quest_kingdom.not_null_stg_sessions_player_id.fa13833b29
[0m18:58:16.292229 [debug] [Thread-1 (]: Writing injected SQL for node "test.quest_kingdom.not_null_stg_sessions_player_id.fa13833b29"
[0m18:58:16.292574 [debug] [Thread-1 (]: Began executing node test.quest_kingdom.not_null_stg_sessions_player_id.fa13833b29
[0m18:58:16.292846 [debug] [Thread-1 (]: Finished running node test.quest_kingdom.not_null_stg_sessions_player_id.fa13833b29
[0m18:58:16.293011 [debug] [Thread-1 (]: Began running node test.quest_kingdom.not_null_stg_sessions_session_id.2e872a126d
[0m18:58:16.293186 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.quest_kingdom.not_null_stg_sessions_player_id.fa13833b29, now test.quest_kingdom.not_null_stg_sessions_session_id.2e872a126d)
[0m18:58:16.293339 [debug] [Thread-1 (]: Began compiling node test.quest_kingdom.not_null_stg_sessions_session_id.2e872a126d
[0m18:58:16.295154 [debug] [Thread-1 (]: Writing injected SQL for node "test.quest_kingdom.not_null_stg_sessions_session_id.2e872a126d"
[0m18:58:16.295610 [debug] [Thread-1 (]: Began executing node test.quest_kingdom.not_null_stg_sessions_session_id.2e872a126d
[0m18:58:16.297492 [debug] [Thread-1 (]: Finished running node test.quest_kingdom.not_null_stg_sessions_session_id.2e872a126d
[0m18:58:16.297921 [debug] [Thread-1 (]: Began running node test.quest_kingdom.not_null_stg_sessions_session_started_at.039a312a09
[0m18:58:16.298246 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.quest_kingdom.not_null_stg_sessions_session_id.2e872a126d, now test.quest_kingdom.not_null_stg_sessions_session_started_at.039a312a09)
[0m18:58:16.298445 [debug] [Thread-1 (]: Began compiling node test.quest_kingdom.not_null_stg_sessions_session_started_at.039a312a09
[0m18:58:16.300610 [debug] [Thread-1 (]: Writing injected SQL for node "test.quest_kingdom.not_null_stg_sessions_session_started_at.039a312a09"
[0m18:58:16.301032 [debug] [Thread-1 (]: Began executing node test.quest_kingdom.not_null_stg_sessions_session_started_at.039a312a09
[0m18:58:16.301348 [debug] [Thread-1 (]: Finished running node test.quest_kingdom.not_null_stg_sessions_session_started_at.039a312a09
[0m18:58:16.301539 [debug] [Thread-1 (]: Began running node test.quest_kingdom.relationships_stg_sessions_player_id__player_id__ref_stg_players_.6b4c9276ee
[0m18:58:16.301743 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.quest_kingdom.not_null_stg_sessions_session_started_at.039a312a09, now test.quest_kingdom.relationships_stg_sessions_player_id__player_id__ref_stg_players_.6b4c9276ee)
[0m18:58:16.301932 [debug] [Thread-1 (]: Began compiling node test.quest_kingdom.relationships_stg_sessions_player_id__player_id__ref_stg_players_.6b4c9276ee
[0m18:58:16.304428 [debug] [Thread-1 (]: Writing injected SQL for node "test.quest_kingdom.relationships_stg_sessions_player_id__player_id__ref_stg_players_.6b4c9276ee"
[0m18:58:16.304822 [debug] [Thread-1 (]: Began executing node test.quest_kingdom.relationships_stg_sessions_player_id__player_id__ref_stg_players_.6b4c9276ee
[0m18:58:16.305134 [debug] [Thread-1 (]: Finished running node test.quest_kingdom.relationships_stg_sessions_player_id__player_id__ref_stg_players_.6b4c9276ee
[0m18:58:16.305311 [debug] [Thread-1 (]: Began running node test.quest_kingdom.unique_stg_sessions_session_id.ce45726d03
[0m18:58:16.305496 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.quest_kingdom.relationships_stg_sessions_player_id__player_id__ref_stg_players_.6b4c9276ee, now test.quest_kingdom.unique_stg_sessions_session_id.ce45726d03)
[0m18:58:16.305651 [debug] [Thread-1 (]: Began compiling node test.quest_kingdom.unique_stg_sessions_session_id.ce45726d03
[0m18:58:16.307630 [debug] [Thread-1 (]: Writing injected SQL for node "test.quest_kingdom.unique_stg_sessions_session_id.ce45726d03"
[0m18:58:16.307993 [debug] [Thread-1 (]: Began executing node test.quest_kingdom.unique_stg_sessions_session_id.ce45726d03
[0m18:58:16.308282 [debug] [Thread-1 (]: Finished running node test.quest_kingdom.unique_stg_sessions_session_id.ce45726d03
[0m18:58:16.308988 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:58:16.309160 [debug] [MainThread]: Connection 'test.quest_kingdom.unique_stg_sessions_session_id.ce45726d03' was properly closed.
[0m18:58:16.310780 [debug] [MainThread]: Command end result
[0m18:58:16.390086 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/manifest.json
[0m18:58:16.391238 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/semantic_manifest.json
[0m18:58:16.395536 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/run_results.json
[0m18:58:16.397684 [debug] [MainThread]: Acquiring new duckdb connection 'generate_catalog'
[0m18:58:16.397840 [info ] [MainThread]: Building catalog
[0m18:58:16.402705 [debug] [ThreadPool]: Acquiring new duckdb connection 'quest_kingdom.information_schema'
[0m18:58:16.406049 [debug] [ThreadPool]: Using duckdb connection "quest_kingdom.information_schema"
[0m18:58:16.406261 [debug] [ThreadPool]: On quest_kingdom.information_schema: BEGIN
[0m18:58:16.406400 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:58:16.406807 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m18:58:16.406948 [debug] [ThreadPool]: Using duckdb connection "quest_kingdom.information_schema"
[0m18:58:16.407106 [debug] [ThreadPool]: On quest_kingdom.information_schema: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "quest_kingdom.information_schema"} */
with relations AS (
      select
        t.table_name
        , t.database_name
        , t.schema_name
        , 'BASE TABLE' as table_type
        , t.comment as table_comment
      from duckdb_tables() t
      WHERE t.database_name = 'quest_kingdom'
      UNION ALL
      SELECT v.view_name as table_name
      , v.database_name
      , v.schema_name
      , 'VIEW' as table_type
      , v.comment as table_comment
      from duckdb_views() v
      WHERE v.database_name = 'quest_kingdom'
    )
    select
        'quest_kingdom' as table_database,
        r.schema_name as table_schema,
        r.table_name,
        r.table_type,
        r.table_comment,
        c.column_name,
        c.column_index as column_index,
        c.data_type as column_type,
        c.comment as column_comment,
        NULL as table_owner
    FROM relations r JOIN duckdb_columns() c ON r.schema_name = c.schema_name AND r.table_name = c.table_name
    WHERE (upper(r.schema_name) = upper('main'))
    ORDER BY
        r.schema_name,
        r.table_name,
        c.column_index
[0m18:58:16.415557 [debug] [ThreadPool]: SQL status: OK in 0.008 seconds
[0m18:58:16.419431 [debug] [ThreadPool]: On quest_kingdom.information_schema: ROLLBACK
[0m18:58:16.419970 [debug] [ThreadPool]: Failed to rollback 'quest_kingdom.information_schema'
[0m18:58:16.420123 [debug] [ThreadPool]: On quest_kingdom.information_schema: Close
[0m18:58:16.429205 [debug] [MainThread]: Wrote artifact CatalogArtifact to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/catalog.json
[0m18:58:16.448584 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/manifest.json
[0m18:58:16.450239 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/semantic_manifest.json
[0m18:58:16.450441 [info ] [MainThread]: Catalog written to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/catalog.json
[0m18:58:16.452502 [debug] [MainThread]: Resource report: {"command_name": "generate", "command_success": true, "command_wall_clock_time": 0.67292494, "process_in_blocks": "0", "process_kernel_time": 0.192246, "process_mem_max_rss": "147456000", "process_out_blocks": "0", "process_user_time": 1.256574}
[0m18:58:16.452802 [debug] [MainThread]: Command `dbt docs generate` succeeded at 18:58:16.452756 after 0.67 seconds
[0m18:58:16.452969 [debug] [MainThread]: Connection 'generate_catalog' was properly closed.
[0m18:58:16.453098 [debug] [MainThread]: Connection 'quest_kingdom.information_schema' was properly closed.
[0m18:58:16.453264 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104756ea0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105aaca40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1054ada30>]}
[0m18:58:16.453449 [debug] [MainThread]: Flushing usage events
[0m18:58:16.555789 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m16:29:13.465744 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1062bec30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1064b5be0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1064b5940>]}


============================== 16:29:13.473630 | 665d3a30-2864-41fc-83fb-6a7ac1938e83 ==============================
[0m16:29:13.473630 [info ] [MainThread]: Running with dbt=1.11.4
[0m16:29:13.474213 [debug] [MainThread]: running dbt with arguments {'partial_parse': 'True', 'use_colors': 'True', 'cache_selected_only': 'False', 'no_print': 'None', 'fail_fast': 'False', 'quiet': 'False', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'target_path': 'None', 'write_json': 'True', 'log_cache_events': 'False', 'warn_error': 'None', 'profiles_dir': '/Users/hazeldonaldson/.dbt', 'send_anonymous_usage_stats': 'True', 'debug': 'False', 'log_format': 'default', 'invocation_command': 'dbt run --select dim_players', 'printer_width': '80', 'introspect': 'True', 'static_parser': 'True', 'log_path': '/Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/logs', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'empty': 'False', 'version_check': 'True'}
[0m16:29:14.065744 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '665d3a30-2864-41fc-83fb-6a7ac1938e83', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106868ce0>]}
[0m16:29:14.102827 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '665d3a30-2864-41fc-83fb-6a7ac1938e83', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1065217c0>]}
[0m16:29:14.104681 [info ] [MainThread]: Registered adapter: duckdb=1.10.0
[0m16:29:14.222348 [debug] [MainThread]: checksum: 092b177ba87eb6bb3c55954c38aa57900eebac336561eb9ee32218428aa81d43, vars: {}, profile: , target: , version: 1.11.4
[0m16:29:14.331831 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 5 files added, 1 files changed.
[0m16:29:14.333518 [debug] [MainThread]: Partial parsing: added file: quest_kingdom://models/marts/retention/rpt_d1_d7_d30_retention.sql
[0m16:29:14.334105 [debug] [MainThread]: Partial parsing: added file: quest_kingdom://models/marts/retention/fct_daily_active_users.sql
[0m16:29:14.334670 [debug] [MainThread]: Partial parsing: added file: quest_kingdom://models/marts/retention/retention.yml
[0m16:29:14.335196 [debug] [MainThread]: Partial parsing: added file: quest_kingdom://models/marts/retention/rpt_cohort_retention.sql
[0m16:29:14.335613 [debug] [MainThread]: Partial parsing: added file: quest_kingdom://models/marts/retention/rpt_retention_curves.sql
[0m16:29:14.336333 [debug] [MainThread]: Partial parsing: updated file: quest_kingdom://models/marts/core/dim_players.sql
[0m16:29:14.686952 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 7 unused configuration paths:
- models.retention
- models.staging
- models.product
- models.question_kingdom
- models.monetization
- models.marts
- models.core
[0m16:29:14.776184 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '665d3a30-2864-41fc-83fb-6a7ac1938e83', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1068528a0>]}
[0m16:29:14.884343 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/manifest.json
[0m16:29:14.886457 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/semantic_manifest.json
[0m16:29:14.909021 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '665d3a30-2864-41fc-83fb-6a7ac1938e83', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106f9ec90>]}
[0m16:29:14.909519 [info ] [MainThread]: Found 11 models, 32 data tests, 5 sources, 472 macros
[0m16:29:14.909793 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '665d3a30-2864-41fc-83fb-6a7ac1938e83', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106f76270>]}
[0m16:29:14.911590 [info ] [MainThread]: 
[0m16:29:14.911956 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m16:29:14.912299 [info ] [MainThread]: 
[0m16:29:14.912634 [debug] [MainThread]: Acquiring new duckdb connection 'master'
[0m16:29:14.913208 [debug] [ThreadPool]: Acquiring new duckdb connection 'list_quest_kingdom'
[0m16:29:14.959956 [debug] [ThreadPool]: Using duckdb connection "list_quest_kingdom"
[0m16:29:14.960339 [debug] [ThreadPool]: On list_quest_kingdom: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "list_quest_kingdom"} */

    
    select schema_name
    from system.information_schema.schemata
    
    where lower(catalog_name) = '"quest_kingdom"'
    
  
  
[0m16:29:14.960577 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:29:14.976690 [debug] [ThreadPool]: SQL status: OK in 0.016 seconds
[0m16:29:14.977614 [debug] [ThreadPool]: On list_quest_kingdom: Close
[0m16:29:14.978055 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_quest_kingdom, now create_quest_kingdom_main)
[0m16:29:14.978343 [debug] [ThreadPool]: Creating schema "database: "quest_kingdom"
schema: "main"
"
[0m16:29:14.982349 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m16:29:14.982606 [debug] [ThreadPool]: On create_quest_kingdom_main: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "create_quest_kingdom_main"} */

    
        select type from duckdb_databases()
        where lower(database_name)='quest_kingdom'
        and type='sqlite'
    
  
[0m16:29:14.982764 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:29:14.983423 [debug] [ThreadPool]: SQL status: OK in 0.001 seconds
[0m16:29:14.984203 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m16:29:14.984387 [debug] [ThreadPool]: On create_quest_kingdom_main: BEGIN
[0m16:29:14.984758 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m16:29:14.984913 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m16:29:14.985050 [debug] [ThreadPool]: On create_quest_kingdom_main: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "create_quest_kingdom_main"} */

    
    
        create schema if not exists "quest_kingdom"."main"
    
[0m16:29:14.985325 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m16:29:14.985797 [debug] [ThreadPool]: On create_quest_kingdom_main: COMMIT
[0m16:29:14.985952 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m16:29:14.986083 [debug] [ThreadPool]: On create_quest_kingdom_main: COMMIT
[0m16:29:14.986296 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m16:29:14.986434 [debug] [ThreadPool]: On create_quest_kingdom_main: Close
[0m16:29:14.989665 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_quest_kingdom_main, now list_quest_kingdom_main)
[0m16:29:14.994541 [debug] [ThreadPool]: Using duckdb connection "list_quest_kingdom_main"
[0m16:29:14.994792 [debug] [ThreadPool]: On list_quest_kingdom_main: BEGIN
[0m16:29:14.994924 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:29:14.995287 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m16:29:14.995416 [debug] [ThreadPool]: Using duckdb connection "list_quest_kingdom_main"
[0m16:29:14.995550 [debug] [ThreadPool]: On list_quest_kingdom_main: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "list_quest_kingdom_main"} */
select
      'quest_kingdom' as database,
      table_name as name,
      table_schema as schema,
      CASE table_type
        WHEN 'BASE TABLE' THEN 'table'
        WHEN 'VIEW' THEN 'view'
        WHEN 'LOCAL TEMPORARY' THEN 'table'
        END as type
    from system.information_schema.tables
    where lower(table_schema) = 'main'
    and lower(table_catalog) = 'quest_kingdom'
  
[0m16:29:15.008353 [debug] [ThreadPool]: SQL status: OK in 0.013 seconds
[0m16:29:15.009374 [debug] [ThreadPool]: On list_quest_kingdom_main: ROLLBACK
[0m16:29:15.010516 [debug] [ThreadPool]: Failed to rollback 'list_quest_kingdom_main'
[0m16:29:15.010707 [debug] [ThreadPool]: On list_quest_kingdom_main: Close
[0m16:29:15.011806 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '665d3a30-2864-41fc-83fb-6a7ac1938e83', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1031cf9e0>]}
[0m16:29:15.012130 [debug] [MainThread]: Using duckdb connection "master"
[0m16:29:15.012284 [debug] [MainThread]: On master: BEGIN
[0m16:29:15.012415 [debug] [MainThread]: Opening a new connection, currently in state init
[0m16:29:15.012811 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m16:29:15.012973 [debug] [MainThread]: On master: COMMIT
[0m16:29:15.013119 [debug] [MainThread]: Using duckdb connection "master"
[0m16:29:15.013251 [debug] [MainThread]: On master: COMMIT
[0m16:29:15.013540 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m16:29:15.013680 [debug] [MainThread]: On master: Close
[0m16:29:15.016023 [debug] [Thread-1 (]: Began running node model.quest_kingdom.dim_players
[0m16:29:15.016331 [info ] [Thread-1 (]: 1 of 1 START sql table model main.dim_players .................................. [RUN]
[0m16:29:15.016576 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_quest_kingdom_main, now model.quest_kingdom.dim_players)
[0m16:29:15.016741 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.dim_players
[0m16:29:15.021836 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.dim_players"
[0m16:29:15.024969 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.dim_players
[0m16:29:15.049938 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.dim_players"
[0m16:29:15.051411 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.dim_players"
[0m16:29:15.051616 [debug] [Thread-1 (]: On model.quest_kingdom.dim_players: BEGIN
[0m16:29:15.051780 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:29:15.052240 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:29:15.052401 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.dim_players"
[0m16:29:15.052648 [debug] [Thread-1 (]: On model.quest_kingdom.dim_players: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.dim_players"} */

  
    
    

    create  table
      "quest_kingdom"."main"."dim_players__dbt_tmp"
  
    as (
      

with players as (

    select * from "quest_kingdom"."main"."stg_players"

),

sessions as (

    select * from "quest_kingdom"."main"."stg_sessions"

),

transactions as (

    select * from "quest_kingdom"."main"."stg_iap_transactions"

),

ads as (

    select * from "quest_kingdom"."main"."stg_ad_impressions"

),

-- Aggregate session metrics per player
player_sessions as (

    select
        player_id,
        count(*) as total_sessions,
        min(session_started_at) as first_session_at,
        max(session_started_at) as last_session_at,
        sum(session_duration_minutes) as total_play_time_minutes,
        avg(session_duration_minutes) as avg_session_duration_minutes,
        max(ending_level) as max_level_reached

    from sessions
    group by player_id

),

-- Aggregate IAP metrics per player
player_iap as (

    select
        player_id,
        count(*) as total_purchases,
        sum(price_usd) as total_iap_revenue,
        min(purchased_at) as first_purchase_at,
        avg(price_usd) as avg_purchase_value

    from transactions
    group by player_id

),

-- Aggregate ad metrics per player
player_ads as (

    select
        player_id,
        count(*) as total_ad_impressions,
        sum(revenue_usd) as total_ad_revenue,
        sum(case when clicked then 1 else 0 end) as total_ad_clicks

    from ads
    group by player_id

),

-- Combine everything
final as (

    select
        -- player attributes
        p.player_id,
        p.installed_at,
        p.attribution_channel,
        p.country,
        p.device_type,
        p.player_segment,
        p.experiment_variant,
        p.tutorial_completed,
        
        -- session metrics
        coalesce(ps.total_sessions, 0) as total_sessions,
        ps.first_session_at,
        ps.last_session_at,
        coalesce(ps.total_play_time_minutes, 0) as total_play_time_minutes,
        ps.avg_session_duration_minutes,
        coalesce(ps.max_level_reached, 0) as max_level_reached,
        
        -- monetization metrics
        coalesce(pi.total_purchases, 0) as total_purchases,
        coalesce(pi.total_iap_revenue, 0) as total_iap_revenue,
        pi.first_purchase_at,
        pi.avg_purchase_value,
        
        coalesce(pa.total_ad_impressions, 0) as total_ad_impressions,
        coalesce(pa.total_ad_revenue, 0) as total_ad_revenue,
        coalesce(pa.total_ad_clicks, 0) as total_ad_clicks,
        
        -- derived total revenue
        coalesce(pi.total_iap_revenue, 0) + coalesce(pa.total_ad_revenue, 0) as total_revenue,
        
        -- derived days metrics
        datediff('day', p.installed_at, current_date) as days_since_install,
        case 
            when ps.last_session_at is not null 
            then datediff('day', ps.last_session_at, current_date)
            else null
        end as days_since_last_session,
        case 
            when pi.first_purchase_at is not null 
            then datediff('day', p.installed_at, pi.first_purchase_at)
            else null
        end as days_to_first_purchase,
        
        -- derived flags
        coalesce(ps.total_sessions, 0) > 0 as is_activated,
        coalesce(pi.total_purchases, 0) > 0 as is_payer,
        coalesce(pa.total_ad_impressions, 0) > 0 as has_seen_ads,

        --cohort fields
        date_trunc('week', p.installed_at)::date as cohort_week,
        date_trunc('month', p.installed_at)::date as cohort_month

    from players p
    left join player_sessions ps on p.player_id = ps.player_id
    left join player_iap pi on p.player_id = pi.player_id
    left join player_ads pa on p.player_id = pa.player_id

)

select * from final
    );
  
  
[0m16:29:15.108451 [debug] [Thread-1 (]: SQL status: OK in 0.055 seconds
[0m16:29:15.111702 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.dim_players"
[0m16:29:15.111928 [debug] [Thread-1 (]: On model.quest_kingdom.dim_players: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.dim_players"} */

    SELECT index_name
    FROM duckdb_indexes()
    WHERE schema_name = 'main'
      AND table_name = 'dim_players'
  
[0m16:29:15.112549 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:29:15.113338 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.dim_players"
[0m16:29:15.113547 [debug] [Thread-1 (]: On model.quest_kingdom.dim_players: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.dim_players"} */

    SELECT COUNT(*) as remaining_indexes
    FROM duckdb_indexes()
    WHERE schema_name = 'main'
      AND table_name = 'dim_players'
  
[0m16:29:15.114104 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:29:15.118282 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.dim_players"
[0m16:29:15.118542 [debug] [Thread-1 (]: On model.quest_kingdom.dim_players: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.dim_players"} */
alter table "quest_kingdom"."main"."dim_players" rename to "dim_players__dbt_backup"
[0m16:29:15.119055 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:29:15.123515 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.dim_players"
[0m16:29:15.123799 [debug] [Thread-1 (]: On model.quest_kingdom.dim_players: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.dim_players"} */
alter table "quest_kingdom"."main"."dim_players__dbt_tmp" rename to "dim_players"
[0m16:29:15.124266 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:29:15.134838 [debug] [Thread-1 (]: On model.quest_kingdom.dim_players: COMMIT
[0m16:29:15.137668 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.dim_players"
[0m16:29:15.137977 [debug] [Thread-1 (]: On model.quest_kingdom.dim_players: COMMIT
[0m16:29:15.147806 [debug] [Thread-1 (]: SQL status: OK in 0.010 seconds
[0m16:29:15.151234 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.dim_players"
[0m16:29:15.151505 [debug] [Thread-1 (]: On model.quest_kingdom.dim_players: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.dim_players"} */

      drop table if exists "quest_kingdom"."main"."dim_players__dbt_backup" cascade
    
[0m16:29:15.152312 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m16:29:15.153855 [debug] [Thread-1 (]: On model.quest_kingdom.dim_players: Close
[0m16:29:15.155151 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '665d3a30-2864-41fc-83fb-6a7ac1938e83', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1030fb4a0>]}
[0m16:29:15.155540 [info ] [Thread-1 (]: 1 of 1 OK created sql table model main.dim_players ............................. [[32mOK[0m in 0.14s]
[0m16:29:15.155926 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.dim_players
[0m16:29:15.156987 [debug] [MainThread]: Using duckdb connection "master"
[0m16:29:15.157276 [debug] [MainThread]: On master: BEGIN
[0m16:29:15.157420 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m16:29:15.157809 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m16:29:15.157947 [debug] [MainThread]: On master: COMMIT
[0m16:29:15.158073 [debug] [MainThread]: Using duckdb connection "master"
[0m16:29:15.158194 [debug] [MainThread]: On master: COMMIT
[0m16:29:15.158428 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m16:29:15.158596 [debug] [MainThread]: On master: Close
[0m16:29:15.158794 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:29:15.158926 [debug] [MainThread]: Connection 'model.quest_kingdom.dim_players' was properly closed.
[0m16:29:15.159076 [info ] [MainThread]: 
[0m16:29:15.159264 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.25 seconds (0.25s).
[0m16:29:15.204439 [debug] [MainThread]: Command end result
[0m16:29:15.300438 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/manifest.json
[0m16:29:15.302144 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/semantic_manifest.json
[0m16:29:15.311952 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/run_results.json
[0m16:29:15.313050 [info ] [MainThread]: 
[0m16:29:15.314318 [info ] [MainThread]: [32mCompleted successfully[0m
[0m16:29:15.314530 [info ] [MainThread]: 
[0m16:29:15.314705 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m16:29:15.338705 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 1.9598057, "process_in_blocks": "0", "process_kernel_time": 0.352352, "process_mem_max_rss": "170491904", "process_out_blocks": "0", "process_user_time": 1.726608}
[0m16:29:15.339144 [debug] [MainThread]: Command `dbt run` succeeded at 16:29:15.339081 after 1.96 seconds
[0m16:29:15.339432 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106f9f650>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1064b5a90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1064b5be0>]}
[0m16:29:15.339659 [debug] [MainThread]: Flushing usage events
[0m16:29:15.476296 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m16:29:27.737302 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104ec1dc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105539a90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105539850>]}


============================== 16:29:27.741094 | 7f1e464a-57c5-4529-91bc-d70103a490fa ==============================
[0m16:29:27.741094 [info ] [MainThread]: Running with dbt=1.11.4
[0m16:29:27.741493 [debug] [MainThread]: running dbt with arguments {'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'fail_fast': 'False', 'debug': 'False', 'log_cache_events': 'False', 'indirect_selection': 'eager', 'partial_parse': 'True', 'log_format': 'default', 'version_check': 'True', 'no_print': 'None', 'target_path': 'None', 'warn_error': 'None', 'invocation_command': 'dbt run --select retention', 'use_colors': 'True', 'log_path': '/Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/logs', 'printer_width': '80', 'profiles_dir': '/Users/hazeldonaldson/.dbt', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'use_experimental_parser': 'False', 'introspect': 'True', 'empty': 'False', 'write_json': 'True', 'cache_selected_only': 'False', 'quiet': 'False'}
[0m16:29:27.910357 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '7f1e464a-57c5-4529-91bc-d70103a490fa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102d70890>]}
[0m16:29:27.939418 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '7f1e464a-57c5-4529-91bc-d70103a490fa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104a14e00>]}
[0m16:29:27.941627 [info ] [MainThread]: Registered adapter: duckdb=1.10.0
[0m16:29:27.993743 [debug] [MainThread]: checksum: 092b177ba87eb6bb3c55954c38aa57900eebac336561eb9ee32218428aa81d43, vars: {}, profile: , target: , version: 1.11.4
[0m16:29:28.059676 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m16:29:28.059928 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m16:29:28.060071 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m16:29:28.063298 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 7 unused configuration paths:
- models.core
- models.question_kingdom
- models.marts
- models.retention
- models.monetization
- models.product
- models.staging
[0m16:29:28.083747 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '7f1e464a-57c5-4529-91bc-d70103a490fa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1057fb0b0>]}
[0m16:29:28.126826 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/manifest.json
[0m16:29:28.128251 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/semantic_manifest.json
[0m16:29:28.140817 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '7f1e464a-57c5-4529-91bc-d70103a490fa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1057fab40>]}
[0m16:29:28.141135 [info ] [MainThread]: Found 11 models, 32 data tests, 5 sources, 472 macros
[0m16:29:28.141321 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7f1e464a-57c5-4529-91bc-d70103a490fa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105b6acc0>]}
[0m16:29:28.141749 [warn ] [MainThread]: The selection criterion 'retention' does not match any enabled nodes
[0m16:29:28.142478 [warn ] [MainThread]: Nothing to do. Try checking your model configs and model specification args
[0m16:29:28.143464 [debug] [MainThread]: Command end result
[0m16:29:28.162840 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/manifest.json
[0m16:29:28.163964 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/semantic_manifest.json
[0m16:29:28.165655 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/run_results.json
[0m16:29:28.167178 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 0.46773186, "process_in_blocks": "0", "process_kernel_time": 0.161866, "process_mem_max_rss": "134201344", "process_out_blocks": "0", "process_user_time": 0.976357}
[0m16:29:28.167496 [debug] [MainThread]: Command `dbt run` succeeded at 16:29:28.167443 after 0.47 seconds
[0m16:29:28.167732 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105539b20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105b72ed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105b72db0>]}
[0m16:29:28.168067 [debug] [MainThread]: Flushing usage events
[0m16:29:28.281863 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m16:30:52.675730 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102ace6f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105551b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105551910>]}


============================== 16:30:52.679383 | 3a8116b8-e02e-4cfc-abe8-752acdbf7577 ==============================
[0m16:30:52.679383 [info ] [MainThread]: Running with dbt=1.11.4
[0m16:30:52.679713 [debug] [MainThread]: running dbt with arguments {'no_print': 'None', 'target_path': 'None', 'use_colors': 'True', 'profiles_dir': '/Users/hazeldonaldson/.dbt', 'introspect': 'True', 'write_json': 'True', 'cache_selected_only': 'False', 'invocation_command': 'dbt run --select retention', 'partial_parse': 'True', 'quiet': 'False', 'send_anonymous_usage_stats': 'True', 'empty': 'False', 'warn_error': 'None', 'log_cache_events': 'False', 'printer_width': '80', 'use_experimental_parser': 'False', 'fail_fast': 'False', 'log_format': 'default', 'log_path': '/Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/logs', 'debug': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'version_check': 'True', 'static_parser': 'True', 'indirect_selection': 'eager'}
[0m16:30:52.854789 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '3a8116b8-e02e-4cfc-abe8-752acdbf7577', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105739ca0>]}
[0m16:30:52.883884 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '3a8116b8-e02e-4cfc-abe8-752acdbf7577', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104c4c7a0>]}
[0m16:30:52.885410 [info ] [MainThread]: Registered adapter: duckdb=1.10.0
[0m16:30:52.936945 [debug] [MainThread]: checksum: 092b177ba87eb6bb3c55954c38aa57900eebac336561eb9ee32218428aa81d43, vars: {}, profile: , target: , version: 1.11.4
[0m16:30:53.003734 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m16:30:53.003981 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m16:30:53.004120 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m16:30:53.007377 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 7 unused configuration paths:
- models.product
- models.staging
- models.monetization
- models.question_kingdom
- models.core
- models.retention
- models.marts
[0m16:30:53.027683 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '3a8116b8-e02e-4cfc-abe8-752acdbf7577', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1055be360>]}
[0m16:30:53.071553 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/manifest.json
[0m16:30:53.072928 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/semantic_manifest.json
[0m16:30:53.084762 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '3a8116b8-e02e-4cfc-abe8-752acdbf7577', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105c1ecf0>]}
[0m16:30:53.085040 [info ] [MainThread]: Found 11 models, 32 data tests, 5 sources, 472 macros
[0m16:30:53.085218 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3a8116b8-e02e-4cfc-abe8-752acdbf7577', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105b859a0>]}
[0m16:30:53.085622 [warn ] [MainThread]: The selection criterion 'retention' does not match any enabled nodes
[0m16:30:53.086302 [warn ] [MainThread]: Nothing to do. Try checking your model configs and model specification args
[0m16:30:53.087229 [debug] [MainThread]: Command end result
[0m16:30:53.106019 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/manifest.json
[0m16:30:53.107165 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/semantic_manifest.json
[0m16:30:53.108781 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/run_results.json
[0m16:30:53.110203 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 0.47811818, "process_in_blocks": "0", "process_kernel_time": 0.171735, "process_mem_max_rss": "133513216", "process_out_blocks": "0", "process_user_time": 0.994836}
[0m16:30:53.110462 [debug] [MainThread]: Command `dbt run` succeeded at 16:30:53.110416 after 0.48 seconds
[0m16:30:53.110659 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1055519a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104ed9b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105795670>]}
[0m16:30:53.110840 [debug] [MainThread]: Flushing usage events
[0m16:30:53.220602 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m16:31:37.357723 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11926cc50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1192b1e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1192b1af0>]}


============================== 16:31:37.361144 | 4cfb9b23-f857-434b-95a1-1373f807180f ==============================
[0m16:31:37.361144 [info ] [MainThread]: Running with dbt=1.11.4
[0m16:31:37.361471 [debug] [MainThread]: running dbt with arguments {'version_check': 'True', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt test --select retention', 'log_cache_events': 'False', 'debug': 'False', 'fail_fast': 'False', 'send_anonymous_usage_stats': 'True', 'printer_width': '80', 'use_experimental_parser': 'False', 'empty': 'None', 'introspect': 'True', 'partial_parse': 'True', 'no_print': 'None', 'log_path': '/Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/logs', 'cache_selected_only': 'False', 'quiet': 'False', 'indirect_selection': 'eager', 'warn_error': 'None', 'profiles_dir': '/Users/hazeldonaldson/.dbt', 'use_colors': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_format': 'default', 'write_json': 'True'}
[0m16:31:37.530924 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '4cfb9b23-f857-434b-95a1-1373f807180f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1193215e0>]}
[0m16:31:37.560034 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '4cfb9b23-f857-434b-95a1-1373f807180f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11933e480>]}
[0m16:31:37.561418 [info ] [MainThread]: Registered adapter: duckdb=1.10.0
[0m16:31:37.616914 [debug] [MainThread]: checksum: 092b177ba87eb6bb3c55954c38aa57900eebac336561eb9ee32218428aa81d43, vars: {}, profile: , target: , version: 1.11.4
[0m16:31:37.683913 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m16:31:37.684159 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m16:31:37.684294 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m16:31:37.687524 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 7 unused configuration paths:
- models.marts
- models.question_kingdom
- models.core
- models.monetization
- models.product
- models.staging
- models.retention
[0m16:31:37.707569 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '4cfb9b23-f857-434b-95a1-1373f807180f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1192e0ef0>]}
[0m16:31:37.750044 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/manifest.json
[0m16:31:37.751392 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/semantic_manifest.json
[0m16:31:37.768597 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '4cfb9b23-f857-434b-95a1-1373f807180f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1197558b0>]}
[0m16:31:37.768892 [info ] [MainThread]: Found 11 models, 32 data tests, 5 sources, 472 macros
[0m16:31:37.769069 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4cfb9b23-f857-434b-95a1-1373f807180f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11a8909b0>]}
[0m16:31:37.769489 [warn ] [MainThread]: The selection criterion 'retention' does not match any enabled nodes
[0m16:31:37.770178 [warn ] [MainThread]: Nothing to do. Try checking your model configs and model specification args
[0m16:31:37.771147 [debug] [MainThread]: Command end result
[0m16:31:37.806413 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/manifest.json
[0m16:31:37.807966 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/semantic_manifest.json
[0m16:31:37.809926 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/run_results.json
[0m16:31:37.811063 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 0.49076563, "process_in_blocks": "0", "process_kernel_time": 0.166983, "process_mem_max_rss": "134217728", "process_out_blocks": "0", "process_user_time": 0.973519}
[0m16:31:37.811341 [debug] [MainThread]: Command `dbt test` succeeded at 16:31:37.811293 after 0.49 seconds
[0m16:31:37.811556 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1192b1be0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1192b1c10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1192b1df0>]}
[0m16:31:37.811743 [debug] [MainThread]: Flushing usage events
[0m16:31:37.925306 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m16:33:09.429724 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1074ab800>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10904da90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10904d550>]}


============================== 16:33:09.433174 | b268623f-6e6a-4d93-94ec-92a6fac4a461 ==============================
[0m16:33:09.433174 [info ] [MainThread]: Running with dbt=1.11.4
[0m16:33:09.433510 [debug] [MainThread]: running dbt with arguments {'version_check': 'True', 'invocation_command': 'dbt run --select retention', 'use_colors': 'True', 'introspect': 'True', 'indirect_selection': 'eager', 'write_json': 'True', 'send_anonymous_usage_stats': 'True', 'quiet': 'False', 'use_experimental_parser': 'False', 'empty': 'False', 'log_format': 'default', 'no_print': 'None', 'log_cache_events': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'warn_error': 'None', 'printer_width': '80', 'log_path': '/Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/logs', 'cache_selected_only': 'False', 'profiles_dir': '/Users/hazeldonaldson/.dbt', 'fail_fast': 'False', 'static_parser': 'True', 'target_path': 'None', 'partial_parse': 'True', 'debug': 'False'}
[0m16:33:09.614418 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b268623f-6e6a-4d93-94ec-92a6fac4a461', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109204860>]}
[0m16:33:09.645164 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b268623f-6e6a-4d93-94ec-92a6fac4a461', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109129610>]}
[0m16:33:09.646627 [info ] [MainThread]: Registered adapter: duckdb=1.10.0
[0m16:33:09.702940 [debug] [MainThread]: checksum: 092b177ba87eb6bb3c55954c38aa57900eebac336561eb9ee32218428aa81d43, vars: {}, profile: , target: , version: 1.11.4
[0m16:33:09.752744 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m16:33:09.753058 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'b268623f-6e6a-4d93-94ec-92a6fac4a461', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108997410>]}
[0m16:33:10.426068 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.quest_kingdom.marts.product
- models.quest_kingdom.marts.monetization
[0m16:33:10.431117 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b268623f-6e6a-4d93-94ec-92a6fac4a461', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109685160>]}
[0m16:33:10.473977 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/manifest.json
[0m16:33:10.475689 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/semantic_manifest.json
[0m16:33:10.490931 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b268623f-6e6a-4d93-94ec-92a6fac4a461', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1099de360>]}
[0m16:33:10.491329 [info ] [MainThread]: Found 11 models, 32 data tests, 5 sources, 472 macros
[0m16:33:10.491571 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b268623f-6e6a-4d93-94ec-92a6fac4a461', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1099828d0>]}
[0m16:33:10.492061 [warn ] [MainThread]: The selection criterion 'retention' does not match any enabled nodes
[0m16:33:10.492806 [warn ] [MainThread]: Nothing to do. Try checking your model configs and model specification args
[0m16:33:10.493080 [debug] [MainThread]: Command end result
[0m16:33:10.541631 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/manifest.json
[0m16:33:10.543106 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/semantic_manifest.json
[0m16:33:10.545161 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/run_results.json
[0m16:33:10.546578 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 1.1558172, "process_in_blocks": "0", "process_kernel_time": 0.19011, "process_mem_max_rss": "139624448", "process_out_blocks": "0", "process_user_time": 1.627016}
[0m16:33:10.546811 [debug] [MainThread]: Command `dbt run` succeeded at 16:33:10.546767 after 1.16 seconds
[0m16:33:10.546994 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109a3ee40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109a3f1a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109a3ef00>]}
[0m16:33:10.547163 [debug] [MainThread]: Flushing usage events
[0m16:33:10.675231 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m16:35:02.978475 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109179c40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1098559a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109855790>]}


============================== 16:35:02.982125 | eb57e150-1f30-4aef-8685-0584bc1dc523 ==============================
[0m16:35:02.982125 [info ] [MainThread]: Running with dbt=1.11.4
[0m16:35:02.982450 [debug] [MainThread]: running dbt with arguments {'warn_error': 'None', 'version_check': 'True', 'use_experimental_parser': 'False', 'log_format': 'default', 'log_cache_events': 'False', 'debug': 'False', 'use_colors': 'True', 'partial_parse': 'True', 'no_print': 'None', 'cache_selected_only': 'False', 'printer_width': '80', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'invocation_command': 'dbt run --select retention', 'log_path': '/Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/logs', 'empty': 'False', 'introspect': 'True', 'indirect_selection': 'eager', 'fail_fast': 'False', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'profiles_dir': '/Users/hazeldonaldson/.dbt', 'quiet': 'False'}
[0m16:35:03.148861 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'eb57e150-1f30-4aef-8685-0584bc1dc523', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1098e0050>]}
[0m16:35:03.182582 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'eb57e150-1f30-4aef-8685-0584bc1dc523', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10919f980>]}
[0m16:35:03.183970 [info ] [MainThread]: Registered adapter: duckdb=1.10.0
[0m16:35:03.235807 [debug] [MainThread]: checksum: 092b177ba87eb6bb3c55954c38aa57900eebac336561eb9ee32218428aa81d43, vars: {}, profile: , target: , version: 1.11.4
[0m16:35:03.284101 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m16:35:03.284414 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'eb57e150-1f30-4aef-8685-0584bc1dc523', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10919f050>]}
[0m16:35:03.959871 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'eb57e150-1f30-4aef-8685-0584bc1dc523', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a051280>]}
[0m16:35:04.001129 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/manifest.json
[0m16:35:04.002404 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/semantic_manifest.json
[0m16:35:04.016159 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'eb57e150-1f30-4aef-8685-0584bc1dc523', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a2071a0>]}
[0m16:35:04.016442 [info ] [MainThread]: Found 11 models, 32 data tests, 5 sources, 472 macros
[0m16:35:04.016622 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'eb57e150-1f30-4aef-8685-0584bc1dc523', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a0e7e60>]}
[0m16:35:04.017018 [warn ] [MainThread]: The selection criterion 'retention' does not match any enabled nodes
[0m16:35:04.017685 [warn ] [MainThread]: Nothing to do. Try checking your model configs and model specification args
[0m16:35:04.017940 [debug] [MainThread]: Command end result
[0m16:35:04.067678 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/manifest.json
[0m16:35:04.068719 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/semantic_manifest.json
[0m16:35:04.070209 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/run_results.json
[0m16:35:04.071621 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 1.1328638, "process_in_blocks": "0", "process_kernel_time": 0.174486, "process_mem_max_rss": "140197888", "process_out_blocks": "0", "process_user_time": 1.643131}
[0m16:35:04.071873 [debug] [MainThread]: Command `dbt run` succeeded at 16:35:04.071827 after 1.13 seconds
[0m16:35:04.072052 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a1cf380>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a1ced20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a246e70>]}
[0m16:35:04.072217 [debug] [MainThread]: Flushing usage events
[0m16:35:04.199232 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m16:40:52.172911 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1072f2ae0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1126b5a00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1126b5790>]}


============================== 16:40:52.176441 | 737d1c7d-d7cc-41e4-9402-5eeab46607ec ==============================
[0m16:40:52.176441 [info ] [MainThread]: Running with dbt=1.11.4
[0m16:40:52.176772 [debug] [MainThread]: running dbt with arguments {'profiles_dir': '/Users/hazeldonaldson/.dbt', 'use_experimental_parser': 'False', 'warn_error': 'None', 'indirect_selection': 'eager', 'log_path': '/Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/logs', 'log_cache_events': 'False', 'partial_parse': 'True', 'write_json': 'True', 'version_check': 'True', 'printer_width': '80', 'quiet': 'False', 'no_print': 'None', 'introspect': 'True', 'log_format': 'default', 'cache_selected_only': 'False', 'static_parser': 'True', 'debug': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'send_anonymous_usage_stats': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'invocation_command': 'dbt run --select retention', 'target_path': 'None', 'empty': 'False'}
[0m16:40:52.395035 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '737d1c7d-d7cc-41e4-9402-5eeab46607ec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112a52420>]}
[0m16:40:52.437265 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '737d1c7d-d7cc-41e4-9402-5eeab46607ec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1124e6180>]}
[0m16:40:52.438740 [info ] [MainThread]: Registered adapter: duckdb=1.10.0
[0m16:40:52.505454 [debug] [MainThread]: checksum: 092b177ba87eb6bb3c55954c38aa57900eebac336561eb9ee32218428aa81d43, vars: {}, profile: , target: , version: 1.11.4
[0m16:40:52.575210 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m16:40:52.575514 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m16:40:52.575675 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m16:40:52.599590 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '737d1c7d-d7cc-41e4-9402-5eeab46607ec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112b47320>]}
[0m16:40:52.657570 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/manifest.json
[0m16:40:52.659422 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/semantic_manifest.json
[0m16:40:52.672174 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '737d1c7d-d7cc-41e4-9402-5eeab46607ec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112f3edb0>]}
[0m16:40:52.672450 [info ] [MainThread]: Found 11 models, 32 data tests, 5 sources, 472 macros
[0m16:40:52.672629 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '737d1c7d-d7cc-41e4-9402-5eeab46607ec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112b549b0>]}
[0m16:40:52.673035 [warn ] [MainThread]: The selection criterion 'retention' does not match any enabled nodes
[0m16:40:52.673719 [warn ] [MainThread]: Nothing to do. Try checking your model configs and model specification args
[0m16:40:52.674652 [debug] [MainThread]: Command end result
[0m16:40:52.693703 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/manifest.json
[0m16:40:52.694744 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/semantic_manifest.json
[0m16:40:52.696479 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/run_results.json
[0m16:40:52.697916 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 0.5668005, "process_in_blocks": "0", "process_kernel_time": 0.21196, "process_mem_max_rss": "131940352", "process_out_blocks": "0", "process_user_time": 1.065325}
[0m16:40:52.698166 [debug] [MainThread]: Command `dbt run` succeeded at 16:40:52.698121 after 0.57 seconds
[0m16:40:52.698360 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112b54530>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112b56480>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1126b5820>]}
[0m16:40:52.698534 [debug] [MainThread]: Flushing usage events
[0m16:40:52.836490 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m16:41:19.817524 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103022060>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104d05a60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104d05850>]}


============================== 16:41:19.820942 | df9a4b24-df2f-46b4-8019-8e32723f75e5 ==============================
[0m16:41:19.820942 [info ] [MainThread]: Running with dbt=1.11.4
[0m16:41:19.821297 [debug] [MainThread]: running dbt with arguments {'indirect_selection': 'eager', 'profiles_dir': '/Users/hazeldonaldson/.dbt', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'quiet': 'False', 'printer_width': '80', 'no_print': 'None', 'introspect': 'True', 'log_path': '/Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/logs', 'log_format': 'default', 'partial_parse': 'True', 'log_cache_events': 'False', 'fail_fast': 'False', 'write_json': 'True', 'version_check': 'True', 'static_parser': 'True', 'use_experimental_parser': 'False', 'warn_error': 'None', 'use_colors': 'True', 'empty': 'False', 'target_path': 'None', 'cache_selected_only': 'False', 'send_anonymous_usage_stats': 'True', 'invocation_command': 'dbt run --select path:models/marts/retention', 'debug': 'False'}
[0m16:41:19.980965 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'df9a4b24-df2f-46b4-8019-8e32723f75e5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104ebdbe0>]}
[0m16:41:20.010227 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'df9a4b24-df2f-46b4-8019-8e32723f75e5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10320e630>]}
[0m16:41:20.012437 [info ] [MainThread]: Registered adapter: duckdb=1.10.0
[0m16:41:20.065182 [debug] [MainThread]: checksum: 092b177ba87eb6bb3c55954c38aa57900eebac336561eb9ee32218428aa81d43, vars: {}, profile: , target: , version: 1.11.4
[0m16:41:20.129861 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m16:41:20.130126 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m16:41:20.130331 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m16:41:20.152714 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'df9a4b24-df2f-46b4-8019-8e32723f75e5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104fc6d20>]}
[0m16:41:20.200860 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/manifest.json
[0m16:41:20.202427 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/semantic_manifest.json
[0m16:41:20.215219 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'df9a4b24-df2f-46b4-8019-8e32723f75e5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1053865d0>]}
[0m16:41:20.215510 [info ] [MainThread]: Found 11 models, 32 data tests, 5 sources, 472 macros
[0m16:41:20.215688 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'df9a4b24-df2f-46b4-8019-8e32723f75e5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10535ca40>]}
[0m16:41:20.217314 [info ] [MainThread]: 
[0m16:41:20.217499 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m16:41:20.217644 [info ] [MainThread]: 
[0m16:41:20.217893 [debug] [MainThread]: Acquiring new duckdb connection 'master'
[0m16:41:20.220163 [debug] [ThreadPool]: Acquiring new duckdb connection 'list_quest_kingdom'
[0m16:41:20.249570 [debug] [ThreadPool]: Using duckdb connection "list_quest_kingdom"
[0m16:41:20.249826 [debug] [ThreadPool]: On list_quest_kingdom: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "list_quest_kingdom"} */

    
    select schema_name
    from system.information_schema.schemata
    
    where lower(catalog_name) = '"quest_kingdom"'
    
  
  
[0m16:41:20.249985 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:41:20.268736 [debug] [ThreadPool]: SQL status: OK in 0.019 seconds
[0m16:41:20.269767 [debug] [ThreadPool]: On list_quest_kingdom: Close
[0m16:41:20.270138 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_quest_kingdom, now create_quest_kingdom_main)
[0m16:41:20.270392 [debug] [ThreadPool]: Creating schema "database: "quest_kingdom"
schema: "main"
"
[0m16:41:20.274146 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m16:41:20.274354 [debug] [ThreadPool]: On create_quest_kingdom_main: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "create_quest_kingdom_main"} */

    
        select type from duckdb_databases()
        where lower(database_name)='quest_kingdom'
        and type='sqlite'
    
  
[0m16:41:20.274498 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:41:20.275269 [debug] [ThreadPool]: SQL status: OK in 0.001 seconds
[0m16:41:20.275947 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m16:41:20.276087 [debug] [ThreadPool]: On create_quest_kingdom_main: BEGIN
[0m16:41:20.276310 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m16:41:20.276439 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m16:41:20.276564 [debug] [ThreadPool]: On create_quest_kingdom_main: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "create_quest_kingdom_main"} */

    
    
        create schema if not exists "quest_kingdom"."main"
    
[0m16:41:20.276806 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m16:41:20.277190 [debug] [ThreadPool]: On create_quest_kingdom_main: COMMIT
[0m16:41:20.277325 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m16:41:20.277443 [debug] [ThreadPool]: On create_quest_kingdom_main: COMMIT
[0m16:41:20.277639 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m16:41:20.277772 [debug] [ThreadPool]: On create_quest_kingdom_main: Close
[0m16:41:20.278577 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_quest_kingdom_main, now list_quest_kingdom_main)
[0m16:41:20.281355 [debug] [ThreadPool]: Using duckdb connection "list_quest_kingdom_main"
[0m16:41:20.281532 [debug] [ThreadPool]: On list_quest_kingdom_main: BEGIN
[0m16:41:20.281665 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:41:20.281928 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m16:41:20.282064 [debug] [ThreadPool]: Using duckdb connection "list_quest_kingdom_main"
[0m16:41:20.282198 [debug] [ThreadPool]: On list_quest_kingdom_main: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "list_quest_kingdom_main"} */
select
      'quest_kingdom' as database,
      table_name as name,
      table_schema as schema,
      CASE table_type
        WHEN 'BASE TABLE' THEN 'table'
        WHEN 'VIEW' THEN 'view'
        WHEN 'LOCAL TEMPORARY' THEN 'table'
        END as type
    from system.information_schema.tables
    where lower(table_schema) = 'main'
    and lower(table_catalog) = 'quest_kingdom'
  
[0m16:41:20.292701 [debug] [ThreadPool]: SQL status: OK in 0.010 seconds
[0m16:41:20.293800 [debug] [ThreadPool]: On list_quest_kingdom_main: ROLLBACK
[0m16:41:20.294879 [debug] [ThreadPool]: Failed to rollback 'list_quest_kingdom_main'
[0m16:41:20.295043 [debug] [ThreadPool]: On list_quest_kingdom_main: Close
[0m16:41:20.295995 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'df9a4b24-df2f-46b4-8019-8e32723f75e5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105387740>]}
[0m16:41:20.296218 [debug] [MainThread]: Using duckdb connection "master"
[0m16:41:20.296348 [debug] [MainThread]: On master: BEGIN
[0m16:41:20.296466 [debug] [MainThread]: Opening a new connection, currently in state init
[0m16:41:20.296740 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m16:41:20.296874 [debug] [MainThread]: On master: COMMIT
[0m16:41:20.297037 [debug] [MainThread]: Using duckdb connection "master"
[0m16:41:20.297179 [debug] [MainThread]: On master: COMMIT
[0m16:41:20.297398 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m16:41:20.297531 [debug] [MainThread]: On master: Close
[0m16:41:20.298823 [debug] [Thread-1 (]: Began running node model.quest_kingdom.fct_daily_active_users
[0m16:41:20.299067 [info ] [Thread-1 (]: 1 of 4 START sql table model main.fct_daily_active_users ....................... [RUN]
[0m16:41:20.299270 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_quest_kingdom_main, now model.quest_kingdom.fct_daily_active_users)
[0m16:41:20.299430 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.fct_daily_active_users
[0m16:41:20.303194 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.fct_daily_active_users"
[0m16:41:20.303949 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.fct_daily_active_users
[0m16:41:20.319565 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.fct_daily_active_users"
[0m16:41:20.320306 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.fct_daily_active_users"
[0m16:41:20.320480 [debug] [Thread-1 (]: On model.quest_kingdom.fct_daily_active_users: BEGIN
[0m16:41:20.320632 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:41:20.320982 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:41:20.321130 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.fct_daily_active_users"
[0m16:41:20.321307 [debug] [Thread-1 (]: On model.quest_kingdom.fct_daily_active_users: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.fct_daily_active_users"} */

  
    
    

    create  table
      "quest_kingdom"."main"."fct_daily_active_users__dbt_tmp"
  
    as (
      

with players as (
    select * from "quest_kingdom"."main"."dim_players"
),

sessions as (
    select * from "quest_kingdom"."main"."fct_sessions"
),

--get all dates a player was active
player_activity as (
    select 
        player_id,
        session_date as activity_date,
        count(*) as sessions_that_day,
        sum(session_duration_minutes) as total_play_time_minutes,
        max(ending_level) as max_level_that_day
    from sessions 
    group by player_id, session_date 
),

--join to player attributes
final as (
    select 
        pa.player_id,
        pa.activity_date,
        pa.sessions_that_day,
        pa.total_play_time_minutes,
        pa.max_level_that_day,

        --player context
        p.installed_at,
        p.attribution_channel,
        p.country,
        p.device_type,
        p.player_segment,
        p.experiment_variant,
        p.tutorial_completed,

        --derived metrics
        datediff('day', p.installed_at, pa.activity_date) as days_since_install,

        --cohort
        date_trunc('week', p.installed_at)::date as cohort_week,
        date_trunc('month', p.installed_at)::date as cohort_month
    from player_activity pa 
    inner join players p on pa.player_id = p.player_id 
)

select * from final
    );
  
  
[0m16:41:20.350200 [debug] [Thread-1 (]: SQL status: OK in 0.029 seconds
[0m16:41:20.353677 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.fct_daily_active_users"
[0m16:41:20.353899 [debug] [Thread-1 (]: On model.quest_kingdom.fct_daily_active_users: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.fct_daily_active_users"} */
alter table "quest_kingdom"."main"."fct_daily_active_users__dbt_tmp" rename to "fct_daily_active_users"
[0m16:41:20.354561 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:41:20.362575 [debug] [Thread-1 (]: On model.quest_kingdom.fct_daily_active_users: COMMIT
[0m16:41:20.362861 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.fct_daily_active_users"
[0m16:41:20.363031 [debug] [Thread-1 (]: On model.quest_kingdom.fct_daily_active_users: COMMIT
[0m16:41:20.377635 [debug] [Thread-1 (]: SQL status: OK in 0.014 seconds
[0m16:41:20.380720 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.fct_daily_active_users"
[0m16:41:20.380940 [debug] [Thread-1 (]: On model.quest_kingdom.fct_daily_active_users: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.fct_daily_active_users"} */

      drop table if exists "quest_kingdom"."main"."fct_daily_active_users__dbt_backup" cascade
    
[0m16:41:20.381374 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:41:20.382637 [debug] [Thread-1 (]: On model.quest_kingdom.fct_daily_active_users: Close
[0m16:41:20.383664 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'df9a4b24-df2f-46b4-8019-8e32723f75e5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1057bbc50>]}
[0m16:41:20.384007 [info ] [Thread-1 (]: 1 of 4 OK created sql table model main.fct_daily_active_users .................. [[32mOK[0m in 0.08s]
[0m16:41:20.384291 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.fct_daily_active_users
[0m16:41:20.384719 [debug] [Thread-1 (]: Began running node model.quest_kingdom.rpt_cohort_retention
[0m16:41:20.384969 [info ] [Thread-1 (]: 2 of 4 START sql table model main.rpt_cohort_retention ......................... [RUN]
[0m16:41:20.385190 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.quest_kingdom.fct_daily_active_users, now model.quest_kingdom.rpt_cohort_retention)
[0m16:41:20.385354 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.rpt_cohort_retention
[0m16:41:20.387016 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.rpt_cohort_retention"
[0m16:41:20.387392 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.rpt_cohort_retention
[0m16:41:20.388986 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.rpt_cohort_retention"
[0m16:41:20.389327 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_cohort_retention"
[0m16:41:20.389530 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_cohort_retention: BEGIN
[0m16:41:20.389698 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:41:20.390138 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:41:20.390298 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_cohort_retention"
[0m16:41:20.390511 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_cohort_retention: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_cohort_retention"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_cohort_retention__dbt_tmp"
  
    as (
      

with daily_activity as (
    select * from "quest_kingdom"."main"."fct_daily_active_users"
),

--calculate weeks since install for each activity
activity_by_week as (
    select 
        player_id,
        cohort_week,
        activity_date,
        days_since_install,
        floor(days_since_install / 7) as weeks_since_install
    from daily_activity
),

--get cohort sizes
cohort_sizes as (
    select 
        cohort_week,
        count(distinct player_id) as cohort_size 
    from activity_by_week
    group by cohort_week 
),

--count active users by cohort and week
cohort_activity as (
    select 
        cohort_week,
        weeks_since_install,
        count(distinct player_id) as active_users 
    from activity_by_week
    group by cohort_week, weeks_since_install
),

--calculate retention percentages
cohort_retention as (
    select 
        ca.cohort_week,
        ca.cohort_size,
        ca.weeks_since_install,
        ca.active_users,
        round(ca.active_users::float / cs.cohort_size * 100, 2) as retention_pct
    from cohort_activity ca 
    inner join cohort_sizes cs on ca.cohort_week = cs.cohort_week
),

--pivot to wide format for easier analysis
pivoted as (
    select 
        cohort_week,
        cohort_size,

        max(case when weeks_since_install = 0 then retention_pct end) as week_0,
        max(case when weeks_since_install = 1 then retention_pct end) as week_1,
        max(case when weeks_since_install = 2 then retention_pct end) as week_2,
        max(case when weeks_since_install = 3 then retention_pct end) as week_3,
        max(case when weeks_since_install = 4 then retention_pct end) as week_4,
        max(case when weeks_since_install = 5 then retention_pct end) as week_5,
        max(case when weeks_since_install = 6 then retention_pct end) as week_6,
        max(case when weeks_since_install = 7 then retention_pct end) as week_7,
        max(case when weeks_since_install = 8 then retention_pct end) as week_8,
        max(case when weeks_since_install = 9 then retention_pct end) as week_9,
        max(case when weeks_since_install = 10 then retention_pct end) as week_10,
        max(case when weeks_since_install = 11 then retention_pct end) as week_11,
        max(case when weeks_since_install = 12 then retention_pct end) as week_12,
    from cohort_retention
    group by cohort_week, cohort_size
)

select * from pivoted 
order by cohort_week desc
    );
  
  
[0m16:41:20.395840 [debug] [Thread-1 (]: DuckDB adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_cohort_retention"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_cohort_retention__dbt_tmp"
  
    as (
      

with daily_activity as (
    select * from "quest_kingdom"."main"."fct_daily_active_users"
),

--calculate weeks since install for each activity
activity_by_week as (
    select 
        player_id,
        cohort_week,
        activity_date,
        days_since_install,
        floor(days_since_install / 7) as weeks_since_install
    from daily_activity
),

--get cohort sizes
cohort_sizes as (
    select 
        cohort_week,
        count(distinct player_id) as cohort_size 
    from activity_by_week
    group by cohort_week 
),

--count active users by cohort and week
cohort_activity as (
    select 
        cohort_week,
        weeks_since_install,
        count(distinct player_id) as active_users 
    from activity_by_week
    group by cohort_week, weeks_since_install
),

--calculate retention percentages
cohort_retention as (
    select 
        ca.cohort_week,
        ca.cohort_size,
        ca.weeks_since_install,
        ca.active_users,
        round(ca.active_users::float / cs.cohort_size * 100, 2) as retention_pct
    from cohort_activity ca 
    inner join cohort_sizes cs on ca.cohort_week = cs.cohort_week
),

--pivot to wide format for easier analysis
pivoted as (
    select 
        cohort_week,
        cohort_size,

        max(case when weeks_since_install = 0 then retention_pct end) as week_0,
        max(case when weeks_since_install = 1 then retention_pct end) as week_1,
        max(case when weeks_since_install = 2 then retention_pct end) as week_2,
        max(case when weeks_since_install = 3 then retention_pct end) as week_3,
        max(case when weeks_since_install = 4 then retention_pct end) as week_4,
        max(case when weeks_since_install = 5 then retention_pct end) as week_5,
        max(case when weeks_since_install = 6 then retention_pct end) as week_6,
        max(case when weeks_since_install = 7 then retention_pct end) as week_7,
        max(case when weeks_since_install = 8 then retention_pct end) as week_8,
        max(case when weeks_since_install = 9 then retention_pct end) as week_9,
        max(case when weeks_since_install = 10 then retention_pct end) as week_10,
        max(case when weeks_since_install = 11 then retention_pct end) as week_11,
        max(case when weeks_since_install = 12 then retention_pct end) as week_12,
    from cohort_retention
    group by cohort_week, cohort_size
)

select * from pivoted 
order by cohort_week desc
    );
  
  
[0m16:41:20.396387 [debug] [Thread-1 (]: DuckDB adapter: Rolling back transaction.
[0m16:41:20.396687 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_cohort_retention: ROLLBACK
[0m16:41:20.401339 [debug] [Thread-1 (]: Failed to rollback 'model.quest_kingdom.rpt_cohort_retention'
[0m16:41:20.401593 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_cohort_retention: Close
[0m16:41:20.402801 [debug] [Thread-1 (]: Runtime Error in model rpt_cohort_retention (models/marts/retention/rpt_cohort_retention.sql)
  Binder Error: Values list "ca" does not have a column named "cohort_size"
  
  LINE 51:         ca.cohort_size,
                   ^
[0m16:41:20.403062 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'df9a4b24-df2f-46b4-8019-8e32723f75e5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1057b86e0>]}
[0m16:41:20.403386 [error] [Thread-1 (]: 2 of 4 ERROR creating sql table model main.rpt_cohort_retention ................ [[31mERROR[0m in 0.02s]
[0m16:41:20.403656 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.rpt_cohort_retention
[0m16:41:20.403843 [debug] [Thread-1 (]: Began running node model.quest_kingdom.rpt_d1_d7_d30_retention
[0m16:41:20.404073 [debug] [Thread-4 (]: Marking all children of 'model.quest_kingdom.rpt_cohort_retention' to be skipped because of status 'error'.  Reason: Runtime Error in model rpt_cohort_retention (models/marts/retention/rpt_cohort_retention.sql)
  Binder Error: Values list "ca" does not have a column named "cohort_size"
  
  LINE 51:         ca.cohort_size,
                   ^.
[0m16:41:20.404322 [info ] [Thread-1 (]: 3 of 4 START sql table model main.rpt_d1_d7_d30_retention ...................... [RUN]
[0m16:41:20.404927 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.quest_kingdom.rpt_cohort_retention, now model.quest_kingdom.rpt_d1_d7_d30_retention)
[0m16:41:20.405091 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.rpt_d1_d7_d30_retention
[0m16:41:20.406831 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.rpt_d1_d7_d30_retention"
[0m16:41:20.407204 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.rpt_d1_d7_d30_retention
[0m16:41:20.408781 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.rpt_d1_d7_d30_retention"
[0m16:41:20.409118 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_d1_d7_d30_retention"
[0m16:41:20.409278 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_d1_d7_d30_retention: BEGIN
[0m16:41:20.409464 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:41:20.409888 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:41:20.410065 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_d1_d7_d30_retention"
[0m16:41:20.410271 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_d1_d7_d30_retention: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_d1_d7_d30_retention"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_d1_d7_d30_retention__dbt_tmp"
  
    as (
      

with players as (
    select * from "quest_kingdom"."main"."dim_players"
),

daily_activity as (
    select * from "quest_kingdom"."main"."fct_daily_active_users"
),

--for each player, chekc if they were active on D1, D7, D30
player_retention as (
    select 
        p.player_id,
        p.installed_at,
        p.attribution_channel,
        p.country,
        p.device_type,
        p.player_segment,
        p.experiment_variant,
        p.tutorial_completed,
        p.cohort_week,
        p.cohort_month,

        --D1: active on day after install
        max(case when da.days_since_install = 1 then 1 else 0 end) as retained_d1,
        -- D7: active 7 days after install
        max(case when da.days_since_install = 7 then 1 else 0 end) as retained_d7,
        -- D30: active 30 days after install
        max(case when da.days_since_install = 30 then 1 else 0 end) as retained_d30,

        --also need to track if active in ranges (should be more forgiving)
        max(case when da.days_since_install between 1 and 1 then 1 else 0 end) as active_d1_window,
        max(case when da.days_since_install between 6 and 8 then 1 else 0 end) as active_d7_window,
        max(case when da.days_since_install between 28 and 32 then 1 else 0 end) as active_d30_window,

        --total days active
        count(distinct da.activity_date) as total_active_days
    from players p 
    left join daily_activity da on p.player_id = da.player_id 
    group by 
        p.player_id, p.installed_at, p.attribution_channel, p.country,
        p.device_type, p.player_segment, p.experiment_variant,
        p.tutorial_completed, p.cohort_week, p.cohort_month 
)

select * from player_retention
    );
  
  
[0m16:41:20.445587 [debug] [Thread-1 (]: SQL status: OK in 0.035 seconds
[0m16:41:20.447972 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_d1_d7_d30_retention"
[0m16:41:20.448227 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_d1_d7_d30_retention: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_d1_d7_d30_retention"} */
alter table "quest_kingdom"."main"."rpt_d1_d7_d30_retention__dbt_tmp" rename to "rpt_d1_d7_d30_retention"
[0m16:41:20.448708 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:41:20.449550 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_d1_d7_d30_retention: COMMIT
[0m16:41:20.449738 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_d1_d7_d30_retention"
[0m16:41:20.449897 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_d1_d7_d30_retention: COMMIT
[0m16:41:20.455495 [debug] [Thread-1 (]: SQL status: OK in 0.005 seconds
[0m16:41:20.456934 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_d1_d7_d30_retention"
[0m16:41:20.457172 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_d1_d7_d30_retention: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_d1_d7_d30_retention"} */

      drop table if exists "quest_kingdom"."main"."rpt_d1_d7_d30_retention__dbt_backup" cascade
    
[0m16:41:20.457541 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:41:20.458277 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_d1_d7_d30_retention: Close
[0m16:41:20.458558 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'df9a4b24-df2f-46b4-8019-8e32723f75e5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10570ae40>]}
[0m16:41:20.458860 [info ] [Thread-1 (]: 3 of 4 OK created sql table model main.rpt_d1_d7_d30_retention ................. [[32mOK[0m in 0.05s]
[0m16:41:20.459118 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.rpt_d1_d7_d30_retention
[0m16:41:20.459308 [debug] [Thread-1 (]: Began running node model.quest_kingdom.rpt_retention_curves
[0m16:41:20.459539 [info ] [Thread-1 (]: 4 of 4 START sql table model main.rpt_retention_curves ......................... [RUN]
[0m16:41:20.459739 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.quest_kingdom.rpt_d1_d7_d30_retention, now model.quest_kingdom.rpt_retention_curves)
[0m16:41:20.459899 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.rpt_retention_curves
[0m16:41:20.461836 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.rpt_retention_curves"
[0m16:41:20.462407 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.rpt_retention_curves
[0m16:41:20.464395 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.rpt_retention_curves"
[0m16:41:20.465235 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_retention_curves"
[0m16:41:20.465464 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_retention_curves: BEGIN
[0m16:41:20.465632 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:41:20.466250 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m16:41:20.466417 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_retention_curves"
[0m16:41:20.466608 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_retention_curves: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_retention_curves"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_retention_curves__dbt_tmp"
  
    as (
      

with daily_activity as (
    select * from "quest_kingdom"."main"."fct_daily_active_users"
),

--calculate weeks since install
activity_by_week as (
    select
        player_id,
        cohort_week,
        activity_date,
        days_since_install,
        floor(days_since_install / 7) as weeks_since_install 
    from daily_activity
),

--get cohort sizes 
cohort_sizes as (
    select 
        cohort_week,
        count(distinct player_id) as cohort_size 
    from activity_by_week
    group by cohort_week
),

--countr active users by cohort and week
cohort_activity as (
    select 
        cohort_weeks,
        weeks_since_install,
        count(distinct player_id) as active_users 
    from activity_by_week
    where weeks_since_install <= 12 --only tracking the first 12 weeks
    group by cohort_week, weeks_since_install
),

--calculate retention
final as (
    select
        ca.cohort_week,
        cs.cohort_size,
        ca.weeks_since_install,
        ca.active_users,
        ca.active_users::float / cs.cohort_size as retention_rate,
        round(ca.active_users::float / cs.cohort_size * 100, 1) as retention_pct 
        --cohort label for charts
        'Cohort' || to_char(ca.cohort_week, 'YYYY-MM-DD') as cohort_label
    from cohort_activity ca 
    inner join cohort_sizes cs on ca.cohort_week = cs.cohort_week
)

select * from final
order by cohort_week, weeks_since_install
    );
  
  
[0m16:41:20.467896 [debug] [Thread-1 (]: DuckDB adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_retention_curves"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_retention_curves__dbt_tmp"
  
    as (
      

with daily_activity as (
    select * from "quest_kingdom"."main"."fct_daily_active_users"
),

--calculate weeks since install
activity_by_week as (
    select
        player_id,
        cohort_week,
        activity_date,
        days_since_install,
        floor(days_since_install / 7) as weeks_since_install 
    from daily_activity
),

--get cohort sizes 
cohort_sizes as (
    select 
        cohort_week,
        count(distinct player_id) as cohort_size 
    from activity_by_week
    group by cohort_week
),

--countr active users by cohort and week
cohort_activity as (
    select 
        cohort_weeks,
        weeks_since_install,
        count(distinct player_id) as active_users 
    from activity_by_week
    where weeks_since_install <= 12 --only tracking the first 12 weeks
    group by cohort_week, weeks_since_install
),

--calculate retention
final as (
    select
        ca.cohort_week,
        cs.cohort_size,
        ca.weeks_since_install,
        ca.active_users,
        ca.active_users::float / cs.cohort_size as retention_rate,
        round(ca.active_users::float / cs.cohort_size * 100, 1) as retention_pct 
        --cohort label for charts
        'Cohort' || to_char(ca.cohort_week, 'YYYY-MM-DD') as cohort_label
    from cohort_activity ca 
    inner join cohort_sizes cs on ca.cohort_week = cs.cohort_week
)

select * from final
order by cohort_week, weeks_since_install
    );
  
  
[0m16:41:20.468145 [debug] [Thread-1 (]: DuckDB adapter: Rolling back transaction.
[0m16:41:20.468386 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_retention_curves: ROLLBACK
[0m16:41:20.469906 [debug] [Thread-1 (]: Failed to rollback 'model.quest_kingdom.rpt_retention_curves'
[0m16:41:20.470093 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_retention_curves: Close
[0m16:41:20.471306 [debug] [Thread-1 (]: Runtime Error in model rpt_retention_curves (models/marts/retention/rpt_retention_curves.sql)
  Parser Error: syntax error at or near "'Cohort'"
  
  LINE 58:         'Cohort' || to_char(ca.cohort_week, 'YYYY-MM-DD') as cohort...
                   ^
[0m16:41:20.471567 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'df9a4b24-df2f-46b4-8019-8e32723f75e5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105a5c6b0>]}
[0m16:41:20.471890 [error] [Thread-1 (]: 4 of 4 ERROR creating sql table model main.rpt_retention_curves ................ [[31mERROR[0m in 0.01s]
[0m16:41:20.472155 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.rpt_retention_curves
[0m16:41:20.472393 [debug] [Thread-4 (]: Marking all children of 'model.quest_kingdom.rpt_retention_curves' to be skipped because of status 'error'.  Reason: Runtime Error in model rpt_retention_curves (models/marts/retention/rpt_retention_curves.sql)
  Parser Error: syntax error at or near "'Cohort'"
  
  LINE 58:         'Cohort' || to_char(ca.cohort_week, 'YYYY-MM-DD') as cohort...
                   ^.
[0m16:41:20.473002 [debug] [MainThread]: Using duckdb connection "master"
[0m16:41:20.473149 [debug] [MainThread]: On master: BEGIN
[0m16:41:20.473273 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m16:41:20.473632 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m16:41:20.473765 [debug] [MainThread]: On master: COMMIT
[0m16:41:20.473890 [debug] [MainThread]: Using duckdb connection "master"
[0m16:41:20.474004 [debug] [MainThread]: On master: COMMIT
[0m16:41:20.474202 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m16:41:20.474329 [debug] [MainThread]: On master: Close
[0m16:41:20.474499 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:41:20.474620 [debug] [MainThread]: Connection 'model.quest_kingdom.rpt_retention_curves' was properly closed.
[0m16:41:20.474799 [info ] [MainThread]: 
[0m16:41:20.474961 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 0.26 seconds (0.26s).
[0m16:41:20.475440 [debug] [MainThread]: Command end result
[0m16:41:20.527054 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/manifest.json
[0m16:41:20.528074 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/semantic_manifest.json
[0m16:41:20.531267 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/run_results.json
[0m16:41:20.531458 [info ] [MainThread]: 
[0m16:41:20.531636 [info ] [MainThread]: [31mCompleted with 2 errors, 0 partial successes, and 0 warnings:[0m
[0m16:41:20.531786 [info ] [MainThread]: 
[0m16:41:20.532002 [error] [MainThread]: [31mFailure in model rpt_cohort_retention (models/marts/retention/rpt_cohort_retention.sql)[0m
[0m16:41:20.532256 [error] [MainThread]:   Runtime Error in model rpt_cohort_retention (models/marts/retention/rpt_cohort_retention.sql)
  Binder Error: Values list "ca" does not have a column named "cohort_size"
  
  LINE 51:         ca.cohort_size,
                   ^
[0m16:41:20.532436 [info ] [MainThread]: 
[0m16:41:20.532609 [info ] [MainThread]:   compiled code at target/compiled/quest_kingdom/models/marts/retention/rpt_cohort_retention.sql
[0m16:41:20.532754 [info ] [MainThread]: 
[0m16:41:20.532917 [error] [MainThread]: [31mFailure in model rpt_retention_curves (models/marts/retention/rpt_retention_curves.sql)[0m
[0m16:41:20.533079 [error] [MainThread]:   Runtime Error in model rpt_retention_curves (models/marts/retention/rpt_retention_curves.sql)
  Parser Error: syntax error at or near "'Cohort'"
  
  LINE 58:         'Cohort' || to_char(ca.cohort_week, 'YYYY-MM-DD') as cohort...
                   ^
[0m16:41:20.533205 [info ] [MainThread]: 
[0m16:41:20.533355 [info ] [MainThread]:   compiled code at target/compiled/quest_kingdom/models/marts/retention/rpt_retention_curves.sql
[0m16:41:20.533478 [info ] [MainThread]: 
[0m16:41:20.533620 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=2 SKIP=0 NO-OP=0 TOTAL=4
[0m16:41:20.534979 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.75606096, "process_in_blocks": "0", "process_kernel_time": 0.215149, "process_mem_max_rss": "203636736", "process_out_blocks": "0", "process_user_time": 1.328239}
[0m16:41:20.535197 [debug] [MainThread]: Command `dbt run` failed at 16:41:20.535159 after 0.76 seconds
[0m16:41:20.535375 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105175580>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105175100>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105177b00>]}
[0m16:41:20.535540 [debug] [MainThread]: Flushing usage events
[0m16:41:20.682435 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m16:41:55.008755 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10554fef0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105745910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1057456d0>]}


============================== 16:41:55.012255 | 287b98d2-d7b3-4d96-8527-8376a8db02e6 ==============================
[0m16:41:55.012255 [info ] [MainThread]: Running with dbt=1.11.4
[0m16:41:55.012576 [debug] [MainThread]: running dbt with arguments {'log_format': 'default', 'log_path': '/Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/logs', 'static_parser': 'True', 'use_experimental_parser': 'False', 'send_anonymous_usage_stats': 'True', 'debug': 'False', 'indirect_selection': 'eager', 'quiet': 'False', 'version_check': 'True', 'invocation_command': 'dbt run --select path:models/marts/retention', 'partial_parse': 'True', 'fail_fast': 'False', 'write_json': 'True', 'use_colors': 'True', 'empty': 'False', 'log_cache_events': 'False', 'target_path': 'None', 'introspect': 'True', 'warn_error': 'None', 'printer_width': '80', 'cache_selected_only': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'profiles_dir': '/Users/hazeldonaldson/.dbt', 'no_print': 'None'}
[0m16:41:55.190827 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '287b98d2-d7b3-4d96-8527-8376a8db02e6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102defcb0>]}
[0m16:41:55.221176 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '287b98d2-d7b3-4d96-8527-8376a8db02e6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1059ed4f0>]}
[0m16:41:55.222825 [info ] [MainThread]: Registered adapter: duckdb=1.10.0
[0m16:41:55.279721 [debug] [MainThread]: checksum: 092b177ba87eb6bb3c55954c38aa57900eebac336561eb9ee32218428aa81d43, vars: {}, profile: , target: , version: 1.11.4
[0m16:41:55.348608 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m16:41:55.349085 [debug] [MainThread]: Partial parsing: updated file: quest_kingdom://models/marts/retention/rpt_retention_curves.sql
[0m16:41:55.549451 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '287b98d2-d7b3-4d96-8527-8376a8db02e6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105fa71a0>]}
[0m16:41:55.632813 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/manifest.json
[0m16:41:55.634148 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/semantic_manifest.json
[0m16:41:55.648247 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '287b98d2-d7b3-4d96-8527-8376a8db02e6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106045ac0>]}
[0m16:41:55.648692 [info ] [MainThread]: Found 11 models, 32 data tests, 5 sources, 472 macros
[0m16:41:55.649039 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '287b98d2-d7b3-4d96-8527-8376a8db02e6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105f86000>]}
[0m16:41:55.650997 [info ] [MainThread]: 
[0m16:41:55.651208 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m16:41:55.651361 [info ] [MainThread]: 
[0m16:41:55.651602 [debug] [MainThread]: Acquiring new duckdb connection 'master'
[0m16:41:55.653876 [debug] [ThreadPool]: Acquiring new duckdb connection 'list_quest_kingdom'
[0m16:41:55.683467 [debug] [ThreadPool]: Using duckdb connection "list_quest_kingdom"
[0m16:41:55.683733 [debug] [ThreadPool]: On list_quest_kingdom: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "list_quest_kingdom"} */

    
    select schema_name
    from system.information_schema.schemata
    
    where lower(catalog_name) = '"quest_kingdom"'
    
  
  
[0m16:41:55.683887 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:41:55.703043 [debug] [ThreadPool]: SQL status: OK in 0.019 seconds
[0m16:41:55.704190 [debug] [ThreadPool]: On list_quest_kingdom: Close
[0m16:41:55.704602 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_quest_kingdom, now create_quest_kingdom_main)
[0m16:41:55.704866 [debug] [ThreadPool]: Creating schema "database: "quest_kingdom"
schema: "main"
"
[0m16:41:55.708482 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m16:41:55.708701 [debug] [ThreadPool]: On create_quest_kingdom_main: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "create_quest_kingdom_main"} */

    
        select type from duckdb_databases()
        where lower(database_name)='quest_kingdom'
        and type='sqlite'
    
  
[0m16:41:55.708847 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:41:55.709794 [debug] [ThreadPool]: SQL status: OK in 0.001 seconds
[0m16:41:55.710652 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m16:41:55.710792 [debug] [ThreadPool]: On create_quest_kingdom_main: BEGIN
[0m16:41:55.711021 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m16:41:55.711148 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m16:41:55.711273 [debug] [ThreadPool]: On create_quest_kingdom_main: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "create_quest_kingdom_main"} */

    
    
        create schema if not exists "quest_kingdom"."main"
    
[0m16:41:55.711689 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m16:41:55.712161 [debug] [ThreadPool]: On create_quest_kingdom_main: COMMIT
[0m16:41:55.712317 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m16:41:55.712450 [debug] [ThreadPool]: On create_quest_kingdom_main: COMMIT
[0m16:41:55.712673 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m16:41:55.712811 [debug] [ThreadPool]: On create_quest_kingdom_main: Close
[0m16:41:55.713618 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_quest_kingdom_main, now list_quest_kingdom_main)
[0m16:41:55.716476 [debug] [ThreadPool]: Using duckdb connection "list_quest_kingdom_main"
[0m16:41:55.716644 [debug] [ThreadPool]: On list_quest_kingdom_main: BEGIN
[0m16:41:55.716831 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:41:55.717102 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m16:41:55.717242 [debug] [ThreadPool]: Using duckdb connection "list_quest_kingdom_main"
[0m16:41:55.717375 [debug] [ThreadPool]: On list_quest_kingdom_main: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "list_quest_kingdom_main"} */
select
      'quest_kingdom' as database,
      table_name as name,
      table_schema as schema,
      CASE table_type
        WHEN 'BASE TABLE' THEN 'table'
        WHEN 'VIEW' THEN 'view'
        WHEN 'LOCAL TEMPORARY' THEN 'table'
        END as type
    from system.information_schema.tables
    where lower(table_schema) = 'main'
    and lower(table_catalog) = 'quest_kingdom'
  
[0m16:41:55.728888 [debug] [ThreadPool]: SQL status: OK in 0.011 seconds
[0m16:41:55.730011 [debug] [ThreadPool]: On list_quest_kingdom_main: ROLLBACK
[0m16:41:55.730999 [debug] [ThreadPool]: Failed to rollback 'list_quest_kingdom_main'
[0m16:41:55.731170 [debug] [ThreadPool]: On list_quest_kingdom_main: Close
[0m16:41:55.732271 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '287b98d2-d7b3-4d96-8527-8376a8db02e6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10623a000>]}
[0m16:41:55.732525 [debug] [MainThread]: Using duckdb connection "master"
[0m16:41:55.732665 [debug] [MainThread]: On master: BEGIN
[0m16:41:55.732794 [debug] [MainThread]: Opening a new connection, currently in state init
[0m16:41:55.733094 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m16:41:55.733235 [debug] [MainThread]: On master: COMMIT
[0m16:41:55.733370 [debug] [MainThread]: Using duckdb connection "master"
[0m16:41:55.733489 [debug] [MainThread]: On master: COMMIT
[0m16:41:55.733686 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m16:41:55.733816 [debug] [MainThread]: On master: Close
[0m16:41:55.735190 [debug] [Thread-1 (]: Began running node model.quest_kingdom.fct_daily_active_users
[0m16:41:55.735458 [info ] [Thread-1 (]: 1 of 4 START sql table model main.fct_daily_active_users ....................... [RUN]
[0m16:41:55.735682 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_quest_kingdom_main, now model.quest_kingdom.fct_daily_active_users)
[0m16:41:55.735852 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.fct_daily_active_users
[0m16:41:55.740069 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.fct_daily_active_users"
[0m16:41:55.740849 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.fct_daily_active_users
[0m16:41:55.758431 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.fct_daily_active_users"
[0m16:41:55.758992 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.fct_daily_active_users"
[0m16:41:55.759226 [debug] [Thread-1 (]: On model.quest_kingdom.fct_daily_active_users: BEGIN
[0m16:41:55.759390 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:41:55.759762 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:41:55.759912 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.fct_daily_active_users"
[0m16:41:55.760090 [debug] [Thread-1 (]: On model.quest_kingdom.fct_daily_active_users: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.fct_daily_active_users"} */

  
    
    

    create  table
      "quest_kingdom"."main"."fct_daily_active_users__dbt_tmp"
  
    as (
      

with players as (
    select * from "quest_kingdom"."main"."dim_players"
),

sessions as (
    select * from "quest_kingdom"."main"."fct_sessions"
),

--get all dates a player was active
player_activity as (
    select 
        player_id,
        session_date as activity_date,
        count(*) as sessions_that_day,
        sum(session_duration_minutes) as total_play_time_minutes,
        max(ending_level) as max_level_that_day
    from sessions 
    group by player_id, session_date 
),

--join to player attributes
final as (
    select 
        pa.player_id,
        pa.activity_date,
        pa.sessions_that_day,
        pa.total_play_time_minutes,
        pa.max_level_that_day,

        --player context
        p.installed_at,
        p.attribution_channel,
        p.country,
        p.device_type,
        p.player_segment,
        p.experiment_variant,
        p.tutorial_completed,

        --derived metrics
        datediff('day', p.installed_at, pa.activity_date) as days_since_install,

        --cohort
        date_trunc('week', p.installed_at)::date as cohort_week,
        date_trunc('month', p.installed_at)::date as cohort_month
    from player_activity pa 
    inner join players p on pa.player_id = p.player_id 
)

select * from final
    );
  
  
[0m16:41:55.794389 [debug] [Thread-1 (]: SQL status: OK in 0.034 seconds
[0m16:41:55.797472 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.fct_daily_active_users"
[0m16:41:55.797688 [debug] [Thread-1 (]: On model.quest_kingdom.fct_daily_active_users: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.fct_daily_active_users"} */

    SELECT index_name
    FROM duckdb_indexes()
    WHERE schema_name = 'main'
      AND table_name = 'fct_daily_active_users'
  
[0m16:41:55.798228 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:41:55.798867 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.fct_daily_active_users"
[0m16:41:55.799041 [debug] [Thread-1 (]: On model.quest_kingdom.fct_daily_active_users: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.fct_daily_active_users"} */

    SELECT COUNT(*) as remaining_indexes
    FROM duckdb_indexes()
    WHERE schema_name = 'main'
      AND table_name = 'fct_daily_active_users'
  
[0m16:41:55.800103 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m16:41:55.803335 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.fct_daily_active_users"
[0m16:41:55.803535 [debug] [Thread-1 (]: On model.quest_kingdom.fct_daily_active_users: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.fct_daily_active_users"} */
alter table "quest_kingdom"."main"."fct_daily_active_users" rename to "fct_daily_active_users__dbt_backup"
[0m16:41:55.804479 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m16:41:55.805952 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.fct_daily_active_users"
[0m16:41:55.806124 [debug] [Thread-1 (]: On model.quest_kingdom.fct_daily_active_users: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.fct_daily_active_users"} */
alter table "quest_kingdom"."main"."fct_daily_active_users__dbt_tmp" rename to "fct_daily_active_users"
[0m16:41:55.806433 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:41:55.814246 [debug] [Thread-1 (]: On model.quest_kingdom.fct_daily_active_users: COMMIT
[0m16:41:55.814524 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.fct_daily_active_users"
[0m16:41:55.814693 [debug] [Thread-1 (]: On model.quest_kingdom.fct_daily_active_users: COMMIT
[0m16:41:55.827318 [debug] [Thread-1 (]: SQL status: OK in 0.012 seconds
[0m16:41:55.830305 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.fct_daily_active_users"
[0m16:41:55.830504 [debug] [Thread-1 (]: On model.quest_kingdom.fct_daily_active_users: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.fct_daily_active_users"} */

      drop table if exists "quest_kingdom"."main"."fct_daily_active_users__dbt_backup" cascade
    
[0m16:41:55.831538 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m16:41:55.832712 [debug] [Thread-1 (]: On model.quest_kingdom.fct_daily_active_users: Close
[0m16:41:55.833653 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '287b98d2-d7b3-4d96-8527-8376a8db02e6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1049be930>]}
[0m16:41:55.833965 [info ] [Thread-1 (]: 1 of 4 OK created sql table model main.fct_daily_active_users .................. [[32mOK[0m in 0.10s]
[0m16:41:55.834245 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.fct_daily_active_users
[0m16:41:55.834641 [debug] [Thread-1 (]: Began running node model.quest_kingdom.rpt_cohort_retention
[0m16:41:55.834871 [info ] [Thread-1 (]: 2 of 4 START sql table model main.rpt_cohort_retention ......................... [RUN]
[0m16:41:55.835065 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.quest_kingdom.fct_daily_active_users, now model.quest_kingdom.rpt_cohort_retention)
[0m16:41:55.835227 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.rpt_cohort_retention
[0m16:41:55.836832 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.rpt_cohort_retention"
[0m16:41:55.837508 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.rpt_cohort_retention
[0m16:41:55.839147 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.rpt_cohort_retention"
[0m16:41:55.839473 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_cohort_retention"
[0m16:41:55.839635 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_cohort_retention: BEGIN
[0m16:41:55.839780 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:41:55.840117 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:41:55.840270 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_cohort_retention"
[0m16:41:55.840473 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_cohort_retention: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_cohort_retention"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_cohort_retention__dbt_tmp"
  
    as (
      

with daily_activity as (
    select * from "quest_kingdom"."main"."fct_daily_active_users"
),

--calculate weeks since install for each activity
activity_by_week as (
    select 
        player_id,
        cohort_week,
        activity_date,
        days_since_install,
        floor(days_since_install / 7) as weeks_since_install
    from daily_activity
),

--get cohort sizes
cohort_sizes as (
    select 
        cohort_week,
        count(distinct player_id) as cohort_size 
    from activity_by_week
    group by cohort_week 
),

--count active users by cohort and week
cohort_activity as (
    select 
        cohort_week,
        weeks_since_install,
        count(distinct player_id) as active_users 
    from activity_by_week
    group by cohort_week, weeks_since_install
),

--calculate retention percentages
cohort_retention as (
    select 
        ca.cohort_week,
        ca.cohort_size,
        ca.weeks_since_install,
        ca.active_users,
        round(ca.active_users::float / cs.cohort_size * 100, 2) as retention_pct
    from cohort_activity ca 
    inner join cohort_sizes cs on ca.cohort_week = cs.cohort_week
),

--pivot to wide format for easier analysis
pivoted as (
    select 
        cohort_week,
        cohort_size,

        max(case when weeks_since_install = 0 then retention_pct end) as week_0,
        max(case when weeks_since_install = 1 then retention_pct end) as week_1,
        max(case when weeks_since_install = 2 then retention_pct end) as week_2,
        max(case when weeks_since_install = 3 then retention_pct end) as week_3,
        max(case when weeks_since_install = 4 then retention_pct end) as week_4,
        max(case when weeks_since_install = 5 then retention_pct end) as week_5,
        max(case when weeks_since_install = 6 then retention_pct end) as week_6,
        max(case when weeks_since_install = 7 then retention_pct end) as week_7,
        max(case when weeks_since_install = 8 then retention_pct end) as week_8,
        max(case when weeks_since_install = 9 then retention_pct end) as week_9,
        max(case when weeks_since_install = 10 then retention_pct end) as week_10,
        max(case when weeks_since_install = 11 then retention_pct end) as week_11,
        max(case when weeks_since_install = 12 then retention_pct end) as week_12,
    from cohort_retention
    group by cohort_week, cohort_size
)

select * from pivoted 
order by cohort_week desc
    );
  
  
[0m16:41:55.845223 [debug] [Thread-1 (]: DuckDB adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_cohort_retention"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_cohort_retention__dbt_tmp"
  
    as (
      

with daily_activity as (
    select * from "quest_kingdom"."main"."fct_daily_active_users"
),

--calculate weeks since install for each activity
activity_by_week as (
    select 
        player_id,
        cohort_week,
        activity_date,
        days_since_install,
        floor(days_since_install / 7) as weeks_since_install
    from daily_activity
),

--get cohort sizes
cohort_sizes as (
    select 
        cohort_week,
        count(distinct player_id) as cohort_size 
    from activity_by_week
    group by cohort_week 
),

--count active users by cohort and week
cohort_activity as (
    select 
        cohort_week,
        weeks_since_install,
        count(distinct player_id) as active_users 
    from activity_by_week
    group by cohort_week, weeks_since_install
),

--calculate retention percentages
cohort_retention as (
    select 
        ca.cohort_week,
        ca.cohort_size,
        ca.weeks_since_install,
        ca.active_users,
        round(ca.active_users::float / cs.cohort_size * 100, 2) as retention_pct
    from cohort_activity ca 
    inner join cohort_sizes cs on ca.cohort_week = cs.cohort_week
),

--pivot to wide format for easier analysis
pivoted as (
    select 
        cohort_week,
        cohort_size,

        max(case when weeks_since_install = 0 then retention_pct end) as week_0,
        max(case when weeks_since_install = 1 then retention_pct end) as week_1,
        max(case when weeks_since_install = 2 then retention_pct end) as week_2,
        max(case when weeks_since_install = 3 then retention_pct end) as week_3,
        max(case when weeks_since_install = 4 then retention_pct end) as week_4,
        max(case when weeks_since_install = 5 then retention_pct end) as week_5,
        max(case when weeks_since_install = 6 then retention_pct end) as week_6,
        max(case when weeks_since_install = 7 then retention_pct end) as week_7,
        max(case when weeks_since_install = 8 then retention_pct end) as week_8,
        max(case when weeks_since_install = 9 then retention_pct end) as week_9,
        max(case when weeks_since_install = 10 then retention_pct end) as week_10,
        max(case when weeks_since_install = 11 then retention_pct end) as week_11,
        max(case when weeks_since_install = 12 then retention_pct end) as week_12,
    from cohort_retention
    group by cohort_week, cohort_size
)

select * from pivoted 
order by cohort_week desc
    );
  
  
[0m16:41:55.845590 [debug] [Thread-1 (]: DuckDB adapter: Rolling back transaction.
[0m16:41:55.845830 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_cohort_retention: ROLLBACK
[0m16:41:55.850264 [debug] [Thread-1 (]: Failed to rollback 'model.quest_kingdom.rpt_cohort_retention'
[0m16:41:55.850470 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_cohort_retention: Close
[0m16:41:55.851670 [debug] [Thread-1 (]: Runtime Error in model rpt_cohort_retention (models/marts/retention/rpt_cohort_retention.sql)
  Binder Error: Values list "ca" does not have a column named "cohort_size"
  
  LINE 51:         ca.cohort_size,
                   ^
[0m16:41:55.851916 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '287b98d2-d7b3-4d96-8527-8376a8db02e6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10624abd0>]}
[0m16:41:55.852225 [error] [Thread-1 (]: 2 of 4 ERROR creating sql table model main.rpt_cohort_retention ................ [[31mERROR[0m in 0.02s]
[0m16:41:55.852489 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.rpt_cohort_retention
[0m16:41:55.852675 [debug] [Thread-1 (]: Began running node model.quest_kingdom.rpt_d1_d7_d30_retention
[0m16:41:55.852897 [debug] [Thread-4 (]: Marking all children of 'model.quest_kingdom.rpt_cohort_retention' to be skipped because of status 'error'.  Reason: Runtime Error in model rpt_cohort_retention (models/marts/retention/rpt_cohort_retention.sql)
  Binder Error: Values list "ca" does not have a column named "cohort_size"
  
  LINE 51:         ca.cohort_size,
                   ^.
[0m16:41:55.853113 [info ] [Thread-1 (]: 3 of 4 START sql table model main.rpt_d1_d7_d30_retention ...................... [RUN]
[0m16:41:55.853649 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.quest_kingdom.rpt_cohort_retention, now model.quest_kingdom.rpt_d1_d7_d30_retention)
[0m16:41:55.853830 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.rpt_d1_d7_d30_retention
[0m16:41:55.855700 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.rpt_d1_d7_d30_retention"
[0m16:41:55.856135 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.rpt_d1_d7_d30_retention
[0m16:41:55.857909 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.rpt_d1_d7_d30_retention"
[0m16:41:55.858312 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_d1_d7_d30_retention"
[0m16:41:55.861997 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_d1_d7_d30_retention: BEGIN
[0m16:41:55.862172 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:41:55.862577 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:41:55.862744 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_d1_d7_d30_retention"
[0m16:41:55.862936 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_d1_d7_d30_retention: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_d1_d7_d30_retention"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_d1_d7_d30_retention__dbt_tmp"
  
    as (
      

with players as (
    select * from "quest_kingdom"."main"."dim_players"
),

daily_activity as (
    select * from "quest_kingdom"."main"."fct_daily_active_users"
),

--for each player, chekc if they were active on D1, D7, D30
player_retention as (
    select 
        p.player_id,
        p.installed_at,
        p.attribution_channel,
        p.country,
        p.device_type,
        p.player_segment,
        p.experiment_variant,
        p.tutorial_completed,
        p.cohort_week,
        p.cohort_month,

        --D1: active on day after install
        max(case when da.days_since_install = 1 then 1 else 0 end) as retained_d1,
        -- D7: active 7 days after install
        max(case when da.days_since_install = 7 then 1 else 0 end) as retained_d7,
        -- D30: active 30 days after install
        max(case when da.days_since_install = 30 then 1 else 0 end) as retained_d30,

        --also need to track if active in ranges (should be more forgiving)
        max(case when da.days_since_install between 1 and 1 then 1 else 0 end) as active_d1_window,
        max(case when da.days_since_install between 6 and 8 then 1 else 0 end) as active_d7_window,
        max(case when da.days_since_install between 28 and 32 then 1 else 0 end) as active_d30_window,

        --total days active
        count(distinct da.activity_date) as total_active_days
    from players p 
    left join daily_activity da on p.player_id = da.player_id 
    group by 
        p.player_id, p.installed_at, p.attribution_channel, p.country,
        p.device_type, p.player_segment, p.experiment_variant,
        p.tutorial_completed, p.cohort_week, p.cohort_month 
)

select * from player_retention
    );
  
  
[0m16:41:55.886325 [debug] [Thread-1 (]: SQL status: OK in 0.023 seconds
[0m16:41:55.887056 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_d1_d7_d30_retention"
[0m16:41:55.887241 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_d1_d7_d30_retention: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_d1_d7_d30_retention"} */

    SELECT index_name
    FROM duckdb_indexes()
    WHERE schema_name = 'main'
      AND table_name = 'rpt_d1_d7_d30_retention'
  
[0m16:41:55.887796 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:41:55.888486 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_d1_d7_d30_retention"
[0m16:41:55.888669 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_d1_d7_d30_retention: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_d1_d7_d30_retention"} */

    SELECT COUNT(*) as remaining_indexes
    FROM duckdb_indexes()
    WHERE schema_name = 'main'
      AND table_name = 'rpt_d1_d7_d30_retention'
  
[0m16:41:55.889108 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:41:55.891655 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_d1_d7_d30_retention"
[0m16:41:55.891839 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_d1_d7_d30_retention: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_d1_d7_d30_retention"} */
alter table "quest_kingdom"."main"."rpt_d1_d7_d30_retention" rename to "rpt_d1_d7_d30_retention__dbt_backup"
[0m16:41:55.892158 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:41:55.893485 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_d1_d7_d30_retention"
[0m16:41:55.893652 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_d1_d7_d30_retention: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_d1_d7_d30_retention"} */
alter table "quest_kingdom"."main"."rpt_d1_d7_d30_retention__dbt_tmp" rename to "rpt_d1_d7_d30_retention"
[0m16:41:55.893927 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:41:55.894664 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_d1_d7_d30_retention: COMMIT
[0m16:41:55.894818 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_d1_d7_d30_retention"
[0m16:41:55.894957 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_d1_d7_d30_retention: COMMIT
[0m16:41:55.898148 [debug] [Thread-1 (]: SQL status: OK in 0.003 seconds
[0m16:41:55.899361 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_d1_d7_d30_retention"
[0m16:41:55.899538 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_d1_d7_d30_retention: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_d1_d7_d30_retention"} */

      drop table if exists "quest_kingdom"."main"."rpt_d1_d7_d30_retention__dbt_backup" cascade
    
[0m16:41:55.899958 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:41:55.900586 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_d1_d7_d30_retention: Close
[0m16:41:55.900843 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '287b98d2-d7b3-4d96-8527-8376a8db02e6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106397f80>]}
[0m16:41:55.901132 [info ] [Thread-1 (]: 3 of 4 OK created sql table model main.rpt_d1_d7_d30_retention ................. [[32mOK[0m in 0.05s]
[0m16:41:55.901392 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.rpt_d1_d7_d30_retention
[0m16:41:55.901578 [debug] [Thread-1 (]: Began running node model.quest_kingdom.rpt_retention_curves
[0m16:41:55.901804 [info ] [Thread-1 (]: 4 of 4 START sql table model main.rpt_retention_curves ......................... [RUN]
[0m16:41:55.901994 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.quest_kingdom.rpt_d1_d7_d30_retention, now model.quest_kingdom.rpt_retention_curves)
[0m16:41:55.902159 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.rpt_retention_curves
[0m16:41:55.903744 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.rpt_retention_curves"
[0m16:41:55.904283 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.rpt_retention_curves
[0m16:41:55.906070 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.rpt_retention_curves"
[0m16:41:55.906440 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_retention_curves"
[0m16:41:55.906610 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_retention_curves: BEGIN
[0m16:41:55.906758 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:41:55.907100 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:41:55.907252 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_retention_curves"
[0m16:41:55.907438 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_retention_curves: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_retention_curves"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_retention_curves__dbt_tmp"
  
    as (
      

with daily_activity as (
    select * from "quest_kingdom"."main"."fct_daily_active_users"
),

--calculate weeks since install
activity_by_week as (
    select
        player_id,
        cohort_week,
        activity_date,
        days_since_install,
        floor(days_since_install / 7) as weeks_since_install 
    from daily_activity
),

--get cohort sizes 
cohort_sizes as (
    select 
        cohort_week,
        count(distinct player_id) as cohort_size 
    from activity_by_week
    group by cohort_week
),

--countr active users by cohort and week
cohort_activity as (
    select 
        cohort_weeks,
        weeks_since_install,
        count(distinct player_id) as active_users 
    from activity_by_week
    where weeks_since_install <= 12 --only tracking the first 12 weeks
    group by cohort_week, weeks_since_install
),

--calculate retention
final as (
    select
        ca.cohort_week,
        cs.cohort_size,
        ca.weeks_since_install,
        ca.active_users,
        ca.active_users::float / cs.cohort_size as retention_rate,
        round(ca.active_users::float / cs.cohort_size * 100, 1) as retention_pct,
        --cohort label for charts
        'Cohort' || to_char(ca.cohort_week, 'YYYY-MM-DD') as cohort_label
    from cohort_activity ca 
    inner join cohort_sizes cs on ca.cohort_week = cs.cohort_week
)

select * from final
order by cohort_week, weeks_since_install
    );
  
  
[0m16:41:55.908318 [debug] [Thread-1 (]: DuckDB adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_retention_curves"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_retention_curves__dbt_tmp"
  
    as (
      

with daily_activity as (
    select * from "quest_kingdom"."main"."fct_daily_active_users"
),

--calculate weeks since install
activity_by_week as (
    select
        player_id,
        cohort_week,
        activity_date,
        days_since_install,
        floor(days_since_install / 7) as weeks_since_install 
    from daily_activity
),

--get cohort sizes 
cohort_sizes as (
    select 
        cohort_week,
        count(distinct player_id) as cohort_size 
    from activity_by_week
    group by cohort_week
),

--countr active users by cohort and week
cohort_activity as (
    select 
        cohort_weeks,
        weeks_since_install,
        count(distinct player_id) as active_users 
    from activity_by_week
    where weeks_since_install <= 12 --only tracking the first 12 weeks
    group by cohort_week, weeks_since_install
),

--calculate retention
final as (
    select
        ca.cohort_week,
        cs.cohort_size,
        ca.weeks_since_install,
        ca.active_users,
        ca.active_users::float / cs.cohort_size as retention_rate,
        round(ca.active_users::float / cs.cohort_size * 100, 1) as retention_pct,
        --cohort label for charts
        'Cohort' || to_char(ca.cohort_week, 'YYYY-MM-DD') as cohort_label
    from cohort_activity ca 
    inner join cohort_sizes cs on ca.cohort_week = cs.cohort_week
)

select * from final
order by cohort_week, weeks_since_install
    );
  
  
[0m16:41:55.908534 [debug] [Thread-1 (]: DuckDB adapter: Rolling back transaction.
[0m16:41:55.908744 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_retention_curves: ROLLBACK
[0m16:41:55.910284 [debug] [Thread-1 (]: Failed to rollback 'model.quest_kingdom.rpt_retention_curves'
[0m16:41:55.910493 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_retention_curves: Close
[0m16:41:55.911962 [debug] [Thread-1 (]: Runtime Error in model rpt_retention_curves (models/marts/retention/rpt_retention_curves.sql)
  Binder Error: Referenced column "cohort_weeks" not found in FROM clause!
  Candidate bindings: "cohort_week", "activity_date"
  
  LINE 40:         cohort_weeks,
                   ^
[0m16:41:55.912322 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '287b98d2-d7b3-4d96-8527-8376a8db02e6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106235e20>]}
[0m16:41:55.912672 [error] [Thread-1 (]: 4 of 4 ERROR creating sql table model main.rpt_retention_curves ................ [[31mERROR[0m in 0.01s]
[0m16:41:55.912950 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.rpt_retention_curves
[0m16:41:55.913203 [debug] [Thread-4 (]: Marking all children of 'model.quest_kingdom.rpt_retention_curves' to be skipped because of status 'error'.  Reason: Runtime Error in model rpt_retention_curves (models/marts/retention/rpt_retention_curves.sql)
  Binder Error: Referenced column "cohort_weeks" not found in FROM clause!
  Candidate bindings: "cohort_week", "activity_date"
  
  LINE 40:         cohort_weeks,
                   ^.
[0m16:41:55.913856 [debug] [MainThread]: Using duckdb connection "master"
[0m16:41:55.914016 [debug] [MainThread]: On master: BEGIN
[0m16:41:55.914138 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m16:41:55.914474 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m16:41:55.914610 [debug] [MainThread]: On master: COMMIT
[0m16:41:55.914736 [debug] [MainThread]: Using duckdb connection "master"
[0m16:41:55.914857 [debug] [MainThread]: On master: COMMIT
[0m16:41:55.915057 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m16:41:55.915187 [debug] [MainThread]: On master: Close
[0m16:41:55.915357 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:41:55.915482 [debug] [MainThread]: Connection 'model.quest_kingdom.rpt_retention_curves' was properly closed.
[0m16:41:55.915649 [info ] [MainThread]: 
[0m16:41:55.915792 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 0.26 seconds (0.26s).
[0m16:41:55.916362 [debug] [MainThread]: Command end result
[0m16:41:55.932770 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/manifest.json
[0m16:41:55.933839 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/semantic_manifest.json
[0m16:41:55.936764 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/run_results.json
[0m16:41:55.936926 [info ] [MainThread]: 
[0m16:41:55.937101 [info ] [MainThread]: [31mCompleted with 2 errors, 0 partial successes, and 0 warnings:[0m
[0m16:41:55.937242 [info ] [MainThread]: 
[0m16:41:55.937475 [error] [MainThread]: [31mFailure in model rpt_cohort_retention (models/marts/retention/rpt_cohort_retention.sql)[0m
[0m16:41:55.937675 [error] [MainThread]:   Runtime Error in model rpt_cohort_retention (models/marts/retention/rpt_cohort_retention.sql)
  Binder Error: Values list "ca" does not have a column named "cohort_size"
  
  LINE 51:         ca.cohort_size,
                   ^
[0m16:41:55.937817 [info ] [MainThread]: 
[0m16:41:55.937976 [info ] [MainThread]:   compiled code at target/compiled/quest_kingdom/models/marts/retention/rpt_cohort_retention.sql
[0m16:41:55.938112 [info ] [MainThread]: 
[0m16:41:55.938266 [error] [MainThread]: [31mFailure in model rpt_retention_curves (models/marts/retention/rpt_retention_curves.sql)[0m
[0m16:41:55.938425 [error] [MainThread]:   Runtime Error in model rpt_retention_curves (models/marts/retention/rpt_retention_curves.sql)
  Binder Error: Referenced column "cohort_weeks" not found in FROM clause!
  Candidate bindings: "cohort_week", "activity_date"
  
  LINE 40:         cohort_weeks,
                   ^
[0m16:41:55.938549 [info ] [MainThread]: 
[0m16:41:55.938697 [info ] [MainThread]:   compiled code at target/compiled/quest_kingdom/models/marts/retention/rpt_retention_curves.sql
[0m16:41:55.938819 [info ] [MainThread]: 
[0m16:41:55.938961 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=2 SKIP=0 NO-OP=0 TOTAL=4
[0m16:41:55.940373 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.969867, "process_in_blocks": "0", "process_kernel_time": 0.208923, "process_mem_max_rss": "208764928", "process_out_blocks": "0", "process_user_time": 1.432163}
[0m16:41:55.940585 [debug] [MainThread]: Command `dbt run` failed at 16:41:55.940547 after 0.97 seconds
[0m16:41:55.940763 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104b6c2c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105cf3cb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105d8e870>]}
[0m16:41:55.940934 [debug] [MainThread]: Flushing usage events
[0m16:41:56.044895 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m16:42:17.612119 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1063dadb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106b49940>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106b49700>]}


============================== 16:42:17.615490 | 8c0320be-7700-4333-9bfa-f57c288c5f13 ==============================
[0m16:42:17.615490 [info ] [MainThread]: Running with dbt=1.11.4
[0m16:42:17.615816 [debug] [MainThread]: running dbt with arguments {'indirect_selection': 'eager', 'cache_selected_only': 'False', 'printer_width': '80', 'write_json': 'True', 'target_path': 'None', 'invocation_command': 'dbt run --select path:models/marts/retention', 'introspect': 'True', 'use_experimental_parser': 'False', 'warn_error': 'None', 'log_path': '/Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/logs', 'send_anonymous_usage_stats': 'True', 'no_print': 'None', 'log_format': 'default', 'version_check': 'True', 'empty': 'False', 'fail_fast': 'False', 'profiles_dir': '/Users/hazeldonaldson/.dbt', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_cache_events': 'False', 'partial_parse': 'True', 'debug': 'False', 'quiet': 'False', 'use_colors': 'True'}
[0m16:42:17.787402 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '8c0320be-7700-4333-9bfa-f57c288c5f13', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106bd5820>]}
[0m16:42:17.817930 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '8c0320be-7700-4333-9bfa-f57c288c5f13', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106952d50>]}
[0m16:42:17.819578 [info ] [MainThread]: Registered adapter: duckdb=1.10.0
[0m16:42:17.873988 [debug] [MainThread]: checksum: 092b177ba87eb6bb3c55954c38aa57900eebac336561eb9ee32218428aa81d43, vars: {}, profile: , target: , version: 1.11.4
[0m16:42:17.945278 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m16:42:17.945721 [debug] [MainThread]: Partial parsing: updated file: quest_kingdom://models/marts/retention/rpt_retention_curves.sql
[0m16:42:18.138338 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '8c0320be-7700-4333-9bfa-f57c288c5f13', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112b77260>]}
[0m16:42:18.218468 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/manifest.json
[0m16:42:18.219779 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/semantic_manifest.json
[0m16:42:18.232069 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '8c0320be-7700-4333-9bfa-f57c288c5f13', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112c285c0>]}
[0m16:42:18.232361 [info ] [MainThread]: Found 11 models, 32 data tests, 5 sources, 472 macros
[0m16:42:18.232539 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8c0320be-7700-4333-9bfa-f57c288c5f13', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112dc2900>]}
[0m16:42:18.234156 [info ] [MainThread]: 
[0m16:42:18.234342 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m16:42:18.234480 [info ] [MainThread]: 
[0m16:42:18.234709 [debug] [MainThread]: Acquiring new duckdb connection 'master'
[0m16:42:18.236897 [debug] [ThreadPool]: Acquiring new duckdb connection 'list_quest_kingdom'
[0m16:42:18.263935 [debug] [ThreadPool]: Using duckdb connection "list_quest_kingdom"
[0m16:42:18.264178 [debug] [ThreadPool]: On list_quest_kingdom: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "list_quest_kingdom"} */

    
    select schema_name
    from system.information_schema.schemata
    
    where lower(catalog_name) = '"quest_kingdom"'
    
  
  
[0m16:42:18.264601 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:42:18.283514 [debug] [ThreadPool]: SQL status: OK in 0.019 seconds
[0m16:42:18.284493 [debug] [ThreadPool]: On list_quest_kingdom: Close
[0m16:42:18.284847 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_quest_kingdom, now create_quest_kingdom_main)
[0m16:42:18.285084 [debug] [ThreadPool]: Creating schema "database: "quest_kingdom"
schema: "main"
"
[0m16:42:18.288413 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m16:42:18.288600 [debug] [ThreadPool]: On create_quest_kingdom_main: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "create_quest_kingdom_main"} */

    
        select type from duckdb_databases()
        where lower(database_name)='quest_kingdom'
        and type='sqlite'
    
  
[0m16:42:18.288740 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:42:18.289702 [debug] [ThreadPool]: SQL status: OK in 0.001 seconds
[0m16:42:18.290586 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m16:42:18.290729 [debug] [ThreadPool]: On create_quest_kingdom_main: BEGIN
[0m16:42:18.290953 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m16:42:18.291079 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m16:42:18.291206 [debug] [ThreadPool]: On create_quest_kingdom_main: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "create_quest_kingdom_main"} */

    
    
        create schema if not exists "quest_kingdom"."main"
    
[0m16:42:18.291612 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m16:42:18.291997 [debug] [ThreadPool]: On create_quest_kingdom_main: COMMIT
[0m16:42:18.292135 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m16:42:18.292256 [debug] [ThreadPool]: On create_quest_kingdom_main: COMMIT
[0m16:42:18.292447 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m16:42:18.292577 [debug] [ThreadPool]: On create_quest_kingdom_main: Close
[0m16:42:18.293325 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_quest_kingdom_main, now list_quest_kingdom_main)
[0m16:42:18.296034 [debug] [ThreadPool]: Using duckdb connection "list_quest_kingdom_main"
[0m16:42:18.296193 [debug] [ThreadPool]: On list_quest_kingdom_main: BEGIN
[0m16:42:18.296371 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:42:18.296610 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m16:42:18.296739 [debug] [ThreadPool]: Using duckdb connection "list_quest_kingdom_main"
[0m16:42:18.296871 [debug] [ThreadPool]: On list_quest_kingdom_main: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "list_quest_kingdom_main"} */
select
      'quest_kingdom' as database,
      table_name as name,
      table_schema as schema,
      CASE table_type
        WHEN 'BASE TABLE' THEN 'table'
        WHEN 'VIEW' THEN 'view'
        WHEN 'LOCAL TEMPORARY' THEN 'table'
        END as type
    from system.information_schema.tables
    where lower(table_schema) = 'main'
    and lower(table_catalog) = 'quest_kingdom'
  
[0m16:42:18.307858 [debug] [ThreadPool]: SQL status: OK in 0.011 seconds
[0m16:42:18.308836 [debug] [ThreadPool]: On list_quest_kingdom_main: ROLLBACK
[0m16:42:18.309789 [debug] [ThreadPool]: Failed to rollback 'list_quest_kingdom_main'
[0m16:42:18.309937 [debug] [ThreadPool]: On list_quest_kingdom_main: Close
[0m16:42:18.311171 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8c0320be-7700-4333-9bfa-f57c288c5f13', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1128d3bf0>]}
[0m16:42:18.311399 [debug] [MainThread]: Using duckdb connection "master"
[0m16:42:18.311532 [debug] [MainThread]: On master: BEGIN
[0m16:42:18.311652 [debug] [MainThread]: Opening a new connection, currently in state init
[0m16:42:18.311906 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m16:42:18.312035 [debug] [MainThread]: On master: COMMIT
[0m16:42:18.312157 [debug] [MainThread]: Using duckdb connection "master"
[0m16:42:18.312273 [debug] [MainThread]: On master: COMMIT
[0m16:42:18.312472 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m16:42:18.312595 [debug] [MainThread]: On master: Close
[0m16:42:18.313778 [debug] [Thread-1 (]: Began running node model.quest_kingdom.fct_daily_active_users
[0m16:42:18.314035 [info ] [Thread-1 (]: 1 of 4 START sql table model main.fct_daily_active_users ....................... [RUN]
[0m16:42:18.314251 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_quest_kingdom_main, now model.quest_kingdom.fct_daily_active_users)
[0m16:42:18.314416 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.fct_daily_active_users
[0m16:42:18.318207 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.fct_daily_active_users"
[0m16:42:18.318589 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.fct_daily_active_users
[0m16:42:18.334894 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.fct_daily_active_users"
[0m16:42:18.335432 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.fct_daily_active_users"
[0m16:42:18.335612 [debug] [Thread-1 (]: On model.quest_kingdom.fct_daily_active_users: BEGIN
[0m16:42:18.335765 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:42:18.336131 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:42:18.336278 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.fct_daily_active_users"
[0m16:42:18.336455 [debug] [Thread-1 (]: On model.quest_kingdom.fct_daily_active_users: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.fct_daily_active_users"} */

  
    
    

    create  table
      "quest_kingdom"."main"."fct_daily_active_users__dbt_tmp"
  
    as (
      

with players as (
    select * from "quest_kingdom"."main"."dim_players"
),

sessions as (
    select * from "quest_kingdom"."main"."fct_sessions"
),

--get all dates a player was active
player_activity as (
    select 
        player_id,
        session_date as activity_date,
        count(*) as sessions_that_day,
        sum(session_duration_minutes) as total_play_time_minutes,
        max(ending_level) as max_level_that_day
    from sessions 
    group by player_id, session_date 
),

--join to player attributes
final as (
    select 
        pa.player_id,
        pa.activity_date,
        pa.sessions_that_day,
        pa.total_play_time_minutes,
        pa.max_level_that_day,

        --player context
        p.installed_at,
        p.attribution_channel,
        p.country,
        p.device_type,
        p.player_segment,
        p.experiment_variant,
        p.tutorial_completed,

        --derived metrics
        datediff('day', p.installed_at, pa.activity_date) as days_since_install,

        --cohort
        date_trunc('week', p.installed_at)::date as cohort_week,
        date_trunc('month', p.installed_at)::date as cohort_month
    from player_activity pa 
    inner join players p on pa.player_id = p.player_id 
)

select * from final
    );
  
  
[0m16:42:18.372140 [debug] [Thread-1 (]: SQL status: OK in 0.035 seconds
[0m16:42:18.375112 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.fct_daily_active_users"
[0m16:42:18.375322 [debug] [Thread-1 (]: On model.quest_kingdom.fct_daily_active_users: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.fct_daily_active_users"} */

    SELECT index_name
    FROM duckdb_indexes()
    WHERE schema_name = 'main'
      AND table_name = 'fct_daily_active_users'
  
[0m16:42:18.375920 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:42:18.376620 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.fct_daily_active_users"
[0m16:42:18.376803 [debug] [Thread-1 (]: On model.quest_kingdom.fct_daily_active_users: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.fct_daily_active_users"} */

    SELECT COUNT(*) as remaining_indexes
    FROM duckdb_indexes()
    WHERE schema_name = 'main'
      AND table_name = 'fct_daily_active_users'
  
[0m16:42:18.377772 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m16:42:18.381172 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.fct_daily_active_users"
[0m16:42:18.381391 [debug] [Thread-1 (]: On model.quest_kingdom.fct_daily_active_users: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.fct_daily_active_users"} */
alter table "quest_kingdom"."main"."fct_daily_active_users" rename to "fct_daily_active_users__dbt_backup"
[0m16:42:18.382284 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m16:42:18.383800 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.fct_daily_active_users"
[0m16:42:18.383981 [debug] [Thread-1 (]: On model.quest_kingdom.fct_daily_active_users: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.fct_daily_active_users"} */
alter table "quest_kingdom"."main"."fct_daily_active_users__dbt_tmp" rename to "fct_daily_active_users"
[0m16:42:18.384283 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:42:18.391366 [debug] [Thread-1 (]: On model.quest_kingdom.fct_daily_active_users: COMMIT
[0m16:42:18.391563 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.fct_daily_active_users"
[0m16:42:18.391719 [debug] [Thread-1 (]: On model.quest_kingdom.fct_daily_active_users: COMMIT
[0m16:42:18.409690 [debug] [Thread-1 (]: SQL status: OK in 0.018 seconds
[0m16:42:18.412682 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.fct_daily_active_users"
[0m16:42:18.412881 [debug] [Thread-1 (]: On model.quest_kingdom.fct_daily_active_users: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.fct_daily_active_users"} */

      drop table if exists "quest_kingdom"."main"."fct_daily_active_users__dbt_backup" cascade
    
[0m16:42:18.413854 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m16:42:18.415028 [debug] [Thread-1 (]: On model.quest_kingdom.fct_daily_active_users: Close
[0m16:42:18.415991 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8c0320be-7700-4333-9bfa-f57c288c5f13', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112b91d30>]}
[0m16:42:18.416314 [info ] [Thread-1 (]: 1 of 4 OK created sql table model main.fct_daily_active_users .................. [[32mOK[0m in 0.10s]
[0m16:42:18.416585 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.fct_daily_active_users
[0m16:42:18.416982 [debug] [Thread-1 (]: Began running node model.quest_kingdom.rpt_cohort_retention
[0m16:42:18.417209 [info ] [Thread-1 (]: 2 of 4 START sql table model main.rpt_cohort_retention ......................... [RUN]
[0m16:42:18.417407 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.quest_kingdom.fct_daily_active_users, now model.quest_kingdom.rpt_cohort_retention)
[0m16:42:18.417565 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.rpt_cohort_retention
[0m16:42:18.419195 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.rpt_cohort_retention"
[0m16:42:18.419565 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.rpt_cohort_retention
[0m16:42:18.421186 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.rpt_cohort_retention"
[0m16:42:18.421504 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_cohort_retention"
[0m16:42:18.421715 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_cohort_retention: BEGIN
[0m16:42:18.421876 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:42:18.422213 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:42:18.422367 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_cohort_retention"
[0m16:42:18.422611 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_cohort_retention: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_cohort_retention"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_cohort_retention__dbt_tmp"
  
    as (
      

with daily_activity as (
    select * from "quest_kingdom"."main"."fct_daily_active_users"
),

--calculate weeks since install for each activity
activity_by_week as (
    select 
        player_id,
        cohort_week,
        activity_date,
        days_since_install,
        floor(days_since_install / 7) as weeks_since_install
    from daily_activity
),

--get cohort sizes
cohort_sizes as (
    select 
        cohort_week,
        count(distinct player_id) as cohort_size 
    from activity_by_week
    group by cohort_week 
),

--count active users by cohort and week
cohort_activity as (
    select 
        cohort_week,
        weeks_since_install,
        count(distinct player_id) as active_users 
    from activity_by_week
    group by cohort_week, weeks_since_install
),

--calculate retention percentages
cohort_retention as (
    select 
        ca.cohort_week,
        ca.cohort_size,
        ca.weeks_since_install,
        ca.active_users,
        round(ca.active_users::float / cs.cohort_size * 100, 2) as retention_pct
    from cohort_activity ca 
    inner join cohort_sizes cs on ca.cohort_week = cs.cohort_week
),

--pivot to wide format for easier analysis
pivoted as (
    select 
        cohort_week,
        cohort_size,

        max(case when weeks_since_install = 0 then retention_pct end) as week_0,
        max(case when weeks_since_install = 1 then retention_pct end) as week_1,
        max(case when weeks_since_install = 2 then retention_pct end) as week_2,
        max(case when weeks_since_install = 3 then retention_pct end) as week_3,
        max(case when weeks_since_install = 4 then retention_pct end) as week_4,
        max(case when weeks_since_install = 5 then retention_pct end) as week_5,
        max(case when weeks_since_install = 6 then retention_pct end) as week_6,
        max(case when weeks_since_install = 7 then retention_pct end) as week_7,
        max(case when weeks_since_install = 8 then retention_pct end) as week_8,
        max(case when weeks_since_install = 9 then retention_pct end) as week_9,
        max(case when weeks_since_install = 10 then retention_pct end) as week_10,
        max(case when weeks_since_install = 11 then retention_pct end) as week_11,
        max(case when weeks_since_install = 12 then retention_pct end) as week_12,
    from cohort_retention
    group by cohort_week, cohort_size
)

select * from pivoted 
order by cohort_week desc
    );
  
  
[0m16:42:18.427688 [debug] [Thread-1 (]: DuckDB adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_cohort_retention"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_cohort_retention__dbt_tmp"
  
    as (
      

with daily_activity as (
    select * from "quest_kingdom"."main"."fct_daily_active_users"
),

--calculate weeks since install for each activity
activity_by_week as (
    select 
        player_id,
        cohort_week,
        activity_date,
        days_since_install,
        floor(days_since_install / 7) as weeks_since_install
    from daily_activity
),

--get cohort sizes
cohort_sizes as (
    select 
        cohort_week,
        count(distinct player_id) as cohort_size 
    from activity_by_week
    group by cohort_week 
),

--count active users by cohort and week
cohort_activity as (
    select 
        cohort_week,
        weeks_since_install,
        count(distinct player_id) as active_users 
    from activity_by_week
    group by cohort_week, weeks_since_install
),

--calculate retention percentages
cohort_retention as (
    select 
        ca.cohort_week,
        ca.cohort_size,
        ca.weeks_since_install,
        ca.active_users,
        round(ca.active_users::float / cs.cohort_size * 100, 2) as retention_pct
    from cohort_activity ca 
    inner join cohort_sizes cs on ca.cohort_week = cs.cohort_week
),

--pivot to wide format for easier analysis
pivoted as (
    select 
        cohort_week,
        cohort_size,

        max(case when weeks_since_install = 0 then retention_pct end) as week_0,
        max(case when weeks_since_install = 1 then retention_pct end) as week_1,
        max(case when weeks_since_install = 2 then retention_pct end) as week_2,
        max(case when weeks_since_install = 3 then retention_pct end) as week_3,
        max(case when weeks_since_install = 4 then retention_pct end) as week_4,
        max(case when weeks_since_install = 5 then retention_pct end) as week_5,
        max(case when weeks_since_install = 6 then retention_pct end) as week_6,
        max(case when weeks_since_install = 7 then retention_pct end) as week_7,
        max(case when weeks_since_install = 8 then retention_pct end) as week_8,
        max(case when weeks_since_install = 9 then retention_pct end) as week_9,
        max(case when weeks_since_install = 10 then retention_pct end) as week_10,
        max(case when weeks_since_install = 11 then retention_pct end) as week_11,
        max(case when weeks_since_install = 12 then retention_pct end) as week_12,
    from cohort_retention
    group by cohort_week, cohort_size
)

select * from pivoted 
order by cohort_week desc
    );
  
  
[0m16:42:18.428013 [debug] [Thread-1 (]: DuckDB adapter: Rolling back transaction.
[0m16:42:18.428239 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_cohort_retention: ROLLBACK
[0m16:42:18.432501 [debug] [Thread-1 (]: Failed to rollback 'model.quest_kingdom.rpt_cohort_retention'
[0m16:42:18.432707 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_cohort_retention: Close
[0m16:42:18.433922 [debug] [Thread-1 (]: Runtime Error in model rpt_cohort_retention (models/marts/retention/rpt_cohort_retention.sql)
  Binder Error: Values list "ca" does not have a column named "cohort_size"
  
  LINE 51:         ca.cohort_size,
                   ^
[0m16:42:18.434169 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8c0320be-7700-4333-9bfa-f57c288c5f13', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113186c00>]}
[0m16:42:18.434473 [error] [Thread-1 (]: 2 of 4 ERROR creating sql table model main.rpt_cohort_retention ................ [[31mERROR[0m in 0.02s]
[0m16:42:18.434739 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.rpt_cohort_retention
[0m16:42:18.434922 [debug] [Thread-1 (]: Began running node model.quest_kingdom.rpt_d1_d7_d30_retention
[0m16:42:18.435158 [debug] [Thread-4 (]: Marking all children of 'model.quest_kingdom.rpt_cohort_retention' to be skipped because of status 'error'.  Reason: Runtime Error in model rpt_cohort_retention (models/marts/retention/rpt_cohort_retention.sql)
  Binder Error: Values list "ca" does not have a column named "cohort_size"
  
  LINE 51:         ca.cohort_size,
                   ^.
[0m16:42:18.435378 [info ] [Thread-1 (]: 3 of 4 START sql table model main.rpt_d1_d7_d30_retention ...................... [RUN]
[0m16:42:18.435932 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.quest_kingdom.rpt_cohort_retention, now model.quest_kingdom.rpt_d1_d7_d30_retention)
[0m16:42:18.436096 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.rpt_d1_d7_d30_retention
[0m16:42:18.437807 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.rpt_d1_d7_d30_retention"
[0m16:42:18.438178 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.rpt_d1_d7_d30_retention
[0m16:42:18.440008 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.rpt_d1_d7_d30_retention"
[0m16:42:18.440479 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_d1_d7_d30_retention"
[0m16:42:18.440779 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_d1_d7_d30_retention: BEGIN
[0m16:42:18.440948 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:42:18.441563 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m16:42:18.441732 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_d1_d7_d30_retention"
[0m16:42:18.441926 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_d1_d7_d30_retention: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_d1_d7_d30_retention"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_d1_d7_d30_retention__dbt_tmp"
  
    as (
      

with players as (
    select * from "quest_kingdom"."main"."dim_players"
),

daily_activity as (
    select * from "quest_kingdom"."main"."fct_daily_active_users"
),

--for each player, chekc if they were active on D1, D7, D30
player_retention as (
    select 
        p.player_id,
        p.installed_at,
        p.attribution_channel,
        p.country,
        p.device_type,
        p.player_segment,
        p.experiment_variant,
        p.tutorial_completed,
        p.cohort_week,
        p.cohort_month,

        --D1: active on day after install
        max(case when da.days_since_install = 1 then 1 else 0 end) as retained_d1,
        -- D7: active 7 days after install
        max(case when da.days_since_install = 7 then 1 else 0 end) as retained_d7,
        -- D30: active 30 days after install
        max(case when da.days_since_install = 30 then 1 else 0 end) as retained_d30,

        --also need to track if active in ranges (should be more forgiving)
        max(case when da.days_since_install between 1 and 1 then 1 else 0 end) as active_d1_window,
        max(case when da.days_since_install between 6 and 8 then 1 else 0 end) as active_d7_window,
        max(case when da.days_since_install between 28 and 32 then 1 else 0 end) as active_d30_window,

        --total days active
        count(distinct da.activity_date) as total_active_days
    from players p 
    left join daily_activity da on p.player_id = da.player_id 
    group by 
        p.player_id, p.installed_at, p.attribution_channel, p.country,
        p.device_type, p.player_segment, p.experiment_variant,
        p.tutorial_completed, p.cohort_week, p.cohort_month 
)

select * from player_retention
    );
  
  
[0m16:42:18.469411 [debug] [Thread-1 (]: SQL status: OK in 0.024 seconds
[0m16:42:18.470234 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_d1_d7_d30_retention"
[0m16:42:18.470424 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_d1_d7_d30_retention: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_d1_d7_d30_retention"} */

    SELECT index_name
    FROM duckdb_indexes()
    WHERE schema_name = 'main'
      AND table_name = 'rpt_d1_d7_d30_retention'
  
[0m16:42:18.470905 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:42:18.471509 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_d1_d7_d30_retention"
[0m16:42:18.471742 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_d1_d7_d30_retention: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_d1_d7_d30_retention"} */

    SELECT COUNT(*) as remaining_indexes
    FROM duckdb_indexes()
    WHERE schema_name = 'main'
      AND table_name = 'rpt_d1_d7_d30_retention'
  
[0m16:42:18.472238 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:42:18.474887 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_d1_d7_d30_retention"
[0m16:42:18.475078 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_d1_d7_d30_retention: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_d1_d7_d30_retention"} */
alter table "quest_kingdom"."main"."rpt_d1_d7_d30_retention" rename to "rpt_d1_d7_d30_retention__dbt_backup"
[0m16:42:18.475434 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:42:18.476778 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_d1_d7_d30_retention"
[0m16:42:18.476943 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_d1_d7_d30_retention: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_d1_d7_d30_retention"} */
alter table "quest_kingdom"."main"."rpt_d1_d7_d30_retention__dbt_tmp" rename to "rpt_d1_d7_d30_retention"
[0m16:42:18.477233 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:42:18.477991 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_d1_d7_d30_retention: COMMIT
[0m16:42:18.478150 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_d1_d7_d30_retention"
[0m16:42:18.478295 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_d1_d7_d30_retention: COMMIT
[0m16:42:18.481117 [debug] [Thread-1 (]: SQL status: OK in 0.003 seconds
[0m16:42:18.482370 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_d1_d7_d30_retention"
[0m16:42:18.482552 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_d1_d7_d30_retention: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_d1_d7_d30_retention"} */

      drop table if exists "quest_kingdom"."main"."rpt_d1_d7_d30_retention__dbt_backup" cascade
    
[0m16:42:18.483084 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:42:18.483785 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_d1_d7_d30_retention: Close
[0m16:42:18.484067 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8c0320be-7700-4333-9bfa-f57c288c5f13', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11340d460>]}
[0m16:42:18.484383 [info ] [Thread-1 (]: 3 of 4 OK created sql table model main.rpt_d1_d7_d30_retention ................. [[32mOK[0m in 0.05s]
[0m16:42:18.484645 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.rpt_d1_d7_d30_retention
[0m16:42:18.484835 [debug] [Thread-1 (]: Began running node model.quest_kingdom.rpt_retention_curves
[0m16:42:18.485067 [info ] [Thread-1 (]: 4 of 4 START sql table model main.rpt_retention_curves ......................... [RUN]
[0m16:42:18.485267 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.quest_kingdom.rpt_d1_d7_d30_retention, now model.quest_kingdom.rpt_retention_curves)
[0m16:42:18.485430 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.rpt_retention_curves
[0m16:42:18.487104 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.rpt_retention_curves"
[0m16:42:18.487538 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.rpt_retention_curves
[0m16:42:18.489292 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.rpt_retention_curves"
[0m16:42:18.489687 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_retention_curves"
[0m16:42:18.489849 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_retention_curves: BEGIN
[0m16:42:18.489995 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:42:18.490371 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:42:18.490619 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_retention_curves"
[0m16:42:18.490813 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_retention_curves: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_retention_curves"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_retention_curves__dbt_tmp"
  
    as (
      

with daily_activity as (
    select * from "quest_kingdom"."main"."fct_daily_active_users"
),

--calculate weeks since install
activity_by_week as (
    select
        player_id,
        cohort_week,
        activity_date,
        days_since_install,
        floor(days_since_install / 7) as weeks_since_install 
    from daily_activity
),

--get cohort sizes 
cohort_sizes as (
    select 
        cohort_week,
        count(distinct player_id) as cohort_size 
    from activity_by_week
    group by cohort_week
),

--countr active users by cohort and week
cohort_activity as (
    select 
        cohort_week,
        weeks_since_install,
        count(distinct player_id) as active_users 
    from activity_by_week
    where weeks_since_install <= 12 --only tracking the first 12 weeks
    group by cohort_week, weeks_since_install
),

--calculate retention
final as (
    select
        ca.cohort_week,
        cs.cohort_size,
        ca.weeks_since_install,
        ca.active_users,
        ca.active_users::float / cs.cohort_size as retention_rate,
        round(ca.active_users::float / cs.cohort_size * 100, 1) as retention_pct,
        --cohort label for charts
        'Cohort' || to_char(ca.cohort_week, 'YYYY-MM-DD') as cohort_label
    from cohort_activity ca 
    inner join cohort_sizes cs on ca.cohort_week = cs.cohort_week
)

select * from final
order by cohort_week, weeks_since_install
    );
  
  
[0m16:42:18.497481 [debug] [Thread-1 (]: DuckDB adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_retention_curves"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_retention_curves__dbt_tmp"
  
    as (
      

with daily_activity as (
    select * from "quest_kingdom"."main"."fct_daily_active_users"
),

--calculate weeks since install
activity_by_week as (
    select
        player_id,
        cohort_week,
        activity_date,
        days_since_install,
        floor(days_since_install / 7) as weeks_since_install 
    from daily_activity
),

--get cohort sizes 
cohort_sizes as (
    select 
        cohort_week,
        count(distinct player_id) as cohort_size 
    from activity_by_week
    group by cohort_week
),

--countr active users by cohort and week
cohort_activity as (
    select 
        cohort_week,
        weeks_since_install,
        count(distinct player_id) as active_users 
    from activity_by_week
    where weeks_since_install <= 12 --only tracking the first 12 weeks
    group by cohort_week, weeks_since_install
),

--calculate retention
final as (
    select
        ca.cohort_week,
        cs.cohort_size,
        ca.weeks_since_install,
        ca.active_users,
        ca.active_users::float / cs.cohort_size as retention_rate,
        round(ca.active_users::float / cs.cohort_size * 100, 1) as retention_pct,
        --cohort label for charts
        'Cohort' || to_char(ca.cohort_week, 'YYYY-MM-DD') as cohort_label
    from cohort_activity ca 
    inner join cohort_sizes cs on ca.cohort_week = cs.cohort_week
)

select * from final
order by cohort_week, weeks_since_install
    );
  
  
[0m16:42:18.497897 [debug] [Thread-1 (]: DuckDB adapter: Rolling back transaction.
[0m16:42:18.498238 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_retention_curves: ROLLBACK
[0m16:42:18.499850 [debug] [Thread-1 (]: Failed to rollback 'model.quest_kingdom.rpt_retention_curves'
[0m16:42:18.500061 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_retention_curves: Close
[0m16:42:18.501245 [debug] [Thread-1 (]: Runtime Error in model rpt_retention_curves (models/marts/retention/rpt_retention_curves.sql)
  Catalog Error: Scalar Function with name to_char does not exist!
  Did you mean "to_hours"?
  
  LINE 58:         'Cohort' || to_char(ca.cohort_week, 'YYYY-MM-DD') as cohort_label
                               ^
[0m16:42:18.501474 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8c0320be-7700-4333-9bfa-f57c288c5f13', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1131f6f90>]}
[0m16:42:18.501775 [error] [Thread-1 (]: 4 of 4 ERROR creating sql table model main.rpt_retention_curves ................ [[31mERROR[0m in 0.02s]
[0m16:42:18.502038 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.rpt_retention_curves
[0m16:42:18.502293 [debug] [Thread-4 (]: Marking all children of 'model.quest_kingdom.rpt_retention_curves' to be skipped because of status 'error'.  Reason: Runtime Error in model rpt_retention_curves (models/marts/retention/rpt_retention_curves.sql)
  Catalog Error: Scalar Function with name to_char does not exist!
  Did you mean "to_hours"?
  
  LINE 58:         'Cohort' || to_char(ca.cohort_week, 'YYYY-MM-DD') as cohort_label
                               ^.
[0m16:42:18.502859 [debug] [MainThread]: Using duckdb connection "master"
[0m16:42:18.503000 [debug] [MainThread]: On master: BEGIN
[0m16:42:18.503124 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m16:42:18.503453 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m16:42:18.503583 [debug] [MainThread]: On master: COMMIT
[0m16:42:18.503709 [debug] [MainThread]: Using duckdb connection "master"
[0m16:42:18.503829 [debug] [MainThread]: On master: COMMIT
[0m16:42:18.504024 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m16:42:18.504148 [debug] [MainThread]: On master: Close
[0m16:42:18.504307 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:42:18.504429 [debug] [MainThread]: Connection 'model.quest_kingdom.rpt_retention_curves' was properly closed.
[0m16:42:18.504585 [info ] [MainThread]: 
[0m16:42:18.504723 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 0.27 seconds (0.27s).
[0m16:42:18.505228 [debug] [MainThread]: Command end result
[0m16:42:18.519440 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/manifest.json
[0m16:42:18.520376 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/semantic_manifest.json
[0m16:42:18.523756 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/run_results.json
[0m16:42:18.523990 [info ] [MainThread]: 
[0m16:42:18.524354 [info ] [MainThread]: [31mCompleted with 2 errors, 0 partial successes, and 0 warnings:[0m
[0m16:42:18.524565 [info ] [MainThread]: 
[0m16:42:18.524762 [error] [MainThread]: [31mFailure in model rpt_cohort_retention (models/marts/retention/rpt_cohort_retention.sql)[0m
[0m16:42:18.524941 [error] [MainThread]:   Runtime Error in model rpt_cohort_retention (models/marts/retention/rpt_cohort_retention.sql)
  Binder Error: Values list "ca" does not have a column named "cohort_size"
  
  LINE 51:         ca.cohort_size,
                   ^
[0m16:42:18.525076 [info ] [MainThread]: 
[0m16:42:18.525230 [info ] [MainThread]:   compiled code at target/compiled/quest_kingdom/models/marts/retention/rpt_cohort_retention.sql
[0m16:42:18.525363 [info ] [MainThread]: 
[0m16:42:18.525519 [error] [MainThread]: [31mFailure in model rpt_retention_curves (models/marts/retention/rpt_retention_curves.sql)[0m
[0m16:42:18.525679 [error] [MainThread]:   Runtime Error in model rpt_retention_curves (models/marts/retention/rpt_retention_curves.sql)
  Catalog Error: Scalar Function with name to_char does not exist!
  Did you mean "to_hours"?
  
  LINE 58:         'Cohort' || to_char(ca.cohort_week, 'YYYY-MM-DD') as cohort_label
                               ^
[0m16:42:18.525803 [info ] [MainThread]: 
[0m16:42:18.525949 [info ] [MainThread]:   compiled code at target/compiled/quest_kingdom/models/marts/retention/rpt_retention_curves.sql
[0m16:42:18.526073 [info ] [MainThread]: 
[0m16:42:18.526217 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=2 SKIP=0 NO-OP=0 TOTAL=4
[0m16:42:18.527787 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.95326877, "process_in_blocks": "0", "process_kernel_time": 0.218615, "process_mem_max_rss": "211746816", "process_out_blocks": "0", "process_user_time": 1.44367}
[0m16:42:18.528020 [debug] [MainThread]: Command `dbt run` failed at 16:42:18.527978 after 0.95 seconds
[0m16:42:18.528209 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106b497f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11306f470>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106b75970>]}
[0m16:42:18.528383 [debug] [MainThread]: Flushing usage events
[0m16:42:18.634181 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m16:43:37.893557 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10669ca40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113fb5a30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113fb57c0>]}


============================== 16:43:37.896986 | a6c638bc-d156-4a4d-baa9-c31334516304 ==============================
[0m16:43:37.896986 [info ] [MainThread]: Running with dbt=1.11.4
[0m16:43:37.897308 [debug] [MainThread]: running dbt with arguments {'target_path': 'None', 'write_json': 'True', 'no_print': 'None', 'introspect': 'True', 'empty': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'debug': 'False', 'send_anonymous_usage_stats': 'True', 'invocation_command': 'dbt run --select path:models/marts/retention', 'profiles_dir': '/Users/hazeldonaldson/.dbt', 'version_check': 'True', 'quiet': 'False', 'printer_width': '80', 'static_parser': 'True', 'partial_parse': 'True', 'warn_error': 'None', 'log_path': '/Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/logs', 'cache_selected_only': 'False', 'use_colors': 'True', 'log_format': 'default', 'fail_fast': 'False', 'log_cache_events': 'False'}
[0m16:43:38.095067 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a6c638bc-d156-4a4d-baa9-c31334516304', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113fe0440>]}
[0m16:43:38.123646 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a6c638bc-d156-4a4d-baa9-c31334516304', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114268440>]}
[0m16:43:38.124934 [info ] [MainThread]: Registered adapter: duckdb=1.10.0
[0m16:43:38.182677 [debug] [MainThread]: checksum: 092b177ba87eb6bb3c55954c38aa57900eebac336561eb9ee32218428aa81d43, vars: {}, profile: , target: , version: 1.11.4
[0m16:43:38.259731 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m16:43:38.260222 [debug] [MainThread]: Partial parsing: updated file: quest_kingdom://models/marts/retention/rpt_retention_curves.sql
[0m16:43:38.507708 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a6c638bc-d156-4a4d-baa9-c31334516304', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114793260>]}
[0m16:43:38.590156 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/manifest.json
[0m16:43:38.591446 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/semantic_manifest.json
[0m16:43:38.604641 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a6c638bc-d156-4a4d-baa9-c31334516304', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11492ab10>]}
[0m16:43:38.604916 [info ] [MainThread]: Found 11 models, 32 data tests, 5 sources, 472 macros
[0m16:43:38.605093 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a6c638bc-d156-4a4d-baa9-c31334516304', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11498bd70>]}
[0m16:43:38.606697 [info ] [MainThread]: 
[0m16:43:38.606891 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m16:43:38.607035 [info ] [MainThread]: 
[0m16:43:38.607286 [debug] [MainThread]: Acquiring new duckdb connection 'master'
[0m16:43:38.609474 [debug] [ThreadPool]: Acquiring new duckdb connection 'list_quest_kingdom'
[0m16:43:38.642513 [debug] [ThreadPool]: Using duckdb connection "list_quest_kingdom"
[0m16:43:38.642769 [debug] [ThreadPool]: On list_quest_kingdom: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "list_quest_kingdom"} */

    
    select schema_name
    from system.information_schema.schemata
    
    where lower(catalog_name) = '"quest_kingdom"'
    
  
  
[0m16:43:38.642922 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:43:38.661888 [debug] [ThreadPool]: SQL status: OK in 0.019 seconds
[0m16:43:38.662907 [debug] [ThreadPool]: On list_quest_kingdom: Close
[0m16:43:38.663470 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_quest_kingdom, now create_quest_kingdom_main)
[0m16:43:38.663707 [debug] [ThreadPool]: Creating schema "database: "quest_kingdom"
schema: "main"
"
[0m16:43:38.666997 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m16:43:38.667171 [debug] [ThreadPool]: On create_quest_kingdom_main: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "create_quest_kingdom_main"} */

    
        select type from duckdb_databases()
        where lower(database_name)='quest_kingdom'
        and type='sqlite'
    
  
[0m16:43:38.667310 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:43:38.668126 [debug] [ThreadPool]: SQL status: OK in 0.001 seconds
[0m16:43:38.668879 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m16:43:38.669013 [debug] [ThreadPool]: On create_quest_kingdom_main: BEGIN
[0m16:43:38.669229 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m16:43:38.669355 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m16:43:38.669478 [debug] [ThreadPool]: On create_quest_kingdom_main: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "create_quest_kingdom_main"} */

    
    
        create schema if not exists "quest_kingdom"."main"
    
[0m16:43:38.669849 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m16:43:38.670229 [debug] [ThreadPool]: On create_quest_kingdom_main: COMMIT
[0m16:43:38.670373 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m16:43:38.670490 [debug] [ThreadPool]: On create_quest_kingdom_main: COMMIT
[0m16:43:38.670878 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m16:43:38.671008 [debug] [ThreadPool]: On create_quest_kingdom_main: Close
[0m16:43:38.671758 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_quest_kingdom_main, now list_quest_kingdom_main)
[0m16:43:38.674485 [debug] [ThreadPool]: Using duckdb connection "list_quest_kingdom_main"
[0m16:43:38.674644 [debug] [ThreadPool]: On list_quest_kingdom_main: BEGIN
[0m16:43:38.674827 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:43:38.675076 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m16:43:38.675208 [debug] [ThreadPool]: Using duckdb connection "list_quest_kingdom_main"
[0m16:43:38.675341 [debug] [ThreadPool]: On list_quest_kingdom_main: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "list_quest_kingdom_main"} */
select
      'quest_kingdom' as database,
      table_name as name,
      table_schema as schema,
      CASE table_type
        WHEN 'BASE TABLE' THEN 'table'
        WHEN 'VIEW' THEN 'view'
        WHEN 'LOCAL TEMPORARY' THEN 'table'
        END as type
    from system.information_schema.tables
    where lower(table_schema) = 'main'
    and lower(table_catalog) = 'quest_kingdom'
  
[0m16:43:38.686383 [debug] [ThreadPool]: SQL status: OK in 0.011 seconds
[0m16:43:38.687343 [debug] [ThreadPool]: On list_quest_kingdom_main: ROLLBACK
[0m16:43:38.688318 [debug] [ThreadPool]: Failed to rollback 'list_quest_kingdom_main'
[0m16:43:38.688464 [debug] [ThreadPool]: On list_quest_kingdom_main: Close
[0m16:43:38.689692 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a6c638bc-d156-4a4d-baa9-c31334516304', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114935310>]}
[0m16:43:38.689933 [debug] [MainThread]: Using duckdb connection "master"
[0m16:43:38.690072 [debug] [MainThread]: On master: BEGIN
[0m16:43:38.690191 [debug] [MainThread]: Opening a new connection, currently in state init
[0m16:43:38.690462 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m16:43:38.690590 [debug] [MainThread]: On master: COMMIT
[0m16:43:38.690713 [debug] [MainThread]: Using duckdb connection "master"
[0m16:43:38.690831 [debug] [MainThread]: On master: COMMIT
[0m16:43:38.691026 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m16:43:38.691149 [debug] [MainThread]: On master: Close
[0m16:43:38.692434 [debug] [Thread-1 (]: Began running node model.quest_kingdom.fct_daily_active_users
[0m16:43:38.692675 [info ] [Thread-1 (]: 1 of 4 START sql table model main.fct_daily_active_users ....................... [RUN]
[0m16:43:38.692882 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_quest_kingdom_main, now model.quest_kingdom.fct_daily_active_users)
[0m16:43:38.693038 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.fct_daily_active_users
[0m16:43:38.696843 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.fct_daily_active_users"
[0m16:43:38.697705 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.fct_daily_active_users
[0m16:43:38.714275 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.fct_daily_active_users"
[0m16:43:38.715193 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.fct_daily_active_users"
[0m16:43:38.715370 [debug] [Thread-1 (]: On model.quest_kingdom.fct_daily_active_users: BEGIN
[0m16:43:38.715523 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:43:38.715887 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:43:38.716035 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.fct_daily_active_users"
[0m16:43:38.716210 [debug] [Thread-1 (]: On model.quest_kingdom.fct_daily_active_users: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.fct_daily_active_users"} */

  
    
    

    create  table
      "quest_kingdom"."main"."fct_daily_active_users__dbt_tmp"
  
    as (
      

with players as (
    select * from "quest_kingdom"."main"."dim_players"
),

sessions as (
    select * from "quest_kingdom"."main"."fct_sessions"
),

--get all dates a player was active
player_activity as (
    select 
        player_id,
        session_date as activity_date,
        count(*) as sessions_that_day,
        sum(session_duration_minutes) as total_play_time_minutes,
        max(ending_level) as max_level_that_day
    from sessions 
    group by player_id, session_date 
),

--join to player attributes
final as (
    select 
        pa.player_id,
        pa.activity_date,
        pa.sessions_that_day,
        pa.total_play_time_minutes,
        pa.max_level_that_day,

        --player context
        p.installed_at,
        p.attribution_channel,
        p.country,
        p.device_type,
        p.player_segment,
        p.experiment_variant,
        p.tutorial_completed,

        --derived metrics
        datediff('day', p.installed_at, pa.activity_date) as days_since_install,

        --cohort
        date_trunc('week', p.installed_at)::date as cohort_week,
        date_trunc('month', p.installed_at)::date as cohort_month
    from player_activity pa 
    inner join players p on pa.player_id = p.player_id 
)

select * from final
    );
  
  
[0m16:43:38.749995 [debug] [Thread-1 (]: SQL status: OK in 0.034 seconds
[0m16:43:38.753124 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.fct_daily_active_users"
[0m16:43:38.753357 [debug] [Thread-1 (]: On model.quest_kingdom.fct_daily_active_users: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.fct_daily_active_users"} */

    SELECT index_name
    FROM duckdb_indexes()
    WHERE schema_name = 'main'
      AND table_name = 'fct_daily_active_users'
  
[0m16:43:38.753938 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:43:38.754620 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.fct_daily_active_users"
[0m16:43:38.754800 [debug] [Thread-1 (]: On model.quest_kingdom.fct_daily_active_users: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.fct_daily_active_users"} */

    SELECT COUNT(*) as remaining_indexes
    FROM duckdb_indexes()
    WHERE schema_name = 'main'
      AND table_name = 'fct_daily_active_users'
  
[0m16:43:38.756249 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m16:43:38.760016 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.fct_daily_active_users"
[0m16:43:38.760270 [debug] [Thread-1 (]: On model.quest_kingdom.fct_daily_active_users: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.fct_daily_active_users"} */
alter table "quest_kingdom"."main"."fct_daily_active_users" rename to "fct_daily_active_users__dbt_backup"
[0m16:43:38.762628 [debug] [Thread-1 (]: SQL status: OK in 0.002 seconds
[0m16:43:38.764283 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.fct_daily_active_users"
[0m16:43:38.764460 [debug] [Thread-1 (]: On model.quest_kingdom.fct_daily_active_users: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.fct_daily_active_users"} */
alter table "quest_kingdom"."main"."fct_daily_active_users__dbt_tmp" rename to "fct_daily_active_users"
[0m16:43:38.764770 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:43:38.771940 [debug] [Thread-1 (]: On model.quest_kingdom.fct_daily_active_users: COMMIT
[0m16:43:38.772137 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.fct_daily_active_users"
[0m16:43:38.772296 [debug] [Thread-1 (]: On model.quest_kingdom.fct_daily_active_users: COMMIT
[0m16:43:38.784273 [debug] [Thread-1 (]: SQL status: OK in 0.012 seconds
[0m16:43:38.787224 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.fct_daily_active_users"
[0m16:43:38.787415 [debug] [Thread-1 (]: On model.quest_kingdom.fct_daily_active_users: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.fct_daily_active_users"} */

      drop table if exists "quest_kingdom"."main"."fct_daily_active_users__dbt_backup" cascade
    
[0m16:43:38.788258 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m16:43:38.789513 [debug] [Thread-1 (]: On model.quest_kingdom.fct_daily_active_users: Close
[0m16:43:38.790607 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a6c638bc-d156-4a4d-baa9-c31334516304', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114988590>]}
[0m16:43:38.790960 [info ] [Thread-1 (]: 1 of 4 OK created sql table model main.fct_daily_active_users .................. [[32mOK[0m in 0.10s]
[0m16:43:38.791244 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.fct_daily_active_users
[0m16:43:38.791653 [debug] [Thread-1 (]: Began running node model.quest_kingdom.rpt_cohort_retention
[0m16:43:38.791910 [info ] [Thread-1 (]: 2 of 4 START sql table model main.rpt_cohort_retention ......................... [RUN]
[0m16:43:38.792119 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.quest_kingdom.fct_daily_active_users, now model.quest_kingdom.rpt_cohort_retention)
[0m16:43:38.792286 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.rpt_cohort_retention
[0m16:43:38.793962 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.rpt_cohort_retention"
[0m16:43:38.794472 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.rpt_cohort_retention
[0m16:43:38.796033 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.rpt_cohort_retention"
[0m16:43:38.796348 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_cohort_retention"
[0m16:43:38.796500 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_cohort_retention: BEGIN
[0m16:43:38.796641 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:43:38.796974 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:43:38.797121 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_cohort_retention"
[0m16:43:38.797379 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_cohort_retention: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_cohort_retention"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_cohort_retention__dbt_tmp"
  
    as (
      

with daily_activity as (
    select * from "quest_kingdom"."main"."fct_daily_active_users"
),

--calculate weeks since install for each activity
activity_by_week as (
    select 
        player_id,
        cohort_week,
        activity_date,
        days_since_install,
        floor(days_since_install / 7) as weeks_since_install
    from daily_activity
),

--get cohort sizes
cohort_sizes as (
    select 
        cohort_week,
        count(distinct player_id) as cohort_size 
    from activity_by_week
    group by cohort_week 
),

--count active users by cohort and week
cohort_activity as (
    select 
        cohort_week,
        weeks_since_install,
        count(distinct player_id) as active_users 
    from activity_by_week
    group by cohort_week, weeks_since_install
),

--calculate retention percentages
cohort_retention as (
    select 
        ca.cohort_week,
        ca.cohort_size,
        ca.weeks_since_install,
        ca.active_users,
        round(ca.active_users::float / cs.cohort_size * 100, 2) as retention_pct
    from cohort_activity ca 
    inner join cohort_sizes cs on ca.cohort_week = cs.cohort_week
),

--pivot to wide format for easier analysis
pivoted as (
    select 
        cohort_week,
        cohort_size,

        max(case when weeks_since_install = 0 then retention_pct end) as week_0,
        max(case when weeks_since_install = 1 then retention_pct end) as week_1,
        max(case when weeks_since_install = 2 then retention_pct end) as week_2,
        max(case when weeks_since_install = 3 then retention_pct end) as week_3,
        max(case when weeks_since_install = 4 then retention_pct end) as week_4,
        max(case when weeks_since_install = 5 then retention_pct end) as week_5,
        max(case when weeks_since_install = 6 then retention_pct end) as week_6,
        max(case when weeks_since_install = 7 then retention_pct end) as week_7,
        max(case when weeks_since_install = 8 then retention_pct end) as week_8,
        max(case when weeks_since_install = 9 then retention_pct end) as week_9,
        max(case when weeks_since_install = 10 then retention_pct end) as week_10,
        max(case when weeks_since_install = 11 then retention_pct end) as week_11,
        max(case when weeks_since_install = 12 then retention_pct end) as week_12,
    from cohort_retention
    group by cohort_week, cohort_size
)

select * from pivoted 
order by cohort_week desc
    );
  
  
[0m16:43:38.802398 [debug] [Thread-1 (]: DuckDB adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_cohort_retention"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_cohort_retention__dbt_tmp"
  
    as (
      

with daily_activity as (
    select * from "quest_kingdom"."main"."fct_daily_active_users"
),

--calculate weeks since install for each activity
activity_by_week as (
    select 
        player_id,
        cohort_week,
        activity_date,
        days_since_install,
        floor(days_since_install / 7) as weeks_since_install
    from daily_activity
),

--get cohort sizes
cohort_sizes as (
    select 
        cohort_week,
        count(distinct player_id) as cohort_size 
    from activity_by_week
    group by cohort_week 
),

--count active users by cohort and week
cohort_activity as (
    select 
        cohort_week,
        weeks_since_install,
        count(distinct player_id) as active_users 
    from activity_by_week
    group by cohort_week, weeks_since_install
),

--calculate retention percentages
cohort_retention as (
    select 
        ca.cohort_week,
        ca.cohort_size,
        ca.weeks_since_install,
        ca.active_users,
        round(ca.active_users::float / cs.cohort_size * 100, 2) as retention_pct
    from cohort_activity ca 
    inner join cohort_sizes cs on ca.cohort_week = cs.cohort_week
),

--pivot to wide format for easier analysis
pivoted as (
    select 
        cohort_week,
        cohort_size,

        max(case when weeks_since_install = 0 then retention_pct end) as week_0,
        max(case when weeks_since_install = 1 then retention_pct end) as week_1,
        max(case when weeks_since_install = 2 then retention_pct end) as week_2,
        max(case when weeks_since_install = 3 then retention_pct end) as week_3,
        max(case when weeks_since_install = 4 then retention_pct end) as week_4,
        max(case when weeks_since_install = 5 then retention_pct end) as week_5,
        max(case when weeks_since_install = 6 then retention_pct end) as week_6,
        max(case when weeks_since_install = 7 then retention_pct end) as week_7,
        max(case when weeks_since_install = 8 then retention_pct end) as week_8,
        max(case when weeks_since_install = 9 then retention_pct end) as week_9,
        max(case when weeks_since_install = 10 then retention_pct end) as week_10,
        max(case when weeks_since_install = 11 then retention_pct end) as week_11,
        max(case when weeks_since_install = 12 then retention_pct end) as week_12,
    from cohort_retention
    group by cohort_week, cohort_size
)

select * from pivoted 
order by cohort_week desc
    );
  
  
[0m16:43:38.802672 [debug] [Thread-1 (]: DuckDB adapter: Rolling back transaction.
[0m16:43:38.802946 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_cohort_retention: ROLLBACK
[0m16:43:38.810815 [debug] [Thread-1 (]: Failed to rollback 'model.quest_kingdom.rpt_cohort_retention'
[0m16:43:38.811285 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_cohort_retention: Close
[0m16:43:38.812962 [debug] [Thread-1 (]: Runtime Error in model rpt_cohort_retention (models/marts/retention/rpt_cohort_retention.sql)
  Binder Error: Values list "ca" does not have a column named "cohort_size"
  
  LINE 51:         ca.cohort_size,
                   ^
[0m16:43:38.815905 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a6c638bc-d156-4a4d-baa9-c31334516304', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114e86a80>]}
[0m16:43:38.817125 [error] [Thread-1 (]: 2 of 4 ERROR creating sql table model main.rpt_cohort_retention ................ [[31mERROR[0m in 0.02s]
[0m16:43:38.817850 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.rpt_cohort_retention
[0m16:43:38.818078 [debug] [Thread-1 (]: Began running node model.quest_kingdom.rpt_d1_d7_d30_retention
[0m16:43:38.818330 [debug] [Thread-4 (]: Marking all children of 'model.quest_kingdom.rpt_cohort_retention' to be skipped because of status 'error'.  Reason: Runtime Error in model rpt_cohort_retention (models/marts/retention/rpt_cohort_retention.sql)
  Binder Error: Values list "ca" does not have a column named "cohort_size"
  
  LINE 51:         ca.cohort_size,
                   ^.
[0m16:43:38.818607 [info ] [Thread-1 (]: 3 of 4 START sql table model main.rpt_d1_d7_d30_retention ...................... [RUN]
[0m16:43:38.819546 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.quest_kingdom.rpt_cohort_retention, now model.quest_kingdom.rpt_d1_d7_d30_retention)
[0m16:43:38.819778 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.rpt_d1_d7_d30_retention
[0m16:43:38.822074 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.rpt_d1_d7_d30_retention"
[0m16:43:38.824947 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.rpt_d1_d7_d30_retention
[0m16:43:38.826849 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.rpt_d1_d7_d30_retention"
[0m16:43:38.827314 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_d1_d7_d30_retention"
[0m16:43:38.827481 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_d1_d7_d30_retention: BEGIN
[0m16:43:38.827630 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:43:38.828024 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:43:38.828180 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_d1_d7_d30_retention"
[0m16:43:38.828376 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_d1_d7_d30_retention: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_d1_d7_d30_retention"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_d1_d7_d30_retention__dbt_tmp"
  
    as (
      

with players as (
    select * from "quest_kingdom"."main"."dim_players"
),

daily_activity as (
    select * from "quest_kingdom"."main"."fct_daily_active_users"
),

--for each player, chekc if they were active on D1, D7, D30
player_retention as (
    select 
        p.player_id,
        p.installed_at,
        p.attribution_channel,
        p.country,
        p.device_type,
        p.player_segment,
        p.experiment_variant,
        p.tutorial_completed,
        p.cohort_week,
        p.cohort_month,

        --D1: active on day after install
        max(case when da.days_since_install = 1 then 1 else 0 end) as retained_d1,
        -- D7: active 7 days after install
        max(case when da.days_since_install = 7 then 1 else 0 end) as retained_d7,
        -- D30: active 30 days after install
        max(case when da.days_since_install = 30 then 1 else 0 end) as retained_d30,

        --also need to track if active in ranges (should be more forgiving)
        max(case when da.days_since_install between 1 and 1 then 1 else 0 end) as active_d1_window,
        max(case when da.days_since_install between 6 and 8 then 1 else 0 end) as active_d7_window,
        max(case when da.days_since_install between 28 and 32 then 1 else 0 end) as active_d30_window,

        --total days active
        count(distinct da.activity_date) as total_active_days
    from players p 
    left join daily_activity da on p.player_id = da.player_id 
    group by 
        p.player_id, p.installed_at, p.attribution_channel, p.country,
        p.device_type, p.player_segment, p.experiment_variant,
        p.tutorial_completed, p.cohort_week, p.cohort_month 
)

select * from player_retention
    );
  
  
[0m16:43:38.858956 [debug] [Thread-1 (]: SQL status: OK in 0.030 seconds
[0m16:43:38.860416 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_d1_d7_d30_retention"
[0m16:43:38.860699 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_d1_d7_d30_retention: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_d1_d7_d30_retention"} */

    SELECT index_name
    FROM duckdb_indexes()
    WHERE schema_name = 'main'
      AND table_name = 'rpt_d1_d7_d30_retention'
  
[0m16:43:38.861289 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:43:38.861979 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_d1_d7_d30_retention"
[0m16:43:38.862156 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_d1_d7_d30_retention: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_d1_d7_d30_retention"} */

    SELECT COUNT(*) as remaining_indexes
    FROM duckdb_indexes()
    WHERE schema_name = 'main'
      AND table_name = 'rpt_d1_d7_d30_retention'
  
[0m16:43:38.862644 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:43:38.865366 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_d1_d7_d30_retention"
[0m16:43:38.865592 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_d1_d7_d30_retention: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_d1_d7_d30_retention"} */
alter table "quest_kingdom"."main"."rpt_d1_d7_d30_retention" rename to "rpt_d1_d7_d30_retention__dbt_backup"
[0m16:43:38.866004 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:43:38.867539 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_d1_d7_d30_retention"
[0m16:43:38.867717 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_d1_d7_d30_retention: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_d1_d7_d30_retention"} */
alter table "quest_kingdom"."main"."rpt_d1_d7_d30_retention__dbt_tmp" rename to "rpt_d1_d7_d30_retention"
[0m16:43:38.868047 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:43:38.868842 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_d1_d7_d30_retention: COMMIT
[0m16:43:38.869009 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_d1_d7_d30_retention"
[0m16:43:38.869151 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_d1_d7_d30_retention: COMMIT
[0m16:43:38.872220 [debug] [Thread-1 (]: SQL status: OK in 0.003 seconds
[0m16:43:38.873802 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_d1_d7_d30_retention"
[0m16:43:38.874047 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_d1_d7_d30_retention: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_d1_d7_d30_retention"} */

      drop table if exists "quest_kingdom"."main"."rpt_d1_d7_d30_retention__dbt_backup" cascade
    
[0m16:43:38.874707 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:43:38.875743 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_d1_d7_d30_retention: Close
[0m16:43:38.876033 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a6c638bc-d156-4a4d-baa9-c31334516304', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114efb8f0>]}
[0m16:43:38.876322 [info ] [Thread-1 (]: 3 of 4 OK created sql table model main.rpt_d1_d7_d30_retention ................. [[32mOK[0m in 0.06s]
[0m16:43:38.876570 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.rpt_d1_d7_d30_retention
[0m16:43:38.876749 [debug] [Thread-1 (]: Began running node model.quest_kingdom.rpt_retention_curves
[0m16:43:38.876966 [info ] [Thread-1 (]: 4 of 4 START sql table model main.rpt_retention_curves ......................... [RUN]
[0m16:43:38.877149 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.quest_kingdom.rpt_d1_d7_d30_retention, now model.quest_kingdom.rpt_retention_curves)
[0m16:43:38.877304 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.rpt_retention_curves
[0m16:43:38.878907 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.rpt_retention_curves"
[0m16:43:38.879302 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.rpt_retention_curves
[0m16:43:38.880890 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.rpt_retention_curves"
[0m16:43:38.881211 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_retention_curves"
[0m16:43:38.881364 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_retention_curves: BEGIN
[0m16:43:38.881505 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:43:38.881845 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:43:38.881988 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_retention_curves"
[0m16:43:38.882168 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_retention_curves: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_retention_curves"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_retention_curves__dbt_tmp"
  
    as (
      

with daily_activity as (
    select * from "quest_kingdom"."main"."fct_daily_active_users"
),

--calculate weeks since install
activity_by_week as (
    select
        player_id,
        cohort_week,
        activity_date,
        days_since_install,
        floor(days_since_install / 7) as weeks_since_install 
    from daily_activity
),

--get cohort sizes 
cohort_sizes as (
    select 
        cohort_week,
        count(distinct player_id) as cohort_size 
    from activity_by_week
    group by cohort_week
),

--countr active users by cohort and week
cohort_activity as (
    select 
        cohort_week,
        weeks_since_install,
        count(distinct player_id) as active_users 
    from activity_by_week
    where weeks_since_install <= 12 --only tracking the first 12 weeks
    group by cohort_week, weeks_since_install
),

--calculate retention
final as (
    select
        ca.cohort_week,
        cs.cohort_size,
        ca.weeks_since_install,
        ca.active_users,
        ca.active_users::float / cs.cohort_size as retention_rate,
        round(ca.active_users::float / cs.cohort_size * 100, 1) as retention_pct,
        --cohort label for charts
        cs.cohort_week::varchar || ' Cohort' as cohort_label
    from cohort_activity ca 
    inner join cohort_sizes cs on ca.cohort_week = cs.cohort_week
)

select * from final
order by cohort_week, weeks_since_install
    );
  
  
[0m16:43:38.891480 [debug] [Thread-1 (]: SQL status: OK in 0.009 seconds
[0m16:43:38.893350 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_retention_curves"
[0m16:43:38.893560 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_retention_curves: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_retention_curves"} */
alter table "quest_kingdom"."main"."rpt_retention_curves__dbt_tmp" rename to "rpt_retention_curves"
[0m16:43:38.894073 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:43:38.895029 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_retention_curves: COMMIT
[0m16:43:38.895233 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_retention_curves"
[0m16:43:38.895400 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_retention_curves: COMMIT
[0m16:43:38.895977 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:43:38.897356 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_retention_curves"
[0m16:43:38.897551 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_retention_curves: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_retention_curves"} */

      drop table if exists "quest_kingdom"."main"."rpt_retention_curves__dbt_backup" cascade
    
[0m16:43:38.897898 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:43:38.898612 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_retention_curves: Close
[0m16:43:38.898908 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a6c638bc-d156-4a4d-baa9-c31334516304', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114e38b90>]}
[0m16:43:38.899220 [info ] [Thread-1 (]: 4 of 4 OK created sql table model main.rpt_retention_curves .................... [[32mOK[0m in 0.02s]
[0m16:43:38.899483 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.rpt_retention_curves
[0m16:43:38.900102 [debug] [MainThread]: Using duckdb connection "master"
[0m16:43:38.900254 [debug] [MainThread]: On master: BEGIN
[0m16:43:38.900377 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m16:43:38.900705 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m16:43:38.900837 [debug] [MainThread]: On master: COMMIT
[0m16:43:38.900963 [debug] [MainThread]: Using duckdb connection "master"
[0m16:43:38.901080 [debug] [MainThread]: On master: COMMIT
[0m16:43:38.901316 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m16:43:38.901473 [debug] [MainThread]: On master: Close
[0m16:43:38.901663 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:43:38.901788 [debug] [MainThread]: Connection 'model.quest_kingdom.rpt_retention_curves' was properly closed.
[0m16:43:38.901969 [info ] [MainThread]: 
[0m16:43:38.902127 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 0.29 seconds (0.29s).
[0m16:43:38.902640 [debug] [MainThread]: Command end result
[0m16:43:38.919058 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/manifest.json
[0m16:43:38.920154 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/semantic_manifest.json
[0m16:43:38.923514 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/run_results.json
[0m16:43:38.923758 [info ] [MainThread]: 
[0m16:43:38.923952 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m16:43:38.924102 [info ] [MainThread]: 
[0m16:43:38.924285 [error] [MainThread]: [31mFailure in model rpt_cohort_retention (models/marts/retention/rpt_cohort_retention.sql)[0m
[0m16:43:38.924455 [error] [MainThread]:   Runtime Error in model rpt_cohort_retention (models/marts/retention/rpt_cohort_retention.sql)
  Binder Error: Values list "ca" does not have a column named "cohort_size"
  
  LINE 51:         ca.cohort_size,
                   ^
[0m16:43:38.924583 [info ] [MainThread]: 
[0m16:43:38.924738 [info ] [MainThread]:   compiled code at target/compiled/quest_kingdom/models/marts/retention/rpt_cohort_retention.sql
[0m16:43:38.924866 [info ] [MainThread]: 
[0m16:43:38.925009 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=4
[0m16:43:38.926176 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 1.0750676, "process_in_blocks": "0", "process_kernel_time": 0.24255, "process_mem_max_rss": "209797120", "process_out_blocks": "0", "process_user_time": 1.523863}
[0m16:43:38.926422 [debug] [MainThread]: Command `dbt run` failed at 16:43:38.926379 after 1.08 seconds
[0m16:43:38.926612 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113fb5820>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111c615e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114e7bd70>]}
[0m16:43:38.926787 [debug] [MainThread]: Flushing usage events
[0m16:43:39.058875 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m16:44:21.579908 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106518e00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10698a5d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106b599d0>]}


============================== 16:44:21.584090 | 44264ff0-77bd-46e1-80f4-f6331608be4a ==============================
[0m16:44:21.584090 [info ] [MainThread]: Running with dbt=1.11.4
[0m16:44:21.584438 [debug] [MainThread]: running dbt with arguments {'use_experimental_parser': 'False', 'debug': 'False', 'introspect': 'True', 'log_cache_events': 'False', 'quiet': 'False', 'write_json': 'True', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'target_path': 'None', 'cache_selected_only': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'use_colors': 'True', 'partial_parse': 'True', 'printer_width': '80', 'invocation_command': 'dbt run --select path:models/marts/retention', 'empty': 'False', 'version_check': 'True', 'profiles_dir': '/Users/hazeldonaldson/.dbt', 'log_format': 'default', 'static_parser': 'True', 'log_path': '/Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/logs', 'fail_fast': 'False', 'warn_error': 'None'}
[0m16:44:21.758292 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '44264ff0-77bd-46e1-80f4-f6331608be4a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106cf65a0>]}
[0m16:44:21.787546 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '44264ff0-77bd-46e1-80f4-f6331608be4a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106e01430>]}
[0m16:44:21.788897 [info ] [MainThread]: Registered adapter: duckdb=1.10.0
[0m16:44:21.842627 [debug] [MainThread]: checksum: 092b177ba87eb6bb3c55954c38aa57900eebac336561eb9ee32218428aa81d43, vars: {}, profile: , target: , version: 1.11.4
[0m16:44:21.909945 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m16:44:21.910385 [debug] [MainThread]: Partial parsing: updated file: quest_kingdom://models/marts/retention/rpt_cohort_retention.sql
[0m16:44:22.104836 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '44264ff0-77bd-46e1-80f4-f6331608be4a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106b87260>]}
[0m16:44:22.181579 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/manifest.json
[0m16:44:22.182983 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/semantic_manifest.json
[0m16:44:22.197794 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '44264ff0-77bd-46e1-80f4-f6331608be4a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1073ba5d0>]}
[0m16:44:22.198097 [info ] [MainThread]: Found 11 models, 32 data tests, 5 sources, 472 macros
[0m16:44:22.198277 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '44264ff0-77bd-46e1-80f4-f6331608be4a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10707eea0>]}
[0m16:44:22.199916 [info ] [MainThread]: 
[0m16:44:22.200105 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m16:44:22.200244 [info ] [MainThread]: 
[0m16:44:22.200468 [debug] [MainThread]: Acquiring new duckdb connection 'master'
[0m16:44:22.202746 [debug] [ThreadPool]: Acquiring new duckdb connection 'list_quest_kingdom'
[0m16:44:22.234782 [debug] [ThreadPool]: Using duckdb connection "list_quest_kingdom"
[0m16:44:22.235058 [debug] [ThreadPool]: On list_quest_kingdom: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "list_quest_kingdom"} */

    
    select schema_name
    from system.information_schema.schemata
    
    where lower(catalog_name) = '"quest_kingdom"'
    
  
  
[0m16:44:22.235224 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:44:22.255315 [debug] [ThreadPool]: SQL status: OK in 0.020 seconds
[0m16:44:22.256584 [debug] [ThreadPool]: On list_quest_kingdom: Close
[0m16:44:22.257070 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_quest_kingdom, now create_quest_kingdom_main)
[0m16:44:22.257315 [debug] [ThreadPool]: Creating schema "database: "quest_kingdom"
schema: "main"
"
[0m16:44:22.260995 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m16:44:22.261266 [debug] [ThreadPool]: On create_quest_kingdom_main: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "create_quest_kingdom_main"} */

    
        select type from duckdb_databases()
        where lower(database_name)='quest_kingdom'
        and type='sqlite'
    
  
[0m16:44:22.261415 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:44:22.262401 [debug] [ThreadPool]: SQL status: OK in 0.001 seconds
[0m16:44:22.263721 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m16:44:22.264203 [debug] [ThreadPool]: On create_quest_kingdom_main: BEGIN
[0m16:44:22.264958 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m16:44:22.265120 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m16:44:22.265257 [debug] [ThreadPool]: On create_quest_kingdom_main: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "create_quest_kingdom_main"} */

    
    
        create schema if not exists "quest_kingdom"."main"
    
[0m16:44:22.265757 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m16:44:22.266261 [debug] [ThreadPool]: On create_quest_kingdom_main: COMMIT
[0m16:44:22.266418 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m16:44:22.266547 [debug] [ThreadPool]: On create_quest_kingdom_main: COMMIT
[0m16:44:22.266806 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m16:44:22.267007 [debug] [ThreadPool]: On create_quest_kingdom_main: Close
[0m16:44:22.267893 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_quest_kingdom_main, now list_quest_kingdom_main)
[0m16:44:22.271016 [debug] [ThreadPool]: Using duckdb connection "list_quest_kingdom_main"
[0m16:44:22.271272 [debug] [ThreadPool]: On list_quest_kingdom_main: BEGIN
[0m16:44:22.271490 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:44:22.271872 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m16:44:22.272013 [debug] [ThreadPool]: Using duckdb connection "list_quest_kingdom_main"
[0m16:44:22.272149 [debug] [ThreadPool]: On list_quest_kingdom_main: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "list_quest_kingdom_main"} */
select
      'quest_kingdom' as database,
      table_name as name,
      table_schema as schema,
      CASE table_type
        WHEN 'BASE TABLE' THEN 'table'
        WHEN 'VIEW' THEN 'view'
        WHEN 'LOCAL TEMPORARY' THEN 'table'
        END as type
    from system.information_schema.tables
    where lower(table_schema) = 'main'
    and lower(table_catalog) = 'quest_kingdom'
  
[0m16:44:22.283118 [debug] [ThreadPool]: SQL status: OK in 0.011 seconds
[0m16:44:22.284029 [debug] [ThreadPool]: On list_quest_kingdom_main: ROLLBACK
[0m16:44:22.284999 [debug] [ThreadPool]: Failed to rollback 'list_quest_kingdom_main'
[0m16:44:22.285157 [debug] [ThreadPool]: On list_quest_kingdom_main: Close
[0m16:44:22.286473 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '44264ff0-77bd-46e1-80f4-f6331608be4a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1073bab10>]}
[0m16:44:22.286721 [debug] [MainThread]: Using duckdb connection "master"
[0m16:44:22.286862 [debug] [MainThread]: On master: BEGIN
[0m16:44:22.286984 [debug] [MainThread]: Opening a new connection, currently in state init
[0m16:44:22.287269 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m16:44:22.287405 [debug] [MainThread]: On master: COMMIT
[0m16:44:22.287532 [debug] [MainThread]: Using duckdb connection "master"
[0m16:44:22.287652 [debug] [MainThread]: On master: COMMIT
[0m16:44:22.287848 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m16:44:22.287975 [debug] [MainThread]: On master: Close
[0m16:44:22.289358 [debug] [Thread-1 (]: Began running node model.quest_kingdom.fct_daily_active_users
[0m16:44:22.289600 [info ] [Thread-1 (]: 1 of 4 START sql table model main.fct_daily_active_users ....................... [RUN]
[0m16:44:22.289808 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_quest_kingdom_main, now model.quest_kingdom.fct_daily_active_users)
[0m16:44:22.289967 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.fct_daily_active_users
[0m16:44:22.293972 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.fct_daily_active_users"
[0m16:44:22.294730 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.fct_daily_active_users
[0m16:44:22.311961 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.fct_daily_active_users"
[0m16:44:22.312688 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.fct_daily_active_users"
[0m16:44:22.312868 [debug] [Thread-1 (]: On model.quest_kingdom.fct_daily_active_users: BEGIN
[0m16:44:22.313020 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:44:22.313384 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:44:22.313532 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.fct_daily_active_users"
[0m16:44:22.313711 [debug] [Thread-1 (]: On model.quest_kingdom.fct_daily_active_users: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.fct_daily_active_users"} */

  
    
    

    create  table
      "quest_kingdom"."main"."fct_daily_active_users__dbt_tmp"
  
    as (
      

with players as (
    select * from "quest_kingdom"."main"."dim_players"
),

sessions as (
    select * from "quest_kingdom"."main"."fct_sessions"
),

--get all dates a player was active
player_activity as (
    select 
        player_id,
        session_date as activity_date,
        count(*) as sessions_that_day,
        sum(session_duration_minutes) as total_play_time_minutes,
        max(ending_level) as max_level_that_day
    from sessions 
    group by player_id, session_date 
),

--join to player attributes
final as (
    select 
        pa.player_id,
        pa.activity_date,
        pa.sessions_that_day,
        pa.total_play_time_minutes,
        pa.max_level_that_day,

        --player context
        p.installed_at,
        p.attribution_channel,
        p.country,
        p.device_type,
        p.player_segment,
        p.experiment_variant,
        p.tutorial_completed,

        --derived metrics
        datediff('day', p.installed_at, pa.activity_date) as days_since_install,

        --cohort
        date_trunc('week', p.installed_at)::date as cohort_week,
        date_trunc('month', p.installed_at)::date as cohort_month
    from player_activity pa 
    inner join players p on pa.player_id = p.player_id 
)

select * from final
    );
  
  
[0m16:44:22.345545 [debug] [Thread-1 (]: SQL status: OK in 0.032 seconds
[0m16:44:22.348790 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.fct_daily_active_users"
[0m16:44:22.349039 [debug] [Thread-1 (]: On model.quest_kingdom.fct_daily_active_users: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.fct_daily_active_users"} */

    SELECT index_name
    FROM duckdb_indexes()
    WHERE schema_name = 'main'
      AND table_name = 'fct_daily_active_users'
  
[0m16:44:22.349584 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:44:22.350251 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.fct_daily_active_users"
[0m16:44:22.350425 [debug] [Thread-1 (]: On model.quest_kingdom.fct_daily_active_users: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.fct_daily_active_users"} */

    SELECT COUNT(*) as remaining_indexes
    FROM duckdb_indexes()
    WHERE schema_name = 'main'
      AND table_name = 'fct_daily_active_users'
  
[0m16:44:22.351203 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m16:44:22.355241 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.fct_daily_active_users"
[0m16:44:22.355496 [debug] [Thread-1 (]: On model.quest_kingdom.fct_daily_active_users: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.fct_daily_active_users"} */
alter table "quest_kingdom"."main"."fct_daily_active_users" rename to "fct_daily_active_users__dbt_backup"
[0m16:44:22.356422 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m16:44:22.358068 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.fct_daily_active_users"
[0m16:44:22.358268 [debug] [Thread-1 (]: On model.quest_kingdom.fct_daily_active_users: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.fct_daily_active_users"} */
alter table "quest_kingdom"."main"."fct_daily_active_users__dbt_tmp" rename to "fct_daily_active_users"
[0m16:44:22.358621 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:44:22.366600 [debug] [Thread-1 (]: On model.quest_kingdom.fct_daily_active_users: COMMIT
[0m16:44:22.366897 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.fct_daily_active_users"
[0m16:44:22.367071 [debug] [Thread-1 (]: On model.quest_kingdom.fct_daily_active_users: COMMIT
[0m16:44:22.380500 [debug] [Thread-1 (]: SQL status: OK in 0.013 seconds
[0m16:44:22.383711 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.fct_daily_active_users"
[0m16:44:22.383940 [debug] [Thread-1 (]: On model.quest_kingdom.fct_daily_active_users: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.fct_daily_active_users"} */

      drop table if exists "quest_kingdom"."main"."fct_daily_active_users__dbt_backup" cascade
    
[0m16:44:22.384928 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m16:44:22.386374 [debug] [Thread-1 (]: On model.quest_kingdom.fct_daily_active_users: Close
[0m16:44:22.387439 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '44264ff0-77bd-46e1-80f4-f6331608be4a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10729bc20>]}
[0m16:44:22.387780 [info ] [Thread-1 (]: 1 of 4 OK created sql table model main.fct_daily_active_users .................. [[32mOK[0m in 0.10s]
[0m16:44:22.388069 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.fct_daily_active_users
[0m16:44:22.388478 [debug] [Thread-1 (]: Began running node model.quest_kingdom.rpt_cohort_retention
[0m16:44:22.388795 [info ] [Thread-1 (]: 2 of 4 START sql table model main.rpt_cohort_retention ......................... [RUN]
[0m16:44:22.389037 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.quest_kingdom.fct_daily_active_users, now model.quest_kingdom.rpt_cohort_retention)
[0m16:44:22.389225 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.rpt_cohort_retention
[0m16:44:22.391556 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.rpt_cohort_retention"
[0m16:44:22.392133 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.rpt_cohort_retention
[0m16:44:22.394422 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.rpt_cohort_retention"
[0m16:44:22.395061 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_cohort_retention"
[0m16:44:22.395247 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_cohort_retention: BEGIN
[0m16:44:22.395407 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:44:22.395875 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:44:22.396034 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_cohort_retention"
[0m16:44:22.396252 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_cohort_retention: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_cohort_retention"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_cohort_retention__dbt_tmp"
  
    as (
      

with daily_activity as (
    select * from "quest_kingdom"."main"."fct_daily_active_users"
),

--calculate weeks since install for each activity
activity_by_week as (
    select 
        player_id,
        cohort_week,
        activity_date,
        days_since_install,
        floor(days_since_install / 7) as weeks_since_install
    from daily_activity
),

--get cohort sizes
cohort_sizes as (
    select 
        cohort_week,
        count(distinct player_id) as cohort_size 
    from activity_by_week
    group by cohort_week 
),

--count active users by cohort and week
cohort_activity as (
    select 
        cohort_week,
        weeks_since_install,
        count(distinct player_id) as active_users 
    from activity_by_week
    group by cohort_week, weeks_since_install
),

--calculate retention percentages
cohort_retention as (
    select 
        ca.cohort_week,
        cs.cohort_size,
        ca.weeks_since_install,
        ca.active_users,
        round(ca.active_users::float / cs.cohort_size * 100, 2) as retention_pct
    from cohort_activity ca 
    inner join cohort_sizes cs on ca.cohort_week = cs.cohort_week
),

--pivot to wide format for easier analysis
pivoted as (
    select 
        cohort_week,
        cohort_size,

        max(case when weeks_since_install = 0 then retention_pct end) as week_0,
        max(case when weeks_since_install = 1 then retention_pct end) as week_1,
        max(case when weeks_since_install = 2 then retention_pct end) as week_2,
        max(case when weeks_since_install = 3 then retention_pct end) as week_3,
        max(case when weeks_since_install = 4 then retention_pct end) as week_4,
        max(case when weeks_since_install = 5 then retention_pct end) as week_5,
        max(case when weeks_since_install = 6 then retention_pct end) as week_6,
        max(case when weeks_since_install = 7 then retention_pct end) as week_7,
        max(case when weeks_since_install = 8 then retention_pct end) as week_8,
        max(case when weeks_since_install = 9 then retention_pct end) as week_9,
        max(case when weeks_since_install = 10 then retention_pct end) as week_10,
        max(case when weeks_since_install = 11 then retention_pct end) as week_11,
        max(case when weeks_since_install = 12 then retention_pct end) as week_12,
    from cohort_retention
    group by cohort_week, cohort_size
)

select * from pivoted 
order by cohort_week desc
    );
  
  
[0m16:44:22.406226 [debug] [Thread-1 (]: SQL status: OK in 0.010 seconds
[0m16:44:22.408615 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_cohort_retention"
[0m16:44:22.411398 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_cohort_retention: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_cohort_retention"} */
alter table "quest_kingdom"."main"."rpt_cohort_retention__dbt_tmp" rename to "rpt_cohort_retention"
[0m16:44:22.412342 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:44:22.413237 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_cohort_retention: COMMIT
[0m16:44:22.413436 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_cohort_retention"
[0m16:44:22.413598 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_cohort_retention: COMMIT
[0m16:44:22.414280 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m16:44:22.415567 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_cohort_retention"
[0m16:44:22.415753 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_cohort_retention: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_cohort_retention"} */

      drop table if exists "quest_kingdom"."main"."rpt_cohort_retention__dbt_backup" cascade
    
[0m16:44:22.416047 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:44:22.416708 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_cohort_retention: Close
[0m16:44:22.416994 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '44264ff0-77bd-46e1-80f4-f6331608be4a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10772b350>]}
[0m16:44:22.417307 [info ] [Thread-1 (]: 2 of 4 OK created sql table model main.rpt_cohort_retention .................... [[32mOK[0m in 0.03s]
[0m16:44:22.417572 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.rpt_cohort_retention
[0m16:44:22.417763 [debug] [Thread-1 (]: Began running node model.quest_kingdom.rpt_d1_d7_d30_retention
[0m16:44:22.418000 [info ] [Thread-1 (]: 3 of 4 START sql table model main.rpt_d1_d7_d30_retention ...................... [RUN]
[0m16:44:22.418197 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.quest_kingdom.rpt_cohort_retention, now model.quest_kingdom.rpt_d1_d7_d30_retention)
[0m16:44:22.418360 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.rpt_d1_d7_d30_retention
[0m16:44:22.420062 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.rpt_d1_d7_d30_retention"
[0m16:44:22.420761 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.rpt_d1_d7_d30_retention
[0m16:44:22.423539 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.rpt_d1_d7_d30_retention"
[0m16:44:22.424669 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_d1_d7_d30_retention"
[0m16:44:22.424875 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_d1_d7_d30_retention: BEGIN
[0m16:44:22.425036 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:44:22.425451 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:44:22.425611 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_d1_d7_d30_retention"
[0m16:44:22.425809 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_d1_d7_d30_retention: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_d1_d7_d30_retention"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_d1_d7_d30_retention__dbt_tmp"
  
    as (
      

with players as (
    select * from "quest_kingdom"."main"."dim_players"
),

daily_activity as (
    select * from "quest_kingdom"."main"."fct_daily_active_users"
),

--for each player, chekc if they were active on D1, D7, D30
player_retention as (
    select 
        p.player_id,
        p.installed_at,
        p.attribution_channel,
        p.country,
        p.device_type,
        p.player_segment,
        p.experiment_variant,
        p.tutorial_completed,
        p.cohort_week,
        p.cohort_month,

        --D1: active on day after install
        max(case when da.days_since_install = 1 then 1 else 0 end) as retained_d1,
        -- D7: active 7 days after install
        max(case when da.days_since_install = 7 then 1 else 0 end) as retained_d7,
        -- D30: active 30 days after install
        max(case when da.days_since_install = 30 then 1 else 0 end) as retained_d30,

        --also need to track if active in ranges (should be more forgiving)
        max(case when da.days_since_install between 1 and 1 then 1 else 0 end) as active_d1_window,
        max(case when da.days_since_install between 6 and 8 then 1 else 0 end) as active_d7_window,
        max(case when da.days_since_install between 28 and 32 then 1 else 0 end) as active_d30_window,

        --total days active
        count(distinct da.activity_date) as total_active_days
    from players p 
    left join daily_activity da on p.player_id = da.player_id 
    group by 
        p.player_id, p.installed_at, p.attribution_channel, p.country,
        p.device_type, p.player_segment, p.experiment_variant,
        p.tutorial_completed, p.cohort_week, p.cohort_month 
)

select * from player_retention
    );
  
  
[0m16:44:22.452573 [debug] [Thread-1 (]: SQL status: OK in 0.026 seconds
[0m16:44:22.453260 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_d1_d7_d30_retention"
[0m16:44:22.453446 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_d1_d7_d30_retention: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_d1_d7_d30_retention"} */

    SELECT index_name
    FROM duckdb_indexes()
    WHERE schema_name = 'main'
      AND table_name = 'rpt_d1_d7_d30_retention'
  
[0m16:44:22.453934 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:44:22.454539 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_d1_d7_d30_retention"
[0m16:44:22.454706 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_d1_d7_d30_retention: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_d1_d7_d30_retention"} */

    SELECT COUNT(*) as remaining_indexes
    FROM duckdb_indexes()
    WHERE schema_name = 'main'
      AND table_name = 'rpt_d1_d7_d30_retention'
  
[0m16:44:22.455105 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:44:22.456679 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_d1_d7_d30_retention"
[0m16:44:22.456912 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_d1_d7_d30_retention: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_d1_d7_d30_retention"} */
alter table "quest_kingdom"."main"."rpt_d1_d7_d30_retention" rename to "rpt_d1_d7_d30_retention__dbt_backup"
[0m16:44:22.457315 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:44:22.458766 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_d1_d7_d30_retention"
[0m16:44:22.458948 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_d1_d7_d30_retention: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_d1_d7_d30_retention"} */
alter table "quest_kingdom"."main"."rpt_d1_d7_d30_retention__dbt_tmp" rename to "rpt_d1_d7_d30_retention"
[0m16:44:22.459248 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:44:22.460017 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_d1_d7_d30_retention: COMMIT
[0m16:44:22.460179 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_d1_d7_d30_retention"
[0m16:44:22.460322 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_d1_d7_d30_retention: COMMIT
[0m16:44:22.462669 [debug] [Thread-1 (]: SQL status: OK in 0.002 seconds
[0m16:44:22.463793 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_d1_d7_d30_retention"
[0m16:44:22.463957 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_d1_d7_d30_retention: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_d1_d7_d30_retention"} */

      drop table if exists "quest_kingdom"."main"."rpt_d1_d7_d30_retention__dbt_backup" cascade
    
[0m16:44:22.464389 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:44:22.465077 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_d1_d7_d30_retention: Close
[0m16:44:22.465352 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '44264ff0-77bd-46e1-80f4-f6331608be4a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10773b7a0>]}
[0m16:44:22.465643 [info ] [Thread-1 (]: 3 of 4 OK created sql table model main.rpt_d1_d7_d30_retention ................. [[32mOK[0m in 0.05s]
[0m16:44:22.465900 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.rpt_d1_d7_d30_retention
[0m16:44:22.466083 [debug] [Thread-1 (]: Began running node model.quest_kingdom.rpt_retention_curves
[0m16:44:22.466301 [info ] [Thread-1 (]: 4 of 4 START sql table model main.rpt_retention_curves ......................... [RUN]
[0m16:44:22.466489 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.quest_kingdom.rpt_d1_d7_d30_retention, now model.quest_kingdom.rpt_retention_curves)
[0m16:44:22.466651 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.rpt_retention_curves
[0m16:44:22.468184 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.rpt_retention_curves"
[0m16:44:22.468730 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.rpt_retention_curves
[0m16:44:22.470322 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.rpt_retention_curves"
[0m16:44:22.470783 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_retention_curves"
[0m16:44:22.470943 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_retention_curves: BEGIN
[0m16:44:22.471089 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:44:22.471389 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:44:22.471540 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_retention_curves"
[0m16:44:22.471729 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_retention_curves: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_retention_curves"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_retention_curves__dbt_tmp"
  
    as (
      

with daily_activity as (
    select * from "quest_kingdom"."main"."fct_daily_active_users"
),

--calculate weeks since install
activity_by_week as (
    select
        player_id,
        cohort_week,
        activity_date,
        days_since_install,
        floor(days_since_install / 7) as weeks_since_install 
    from daily_activity
),

--get cohort sizes 
cohort_sizes as (
    select 
        cohort_week,
        count(distinct player_id) as cohort_size 
    from activity_by_week
    group by cohort_week
),

--countr active users by cohort and week
cohort_activity as (
    select 
        cohort_week,
        weeks_since_install,
        count(distinct player_id) as active_users 
    from activity_by_week
    where weeks_since_install <= 12 --only tracking the first 12 weeks
    group by cohort_week, weeks_since_install
),

--calculate retention
final as (
    select
        ca.cohort_week,
        cs.cohort_size,
        ca.weeks_since_install,
        ca.active_users,
        ca.active_users::float / cs.cohort_size as retention_rate,
        round(ca.active_users::float / cs.cohort_size * 100, 1) as retention_pct,
        --cohort label for charts
        cs.cohort_week::varchar || ' Cohort' as cohort_label
    from cohort_activity ca 
    inner join cohort_sizes cs on ca.cohort_week = cs.cohort_week
)

select * from final
order by cohort_week, weeks_since_install
    );
  
  
[0m16:44:22.478302 [debug] [Thread-1 (]: SQL status: OK in 0.006 seconds
[0m16:44:22.478998 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_retention_curves"
[0m16:44:22.479181 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_retention_curves: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_retention_curves"} */

    SELECT index_name
    FROM duckdb_indexes()
    WHERE schema_name = 'main'
      AND table_name = 'rpt_retention_curves'
  
[0m16:44:22.479653 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:44:22.480242 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_retention_curves"
[0m16:44:22.480410 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_retention_curves: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_retention_curves"} */

    SELECT COUNT(*) as remaining_indexes
    FROM duckdb_indexes()
    WHERE schema_name = 'main'
      AND table_name = 'rpt_retention_curves'
  
[0m16:44:22.480812 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:44:22.482393 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_retention_curves"
[0m16:44:22.482565 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_retention_curves: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_retention_curves"} */
alter table "quest_kingdom"."main"."rpt_retention_curves" rename to "rpt_retention_curves__dbt_backup"
[0m16:44:22.482868 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:44:22.484180 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_retention_curves"
[0m16:44:22.484343 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_retention_curves: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_retention_curves"} */
alter table "quest_kingdom"."main"."rpt_retention_curves__dbt_tmp" rename to "rpt_retention_curves"
[0m16:44:22.484613 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:44:22.485359 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_retention_curves: COMMIT
[0m16:44:22.485512 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_retention_curves"
[0m16:44:22.485649 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_retention_curves: COMMIT
[0m16:44:22.486070 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:44:22.487204 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_retention_curves"
[0m16:44:22.487373 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_retention_curves: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_retention_curves"} */

      drop table if exists "quest_kingdom"."main"."rpt_retention_curves__dbt_backup" cascade
    
[0m16:44:22.487736 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:44:22.488354 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_retention_curves: Close
[0m16:44:22.488617 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '44264ff0-77bd-46e1-80f4-f6331608be4a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1072cb1d0>]}
[0m16:44:22.488898 [info ] [Thread-1 (]: 4 of 4 OK created sql table model main.rpt_retention_curves .................... [[32mOK[0m in 0.02s]
[0m16:44:22.489143 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.rpt_retention_curves
[0m16:44:22.489659 [debug] [MainThread]: Using duckdb connection "master"
[0m16:44:22.489800 [debug] [MainThread]: On master: BEGIN
[0m16:44:22.489924 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m16:44:22.490205 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m16:44:22.490386 [debug] [MainThread]: On master: COMMIT
[0m16:44:22.490533 [debug] [MainThread]: Using duckdb connection "master"
[0m16:44:22.490664 [debug] [MainThread]: On master: COMMIT
[0m16:44:22.490873 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m16:44:22.491006 [debug] [MainThread]: On master: Close
[0m16:44:22.491179 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:44:22.491305 [debug] [MainThread]: Connection 'model.quest_kingdom.rpt_retention_curves' was properly closed.
[0m16:44:22.491465 [info ] [MainThread]: 
[0m16:44:22.491612 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 0.29 seconds (0.29s).
[0m16:44:22.492058 [debug] [MainThread]: Command end result
[0m16:44:22.506997 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/manifest.json
[0m16:44:22.508040 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/semantic_manifest.json
[0m16:44:22.511059 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/run_results.json
[0m16:44:22.511212 [info ] [MainThread]: 
[0m16:44:22.511384 [info ] [MainThread]: [32mCompleted successfully[0m
[0m16:44:22.511515 [info ] [MainThread]: 
[0m16:44:22.511665 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=4
[0m16:44:22.513047 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 0.9763212, "process_in_blocks": "0", "process_kernel_time": 0.207859, "process_mem_max_rss": "224575488", "process_out_blocks": "0", "process_user_time": 1.476714}
[0m16:44:22.513265 [debug] [MainThread]: Command `dbt run` succeeded at 16:44:22.513224 after 0.98 seconds
[0m16:44:22.513444 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106b598b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105e056a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10775dac0>]}
[0m16:44:22.513613 [debug] [MainThread]: Flushing usage events
[0m16:44:22.605952 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m14:42:07.095933 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1065bb4d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10730da90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10730d850>]}


============================== 14:42:07.102736 | 0ef61420-0825-4beb-8014-362a38ee8046 ==============================
[0m14:42:07.102736 [info ] [MainThread]: Running with dbt=1.11.4
[0m14:42:07.103088 [debug] [MainThread]: running dbt with arguments {'no_print': 'None', 'send_anonymous_usage_stats': 'True', 'log_path': '/Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/logs', 'indirect_selection': 'eager', 'partial_parse': 'True', 'empty': 'False', 'profiles_dir': '/Users/hazeldonaldson/.dbt', 'debug': 'False', 'static_parser': 'True', 'fail_fast': 'False', 'log_cache_events': 'False', 'log_format': 'default', 'target_path': 'None', 'printer_width': '80', 'quiet': 'False', 'use_experimental_parser': 'False', 'use_colors': 'True', 'invocation_command': 'dbt run --select path:models/marts/monetization', 'cache_selected_only': 'False', 'introspect': 'True', 'warn_error': 'None', 'write_json': 'True', 'version_check': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])'}
[0m14:42:07.275645 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '0ef61420-0825-4beb-8014-362a38ee8046', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106c30b00>]}
[0m14:42:07.304845 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '0ef61420-0825-4beb-8014-362a38ee8046', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106712840>]}
[0m14:42:07.306219 [info ] [MainThread]: Registered adapter: duckdb=1.10.0
[0m14:42:07.364045 [debug] [MainThread]: checksum: 092b177ba87eb6bb3c55954c38aa57900eebac336561eb9ee32218428aa81d43, vars: {}, profile: , target: , version: 1.11.4
[0m14:42:07.414949 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m14:42:07.415255 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '0ef61420-0825-4beb-8014-362a38ee8046', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106c56f00>]}
[0m14:42:08.081992 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '0ef61420-0825-4beb-8014-362a38ee8046', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107a57860>]}
[0m14:42:08.122668 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/manifest.json
[0m14:42:08.124051 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/semantic_manifest.json
[0m14:42:08.138263 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '0ef61420-0825-4beb-8014-362a38ee8046', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107f9a3f0>]}
[0m14:42:08.138535 [info ] [MainThread]: Found 15 models, 40 data tests, 5 sources, 472 macros
[0m14:42:08.138703 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0ef61420-0825-4beb-8014-362a38ee8046', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107f36540>]}
[0m14:42:08.140458 [info ] [MainThread]: 
[0m14:42:08.140642 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m14:42:08.140785 [info ] [MainThread]: 
[0m14:42:08.141038 [debug] [MainThread]: Acquiring new duckdb connection 'master'
[0m14:42:08.143184 [debug] [ThreadPool]: Acquiring new duckdb connection 'list_quest_kingdom'
[0m14:42:08.172054 [debug] [ThreadPool]: Using duckdb connection "list_quest_kingdom"
[0m14:42:08.172293 [debug] [ThreadPool]: On list_quest_kingdom: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "list_quest_kingdom"} */

    
    select schema_name
    from system.information_schema.schemata
    
    where lower(catalog_name) = '"quest_kingdom"'
    
  
  
[0m14:42:08.172438 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:42:08.191630 [debug] [ThreadPool]: SQL status: OK in 0.019 seconds
[0m14:42:08.192619 [debug] [ThreadPool]: On list_quest_kingdom: Close
[0m14:42:08.192973 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_quest_kingdom, now create_quest_kingdom_main)
[0m14:42:08.193223 [debug] [ThreadPool]: Creating schema "database: "quest_kingdom"
schema: "main"
"
[0m14:42:08.196425 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m14:42:08.196597 [debug] [ThreadPool]: On create_quest_kingdom_main: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "create_quest_kingdom_main"} */

    
        select type from duckdb_databases()
        where lower(database_name)='quest_kingdom'
        and type='sqlite'
    
  
[0m14:42:08.196802 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:42:08.197576 [debug] [ThreadPool]: SQL status: OK in 0.001 seconds
[0m14:42:08.198371 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m14:42:08.198507 [debug] [ThreadPool]: On create_quest_kingdom_main: BEGIN
[0m14:42:08.198720 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m14:42:08.198843 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m14:42:08.198964 [debug] [ThreadPool]: On create_quest_kingdom_main: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "create_quest_kingdom_main"} */

    
    
        create schema if not exists "quest_kingdom"."main"
    
[0m14:42:08.199208 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m14:42:08.199576 [debug] [ThreadPool]: On create_quest_kingdom_main: COMMIT
[0m14:42:08.199705 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m14:42:08.199815 [debug] [ThreadPool]: On create_quest_kingdom_main: COMMIT
[0m14:42:08.200004 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m14:42:08.200130 [debug] [ThreadPool]: On create_quest_kingdom_main: Close
[0m14:42:08.200954 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_quest_kingdom_main, now list_quest_kingdom_main)
[0m14:42:08.203668 [debug] [ThreadPool]: Using duckdb connection "list_quest_kingdom_main"
[0m14:42:08.203844 [debug] [ThreadPool]: On list_quest_kingdom_main: BEGIN
[0m14:42:08.203972 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:42:08.204221 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m14:42:08.204352 [debug] [ThreadPool]: Using duckdb connection "list_quest_kingdom_main"
[0m14:42:08.204486 [debug] [ThreadPool]: On list_quest_kingdom_main: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "list_quest_kingdom_main"} */
select
      'quest_kingdom' as database,
      table_name as name,
      table_schema as schema,
      CASE table_type
        WHEN 'BASE TABLE' THEN 'table'
        WHEN 'VIEW' THEN 'view'
        WHEN 'LOCAL TEMPORARY' THEN 'table'
        END as type
    from system.information_schema.tables
    where lower(table_schema) = 'main'
    and lower(table_catalog) = 'quest_kingdom'
  
[0m14:42:08.215499 [debug] [ThreadPool]: SQL status: OK in 0.011 seconds
[0m14:42:08.216259 [debug] [ThreadPool]: On list_quest_kingdom_main: ROLLBACK
[0m14:42:08.217313 [debug] [ThreadPool]: Failed to rollback 'list_quest_kingdom_main'
[0m14:42:08.217451 [debug] [ThreadPool]: On list_quest_kingdom_main: Close
[0m14:42:08.218769 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0ef61420-0825-4beb-8014-362a38ee8046', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107f53b00>]}
[0m14:42:08.219005 [debug] [MainThread]: Using duckdb connection "master"
[0m14:42:08.219139 [debug] [MainThread]: On master: BEGIN
[0m14:42:08.219256 [debug] [MainThread]: Opening a new connection, currently in state init
[0m14:42:08.219511 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m14:42:08.219642 [debug] [MainThread]: On master: COMMIT
[0m14:42:08.219767 [debug] [MainThread]: Using duckdb connection "master"
[0m14:42:08.219884 [debug] [MainThread]: On master: COMMIT
[0m14:42:08.220071 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m14:42:08.220195 [debug] [MainThread]: On master: Close
[0m14:42:08.221645 [debug] [Thread-1 (]: Began running node model.quest_kingdom.rpt_conversion_funnel
[0m14:42:08.221876 [info ] [Thread-1 (]: 1 of 4 START sql table model main.rpt_conversion_funnel ........................ [RUN]
[0m14:42:08.222068 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_quest_kingdom_main, now model.quest_kingdom.rpt_conversion_funnel)
[0m14:42:08.222225 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.rpt_conversion_funnel
[0m14:42:08.225707 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.rpt_conversion_funnel"
[0m14:42:08.226303 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.rpt_conversion_funnel
[0m14:42:08.276537 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.rpt_conversion_funnel"
[0m14:42:08.277148 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_conversion_funnel"
[0m14:42:08.277321 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_conversion_funnel: BEGIN
[0m14:42:08.277472 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:42:08.277827 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m14:42:08.277972 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_conversion_funnel"
[0m14:42:08.278135 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_conversion_funnel: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_conversion_funnel"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_conversion_funnel__dbt_tmp"
  
    as (
      

with players as (
    select * from "quest_kingdom"."main"."dim_players"
),

--define funnel stages
player_funnel as (
    select 
        player_id,
        installed_at,
        cohort_week,
        attribution_channel,
        player_segment,
        experiment_variant,

        --funnel stages (boolean)
        true as stage_1_installed,
        tutorial_completed as stage_2_tutorial_completed,
        is_activated as stage_3_had_session,
        max_level_reached >= 5 as stage_4_reached_level_5,
        is_payer as stage_5_first_purchase,

        --time to each stage
        0 as days_to_install,
        case when tutorial_completed then 0 else null end as days_to_tutorial,
        case when is_activated then 0 else null end as days_to_first_session,
        case when max_level_reached >= 5 then days_to_first_purchase else null end as days_to_level_5,
        days_to_first_purchase
    from players 
)

select * from player_funnel
    );
  
  
[0m14:42:08.286252 [debug] [Thread-1 (]: SQL status: OK in 0.008 seconds
[0m14:42:08.289560 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_conversion_funnel"
[0m14:42:08.289757 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_conversion_funnel: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_conversion_funnel"} */
alter table "quest_kingdom"."main"."rpt_conversion_funnel__dbt_tmp" rename to "rpt_conversion_funnel"
[0m14:42:08.290638 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m14:42:08.296735 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_conversion_funnel: COMMIT
[0m14:42:08.296939 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_conversion_funnel"
[0m14:42:08.297091 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_conversion_funnel: COMMIT
[0m14:42:08.299708 [debug] [Thread-1 (]: SQL status: OK in 0.002 seconds
[0m14:42:08.302430 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_conversion_funnel"
[0m14:42:08.302639 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_conversion_funnel: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_conversion_funnel"} */

      drop table if exists "quest_kingdom"."main"."rpt_conversion_funnel__dbt_backup" cascade
    
[0m14:42:08.303305 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m14:42:08.304456 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_conversion_funnel: Close
[0m14:42:08.305415 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0ef61420-0825-4beb-8014-362a38ee8046', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1065873b0>]}
[0m14:42:08.305719 [info ] [Thread-1 (]: 1 of 4 OK created sql table model main.rpt_conversion_funnel ................... [[32mOK[0m in 0.08s]
[0m14:42:08.305984 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.rpt_conversion_funnel
[0m14:42:08.306175 [debug] [Thread-1 (]: Began running node model.quest_kingdom.rpt_daily_revenue
[0m14:42:08.306405 [info ] [Thread-1 (]: 2 of 4 START sql table model main.rpt_daily_revenue ............................ [RUN]
[0m14:42:08.306598 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.quest_kingdom.rpt_conversion_funnel, now model.quest_kingdom.rpt_daily_revenue)
[0m14:42:08.306757 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.rpt_daily_revenue
[0m14:42:08.308475 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.rpt_daily_revenue"
[0m14:42:08.308804 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.rpt_daily_revenue
[0m14:42:08.310367 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.rpt_daily_revenue"
[0m14:42:08.310670 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_daily_revenue"
[0m14:42:08.310826 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_daily_revenue: BEGIN
[0m14:42:08.311069 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:42:08.311445 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m14:42:08.311619 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_daily_revenue"
[0m14:42:08.311852 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_daily_revenue: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_daily_revenue"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_daily_revenue__dbt_tmp"
  
    as (
      

with daily_active_users as (
    select * from "quest_kingdom"."main"."fct_daily_active_users"
),

iap_transactions as (
    select * from "quest_kingdom"."main"."stg_iap_transactions"
),

ad_impressions as (
    select * from "quest_kingdom"."main"."stg_ad_impressions"
),

--daily IAP revenue
daily_iap as (
    select
        purchase_date as revenue_date,
        count(distinct player_id) as payer_users,
        count(*) as transactions,
        sum(price_usd) as iap_revenue,
        avg(price_usd) as avg_transaction_value
    from iap_transactions
    group by purchase_date
),

--daily ad revenue
daily_ads as (
    select 
        ad_date as revenue_date,
        count(distinct player_id) as users_with_ads,
        count(*) as impressions,
        sum(revenue_usd) as ad_revenue,
        sum(case when clicked then 1 else 0 end) as clicks
    from ad_impressions
    group by ad_date 
),

--daily active users
daily_dau as (
    select 
        activity_date as revenue_date,
        count(distinct player_id) as dau 
    from daily_active_users
    group by activity_date
),

--combine all metrics
final as (
    select
        coalesce(d.revenue_date, i.revenue_date, a.revenue_date) as revenue_date,
        --user counts
        coalesce(d.dau, 0) as dau,
        coalesce(i.payer_users, 0) as payer_users,
        coalesce(a.users_with_ads, 0) as users_with_ads,
        --revenue
        coalesce(i.iap_revenue, 0) as iap_revenue,
        coalesce(a.ad_revenue, 0) as ad_revenue,
        coalesce(i.iap_revenue, 0) + coalesce(a.ad_revenue, 0) as total_revenue,
        --transactions and impressions
        coalesce(i.transactions, 0) as iap_transactions,
        coalesce(a.impressions, 0) as ad_impressions,
        coalesce(a.clicks, 0) as ad_clicks,
        --per-transaction metrics
        i.avg_transaction_value,
        --ARPDAU (average revenue per daily active user)
        case
            when coalesce(d.dau, 0) > 0
            then (coalesce(i.iap_revenue, 0) + coalesce(a.ad_revenue, 0)) / d.dau
            else 0
        end as arpdau,
        --ARPPU (average revenue per paying user)
        case
            when coalesce(i.paying_users, 0) > 0
            then coalesce(i.iap_revenue, 0) / i.paying_users
            else 0
        end as arppu,
        --conversion rate (paying users /DAU)
        case
            when coalesce(d.dau, 0) > 0
            then coalesce(i.paying_users, 0)::float / d.dau * 100
            else 0
        end as daily_conversion_rate,
        --ad metrics
        case 
            when coalesce(a.impressions, 0) > 0
            then coalesce(a.clicks, 0)::float / a.impressions * 100
            else 0
        end as ad_ctr
    from daily_dau d 
    full outer join daily_iap i on d.revenue_date = i.revenue_date
    full outer join daily_ads a on d.revenue_date = a.revenue_date
)

select * from final
order by revenue_date
    );
  
  
[0m14:42:08.317969 [debug] [Thread-1 (]: DuckDB adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_daily_revenue"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_daily_revenue__dbt_tmp"
  
    as (
      

with daily_active_users as (
    select * from "quest_kingdom"."main"."fct_daily_active_users"
),

iap_transactions as (
    select * from "quest_kingdom"."main"."stg_iap_transactions"
),

ad_impressions as (
    select * from "quest_kingdom"."main"."stg_ad_impressions"
),

--daily IAP revenue
daily_iap as (
    select
        purchase_date as revenue_date,
        count(distinct player_id) as payer_users,
        count(*) as transactions,
        sum(price_usd) as iap_revenue,
        avg(price_usd) as avg_transaction_value
    from iap_transactions
    group by purchase_date
),

--daily ad revenue
daily_ads as (
    select 
        ad_date as revenue_date,
        count(distinct player_id) as users_with_ads,
        count(*) as impressions,
        sum(revenue_usd) as ad_revenue,
        sum(case when clicked then 1 else 0 end) as clicks
    from ad_impressions
    group by ad_date 
),

--daily active users
daily_dau as (
    select 
        activity_date as revenue_date,
        count(distinct player_id) as dau 
    from daily_active_users
    group by activity_date
),

--combine all metrics
final as (
    select
        coalesce(d.revenue_date, i.revenue_date, a.revenue_date) as revenue_date,
        --user counts
        coalesce(d.dau, 0) as dau,
        coalesce(i.payer_users, 0) as payer_users,
        coalesce(a.users_with_ads, 0) as users_with_ads,
        --revenue
        coalesce(i.iap_revenue, 0) as iap_revenue,
        coalesce(a.ad_revenue, 0) as ad_revenue,
        coalesce(i.iap_revenue, 0) + coalesce(a.ad_revenue, 0) as total_revenue,
        --transactions and impressions
        coalesce(i.transactions, 0) as iap_transactions,
        coalesce(a.impressions, 0) as ad_impressions,
        coalesce(a.clicks, 0) as ad_clicks,
        --per-transaction metrics
        i.avg_transaction_value,
        --ARPDAU (average revenue per daily active user)
        case
            when coalesce(d.dau, 0) > 0
            then (coalesce(i.iap_revenue, 0) + coalesce(a.ad_revenue, 0)) / d.dau
            else 0
        end as arpdau,
        --ARPPU (average revenue per paying user)
        case
            when coalesce(i.paying_users, 0) > 0
            then coalesce(i.iap_revenue, 0) / i.paying_users
            else 0
        end as arppu,
        --conversion rate (paying users /DAU)
        case
            when coalesce(d.dau, 0) > 0
            then coalesce(i.paying_users, 0)::float / d.dau * 100
            else 0
        end as daily_conversion_rate,
        --ad metrics
        case 
            when coalesce(a.impressions, 0) > 0
            then coalesce(a.clicks, 0)::float / a.impressions * 100
            else 0
        end as ad_ctr
    from daily_dau d 
    full outer join daily_iap i on d.revenue_date = i.revenue_date
    full outer join daily_ads a on d.revenue_date = a.revenue_date
)

select * from final
order by revenue_date
    );
  
  
[0m14:42:08.318307 [debug] [Thread-1 (]: DuckDB adapter: Rolling back transaction.
[0m14:42:08.318540 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_daily_revenue: ROLLBACK
[0m14:42:08.323130 [debug] [Thread-1 (]: Failed to rollback 'model.quest_kingdom.rpt_daily_revenue'
[0m14:42:08.323346 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_daily_revenue: Close
[0m14:42:08.324641 [debug] [Thread-1 (]: Runtime Error in model rpt_daily_revenue (models/marts/monetization/rpt_daily_revenue.sql)
  Binder Error: Values list "i" does not have a column named "paying_users"
  
  LINE 84:             when coalesce(i.paying_users, 0) > 0
                                     ^
[0m14:42:08.324909 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0ef61420-0825-4beb-8014-362a38ee8046', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107a570b0>]}
[0m14:42:08.325220 [error] [Thread-1 (]: 2 of 4 ERROR creating sql table model main.rpt_daily_revenue ................... [[31mERROR[0m in 0.02s]
[0m14:42:08.325482 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.rpt_daily_revenue
[0m14:42:08.325670 [debug] [Thread-1 (]: Began running node model.quest_kingdom.rpt_player_ltv
[0m14:42:08.325901 [debug] [Thread-4 (]: Marking all children of 'model.quest_kingdom.rpt_daily_revenue' to be skipped because of status 'error'.  Reason: Runtime Error in model rpt_daily_revenue (models/marts/monetization/rpt_daily_revenue.sql)
  Binder Error: Values list "i" does not have a column named "paying_users"
  
  LINE 84:             when coalesce(i.paying_users, 0) > 0
                                     ^.
[0m14:42:08.326113 [info ] [Thread-1 (]: 3 of 4 START sql table model main.rpt_player_ltv ............................... [RUN]
[0m14:42:08.326667 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.quest_kingdom.rpt_daily_revenue, now model.quest_kingdom.rpt_player_ltv)
[0m14:42:08.326829 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.rpt_player_ltv
[0m14:42:08.328503 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.rpt_player_ltv"
[0m14:42:08.328938 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.rpt_player_ltv
[0m14:42:08.330515 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.rpt_player_ltv"
[0m14:42:08.330869 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_player_ltv"
[0m14:42:08.331024 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_player_ltv: BEGIN
[0m14:42:08.331164 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:42:08.331614 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m14:42:08.331833 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_player_ltv"
[0m14:42:08.332053 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_player_ltv: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_player_ltv"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_player_ltv__dbt_tmp"
  
    as (
      

with players as (
    select * from "quest_kingdom"."main"."dim_players"
),

--calculate LTV for each player
player_ltv as (
    select 
        player_id,
        installed_at,
        cohort_week,
        cohort_month,
        attribution_channel,
        country,
        device_type,
        player_segment,
        experiment_variant,
        tutorial_completed,

        --revenue
        total_iap_revenue,
        total_ad_revenue,
        total_revenue,

        --purchase behavior
        total_purchases,
        first_purchase_at,
        days_to_first_purchase,
        avg_purchase_value,

        --engagement
        total_sessions,
        total_active_days,
        total_play_time_minutes,
        max_level_reached,

        --derived metrics
        case
            when total_active_days > 0
            then total_revenue / total_active_days
            else 0
        end as revenue_per_active_day,
        case
            when total_sessions > 0
            then total_revenue / total_sessions
            else 0
        end as revenue_per_session,
        case
            when total_purchases > 0
            then total_iap_revenue / total_purchases
            else 0
        end as avg_iap_value,

        --days since install
        datediff('day', installed_at, current_date) as days_since_install,

        --flags
        is_payer,
        case 
            when total_revenue > 0 and days_to_first_purchase <= 1 then 'Fast Converted'
            when total_revenue > 0 and days_to_first_purchase <= 7 then 'Week 1 Converted'
            when total_revenue > 0 and days_to_first_purchase <= 30 then 'Month 1 Converted'
            when total_revenue > 0 then 'Late Converted'
            else 'Non-Payer'
        end as converter_type
    from players 
)

select * from player_ltv
    );
  
  
[0m14:42:08.333119 [debug] [Thread-1 (]: DuckDB adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_player_ltv"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_player_ltv__dbt_tmp"
  
    as (
      

with players as (
    select * from "quest_kingdom"."main"."dim_players"
),

--calculate LTV for each player
player_ltv as (
    select 
        player_id,
        installed_at,
        cohort_week,
        cohort_month,
        attribution_channel,
        country,
        device_type,
        player_segment,
        experiment_variant,
        tutorial_completed,

        --revenue
        total_iap_revenue,
        total_ad_revenue,
        total_revenue,

        --purchase behavior
        total_purchases,
        first_purchase_at,
        days_to_first_purchase,
        avg_purchase_value,

        --engagement
        total_sessions,
        total_active_days,
        total_play_time_minutes,
        max_level_reached,

        --derived metrics
        case
            when total_active_days > 0
            then total_revenue / total_active_days
            else 0
        end as revenue_per_active_day,
        case
            when total_sessions > 0
            then total_revenue / total_sessions
            else 0
        end as revenue_per_session,
        case
            when total_purchases > 0
            then total_iap_revenue / total_purchases
            else 0
        end as avg_iap_value,

        --days since install
        datediff('day', installed_at, current_date) as days_since_install,

        --flags
        is_payer,
        case 
            when total_revenue > 0 and days_to_first_purchase <= 1 then 'Fast Converted'
            when total_revenue > 0 and days_to_first_purchase <= 7 then 'Week 1 Converted'
            when total_revenue > 0 and days_to_first_purchase <= 30 then 'Month 1 Converted'
            when total_revenue > 0 then 'Late Converted'
            else 'Non-Payer'
        end as converter_type
    from players 
)

select * from player_ltv
    );
  
  
[0m14:42:08.333332 [debug] [Thread-1 (]: DuckDB adapter: Rolling back transaction.
[0m14:42:08.333619 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_player_ltv: ROLLBACK
[0m14:42:08.335020 [debug] [Thread-1 (]: Failed to rollback 'model.quest_kingdom.rpt_player_ltv'
[0m14:42:08.335177 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_player_ltv: Close
[0m14:42:08.336558 [debug] [Thread-1 (]: Runtime Error in model rpt_player_ltv (models/marts/monetization/rpt_player_ltv.sql)
  Binder Error: Referenced column "total_active_days" not found in FROM clause!
  Candidate bindings: "total_ad_clicks", "total_play_time_minutes", "total_ad_revenue", "total_ad_impressions", "total_iap_revenue"
  
  LINE 44:         total_active_days,
                   ^
[0m14:42:08.336873 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0ef61420-0825-4beb-8014-362a38ee8046', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107ab9f10>]}
[0m14:42:08.337197 [error] [Thread-1 (]: 3 of 4 ERROR creating sql table model main.rpt_player_ltv ...................... [[31mERROR[0m in 0.01s]
[0m14:42:08.337459 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.rpt_player_ltv
[0m14:42:08.337642 [debug] [Thread-1 (]: Began running node model.quest_kingdom.rpt_sku_performance
[0m14:42:08.337860 [debug] [Thread-4 (]: Marking all children of 'model.quest_kingdom.rpt_player_ltv' to be skipped because of status 'error'.  Reason: Runtime Error in model rpt_player_ltv (models/marts/monetization/rpt_player_ltv.sql)
  Binder Error: Referenced column "total_active_days" not found in FROM clause!
  Candidate bindings: "total_ad_clicks", "total_play_time_minutes", "total_ad_revenue", "total_ad_impressions", "total_iap_revenue"
  
  LINE 44:         total_active_days,
                   ^.
[0m14:42:08.338088 [info ] [Thread-1 (]: 4 of 4 START sql table model main.rpt_sku_performance .......................... [RUN]
[0m14:42:08.338419 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.quest_kingdom.rpt_player_ltv, now model.quest_kingdom.rpt_sku_performance)
[0m14:42:08.338586 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.rpt_sku_performance
[0m14:42:08.341224 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.rpt_sku_performance"
[0m14:42:08.341964 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.rpt_sku_performance
[0m14:42:08.344997 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.rpt_sku_performance"
[0m14:42:08.345478 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_sku_performance"
[0m14:42:08.345646 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_sku_performance: BEGIN
[0m14:42:08.345793 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:42:08.346222 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m14:42:08.346374 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_sku_performance"
[0m14:42:08.346591 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_sku_performance: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_sku_performance"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_sku_performance__dbt_tmp"
  
    as (
      

with transactions as (
    select * from "quest_kingdom"."main"."stg_iap_transactions"
),

players as (
    select * from "quest_kingdom"."main"."dim_players"
),

--aggregate by SKU
sku_metrics as (
    select 
        t.sku,
        --purchase counts
        count(*) as total_purchases,
        count(distinct t.player_id) as unique_buyers,

        --revenue
        sum(t.price_usd) as total_revenue,
        avg(t.price_usd) as avg_price,

        --virtual currency
        sum(t.gems_purchased) as total_gems_sold,
        avg(t.gems_purchased) as avg_gems_per_purchase,

        --platform split
        sum(case when t.platform = 'ios' then t.price_usd else 0 end) as ios_revenue,
        sum(case when t.platform = 'android' then t.price_usd else 0 end) as android_revenue,

        --timing
        min(t.purchased_at) as first_purchase_date,
        max(t.purchased_at) as last_purchase_date
    from transactions t 
    group by t.sku
),

--get buyer segments for each SKU
sku_by_segment as (
    select 
        t.sku,
        p.player_segment,
        count(*) as purchases,
        sum(t.price_usd) as revenue
    from transactions t 
    inner join players p on t.player_id = p.player_id 
    group by t.sku, p.player_segment 
),

--pivot segments
sku_segment_pivot as (
    select 
        sku,
        sum(case when player_segment = 'whale' then purchases else 0 end) as whale_purchases,
        sum(case when player_segment = 'dolphin' then purchases else 0 end) as dolphin_purchases,
        sum(case when player_segment = 'minnow' then purchases else 0 end) as minnow_purchases,
        sum(case when player_segment = 'whale' then revenue else 0 end) as whale_revenue,
        sum(case when player_segment = 'dolphin' then revenue else 0 end) as dolphin_revenue,
        sum(case when player_segment = 'minnow' then revenue else 0 end) as minnow_revenue
    from sku_by_segment
    group by sku

),

--combine
final as (
    select 
        sm.*,
        sp.whale_purchases,
        sp.dolphin_purchases,
        sp.minnow_purchases,
        sp.whale_revenue,
        sp.dolphin_revenue,
        sp.minnow_revenue,

        --derived metrics
        sm.total_revenue / sm.total_purchases as revenue_per_purchase,
        sm.total_purchases::float / sm.unique_buyers as purchases_per_buyer,

        --revenue share
        round(sm.total_revenue / sum(sm.total_revenue) over() * 100, 2) as revenue_share_pct
    from sku_metrics sm 
    left join sku_segment_pivot sp on sm.sku = sp.sku 
)

select * from final 
order by total_revenue desc
    );
  
  
[0m14:42:08.363495 [debug] [Thread-1 (]: SQL status: OK in 0.017 seconds
[0m14:42:08.365225 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_sku_performance"
[0m14:42:08.365425 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_sku_performance: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_sku_performance"} */
alter table "quest_kingdom"."main"."rpt_sku_performance__dbt_tmp" rename to "rpt_sku_performance"
[0m14:42:08.365818 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m14:42:08.366539 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_sku_performance: COMMIT
[0m14:42:08.366693 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_sku_performance"
[0m14:42:08.366835 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_sku_performance: COMMIT
[0m14:42:08.367232 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m14:42:08.368299 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_sku_performance"
[0m14:42:08.368448 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_sku_performance: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_sku_performance"} */

      drop table if exists "quest_kingdom"."main"."rpt_sku_performance__dbt_backup" cascade
    
[0m14:42:08.368698 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m14:42:08.369385 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_sku_performance: Close
[0m14:42:08.369684 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0ef61420-0825-4beb-8014-362a38ee8046', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107843170>]}
[0m14:42:08.369977 [info ] [Thread-1 (]: 4 of 4 OK created sql table model main.rpt_sku_performance ..................... [[32mOK[0m in 0.03s]
[0m14:42:08.370235 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.rpt_sku_performance
[0m14:42:08.370766 [debug] [MainThread]: Using duckdb connection "master"
[0m14:42:08.370910 [debug] [MainThread]: On master: BEGIN
[0m14:42:08.371031 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m14:42:08.371269 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m14:42:08.371395 [debug] [MainThread]: On master: COMMIT
[0m14:42:08.371516 [debug] [MainThread]: Using duckdb connection "master"
[0m14:42:08.371632 [debug] [MainThread]: On master: COMMIT
[0m14:42:08.371814 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m14:42:08.371934 [debug] [MainThread]: On master: Close
[0m14:42:08.372090 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:42:08.372207 [debug] [MainThread]: Connection 'model.quest_kingdom.rpt_sku_performance' was properly closed.
[0m14:42:08.372351 [info ] [MainThread]: 
[0m14:42:08.372491 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 0.23 seconds (0.23s).
[0m14:42:08.372935 [debug] [MainThread]: Command end result
[0m14:42:08.389197 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/manifest.json
[0m14:42:08.390651 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/semantic_manifest.json
[0m14:42:08.393931 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/run_results.json
[0m14:42:08.394100 [info ] [MainThread]: 
[0m14:42:08.394276 [info ] [MainThread]: [31mCompleted with 2 errors, 0 partial successes, and 0 warnings:[0m
[0m14:42:08.394420 [info ] [MainThread]: 
[0m14:42:08.394601 [error] [MainThread]: [31mFailure in model rpt_daily_revenue (models/marts/monetization/rpt_daily_revenue.sql)[0m
[0m14:42:08.394766 [error] [MainThread]:   Runtime Error in model rpt_daily_revenue (models/marts/monetization/rpt_daily_revenue.sql)
  Binder Error: Values list "i" does not have a column named "paying_users"
  
  LINE 84:             when coalesce(i.paying_users, 0) > 0
                                     ^
[0m14:42:08.394892 [info ] [MainThread]: 
[0m14:42:08.395039 [info ] [MainThread]:   compiled code at target/compiled/quest_kingdom/models/marts/monetization/rpt_daily_revenue.sql
[0m14:42:08.395165 [info ] [MainThread]: 
[0m14:42:08.395315 [error] [MainThread]: [31mFailure in model rpt_player_ltv (models/marts/monetization/rpt_player_ltv.sql)[0m
[0m14:42:08.395469 [error] [MainThread]:   Runtime Error in model rpt_player_ltv (models/marts/monetization/rpt_player_ltv.sql)
  Binder Error: Referenced column "total_active_days" not found in FROM clause!
  Candidate bindings: "total_ad_clicks", "total_play_time_minutes", "total_ad_revenue", "total_ad_impressions", "total_iap_revenue"
  
  LINE 44:         total_active_days,
                   ^
[0m14:42:08.395594 [info ] [MainThread]: 
[0m14:42:08.395732 [info ] [MainThread]:   compiled code at target/compiled/quest_kingdom/models/marts/monetization/rpt_player_ltv.sql
[0m14:42:08.395850 [info ] [MainThread]: 
[0m14:42:08.395987 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=2 SKIP=0 NO-OP=0 TOTAL=4
[0m14:42:08.397368 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 1.3413665, "process_in_blocks": "0", "process_kernel_time": 0.207431, "process_mem_max_rss": "178847744", "process_out_blocks": "0", "process_user_time": 1.764235}
[0m14:42:08.397571 [debug] [MainThread]: Command `dbt run` failed at 14:42:08.397532 after 1.34 seconds
[0m14:42:08.397734 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107c37aa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107c36180>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107c365d0>]}
[0m14:42:08.397889 [debug] [MainThread]: Flushing usage events
[0m14:42:08.542400 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m14:46:24.462297 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102206900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104c499d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104c49790>]}


============================== 14:46:24.470526 | ccd3e269-61a9-451c-80c4-e7e222deb135 ==============================
[0m14:46:24.470526 [info ] [MainThread]: Running with dbt=1.11.4
[0m14:46:24.470935 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'use_colors': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'target_path': 'None', 'cache_selected_only': 'False', 'fail_fast': 'False', 'invocation_command': 'dbt run --select path:models/marts/monetization', 'write_json': 'True', 'send_anonymous_usage_stats': 'True', 'static_parser': 'True', 'indirect_selection': 'eager', 'debug': 'False', 'no_print': 'None', 'introspect': 'True', 'log_path': '/Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/logs', 'warn_error': 'None', 'profiles_dir': '/Users/hazeldonaldson/.dbt', 'log_format': 'default', 'printer_width': '80', 'version_check': 'True', 'empty': 'False', 'partial_parse': 'True', 'use_experimental_parser': 'False', 'log_cache_events': 'False'}
[0m14:46:24.655626 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ccd3e269-61a9-451c-80c4-e7e222deb135', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1022f3d70>]}
[0m14:46:24.687375 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'ccd3e269-61a9-451c-80c4-e7e222deb135', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104d7a5a0>]}
[0m14:46:24.689043 [info ] [MainThread]: Registered adapter: duckdb=1.10.0
[0m14:46:24.767508 [debug] [MainThread]: checksum: 092b177ba87eb6bb3c55954c38aa57900eebac336561eb9ee32218428aa81d43, vars: {}, profile: , target: , version: 1.11.4
[0m14:46:24.835416 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m14:46:24.835873 [debug] [MainThread]: Partial parsing: updated file: quest_kingdom://models/marts/monetization/rpt_daily_revenue.sql
[0m14:46:25.027583 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'ccd3e269-61a9-451c-80c4-e7e222deb135', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104ceb7d0>]}
[0m14:46:25.102592 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/manifest.json
[0m14:46:25.103842 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/semantic_manifest.json
[0m14:46:25.117497 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'ccd3e269-61a9-451c-80c4-e7e222deb135', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1054a1ca0>]}
[0m14:46:25.117799 [info ] [MainThread]: Found 15 models, 40 data tests, 5 sources, 472 macros
[0m14:46:25.117981 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ccd3e269-61a9-451c-80c4-e7e222deb135', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1054e5a00>]}
[0m14:46:25.119783 [info ] [MainThread]: 
[0m14:46:25.119969 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m14:46:25.120115 [info ] [MainThread]: 
[0m14:46:25.120347 [debug] [MainThread]: Acquiring new duckdb connection 'master'
[0m14:46:25.122594 [debug] [ThreadPool]: Acquiring new duckdb connection 'list_quest_kingdom'
[0m14:46:25.153165 [debug] [ThreadPool]: Using duckdb connection "list_quest_kingdom"
[0m14:46:25.153401 [debug] [ThreadPool]: On list_quest_kingdom: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "list_quest_kingdom"} */

    
    select schema_name
    from system.information_schema.schemata
    
    where lower(catalog_name) = '"quest_kingdom"'
    
  
  
[0m14:46:25.153804 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:46:25.172658 [debug] [ThreadPool]: SQL status: OK in 0.019 seconds
[0m14:46:25.173654 [debug] [ThreadPool]: On list_quest_kingdom: Close
[0m14:46:25.173998 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_quest_kingdom, now create_quest_kingdom_main)
[0m14:46:25.174230 [debug] [ThreadPool]: Creating schema "database: "quest_kingdom"
schema: "main"
"
[0m14:46:25.177855 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m14:46:25.178084 [debug] [ThreadPool]: On create_quest_kingdom_main: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "create_quest_kingdom_main"} */

    
        select type from duckdb_databases()
        where lower(database_name)='quest_kingdom'
        and type='sqlite'
    
  
[0m14:46:25.178222 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:46:25.179140 [debug] [ThreadPool]: SQL status: OK in 0.001 seconds
[0m14:46:25.179784 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m14:46:25.179928 [debug] [ThreadPool]: On create_quest_kingdom_main: BEGIN
[0m14:46:25.180152 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m14:46:25.180278 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m14:46:25.180401 [debug] [ThreadPool]: On create_quest_kingdom_main: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "create_quest_kingdom_main"} */

    
    
        create schema if not exists "quest_kingdom"."main"
    
[0m14:46:25.180892 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m14:46:25.181343 [debug] [ThreadPool]: On create_quest_kingdom_main: COMMIT
[0m14:46:25.181488 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m14:46:25.181610 [debug] [ThreadPool]: On create_quest_kingdom_main: COMMIT
[0m14:46:25.181823 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m14:46:25.181956 [debug] [ThreadPool]: On create_quest_kingdom_main: Close
[0m14:46:25.182810 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_quest_kingdom_main, now list_quest_kingdom_main)
[0m14:46:25.185704 [debug] [ThreadPool]: Using duckdb connection "list_quest_kingdom_main"
[0m14:46:25.185881 [debug] [ThreadPool]: On list_quest_kingdom_main: BEGIN
[0m14:46:25.186063 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:46:25.186351 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m14:46:25.186482 [debug] [ThreadPool]: Using duckdb connection "list_quest_kingdom_main"
[0m14:46:25.186615 [debug] [ThreadPool]: On list_quest_kingdom_main: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "list_quest_kingdom_main"} */
select
      'quest_kingdom' as database,
      table_name as name,
      table_schema as schema,
      CASE table_type
        WHEN 'BASE TABLE' THEN 'table'
        WHEN 'VIEW' THEN 'view'
        WHEN 'LOCAL TEMPORARY' THEN 'table'
        END as type
    from system.information_schema.tables
    where lower(table_schema) = 'main'
    and lower(table_catalog) = 'quest_kingdom'
  
[0m14:46:25.197728 [debug] [ThreadPool]: SQL status: OK in 0.011 seconds
[0m14:46:25.198620 [debug] [ThreadPool]: On list_quest_kingdom_main: ROLLBACK
[0m14:46:25.199560 [debug] [ThreadPool]: Failed to rollback 'list_quest_kingdom_main'
[0m14:46:25.199726 [debug] [ThreadPool]: On list_quest_kingdom_main: Close
[0m14:46:25.200986 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ccd3e269-61a9-451c-80c4-e7e222deb135', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1055460f0>]}
[0m14:46:25.201232 [debug] [MainThread]: Using duckdb connection "master"
[0m14:46:25.201364 [debug] [MainThread]: On master: BEGIN
[0m14:46:25.201484 [debug] [MainThread]: Opening a new connection, currently in state init
[0m14:46:25.201783 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m14:46:25.201916 [debug] [MainThread]: On master: COMMIT
[0m14:46:25.202039 [debug] [MainThread]: Using duckdb connection "master"
[0m14:46:25.202157 [debug] [MainThread]: On master: COMMIT
[0m14:46:25.202343 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m14:46:25.202467 [debug] [MainThread]: On master: Close
[0m14:46:25.203806 [debug] [Thread-1 (]: Began running node model.quest_kingdom.rpt_conversion_funnel
[0m14:46:25.204043 [info ] [Thread-1 (]: 1 of 4 START sql table model main.rpt_conversion_funnel ........................ [RUN]
[0m14:46:25.204245 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_quest_kingdom_main, now model.quest_kingdom.rpt_conversion_funnel)
[0m14:46:25.204403 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.rpt_conversion_funnel
[0m14:46:25.208286 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.rpt_conversion_funnel"
[0m14:46:25.208840 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.rpt_conversion_funnel
[0m14:46:25.224189 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.rpt_conversion_funnel"
[0m14:46:25.224937 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_conversion_funnel"
[0m14:46:25.225183 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_conversion_funnel: BEGIN
[0m14:46:25.225366 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:46:25.225803 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m14:46:25.225974 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_conversion_funnel"
[0m14:46:25.226156 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_conversion_funnel: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_conversion_funnel"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_conversion_funnel__dbt_tmp"
  
    as (
      

with players as (
    select * from "quest_kingdom"."main"."dim_players"
),

--define funnel stages
player_funnel as (
    select 
        player_id,
        installed_at,
        cohort_week,
        attribution_channel,
        player_segment,
        experiment_variant,

        --funnel stages (boolean)
        true as stage_1_installed,
        tutorial_completed as stage_2_tutorial_completed,
        is_activated as stage_3_had_session,
        max_level_reached >= 5 as stage_4_reached_level_5,
        is_payer as stage_5_first_purchase,

        --time to each stage
        0 as days_to_install,
        case when tutorial_completed then 0 else null end as days_to_tutorial,
        case when is_activated then 0 else null end as days_to_first_session,
        case when max_level_reached >= 5 then days_to_first_purchase else null end as days_to_level_5,
        days_to_first_purchase
    from players 
)

select * from player_funnel
    );
  
  
[0m14:46:25.234511 [debug] [Thread-1 (]: SQL status: OK in 0.008 seconds
[0m14:46:25.237312 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_conversion_funnel"
[0m14:46:25.237514 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_conversion_funnel: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_conversion_funnel"} */

    SELECT index_name
    FROM duckdb_indexes()
    WHERE schema_name = 'main'
      AND table_name = 'rpt_conversion_funnel'
  
[0m14:46:25.238033 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m14:46:25.238721 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_conversion_funnel"
[0m14:46:25.238894 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_conversion_funnel: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_conversion_funnel"} */

    SELECT COUNT(*) as remaining_indexes
    FROM duckdb_indexes()
    WHERE schema_name = 'main'
      AND table_name = 'rpt_conversion_funnel'
  
[0m14:46:25.239834 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m14:46:25.243121 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_conversion_funnel"
[0m14:46:25.243346 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_conversion_funnel: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_conversion_funnel"} */
alter table "quest_kingdom"."main"."rpt_conversion_funnel" rename to "rpt_conversion_funnel__dbt_backup"
[0m14:46:25.244278 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m14:46:25.245734 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_conversion_funnel"
[0m14:46:25.245918 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_conversion_funnel: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_conversion_funnel"} */
alter table "quest_kingdom"."main"."rpt_conversion_funnel__dbt_tmp" rename to "rpt_conversion_funnel"
[0m14:46:25.246231 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m14:46:25.253233 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_conversion_funnel: COMMIT
[0m14:46:25.253447 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_conversion_funnel"
[0m14:46:25.253598 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_conversion_funnel: COMMIT
[0m14:46:25.256217 [debug] [Thread-1 (]: SQL status: OK in 0.002 seconds
[0m14:46:25.260088 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_conversion_funnel"
[0m14:46:25.260319 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_conversion_funnel: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_conversion_funnel"} */

      drop table if exists "quest_kingdom"."main"."rpt_conversion_funnel__dbt_backup" cascade
    
[0m14:46:25.261153 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m14:46:25.262454 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_conversion_funnel: Close
[0m14:46:25.263457 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ccd3e269-61a9-451c-80c4-e7e222deb135', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1022f3080>]}
[0m14:46:25.263778 [info ] [Thread-1 (]: 1 of 4 OK created sql table model main.rpt_conversion_funnel ................... [[32mOK[0m in 0.06s]
[0m14:46:25.264044 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.rpt_conversion_funnel
[0m14:46:25.264235 [debug] [Thread-1 (]: Began running node model.quest_kingdom.rpt_daily_revenue
[0m14:46:25.264476 [info ] [Thread-1 (]: 2 of 4 START sql table model main.rpt_daily_revenue ............................ [RUN]
[0m14:46:25.264674 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.quest_kingdom.rpt_conversion_funnel, now model.quest_kingdom.rpt_daily_revenue)
[0m14:46:25.264836 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.rpt_daily_revenue
[0m14:46:25.266734 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.rpt_daily_revenue"
[0m14:46:25.267355 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.rpt_daily_revenue
[0m14:46:25.268989 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.rpt_daily_revenue"
[0m14:46:25.269350 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_daily_revenue"
[0m14:46:25.269505 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_daily_revenue: BEGIN
[0m14:46:25.269651 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:46:25.270057 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m14:46:25.270224 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_daily_revenue"
[0m14:46:25.270450 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_daily_revenue: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_daily_revenue"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_daily_revenue__dbt_tmp"
  
    as (
      

with daily_active_users as (
    select * from "quest_kingdom"."main"."fct_daily_active_users"
),

iap_transactions as (
    select * from "quest_kingdom"."main"."stg_iap_transactions"
),

ad_impressions as (
    select * from "quest_kingdom"."main"."stg_ad_impressions"
),

--daily IAP revenue
daily_iap as (
    select
        purchase_date as revenue_date,
        count(distinct player_id) as paying_users,
        count(*) as transactions,
        sum(price_usd) as iap_revenue,
        avg(price_usd) as avg_transaction_value
    from iap_transactions
    group by purchase_date
),

--daily ad revenue
daily_ads as (
    select 
        ad_date as revenue_date,
        count(distinct player_id) as users_with_ads,
        count(*) as impressions,
        sum(revenue_usd) as ad_revenue,
        sum(case when clicked then 1 else 0 end) as clicks
    from ad_impressions
    group by ad_date 
),

--daily active users
daily_dau as (
    select 
        activity_date as revenue_date,
        count(distinct player_id) as dau 
    from daily_active_users
    group by activity_date
),

--combine all metrics
final as (
    select
        coalesce(d.revenue_date, i.revenue_date, a.revenue_date) as revenue_date,
        --user counts
        coalesce(d.dau, 0) as dau,
        coalesce(i.payer_users, 0) as payer_users,
        coalesce(a.users_with_ads, 0) as users_with_ads,
        --revenue
        coalesce(i.iap_revenue, 0) as iap_revenue,
        coalesce(a.ad_revenue, 0) as ad_revenue,
        coalesce(i.iap_revenue, 0) + coalesce(a.ad_revenue, 0) as total_revenue,
        --transactions and impressions
        coalesce(i.transactions, 0) as iap_transactions,
        coalesce(a.impressions, 0) as ad_impressions,
        coalesce(a.clicks, 0) as ad_clicks,
        --per-transaction metrics
        i.avg_transaction_value,
        --ARPDAU (average revenue per daily active user)
        case
            when coalesce(d.dau, 0) > 0
            then (coalesce(i.iap_revenue, 0) + coalesce(a.ad_revenue, 0)) / d.dau
            else 0
        end as arpdau,
        --ARPPU (average revenue per paying user)
        case
            when coalesce(i.paying_users, 0) > 0
            then coalesce(i.iap_revenue, 0) / i.paying_users
            else 0
        end as arppu,
        --conversion rate (paying users /DAU)
        case
            when coalesce(d.dau, 0) > 0
            then coalesce(i.paying_users, 0)::float / d.dau * 100
            else 0
        end as daily_conversion_rate,
        --ad metrics
        case 
            when coalesce(a.impressions, 0) > 0
            then coalesce(a.clicks, 0)::float / a.impressions * 100
            else 0
        end as ad_ctr
    from daily_dau d 
    full outer join daily_iap i on d.revenue_date = i.revenue_date
    full outer join daily_ads a on d.revenue_date = a.revenue_date
)

select * from final
order by revenue_date
    );
  
  
[0m14:46:25.274857 [debug] [Thread-1 (]: DuckDB adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_daily_revenue"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_daily_revenue__dbt_tmp"
  
    as (
      

with daily_active_users as (
    select * from "quest_kingdom"."main"."fct_daily_active_users"
),

iap_transactions as (
    select * from "quest_kingdom"."main"."stg_iap_transactions"
),

ad_impressions as (
    select * from "quest_kingdom"."main"."stg_ad_impressions"
),

--daily IAP revenue
daily_iap as (
    select
        purchase_date as revenue_date,
        count(distinct player_id) as paying_users,
        count(*) as transactions,
        sum(price_usd) as iap_revenue,
        avg(price_usd) as avg_transaction_value
    from iap_transactions
    group by purchase_date
),

--daily ad revenue
daily_ads as (
    select 
        ad_date as revenue_date,
        count(distinct player_id) as users_with_ads,
        count(*) as impressions,
        sum(revenue_usd) as ad_revenue,
        sum(case when clicked then 1 else 0 end) as clicks
    from ad_impressions
    group by ad_date 
),

--daily active users
daily_dau as (
    select 
        activity_date as revenue_date,
        count(distinct player_id) as dau 
    from daily_active_users
    group by activity_date
),

--combine all metrics
final as (
    select
        coalesce(d.revenue_date, i.revenue_date, a.revenue_date) as revenue_date,
        --user counts
        coalesce(d.dau, 0) as dau,
        coalesce(i.payer_users, 0) as payer_users,
        coalesce(a.users_with_ads, 0) as users_with_ads,
        --revenue
        coalesce(i.iap_revenue, 0) as iap_revenue,
        coalesce(a.ad_revenue, 0) as ad_revenue,
        coalesce(i.iap_revenue, 0) + coalesce(a.ad_revenue, 0) as total_revenue,
        --transactions and impressions
        coalesce(i.transactions, 0) as iap_transactions,
        coalesce(a.impressions, 0) as ad_impressions,
        coalesce(a.clicks, 0) as ad_clicks,
        --per-transaction metrics
        i.avg_transaction_value,
        --ARPDAU (average revenue per daily active user)
        case
            when coalesce(d.dau, 0) > 0
            then (coalesce(i.iap_revenue, 0) + coalesce(a.ad_revenue, 0)) / d.dau
            else 0
        end as arpdau,
        --ARPPU (average revenue per paying user)
        case
            when coalesce(i.paying_users, 0) > 0
            then coalesce(i.iap_revenue, 0) / i.paying_users
            else 0
        end as arppu,
        --conversion rate (paying users /DAU)
        case
            when coalesce(d.dau, 0) > 0
            then coalesce(i.paying_users, 0)::float / d.dau * 100
            else 0
        end as daily_conversion_rate,
        --ad metrics
        case 
            when coalesce(a.impressions, 0) > 0
            then coalesce(a.clicks, 0)::float / a.impressions * 100
            else 0
        end as ad_ctr
    from daily_dau d 
    full outer join daily_iap i on d.revenue_date = i.revenue_date
    full outer join daily_ads a on d.revenue_date = a.revenue_date
)

select * from final
order by revenue_date
    );
  
  
[0m14:46:25.275208 [debug] [Thread-1 (]: DuckDB adapter: Rolling back transaction.
[0m14:46:25.275651 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_daily_revenue: ROLLBACK
[0m14:46:25.280531 [debug] [Thread-1 (]: Failed to rollback 'model.quest_kingdom.rpt_daily_revenue'
[0m14:46:25.280749 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_daily_revenue: Close
[0m14:46:25.281945 [debug] [Thread-1 (]: Runtime Error in model rpt_daily_revenue (models/marts/monetization/rpt_daily_revenue.sql)
  Binder Error: Values list "i" does not have a column named "payer_users"
  
  LINE 64:         coalesce(i.payer_users, 0) as payer_users,
                            ^
[0m14:46:25.282208 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ccd3e269-61a9-451c-80c4-e7e222deb135', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10576bf50>]}
[0m14:46:25.282526 [error] [Thread-1 (]: 2 of 4 ERROR creating sql table model main.rpt_daily_revenue ................... [[31mERROR[0m in 0.02s]
[0m14:46:25.282795 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.rpt_daily_revenue
[0m14:46:25.282980 [debug] [Thread-1 (]: Began running node model.quest_kingdom.rpt_player_ltv
[0m14:46:25.283207 [debug] [Thread-4 (]: Marking all children of 'model.quest_kingdom.rpt_daily_revenue' to be skipped because of status 'error'.  Reason: Runtime Error in model rpt_daily_revenue (models/marts/monetization/rpt_daily_revenue.sql)
  Binder Error: Values list "i" does not have a column named "payer_users"
  
  LINE 64:         coalesce(i.payer_users, 0) as payer_users,
                            ^.
[0m14:46:25.283442 [info ] [Thread-1 (]: 3 of 4 START sql table model main.rpt_player_ltv ............................... [RUN]
[0m14:46:25.284047 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.quest_kingdom.rpt_daily_revenue, now model.quest_kingdom.rpt_player_ltv)
[0m14:46:25.284377 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.rpt_player_ltv
[0m14:46:25.285898 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.rpt_player_ltv"
[0m14:46:25.286331 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.rpt_player_ltv
[0m14:46:25.287931 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.rpt_player_ltv"
[0m14:46:25.288276 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_player_ltv"
[0m14:46:25.288436 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_player_ltv: BEGIN
[0m14:46:25.288581 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:46:25.289067 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m14:46:25.289247 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_player_ltv"
[0m14:46:25.289452 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_player_ltv: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_player_ltv"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_player_ltv__dbt_tmp"
  
    as (
      

with players as (
    select * from "quest_kingdom"."main"."dim_players"
),

--calculate LTV for each player
player_ltv as (
    select 
        player_id,
        installed_at,
        cohort_week,
        cohort_month,
        attribution_channel,
        country,
        device_type,
        player_segment,
        experiment_variant,
        tutorial_completed,

        --revenue
        total_iap_revenue,
        total_ad_revenue,
        total_revenue,

        --purchase behavior
        total_purchases,
        first_purchase_at,
        days_to_first_purchase,
        avg_purchase_value,

        --engagement
        total_sessions,
        total_active_days,
        total_play_time_minutes,
        max_level_reached,

        --derived metrics
        case
            when total_active_days > 0
            then total_revenue / total_active_days
            else 0
        end as revenue_per_active_day,
        case
            when total_sessions > 0
            then total_revenue / total_sessions
            else 0
        end as revenue_per_session,
        case
            when total_purchases > 0
            then total_iap_revenue / total_purchases
            else 0
        end as avg_iap_value,

        --days since install
        datediff('day', installed_at, current_date) as days_since_install,

        --flags
        is_payer,
        case 
            when total_revenue > 0 and days_to_first_purchase <= 1 then 'Fast Converted'
            when total_revenue > 0 and days_to_first_purchase <= 7 then 'Week 1 Converted'
            when total_revenue > 0 and days_to_first_purchase <= 30 then 'Month 1 Converted'
            when total_revenue > 0 then 'Late Converted'
            else 'Non-Payer'
        end as converter_type
    from players 
)

select * from player_ltv
    );
  
  
[0m14:46:25.290455 [debug] [Thread-1 (]: DuckDB adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_player_ltv"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_player_ltv__dbt_tmp"
  
    as (
      

with players as (
    select * from "quest_kingdom"."main"."dim_players"
),

--calculate LTV for each player
player_ltv as (
    select 
        player_id,
        installed_at,
        cohort_week,
        cohort_month,
        attribution_channel,
        country,
        device_type,
        player_segment,
        experiment_variant,
        tutorial_completed,

        --revenue
        total_iap_revenue,
        total_ad_revenue,
        total_revenue,

        --purchase behavior
        total_purchases,
        first_purchase_at,
        days_to_first_purchase,
        avg_purchase_value,

        --engagement
        total_sessions,
        total_active_days,
        total_play_time_minutes,
        max_level_reached,

        --derived metrics
        case
            when total_active_days > 0
            then total_revenue / total_active_days
            else 0
        end as revenue_per_active_day,
        case
            when total_sessions > 0
            then total_revenue / total_sessions
            else 0
        end as revenue_per_session,
        case
            when total_purchases > 0
            then total_iap_revenue / total_purchases
            else 0
        end as avg_iap_value,

        --days since install
        datediff('day', installed_at, current_date) as days_since_install,

        --flags
        is_payer,
        case 
            when total_revenue > 0 and days_to_first_purchase <= 1 then 'Fast Converted'
            when total_revenue > 0 and days_to_first_purchase <= 7 then 'Week 1 Converted'
            when total_revenue > 0 and days_to_first_purchase <= 30 then 'Month 1 Converted'
            when total_revenue > 0 then 'Late Converted'
            else 'Non-Payer'
        end as converter_type
    from players 
)

select * from player_ltv
    );
  
  
[0m14:46:25.290671 [debug] [Thread-1 (]: DuckDB adapter: Rolling back transaction.
[0m14:46:25.290884 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_player_ltv: ROLLBACK
[0m14:46:25.292397 [debug] [Thread-1 (]: Failed to rollback 'model.quest_kingdom.rpt_player_ltv'
[0m14:46:25.292582 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_player_ltv: Close
[0m14:46:25.293748 [debug] [Thread-1 (]: Runtime Error in model rpt_player_ltv (models/marts/monetization/rpt_player_ltv.sql)
  Binder Error: Referenced column "total_active_days" not found in FROM clause!
  Candidate bindings: "total_ad_clicks", "total_play_time_minutes", "total_ad_revenue", "total_ad_impressions", "total_iap_revenue"
  
  LINE 44:         total_active_days,
                   ^
[0m14:46:25.293968 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ccd3e269-61a9-451c-80c4-e7e222deb135', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1057467b0>]}
[0m14:46:25.294262 [error] [Thread-1 (]: 3 of 4 ERROR creating sql table model main.rpt_player_ltv ...................... [[31mERROR[0m in 0.01s]
[0m14:46:25.294516 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.rpt_player_ltv
[0m14:46:25.294695 [debug] [Thread-1 (]: Began running node model.quest_kingdom.rpt_sku_performance
[0m14:46:25.294941 [debug] [Thread-4 (]: Marking all children of 'model.quest_kingdom.rpt_player_ltv' to be skipped because of status 'error'.  Reason: Runtime Error in model rpt_player_ltv (models/marts/monetization/rpt_player_ltv.sql)
  Binder Error: Referenced column "total_active_days" not found in FROM clause!
  Candidate bindings: "total_ad_clicks", "total_play_time_minutes", "total_ad_revenue", "total_ad_impressions", "total_iap_revenue"
  
  LINE 44:         total_active_days,
                   ^.
[0m14:46:25.295165 [info ] [Thread-1 (]: 4 of 4 START sql table model main.rpt_sku_performance .......................... [RUN]
[0m14:46:25.295430 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.quest_kingdom.rpt_player_ltv, now model.quest_kingdom.rpt_sku_performance)
[0m14:46:25.295601 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.rpt_sku_performance
[0m14:46:25.297304 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.rpt_sku_performance"
[0m14:46:25.297716 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.rpt_sku_performance
[0m14:46:25.299342 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.rpt_sku_performance"
[0m14:46:25.299729 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_sku_performance"
[0m14:46:25.299893 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_sku_performance: BEGIN
[0m14:46:25.300038 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:46:25.300397 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m14:46:25.300584 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_sku_performance"
[0m14:46:25.300798 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_sku_performance: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_sku_performance"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_sku_performance__dbt_tmp"
  
    as (
      

with transactions as (
    select * from "quest_kingdom"."main"."stg_iap_transactions"
),

players as (
    select * from "quest_kingdom"."main"."dim_players"
),

--aggregate by SKU
sku_metrics as (
    select 
        t.sku,
        --purchase counts
        count(*) as total_purchases,
        count(distinct t.player_id) as unique_buyers,

        --revenue
        sum(t.price_usd) as total_revenue,
        avg(t.price_usd) as avg_price,

        --virtual currency
        sum(t.gems_purchased) as total_gems_sold,
        avg(t.gems_purchased) as avg_gems_per_purchase,

        --platform split
        sum(case when t.platform = 'ios' then t.price_usd else 0 end) as ios_revenue,
        sum(case when t.platform = 'android' then t.price_usd else 0 end) as android_revenue,

        --timing
        min(t.purchased_at) as first_purchase_date,
        max(t.purchased_at) as last_purchase_date
    from transactions t 
    group by t.sku
),

--get buyer segments for each SKU
sku_by_segment as (
    select 
        t.sku,
        p.player_segment,
        count(*) as purchases,
        sum(t.price_usd) as revenue
    from transactions t 
    inner join players p on t.player_id = p.player_id 
    group by t.sku, p.player_segment 
),

--pivot segments
sku_segment_pivot as (
    select 
        sku,
        sum(case when player_segment = 'whale' then purchases else 0 end) as whale_purchases,
        sum(case when player_segment = 'dolphin' then purchases else 0 end) as dolphin_purchases,
        sum(case when player_segment = 'minnow' then purchases else 0 end) as minnow_purchases,
        sum(case when player_segment = 'whale' then revenue else 0 end) as whale_revenue,
        sum(case when player_segment = 'dolphin' then revenue else 0 end) as dolphin_revenue,
        sum(case when player_segment = 'minnow' then revenue else 0 end) as minnow_revenue
    from sku_by_segment
    group by sku

),

--combine
final as (
    select 
        sm.*,
        sp.whale_purchases,
        sp.dolphin_purchases,
        sp.minnow_purchases,
        sp.whale_revenue,
        sp.dolphin_revenue,
        sp.minnow_revenue,

        --derived metrics
        sm.total_revenue / sm.total_purchases as revenue_per_purchase,
        sm.total_purchases::float / sm.unique_buyers as purchases_per_buyer,

        --revenue share
        round(sm.total_revenue / sum(sm.total_revenue) over() * 100, 2) as revenue_share_pct
    from sku_metrics sm 
    left join sku_segment_pivot sp on sm.sku = sp.sku 
)

select * from final 
order by total_revenue desc
    );
  
  
[0m14:46:25.316219 [debug] [Thread-1 (]: SQL status: OK in 0.015 seconds
[0m14:46:25.316989 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_sku_performance"
[0m14:46:25.317193 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_sku_performance: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_sku_performance"} */

    SELECT index_name
    FROM duckdb_indexes()
    WHERE schema_name = 'main'
      AND table_name = 'rpt_sku_performance'
  
[0m14:46:25.317707 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m14:46:25.318336 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_sku_performance"
[0m14:46:25.318496 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_sku_performance: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_sku_performance"} */

    SELECT COUNT(*) as remaining_indexes
    FROM duckdb_indexes()
    WHERE schema_name = 'main'
      AND table_name = 'rpt_sku_performance'
  
[0m14:46:25.318929 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m14:46:25.320592 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_sku_performance"
[0m14:46:25.320769 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_sku_performance: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_sku_performance"} */
alter table "quest_kingdom"."main"."rpt_sku_performance" rename to "rpt_sku_performance__dbt_backup"
[0m14:46:25.321089 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m14:46:25.322384 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_sku_performance"
[0m14:46:25.322568 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_sku_performance: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_sku_performance"} */
alter table "quest_kingdom"."main"."rpt_sku_performance__dbt_tmp" rename to "rpt_sku_performance"
[0m14:46:25.322857 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m14:46:25.323727 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_sku_performance: COMMIT
[0m14:46:25.323908 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_sku_performance"
[0m14:46:25.324068 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_sku_performance: COMMIT
[0m14:46:25.324592 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m14:46:25.325893 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_sku_performance"
[0m14:46:25.326089 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_sku_performance: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_sku_performance"} */

      drop table if exists "quest_kingdom"."main"."rpt_sku_performance__dbt_backup" cascade
    
[0m14:46:25.326620 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m14:46:25.327309 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_sku_performance: Close
[0m14:46:25.327853 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ccd3e269-61a9-451c-80c4-e7e222deb135', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1058ae7e0>]}
[0m14:46:25.328193 [info ] [Thread-1 (]: 4 of 4 OK created sql table model main.rpt_sku_performance ..................... [[32mOK[0m in 0.03s]
[0m14:46:25.331706 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.rpt_sku_performance
[0m14:46:25.332326 [debug] [MainThread]: Using duckdb connection "master"
[0m14:46:25.332486 [debug] [MainThread]: On master: BEGIN
[0m14:46:25.332617 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m14:46:25.332954 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m14:46:25.333085 [debug] [MainThread]: On master: COMMIT
[0m14:46:25.333213 [debug] [MainThread]: Using duckdb connection "master"
[0m14:46:25.333332 [debug] [MainThread]: On master: COMMIT
[0m14:46:25.333537 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m14:46:25.333665 [debug] [MainThread]: On master: Close
[0m14:46:25.333835 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:46:25.333956 [debug] [MainThread]: Connection 'model.quest_kingdom.rpt_sku_performance' was properly closed.
[0m14:46:25.334121 [info ] [MainThread]: 
[0m14:46:25.334266 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 0.21 seconds (0.21s).
[0m14:46:25.334761 [debug] [MainThread]: Command end result
[0m14:46:25.351927 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/manifest.json
[0m14:46:25.352995 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/semantic_manifest.json
[0m14:46:25.355969 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/run_results.json
[0m14:46:25.356159 [info ] [MainThread]: 
[0m14:46:25.356379 [info ] [MainThread]: [31mCompleted with 2 errors, 0 partial successes, and 0 warnings:[0m
[0m14:46:25.356560 [info ] [MainThread]: 
[0m14:46:25.356750 [error] [MainThread]: [31mFailure in model rpt_daily_revenue (models/marts/monetization/rpt_daily_revenue.sql)[0m
[0m14:46:25.356930 [error] [MainThread]:   Runtime Error in model rpt_daily_revenue (models/marts/monetization/rpt_daily_revenue.sql)
  Binder Error: Values list "i" does not have a column named "payer_users"
  
  LINE 64:         coalesce(i.payer_users, 0) as payer_users,
                            ^
[0m14:46:25.357065 [info ] [MainThread]: 
[0m14:46:25.357219 [info ] [MainThread]:   compiled code at target/compiled/quest_kingdom/models/marts/monetization/rpt_daily_revenue.sql
[0m14:46:25.357357 [info ] [MainThread]: 
[0m14:46:25.357521 [error] [MainThread]: [31mFailure in model rpt_player_ltv (models/marts/monetization/rpt_player_ltv.sql)[0m
[0m14:46:25.358593 [error] [MainThread]:   Runtime Error in model rpt_player_ltv (models/marts/monetization/rpt_player_ltv.sql)
  Binder Error: Referenced column "total_active_days" not found in FROM clause!
  Candidate bindings: "total_ad_clicks", "total_play_time_minutes", "total_ad_revenue", "total_ad_impressions", "total_iap_revenue"
  
  LINE 44:         total_active_days,
                   ^
[0m14:46:25.358766 [info ] [MainThread]: 
[0m14:46:25.358975 [info ] [MainThread]:   compiled code at target/compiled/quest_kingdom/models/marts/monetization/rpt_player_ltv.sql
[0m14:46:25.359158 [info ] [MainThread]: 
[0m14:46:25.359334 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=2 SKIP=0 NO-OP=0 TOTAL=4
[0m14:46:25.360937 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.9466721, "process_in_blocks": "0", "process_kernel_time": 0.205254, "process_mem_max_rss": "180436992", "process_out_blocks": "0", "process_user_time": 1.345423}
[0m14:46:25.361168 [debug] [MainThread]: Command `dbt run` failed at 14:46:25.361128 after 0.95 seconds
[0m14:46:25.361359 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104c49850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1042f11c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1058df920>]}
[0m14:46:25.361540 [debug] [MainThread]: Flushing usage events
[0m14:46:25.499048 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m14:46:52.425854 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104f9ad50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x118db5a60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x118db5820>]}


============================== 14:46:52.428931 | 802b6024-ddbd-4718-8e2d-ee7170175e2b ==============================
[0m14:46:52.428931 [info ] [MainThread]: Running with dbt=1.11.4
[0m14:46:52.429272 [debug] [MainThread]: running dbt with arguments {'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'introspect': 'True', 'static_parser': 'True', 'empty': 'False', 'profiles_dir': '/Users/hazeldonaldson/.dbt', 'partial_parse': 'True', 'indirect_selection': 'eager', 'use_colors': 'True', 'target_path': 'None', 'quiet': 'False', 'cache_selected_only': 'False', 'log_cache_events': 'False', 'version_check': 'True', 'log_path': '/Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/logs', 'debug': 'False', 'printer_width': '80', 'write_json': 'True', 'use_experimental_parser': 'False', 'send_anonymous_usage_stats': 'True', 'fail_fast': 'False', 'log_format': 'default', 'warn_error': 'None', 'no_print': 'None', 'invocation_command': 'dbt run --select path:models/marts/monetization'}
[0m14:46:52.603865 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '802b6024-ddbd-4718-8e2d-ee7170175e2b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x118e22c00>]}
[0m14:46:52.634226 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '802b6024-ddbd-4718-8e2d-ee7170175e2b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x118bfdd00>]}
[0m14:46:52.636320 [info ] [MainThread]: Registered adapter: duckdb=1.10.0
[0m14:46:52.687851 [debug] [MainThread]: checksum: 092b177ba87eb6bb3c55954c38aa57900eebac336561eb9ee32218428aa81d43, vars: {}, profile: , target: , version: 1.11.4
[0m14:46:52.751199 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m14:46:52.751665 [debug] [MainThread]: Partial parsing: updated file: quest_kingdom://models/marts/monetization/rpt_daily_revenue.sql
[0m14:46:52.934834 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '802b6024-ddbd-4718-8e2d-ee7170175e2b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11a92f680>]}
[0m14:46:53.009554 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/manifest.json
[0m14:46:53.010793 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/semantic_manifest.json
[0m14:46:53.023067 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '802b6024-ddbd-4718-8e2d-ee7170175e2b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11a92e5d0>]}
[0m14:46:53.023330 [info ] [MainThread]: Found 15 models, 40 data tests, 5 sources, 472 macros
[0m14:46:53.023504 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '802b6024-ddbd-4718-8e2d-ee7170175e2b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107422420>]}
[0m14:46:53.025247 [info ] [MainThread]: 
[0m14:46:53.025431 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m14:46:53.025572 [info ] [MainThread]: 
[0m14:46:53.025799 [debug] [MainThread]: Acquiring new duckdb connection 'master'
[0m14:46:53.027942 [debug] [ThreadPool]: Acquiring new duckdb connection 'list_quest_kingdom'
[0m14:46:53.055593 [debug] [ThreadPool]: Using duckdb connection "list_quest_kingdom"
[0m14:46:53.055840 [debug] [ThreadPool]: On list_quest_kingdom: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "list_quest_kingdom"} */

    
    select schema_name
    from system.information_schema.schemata
    
    where lower(catalog_name) = '"quest_kingdom"'
    
  
  
[0m14:46:53.056154 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:46:53.075553 [debug] [ThreadPool]: SQL status: OK in 0.019 seconds
[0m14:46:53.076546 [debug] [ThreadPool]: On list_quest_kingdom: Close
[0m14:46:53.076912 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_quest_kingdom, now create_quest_kingdom_main)
[0m14:46:53.077148 [debug] [ThreadPool]: Creating schema "database: "quest_kingdom"
schema: "main"
"
[0m14:46:53.080405 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m14:46:53.080590 [debug] [ThreadPool]: On create_quest_kingdom_main: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "create_quest_kingdom_main"} */

    
        select type from duckdb_databases()
        where lower(database_name)='quest_kingdom'
        and type='sqlite'
    
  
[0m14:46:53.080726 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:46:53.081577 [debug] [ThreadPool]: SQL status: OK in 0.001 seconds
[0m14:46:53.082506 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m14:46:53.082659 [debug] [ThreadPool]: On create_quest_kingdom_main: BEGIN
[0m14:46:53.082892 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m14:46:53.083019 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m14:46:53.083144 [debug] [ThreadPool]: On create_quest_kingdom_main: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "create_quest_kingdom_main"} */

    
    
        create schema if not exists "quest_kingdom"."main"
    
[0m14:46:53.083526 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m14:46:53.083914 [debug] [ThreadPool]: On create_quest_kingdom_main: COMMIT
[0m14:46:53.084056 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m14:46:53.084177 [debug] [ThreadPool]: On create_quest_kingdom_main: COMMIT
[0m14:46:53.084377 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m14:46:53.084505 [debug] [ThreadPool]: On create_quest_kingdom_main: Close
[0m14:46:53.085346 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_quest_kingdom_main, now list_quest_kingdom_main)
[0m14:46:53.088101 [debug] [ThreadPool]: Using duckdb connection "list_quest_kingdom_main"
[0m14:46:53.088269 [debug] [ThreadPool]: On list_quest_kingdom_main: BEGIN
[0m14:46:53.088449 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:46:53.088725 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m14:46:53.088858 [debug] [ThreadPool]: Using duckdb connection "list_quest_kingdom_main"
[0m14:46:53.088990 [debug] [ThreadPool]: On list_quest_kingdom_main: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "list_quest_kingdom_main"} */
select
      'quest_kingdom' as database,
      table_name as name,
      table_schema as schema,
      CASE table_type
        WHEN 'BASE TABLE' THEN 'table'
        WHEN 'VIEW' THEN 'view'
        WHEN 'LOCAL TEMPORARY' THEN 'table'
        END as type
    from system.information_schema.tables
    where lower(table_schema) = 'main'
    and lower(table_catalog) = 'quest_kingdom'
  
[0m14:46:53.100234 [debug] [ThreadPool]: SQL status: OK in 0.011 seconds
[0m14:46:53.101299 [debug] [ThreadPool]: On list_quest_kingdom_main: ROLLBACK
[0m14:46:53.102272 [debug] [ThreadPool]: Failed to rollback 'list_quest_kingdom_main'
[0m14:46:53.102415 [debug] [ThreadPool]: On list_quest_kingdom_main: Close
[0m14:46:53.103796 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '802b6024-ddbd-4718-8e2d-ee7170175e2b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11a92e5d0>]}
[0m14:46:53.104022 [debug] [MainThread]: Using duckdb connection "master"
[0m14:46:53.104152 [debug] [MainThread]: On master: BEGIN
[0m14:46:53.104265 [debug] [MainThread]: Opening a new connection, currently in state init
[0m14:46:53.104523 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m14:46:53.104650 [debug] [MainThread]: On master: COMMIT
[0m14:46:53.104770 [debug] [MainThread]: Using duckdb connection "master"
[0m14:46:53.104885 [debug] [MainThread]: On master: COMMIT
[0m14:46:53.105076 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m14:46:53.105198 [debug] [MainThread]: On master: Close
[0m14:46:53.106370 [debug] [Thread-1 (]: Began running node model.quest_kingdom.rpt_conversion_funnel
[0m14:46:53.106600 [info ] [Thread-1 (]: 1 of 4 START sql table model main.rpt_conversion_funnel ........................ [RUN]
[0m14:46:53.106796 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_quest_kingdom_main, now model.quest_kingdom.rpt_conversion_funnel)
[0m14:46:53.106956 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.rpt_conversion_funnel
[0m14:46:53.110595 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.rpt_conversion_funnel"
[0m14:46:53.110971 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.rpt_conversion_funnel
[0m14:46:53.126512 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.rpt_conversion_funnel"
[0m14:46:53.127018 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_conversion_funnel"
[0m14:46:53.127186 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_conversion_funnel: BEGIN
[0m14:46:53.127337 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:46:53.127728 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m14:46:53.127918 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_conversion_funnel"
[0m14:46:53.128112 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_conversion_funnel: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_conversion_funnel"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_conversion_funnel__dbt_tmp"
  
    as (
      

with players as (
    select * from "quest_kingdom"."main"."dim_players"
),

--define funnel stages
player_funnel as (
    select 
        player_id,
        installed_at,
        cohort_week,
        attribution_channel,
        player_segment,
        experiment_variant,

        --funnel stages (boolean)
        true as stage_1_installed,
        tutorial_completed as stage_2_tutorial_completed,
        is_activated as stage_3_had_session,
        max_level_reached >= 5 as stage_4_reached_level_5,
        is_payer as stage_5_first_purchase,

        --time to each stage
        0 as days_to_install,
        case when tutorial_completed then 0 else null end as days_to_tutorial,
        case when is_activated then 0 else null end as days_to_first_session,
        case when max_level_reached >= 5 then days_to_first_purchase else null end as days_to_level_5,
        days_to_first_purchase
    from players 
)

select * from player_funnel
    );
  
  
[0m14:46:53.136598 [debug] [Thread-1 (]: SQL status: OK in 0.008 seconds
[0m14:46:53.139303 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_conversion_funnel"
[0m14:46:53.139494 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_conversion_funnel: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_conversion_funnel"} */

    SELECT index_name
    FROM duckdb_indexes()
    WHERE schema_name = 'main'
      AND table_name = 'rpt_conversion_funnel'
  
[0m14:46:53.139969 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m14:46:53.140632 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_conversion_funnel"
[0m14:46:53.140802 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_conversion_funnel: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_conversion_funnel"} */

    SELECT COUNT(*) as remaining_indexes
    FROM duckdb_indexes()
    WHERE schema_name = 'main'
      AND table_name = 'rpt_conversion_funnel'
  
[0m14:46:53.141978 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m14:46:53.144972 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_conversion_funnel"
[0m14:46:53.145157 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_conversion_funnel: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_conversion_funnel"} */
alter table "quest_kingdom"."main"."rpt_conversion_funnel" rename to "rpt_conversion_funnel__dbt_backup"
[0m14:46:53.145919 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m14:46:53.147260 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_conversion_funnel"
[0m14:46:53.147435 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_conversion_funnel: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_conversion_funnel"} */
alter table "quest_kingdom"."main"."rpt_conversion_funnel__dbt_tmp" rename to "rpt_conversion_funnel"
[0m14:46:53.147714 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m14:46:53.154592 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_conversion_funnel: COMMIT
[0m14:46:53.154799 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_conversion_funnel"
[0m14:46:53.154953 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_conversion_funnel: COMMIT
[0m14:46:53.157847 [debug] [Thread-1 (]: SQL status: OK in 0.003 seconds
[0m14:46:53.161260 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_conversion_funnel"
[0m14:46:53.161445 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_conversion_funnel: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_conversion_funnel"} */

      drop table if exists "quest_kingdom"."main"."rpt_conversion_funnel__dbt_backup" cascade
    
[0m14:46:53.162230 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m14:46:53.163321 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_conversion_funnel: Close
[0m14:46:53.164232 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '802b6024-ddbd-4718-8e2d-ee7170175e2b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1073ef170>]}
[0m14:46:53.164528 [info ] [Thread-1 (]: 1 of 4 OK created sql table model main.rpt_conversion_funnel ................... [[32mOK[0m in 0.06s]
[0m14:46:53.164792 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.rpt_conversion_funnel
[0m14:46:53.165075 [debug] [Thread-1 (]: Began running node model.quest_kingdom.rpt_daily_revenue
[0m14:46:53.165323 [info ] [Thread-1 (]: 2 of 4 START sql table model main.rpt_daily_revenue ............................ [RUN]
[0m14:46:53.165525 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.quest_kingdom.rpt_conversion_funnel, now model.quest_kingdom.rpt_daily_revenue)
[0m14:46:53.165685 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.rpt_daily_revenue
[0m14:46:53.167498 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.rpt_daily_revenue"
[0m14:46:53.167895 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.rpt_daily_revenue
[0m14:46:53.169482 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.rpt_daily_revenue"
[0m14:46:53.169799 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_daily_revenue"
[0m14:46:53.169962 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_daily_revenue: BEGIN
[0m14:46:53.170104 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:46:53.170430 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m14:46:53.170631 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_daily_revenue"
[0m14:46:53.170927 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_daily_revenue: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_daily_revenue"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_daily_revenue__dbt_tmp"
  
    as (
      

with daily_active_users as (
    select * from "quest_kingdom"."main"."fct_daily_active_users"
),

iap_transactions as (
    select * from "quest_kingdom"."main"."stg_iap_transactions"
),

ad_impressions as (
    select * from "quest_kingdom"."main"."stg_ad_impressions"
),

--daily IAP revenue
daily_iap as (
    select
        purchase_date as revenue_date,
        count(distinct player_id) as paying_users,
        count(*) as transactions,
        sum(price_usd) as iap_revenue,
        avg(price_usd) as avg_transaction_value
    from iap_transactions
    group by purchase_date
),

--daily ad revenue
daily_ads as (
    select 
        ad_date as revenue_date,
        count(distinct player_id) as users_with_ads,
        count(*) as impressions,
        sum(revenue_usd) as ad_revenue,
        sum(case when clicked then 1 else 0 end) as clicks
    from ad_impressions
    group by ad_date 
),

--daily active users
daily_dau as (
    select 
        activity_date as revenue_date,
        count(distinct player_id) as dau 
    from daily_active_users
    group by activity_date
),

--combine all metrics
final as (
    select
        coalesce(d.revenue_date, i.revenue_date, a.revenue_date) as revenue_date,
        --user counts
        coalesce(d.dau, 0) as dau,
        coalesce(i.paying_users, 0) as paying_users,
        coalesce(a.users_with_ads, 0) as users_with_ads,
        --revenue
        coalesce(i.iap_revenue, 0) as iap_revenue,
        coalesce(a.ad_revenue, 0) as ad_revenue,
        coalesce(i.iap_revenue, 0) + coalesce(a.ad_revenue, 0) as total_revenue,
        --transactions and impressions
        coalesce(i.transactions, 0) as iap_transactions,
        coalesce(a.impressions, 0) as ad_impressions,
        coalesce(a.clicks, 0) as ad_clicks,
        --per-transaction metrics
        i.avg_transaction_value,
        --ARPDAU (average revenue per daily active user)
        case
            when coalesce(d.dau, 0) > 0
            then (coalesce(i.iap_revenue, 0) + coalesce(a.ad_revenue, 0)) / d.dau
            else 0
        end as arpdau,
        --ARPPU (average revenue per paying user)
        case
            when coalesce(i.paying_users, 0) > 0
            then coalesce(i.iap_revenue, 0) / i.paying_users
            else 0
        end as arppu,
        --conversion rate (paying users /DAU)
        case
            when coalesce(d.dau, 0) > 0
            then coalesce(i.paying_users, 0)::float / d.dau * 100
            else 0
        end as daily_conversion_rate,
        --ad metrics
        case 
            when coalesce(a.impressions, 0) > 0
            then coalesce(a.clicks, 0)::float / a.impressions * 100
            else 0
        end as ad_ctr
    from daily_dau d 
    full outer join daily_iap i on d.revenue_date = i.revenue_date
    full outer join daily_ads a on d.revenue_date = a.revenue_date
)

select * from final
order by revenue_date
    );
  
  
[0m14:46:53.195279 [debug] [Thread-1 (]: SQL status: OK in 0.024 seconds
[0m14:46:53.197130 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_daily_revenue"
[0m14:46:53.197310 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_daily_revenue: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_daily_revenue"} */
alter table "quest_kingdom"."main"."rpt_daily_revenue__dbt_tmp" rename to "rpt_daily_revenue"
[0m14:46:53.197689 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m14:46:53.198422 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_daily_revenue: COMMIT
[0m14:46:53.198581 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_daily_revenue"
[0m14:46:53.198722 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_daily_revenue: COMMIT
[0m14:46:53.199234 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m14:46:53.200412 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_daily_revenue"
[0m14:46:53.200635 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_daily_revenue: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_daily_revenue"} */

      drop table if exists "quest_kingdom"."main"."rpt_daily_revenue__dbt_backup" cascade
    
[0m14:46:53.201038 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m14:46:53.201682 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_daily_revenue: Close
[0m14:46:53.201978 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '802b6024-ddbd-4718-8e2d-ee7170175e2b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11adb7680>]}
[0m14:46:53.202282 [info ] [Thread-1 (]: 2 of 4 OK created sql table model main.rpt_daily_revenue ....................... [[32mOK[0m in 0.04s]
[0m14:46:53.202553 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.rpt_daily_revenue
[0m14:46:53.202759 [debug] [Thread-1 (]: Began running node model.quest_kingdom.rpt_player_ltv
[0m14:46:53.203021 [info ] [Thread-1 (]: 3 of 4 START sql table model main.rpt_player_ltv ............................... [RUN]
[0m14:46:53.203248 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.quest_kingdom.rpt_daily_revenue, now model.quest_kingdom.rpt_player_ltv)
[0m14:46:53.203405 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.rpt_player_ltv
[0m14:46:53.205104 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.rpt_player_ltv"
[0m14:46:53.205552 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.rpt_player_ltv
[0m14:46:53.207169 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.rpt_player_ltv"
[0m14:46:53.207524 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_player_ltv"
[0m14:46:53.207684 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_player_ltv: BEGIN
[0m14:46:53.207825 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:46:53.208204 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m14:46:53.208437 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_player_ltv"
[0m14:46:53.208700 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_player_ltv: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_player_ltv"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_player_ltv__dbt_tmp"
  
    as (
      

with players as (
    select * from "quest_kingdom"."main"."dim_players"
),

--calculate LTV for each player
player_ltv as (
    select 
        player_id,
        installed_at,
        cohort_week,
        cohort_month,
        attribution_channel,
        country,
        device_type,
        player_segment,
        experiment_variant,
        tutorial_completed,

        --revenue
        total_iap_revenue,
        total_ad_revenue,
        total_revenue,

        --purchase behavior
        total_purchases,
        first_purchase_at,
        days_to_first_purchase,
        avg_purchase_value,

        --engagement
        total_sessions,
        total_active_days,
        total_play_time_minutes,
        max_level_reached,

        --derived metrics
        case
            when total_active_days > 0
            then total_revenue / total_active_days
            else 0
        end as revenue_per_active_day,
        case
            when total_sessions > 0
            then total_revenue / total_sessions
            else 0
        end as revenue_per_session,
        case
            when total_purchases > 0
            then total_iap_revenue / total_purchases
            else 0
        end as avg_iap_value,

        --days since install
        datediff('day', installed_at, current_date) as days_since_install,

        --flags
        is_payer,
        case 
            when total_revenue > 0 and days_to_first_purchase <= 1 then 'Fast Converted'
            when total_revenue > 0 and days_to_first_purchase <= 7 then 'Week 1 Converted'
            when total_revenue > 0 and days_to_first_purchase <= 30 then 'Month 1 Converted'
            when total_revenue > 0 then 'Late Converted'
            else 'Non-Payer'
        end as converter_type
    from players 
)

select * from player_ltv
    );
  
  
[0m14:46:53.213375 [debug] [Thread-1 (]: DuckDB adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_player_ltv"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_player_ltv__dbt_tmp"
  
    as (
      

with players as (
    select * from "quest_kingdom"."main"."dim_players"
),

--calculate LTV for each player
player_ltv as (
    select 
        player_id,
        installed_at,
        cohort_week,
        cohort_month,
        attribution_channel,
        country,
        device_type,
        player_segment,
        experiment_variant,
        tutorial_completed,

        --revenue
        total_iap_revenue,
        total_ad_revenue,
        total_revenue,

        --purchase behavior
        total_purchases,
        first_purchase_at,
        days_to_first_purchase,
        avg_purchase_value,

        --engagement
        total_sessions,
        total_active_days,
        total_play_time_minutes,
        max_level_reached,

        --derived metrics
        case
            when total_active_days > 0
            then total_revenue / total_active_days
            else 0
        end as revenue_per_active_day,
        case
            when total_sessions > 0
            then total_revenue / total_sessions
            else 0
        end as revenue_per_session,
        case
            when total_purchases > 0
            then total_iap_revenue / total_purchases
            else 0
        end as avg_iap_value,

        --days since install
        datediff('day', installed_at, current_date) as days_since_install,

        --flags
        is_payer,
        case 
            when total_revenue > 0 and days_to_first_purchase <= 1 then 'Fast Converted'
            when total_revenue > 0 and days_to_first_purchase <= 7 then 'Week 1 Converted'
            when total_revenue > 0 and days_to_first_purchase <= 30 then 'Month 1 Converted'
            when total_revenue > 0 then 'Late Converted'
            else 'Non-Payer'
        end as converter_type
    from players 
)

select * from player_ltv
    );
  
  
[0m14:46:53.213664 [debug] [Thread-1 (]: DuckDB adapter: Rolling back transaction.
[0m14:46:53.213884 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_player_ltv: ROLLBACK
[0m14:46:53.218242 [debug] [Thread-1 (]: Failed to rollback 'model.quest_kingdom.rpt_player_ltv'
[0m14:46:53.218426 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_player_ltv: Close
[0m14:46:53.219642 [debug] [Thread-1 (]: Runtime Error in model rpt_player_ltv (models/marts/monetization/rpt_player_ltv.sql)
  Binder Error: Referenced column "total_active_days" not found in FROM clause!
  Candidate bindings: "total_ad_clicks", "total_play_time_minutes", "total_ad_revenue", "total_ad_impressions", "total_iap_revenue"
  
  LINE 44:         total_active_days,
                   ^
[0m14:46:53.219883 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '802b6024-ddbd-4718-8e2d-ee7170175e2b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11aed8e90>]}
[0m14:46:53.220170 [error] [Thread-1 (]: 3 of 4 ERROR creating sql table model main.rpt_player_ltv ...................... [[31mERROR[0m in 0.02s]
[0m14:46:53.220423 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.rpt_player_ltv
[0m14:46:53.220601 [debug] [Thread-1 (]: Began running node model.quest_kingdom.rpt_sku_performance
[0m14:46:53.220813 [debug] [Thread-4 (]: Marking all children of 'model.quest_kingdom.rpt_player_ltv' to be skipped because of status 'error'.  Reason: Runtime Error in model rpt_player_ltv (models/marts/monetization/rpt_player_ltv.sql)
  Binder Error: Referenced column "total_active_days" not found in FROM clause!
  Candidate bindings: "total_ad_clicks", "total_play_time_minutes", "total_ad_revenue", "total_ad_impressions", "total_iap_revenue"
  
  LINE 44:         total_active_days,
                   ^.
[0m14:46:53.221022 [info ] [Thread-1 (]: 4 of 4 START sql table model main.rpt_sku_performance .......................... [RUN]
[0m14:46:53.221557 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.quest_kingdom.rpt_player_ltv, now model.quest_kingdom.rpt_sku_performance)
[0m14:46:53.221728 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.rpt_sku_performance
[0m14:46:53.223466 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.rpt_sku_performance"
[0m14:46:53.223840 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.rpt_sku_performance
[0m14:46:53.225406 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.rpt_sku_performance"
[0m14:46:53.225703 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_sku_performance"
[0m14:46:53.225857 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_sku_performance: BEGIN
[0m14:46:53.225995 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:46:53.226378 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m14:46:53.226582 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_sku_performance"
[0m14:46:53.226819 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_sku_performance: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_sku_performance"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_sku_performance__dbt_tmp"
  
    as (
      

with transactions as (
    select * from "quest_kingdom"."main"."stg_iap_transactions"
),

players as (
    select * from "quest_kingdom"."main"."dim_players"
),

--aggregate by SKU
sku_metrics as (
    select 
        t.sku,
        --purchase counts
        count(*) as total_purchases,
        count(distinct t.player_id) as unique_buyers,

        --revenue
        sum(t.price_usd) as total_revenue,
        avg(t.price_usd) as avg_price,

        --virtual currency
        sum(t.gems_purchased) as total_gems_sold,
        avg(t.gems_purchased) as avg_gems_per_purchase,

        --platform split
        sum(case when t.platform = 'ios' then t.price_usd else 0 end) as ios_revenue,
        sum(case when t.platform = 'android' then t.price_usd else 0 end) as android_revenue,

        --timing
        min(t.purchased_at) as first_purchase_date,
        max(t.purchased_at) as last_purchase_date
    from transactions t 
    group by t.sku
),

--get buyer segments for each SKU
sku_by_segment as (
    select 
        t.sku,
        p.player_segment,
        count(*) as purchases,
        sum(t.price_usd) as revenue
    from transactions t 
    inner join players p on t.player_id = p.player_id 
    group by t.sku, p.player_segment 
),

--pivot segments
sku_segment_pivot as (
    select 
        sku,
        sum(case when player_segment = 'whale' then purchases else 0 end) as whale_purchases,
        sum(case when player_segment = 'dolphin' then purchases else 0 end) as dolphin_purchases,
        sum(case when player_segment = 'minnow' then purchases else 0 end) as minnow_purchases,
        sum(case when player_segment = 'whale' then revenue else 0 end) as whale_revenue,
        sum(case when player_segment = 'dolphin' then revenue else 0 end) as dolphin_revenue,
        sum(case when player_segment = 'minnow' then revenue else 0 end) as minnow_revenue
    from sku_by_segment
    group by sku

),

--combine
final as (
    select 
        sm.*,
        sp.whale_purchases,
        sp.dolphin_purchases,
        sp.minnow_purchases,
        sp.whale_revenue,
        sp.dolphin_revenue,
        sp.minnow_revenue,

        --derived metrics
        sm.total_revenue / sm.total_purchases as revenue_per_purchase,
        sm.total_purchases::float / sm.unique_buyers as purchases_per_buyer,

        --revenue share
        round(sm.total_revenue / sum(sm.total_revenue) over() * 100, 2) as revenue_share_pct
    from sku_metrics sm 
    left join sku_segment_pivot sp on sm.sku = sp.sku 
)

select * from final 
order by total_revenue desc
    );
  
  
[0m14:46:53.239767 [debug] [Thread-1 (]: SQL status: OK in 0.013 seconds
[0m14:46:53.240461 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_sku_performance"
[0m14:46:53.240644 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_sku_performance: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_sku_performance"} */

    SELECT index_name
    FROM duckdb_indexes()
    WHERE schema_name = 'main'
      AND table_name = 'rpt_sku_performance'
  
[0m14:46:53.241116 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m14:46:53.241798 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_sku_performance"
[0m14:46:53.241992 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_sku_performance: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_sku_performance"} */

    SELECT COUNT(*) as remaining_indexes
    FROM duckdb_indexes()
    WHERE schema_name = 'main'
      AND table_name = 'rpt_sku_performance'
  
[0m14:46:53.242411 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m14:46:53.243994 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_sku_performance"
[0m14:46:53.244157 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_sku_performance: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_sku_performance"} */
alter table "quest_kingdom"."main"."rpt_sku_performance" rename to "rpt_sku_performance__dbt_backup"
[0m14:46:53.244460 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m14:46:53.246769 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_sku_performance"
[0m14:46:53.246941 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_sku_performance: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_sku_performance"} */
alter table "quest_kingdom"."main"."rpt_sku_performance__dbt_tmp" rename to "rpt_sku_performance"
[0m14:46:53.247251 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m14:46:53.247980 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_sku_performance: COMMIT
[0m14:46:53.248126 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_sku_performance"
[0m14:46:53.248258 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_sku_performance: COMMIT
[0m14:46:53.248690 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m14:46:53.249829 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_sku_performance"
[0m14:46:53.249997 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_sku_performance: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_sku_performance"} */

      drop table if exists "quest_kingdom"."main"."rpt_sku_performance__dbt_backup" cascade
    
[0m14:46:53.250400 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m14:46:53.251033 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_sku_performance: Close
[0m14:46:53.251304 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '802b6024-ddbd-4718-8e2d-ee7170175e2b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11c0642c0>]}
[0m14:46:53.251580 [info ] [Thread-1 (]: 4 of 4 OK created sql table model main.rpt_sku_performance ..................... [[32mOK[0m in 0.03s]
[0m14:46:53.251825 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.rpt_sku_performance
[0m14:46:53.252375 [debug] [MainThread]: Using duckdb connection "master"
[0m14:46:53.252518 [debug] [MainThread]: On master: BEGIN
[0m14:46:53.252639 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m14:46:53.252911 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m14:46:53.253034 [debug] [MainThread]: On master: COMMIT
[0m14:46:53.253151 [debug] [MainThread]: Using duckdb connection "master"
[0m14:46:53.253261 [debug] [MainThread]: On master: COMMIT
[0m14:46:53.253435 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m14:46:53.253553 [debug] [MainThread]: On master: Close
[0m14:46:53.253704 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:46:53.253810 [debug] [MainThread]: Connection 'model.quest_kingdom.rpt_sku_performance' was properly closed.
[0m14:46:53.253956 [info ] [MainThread]: 
[0m14:46:53.254093 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 0.23 seconds (0.23s).
[0m14:46:53.254530 [debug] [MainThread]: Command end result
[0m14:46:53.270946 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/manifest.json
[0m14:46:53.272026 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/semantic_manifest.json
[0m14:46:53.274685 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/run_results.json
[0m14:46:53.274848 [info ] [MainThread]: 
[0m14:46:53.275024 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m14:46:53.275169 [info ] [MainThread]: 
[0m14:46:53.275344 [error] [MainThread]: [31mFailure in model rpt_player_ltv (models/marts/monetization/rpt_player_ltv.sql)[0m
[0m14:46:53.275512 [error] [MainThread]:   Runtime Error in model rpt_player_ltv (models/marts/monetization/rpt_player_ltv.sql)
  Binder Error: Referenced column "total_active_days" not found in FROM clause!
  Candidate bindings: "total_ad_clicks", "total_play_time_minutes", "total_ad_revenue", "total_ad_impressions", "total_iap_revenue"
  
  LINE 44:         total_active_days,
                   ^
[0m14:46:53.275646 [info ] [MainThread]: 
[0m14:46:53.275800 [info ] [MainThread]:   compiled code at target/compiled/quest_kingdom/models/marts/monetization/rpt_player_ltv.sql
[0m14:46:53.275934 [info ] [MainThread]: 
[0m14:46:53.276078 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=4
[0m14:46:53.277487 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.88603735, "process_in_blocks": "0", "process_kernel_time": 0.168942, "process_mem_max_rss": "193118208", "process_out_blocks": "0", "process_user_time": 1.339079}
[0m14:46:53.277745 [debug] [MainThread]: Command `dbt run` failed at 14:46:53.277695 after 0.89 seconds
[0m14:46:53.277943 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x118db5940>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104f9ad50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107420d10>]}
[0m14:46:53.278122 [debug] [MainThread]: Flushing usage events
[0m14:46:53.376343 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m14:59:15.049788 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112dff530>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112fb5b20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112fb58e0>]}


============================== 14:59:15.058009 | 9ee9977f-8db2-4048-8b42-c2f7ad7179b5 ==============================
[0m14:59:15.058009 [info ] [MainThread]: Running with dbt=1.11.4
[0m14:59:15.058331 [debug] [MainThread]: running dbt with arguments {'partial_parse': 'True', 'indirect_selection': 'eager', 'send_anonymous_usage_stats': 'True', 'log_cache_events': 'False', 'introspect': 'True', 'quiet': 'False', 'warn_error': 'None', 'cache_selected_only': 'False', 'write_json': 'True', 'empty': 'False', 'log_format': 'default', 'debug': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'use_experimental_parser': 'False', 'fail_fast': 'False', 'no_print': 'None', 'invocation_command': 'dbt run --select path:models/marts/monetization', 'printer_width': '80', 'use_colors': 'True', 'log_path': '/Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/logs', 'version_check': 'True', 'profiles_dir': '/Users/hazeldonaldson/.dbt', 'target_path': 'None', 'static_parser': 'True'}
[0m14:59:15.217109 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '9ee9977f-8db2-4048-8b42-c2f7ad7179b5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1130e1b80>]}
[0m14:59:15.245345 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '9ee9977f-8db2-4048-8b42-c2f7ad7179b5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1130567b0>]}
[0m14:59:15.246620 [info ] [MainThread]: Registered adapter: duckdb=1.10.0
[0m14:59:15.297875 [debug] [MainThread]: checksum: 092b177ba87eb6bb3c55954c38aa57900eebac336561eb9ee32218428aa81d43, vars: {}, profile: , target: , version: 1.11.4
[0m14:59:15.364973 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m14:59:15.365444 [debug] [MainThread]: Partial parsing: updated file: quest_kingdom://models/marts/monetization/rpt_player_ltv.sql
[0m14:59:15.559358 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '9ee9977f-8db2-4048-8b42-c2f7ad7179b5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113bf4e30>]}
[0m14:59:15.637133 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/manifest.json
[0m14:59:15.638394 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/semantic_manifest.json
[0m14:59:15.652261 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '9ee9977f-8db2-4048-8b42-c2f7ad7179b5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1135dd670>]}
[0m14:59:15.652531 [info ] [MainThread]: Found 15 models, 40 data tests, 5 sources, 472 macros
[0m14:59:15.652702 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9ee9977f-8db2-4048-8b42-c2f7ad7179b5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113bf6720>]}
[0m14:59:15.654445 [info ] [MainThread]: 
[0m14:59:15.654623 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m14:59:15.654761 [info ] [MainThread]: 
[0m14:59:15.654989 [debug] [MainThread]: Acquiring new duckdb connection 'master'
[0m14:59:15.657143 [debug] [ThreadPool]: Acquiring new duckdb connection 'list_quest_kingdom'
[0m14:59:15.687494 [debug] [ThreadPool]: Using duckdb connection "list_quest_kingdom"
[0m14:59:15.687723 [debug] [ThreadPool]: On list_quest_kingdom: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "list_quest_kingdom"} */

    
    select schema_name
    from system.information_schema.schemata
    
    where lower(catalog_name) = '"quest_kingdom"'
    
  
  
[0m14:59:15.687861 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:59:15.704076 [debug] [ThreadPool]: SQL status: OK in 0.016 seconds
[0m14:59:15.704826 [debug] [ThreadPool]: On list_quest_kingdom: Close
[0m14:59:15.705169 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_quest_kingdom, now create_quest_kingdom_main)
[0m14:59:15.705412 [debug] [ThreadPool]: Creating schema "database: "quest_kingdom"
schema: "main"
"
[0m14:59:15.708680 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m14:59:15.708854 [debug] [ThreadPool]: On create_quest_kingdom_main: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "create_quest_kingdom_main"} */

    
        select type from duckdb_databases()
        where lower(database_name)='quest_kingdom'
        and type='sqlite'
    
  
[0m14:59:15.708989 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:59:15.709645 [debug] [ThreadPool]: SQL status: OK in 0.001 seconds
[0m14:59:15.710252 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m14:59:15.710380 [debug] [ThreadPool]: On create_quest_kingdom_main: BEGIN
[0m14:59:15.710591 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m14:59:15.710711 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m14:59:15.710831 [debug] [ThreadPool]: On create_quest_kingdom_main: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "create_quest_kingdom_main"} */

    
    
        create schema if not exists "quest_kingdom"."main"
    
[0m14:59:15.711063 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m14:59:15.711534 [debug] [ThreadPool]: On create_quest_kingdom_main: COMMIT
[0m14:59:15.711673 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m14:59:15.711786 [debug] [ThreadPool]: On create_quest_kingdom_main: COMMIT
[0m14:59:15.711983 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m14:59:15.712109 [debug] [ThreadPool]: On create_quest_kingdom_main: Close
[0m14:59:15.712943 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_quest_kingdom_main, now list_quest_kingdom_main)
[0m14:59:15.715538 [debug] [ThreadPool]: Using duckdb connection "list_quest_kingdom_main"
[0m14:59:15.715686 [debug] [ThreadPool]: On list_quest_kingdom_main: BEGIN
[0m14:59:15.715859 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:59:15.716097 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m14:59:15.716226 [debug] [ThreadPool]: Using duckdb connection "list_quest_kingdom_main"
[0m14:59:15.716357 [debug] [ThreadPool]: On list_quest_kingdom_main: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "list_quest_kingdom_main"} */
select
      'quest_kingdom' as database,
      table_name as name,
      table_schema as schema,
      CASE table_type
        WHEN 'BASE TABLE' THEN 'table'
        WHEN 'VIEW' THEN 'view'
        WHEN 'LOCAL TEMPORARY' THEN 'table'
        END as type
    from system.information_schema.tables
    where lower(table_schema) = 'main'
    and lower(table_catalog) = 'quest_kingdom'
  
[0m14:59:15.726336 [debug] [ThreadPool]: SQL status: OK in 0.010 seconds
[0m14:59:15.727154 [debug] [ThreadPool]: On list_quest_kingdom_main: ROLLBACK
[0m14:59:15.728092 [debug] [ThreadPool]: Failed to rollback 'list_quest_kingdom_main'
[0m14:59:15.728248 [debug] [ThreadPool]: On list_quest_kingdom_main: Close
[0m14:59:15.729469 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9ee9977f-8db2-4048-8b42-c2f7ad7179b5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113bf6bd0>]}
[0m14:59:15.729728 [debug] [MainThread]: Using duckdb connection "master"
[0m14:59:15.729868 [debug] [MainThread]: On master: BEGIN
[0m14:59:15.729992 [debug] [MainThread]: Opening a new connection, currently in state init
[0m14:59:15.730247 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m14:59:15.730382 [debug] [MainThread]: On master: COMMIT
[0m14:59:15.730507 [debug] [MainThread]: Using duckdb connection "master"
[0m14:59:15.730622 [debug] [MainThread]: On master: COMMIT
[0m14:59:15.730812 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m14:59:15.730937 [debug] [MainThread]: On master: Close
[0m14:59:15.732247 [debug] [Thread-1 (]: Began running node model.quest_kingdom.rpt_conversion_funnel
[0m14:59:15.732482 [info ] [Thread-1 (]: 1 of 4 START sql table model main.rpt_conversion_funnel ........................ [RUN]
[0m14:59:15.732685 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_quest_kingdom_main, now model.quest_kingdom.rpt_conversion_funnel)
[0m14:59:15.732846 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.rpt_conversion_funnel
[0m14:59:15.736446 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.rpt_conversion_funnel"
[0m14:59:15.737022 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.rpt_conversion_funnel
[0m14:59:15.752441 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.rpt_conversion_funnel"
[0m14:59:15.752989 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_conversion_funnel"
[0m14:59:15.753160 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_conversion_funnel: BEGIN
[0m14:59:15.753308 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:59:15.753670 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m14:59:15.753815 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_conversion_funnel"
[0m14:59:15.753981 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_conversion_funnel: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_conversion_funnel"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_conversion_funnel__dbt_tmp"
  
    as (
      

with players as (
    select * from "quest_kingdom"."main"."dim_players"
),

--define funnel stages
player_funnel as (
    select 
        player_id,
        installed_at,
        cohort_week,
        attribution_channel,
        player_segment,
        experiment_variant,

        --funnel stages (boolean)
        true as stage_1_installed,
        tutorial_completed as stage_2_tutorial_completed,
        is_activated as stage_3_had_session,
        max_level_reached >= 5 as stage_4_reached_level_5,
        is_payer as stage_5_first_purchase,

        --time to each stage
        0 as days_to_install,
        case when tutorial_completed then 0 else null end as days_to_tutorial,
        case when is_activated then 0 else null end as days_to_first_session,
        case when max_level_reached >= 5 then days_to_first_purchase else null end as days_to_level_5,
        days_to_first_purchase
    from players 
)

select * from player_funnel
    );
  
  
[0m14:59:15.760971 [debug] [Thread-1 (]: SQL status: OK in 0.007 seconds
[0m14:59:15.763603 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_conversion_funnel"
[0m14:59:15.763795 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_conversion_funnel: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_conversion_funnel"} */

    SELECT index_name
    FROM duckdb_indexes()
    WHERE schema_name = 'main'
      AND table_name = 'rpt_conversion_funnel'
  
[0m14:59:15.764247 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m14:59:15.764914 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_conversion_funnel"
[0m14:59:15.765079 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_conversion_funnel: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_conversion_funnel"} */

    SELECT COUNT(*) as remaining_indexes
    FROM duckdb_indexes()
    WHERE schema_name = 'main'
      AND table_name = 'rpt_conversion_funnel'
  
[0m14:59:15.766213 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m14:59:15.769295 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_conversion_funnel"
[0m14:59:15.769484 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_conversion_funnel: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_conversion_funnel"} */
alter table "quest_kingdom"."main"."rpt_conversion_funnel" rename to "rpt_conversion_funnel__dbt_backup"
[0m14:59:15.769841 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m14:59:15.771170 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_conversion_funnel"
[0m14:59:15.771330 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_conversion_funnel: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_conversion_funnel"} */
alter table "quest_kingdom"."main"."rpt_conversion_funnel__dbt_tmp" rename to "rpt_conversion_funnel"
[0m14:59:15.771606 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m14:59:15.778589 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_conversion_funnel: COMMIT
[0m14:59:15.778782 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_conversion_funnel"
[0m14:59:15.778936 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_conversion_funnel: COMMIT
[0m14:59:15.781705 [debug] [Thread-1 (]: SQL status: OK in 0.003 seconds
[0m14:59:15.785076 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_conversion_funnel"
[0m14:59:15.785264 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_conversion_funnel: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_conversion_funnel"} */

      drop table if exists "quest_kingdom"."main"."rpt_conversion_funnel__dbt_backup" cascade
    
[0m14:59:15.786036 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m14:59:15.787122 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_conversion_funnel: Close
[0m14:59:15.788041 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9ee9977f-8db2-4048-8b42-c2f7ad7179b5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1138f7fe0>]}
[0m14:59:15.788333 [info ] [Thread-1 (]: 1 of 4 OK created sql table model main.rpt_conversion_funnel ................... [[32mOK[0m in 0.05s]
[0m14:59:15.788588 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.rpt_conversion_funnel
[0m14:59:15.788773 [debug] [Thread-1 (]: Began running node model.quest_kingdom.rpt_daily_revenue
[0m14:59:15.788998 [info ] [Thread-1 (]: 2 of 4 START sql table model main.rpt_daily_revenue ............................ [RUN]
[0m14:59:15.789191 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.quest_kingdom.rpt_conversion_funnel, now model.quest_kingdom.rpt_daily_revenue)
[0m14:59:15.789350 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.rpt_daily_revenue
[0m14:59:15.791110 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.rpt_daily_revenue"
[0m14:59:15.791592 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.rpt_daily_revenue
[0m14:59:15.793196 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.rpt_daily_revenue"
[0m14:59:15.793566 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_daily_revenue"
[0m14:59:15.793732 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_daily_revenue: BEGIN
[0m14:59:15.793879 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:59:15.794195 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m14:59:15.794349 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_daily_revenue"
[0m14:59:15.794567 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_daily_revenue: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_daily_revenue"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_daily_revenue__dbt_tmp"
  
    as (
      

with daily_active_users as (
    select * from "quest_kingdom"."main"."fct_daily_active_users"
),

iap_transactions as (
    select * from "quest_kingdom"."main"."stg_iap_transactions"
),

ad_impressions as (
    select * from "quest_kingdom"."main"."stg_ad_impressions"
),

--daily IAP revenue
daily_iap as (
    select
        purchase_date as revenue_date,
        count(distinct player_id) as paying_users,
        count(*) as transactions,
        sum(price_usd) as iap_revenue,
        avg(price_usd) as avg_transaction_value
    from iap_transactions
    group by purchase_date
),

--daily ad revenue
daily_ads as (
    select 
        ad_date as revenue_date,
        count(distinct player_id) as users_with_ads,
        count(*) as impressions,
        sum(revenue_usd) as ad_revenue,
        sum(case when clicked then 1 else 0 end) as clicks
    from ad_impressions
    group by ad_date 
),

--daily active users
daily_dau as (
    select 
        activity_date as revenue_date,
        count(distinct player_id) as dau 
    from daily_active_users
    group by activity_date
),

--combine all metrics
final as (
    select
        coalesce(d.revenue_date, i.revenue_date, a.revenue_date) as revenue_date,
        --user counts
        coalesce(d.dau, 0) as dau,
        coalesce(i.paying_users, 0) as paying_users,
        coalesce(a.users_with_ads, 0) as users_with_ads,
        --revenue
        coalesce(i.iap_revenue, 0) as iap_revenue,
        coalesce(a.ad_revenue, 0) as ad_revenue,
        coalesce(i.iap_revenue, 0) + coalesce(a.ad_revenue, 0) as total_revenue,
        --transactions and impressions
        coalesce(i.transactions, 0) as iap_transactions,
        coalesce(a.impressions, 0) as ad_impressions,
        coalesce(a.clicks, 0) as ad_clicks,
        --per-transaction metrics
        i.avg_transaction_value,
        --ARPDAU (average revenue per daily active user)
        case
            when coalesce(d.dau, 0) > 0
            then (coalesce(i.iap_revenue, 0) + coalesce(a.ad_revenue, 0)) / d.dau
            else 0
        end as arpdau,
        --ARPPU (average revenue per paying user)
        case
            when coalesce(i.paying_users, 0) > 0
            then coalesce(i.iap_revenue, 0) / i.paying_users
            else 0
        end as arppu,
        --conversion rate (paying users /DAU)
        case
            when coalesce(d.dau, 0) > 0
            then coalesce(i.paying_users, 0)::float / d.dau * 100
            else 0
        end as daily_conversion_rate,
        --ad metrics
        case 
            when coalesce(a.impressions, 0) > 0
            then coalesce(a.clicks, 0)::float / a.impressions * 100
            else 0
        end as ad_ctr
    from daily_dau d 
    full outer join daily_iap i on d.revenue_date = i.revenue_date
    full outer join daily_ads a on d.revenue_date = a.revenue_date
)

select * from final
order by revenue_date
    );
  
  
[0m14:59:15.808811 [debug] [Thread-1 (]: SQL status: OK in 0.014 seconds
[0m14:59:15.809504 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_daily_revenue"
[0m14:59:15.809682 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_daily_revenue: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_daily_revenue"} */

    SELECT index_name
    FROM duckdb_indexes()
    WHERE schema_name = 'main'
      AND table_name = 'rpt_daily_revenue'
  
[0m14:59:15.810140 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m14:59:15.810786 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_daily_revenue"
[0m14:59:15.810953 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_daily_revenue: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_daily_revenue"} */

    SELECT COUNT(*) as remaining_indexes
    FROM duckdb_indexes()
    WHERE schema_name = 'main'
      AND table_name = 'rpt_daily_revenue'
  
[0m14:59:15.811365 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m14:59:15.812860 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_daily_revenue"
[0m14:59:15.813088 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_daily_revenue: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_daily_revenue"} */
alter table "quest_kingdom"."main"."rpt_daily_revenue" rename to "rpt_daily_revenue__dbt_backup"
[0m14:59:15.813386 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m14:59:15.814660 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_daily_revenue"
[0m14:59:15.814815 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_daily_revenue: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_daily_revenue"} */
alter table "quest_kingdom"."main"."rpt_daily_revenue__dbt_tmp" rename to "rpt_daily_revenue"
[0m14:59:15.815075 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m14:59:15.815801 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_daily_revenue: COMMIT
[0m14:59:15.815948 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_daily_revenue"
[0m14:59:15.816082 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_daily_revenue: COMMIT
[0m14:59:15.816826 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m14:59:15.817937 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_daily_revenue"
[0m14:59:15.818097 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_daily_revenue: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_daily_revenue"} */

      drop table if exists "quest_kingdom"."main"."rpt_daily_revenue__dbt_backup" cascade
    
[0m14:59:15.818475 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m14:59:15.819060 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_daily_revenue: Close
[0m14:59:15.819323 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9ee9977f-8db2-4048-8b42-c2f7ad7179b5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113fb6de0>]}
[0m14:59:15.819595 [info ] [Thread-1 (]: 2 of 4 OK created sql table model main.rpt_daily_revenue ....................... [[32mOK[0m in 0.03s]
[0m14:59:15.819839 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.rpt_daily_revenue
[0m14:59:15.820020 [debug] [Thread-1 (]: Began running node model.quest_kingdom.rpt_player_ltv
[0m14:59:15.820249 [info ] [Thread-1 (]: 3 of 4 START sql table model main.rpt_player_ltv ............................... [RUN]
[0m14:59:15.820434 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.quest_kingdom.rpt_daily_revenue, now model.quest_kingdom.rpt_player_ltv)
[0m14:59:15.820593 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.rpt_player_ltv
[0m14:59:15.822360 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.rpt_player_ltv"
[0m14:59:15.822819 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.rpt_player_ltv
[0m14:59:15.824642 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.rpt_player_ltv"
[0m14:59:15.825158 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_player_ltv"
[0m14:59:15.825345 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_player_ltv: BEGIN
[0m14:59:15.825504 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:59:15.825942 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m14:59:15.826150 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_player_ltv"
[0m14:59:15.826422 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_player_ltv: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_player_ltv"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_player_ltv__dbt_tmp"
  
    as (
      

with players as (
    select * from "quest_kingdom"."main"."dim_players"
),

daily_activity as (
    select * from "quest_kingdom"."main"."fct_daily_active_users"
),

--count active days per player
player_active_days as (
    select 
        player_id,
        count(distinct activity_date) as total_active_days
),

--calculate LTV for each player
player_ltv as (
    select 
        p.player_id,
        p.installed_at,
        p.cohort_week,
        p.cohort_month,
        p.attribution_channel,
        p.country,
        p.device_type,
        p.player_segment,
        p.experiment_variant,
        p.tutorial_completed,

        --revenue
        p.total_iap_revenue,
        p.total_ad_revenue,
        p.total_revenue,

        --purchase behavior
        p.total_purchases,
        p.first_purchase_at,
        p.days_to_first_purchase,
        p.avg_purchase_value,

        --engagement
        p.total_sessions,
        coalesce(pad.total_active_days, 0) as total_active_days
        p.total_play_time_minutes,
        p.max_level_reached,

        --derived metrics
        case
            when coalesce(pad.total_active_days, 0) > 0
            then p.total_revenue / pad.total_active_days
            else 0
        end as revenue_per_active_day,
        case
            when p.total_sessions > 0
            then p.total_revenue / p.total_sessions
            else 0
        end as revenue_per_session,
        case
            when p.total_purchases > 0
            then p.total_iap_revenue / p.total_purchases
            else 0
        end as avg_iap_value,

        --days since install
        p.days_since_install,

        --flags
        p.is_payer,
        case 
            when p.total_revenue > 0 and p.days_to_first_purchase <= 1 then 'Fast Converted'
            when p.total_revenue > 0 and p.days_to_first_purchase <= 7 then 'Week 1 Converted'
            when p.total_revenue > 0 and p.days_to_first_purchase <= 30 then 'Month 1 Converted'
            when p.total_revenue > 0 then 'Late Converted'
            else 'Non-Payer'
        end as converter_type
    from players p
    left join player_active_days pad on p.player_id = pad.player_id
)

select * from player_ltv
    );
  
  
[0m14:59:15.829871 [debug] [Thread-1 (]: DuckDB adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_player_ltv"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_player_ltv__dbt_tmp"
  
    as (
      

with players as (
    select * from "quest_kingdom"."main"."dim_players"
),

daily_activity as (
    select * from "quest_kingdom"."main"."fct_daily_active_users"
),

--count active days per player
player_active_days as (
    select 
        player_id,
        count(distinct activity_date) as total_active_days
),

--calculate LTV for each player
player_ltv as (
    select 
        p.player_id,
        p.installed_at,
        p.cohort_week,
        p.cohort_month,
        p.attribution_channel,
        p.country,
        p.device_type,
        p.player_segment,
        p.experiment_variant,
        p.tutorial_completed,

        --revenue
        p.total_iap_revenue,
        p.total_ad_revenue,
        p.total_revenue,

        --purchase behavior
        p.total_purchases,
        p.first_purchase_at,
        p.days_to_first_purchase,
        p.avg_purchase_value,

        --engagement
        p.total_sessions,
        coalesce(pad.total_active_days, 0) as total_active_days
        p.total_play_time_minutes,
        p.max_level_reached,

        --derived metrics
        case
            when coalesce(pad.total_active_days, 0) > 0
            then p.total_revenue / pad.total_active_days
            else 0
        end as revenue_per_active_day,
        case
            when p.total_sessions > 0
            then p.total_revenue / p.total_sessions
            else 0
        end as revenue_per_session,
        case
            when p.total_purchases > 0
            then p.total_iap_revenue / p.total_purchases
            else 0
        end as avg_iap_value,

        --days since install
        p.days_since_install,

        --flags
        p.is_payer,
        case 
            when p.total_revenue > 0 and p.days_to_first_purchase <= 1 then 'Fast Converted'
            when p.total_revenue > 0 and p.days_to_first_purchase <= 7 then 'Week 1 Converted'
            when p.total_revenue > 0 and p.days_to_first_purchase <= 30 then 'Month 1 Converted'
            when p.total_revenue > 0 then 'Late Converted'
            else 'Non-Payer'
        end as converter_type
    from players p
    left join player_active_days pad on p.player_id = pad.player_id
)

select * from player_ltv
    );
  
  
[0m14:59:15.830194 [debug] [Thread-1 (]: DuckDB adapter: Rolling back transaction.
[0m14:59:15.830426 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_player_ltv: ROLLBACK
[0m14:59:15.834888 [debug] [Thread-1 (]: Failed to rollback 'model.quest_kingdom.rpt_player_ltv'
[0m14:59:15.835093 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_player_ltv: Close
[0m14:59:15.836286 [debug] [Thread-1 (]: Runtime Error in model rpt_player_ltv (models/marts/monetization/rpt_player_ltv.sql)
  Parser Error: syntax error at or near "p"
  
  LINE 56:         p.total_play_time_minutes,
                   ^
[0m14:59:15.836525 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9ee9977f-8db2-4048-8b42-c2f7ad7179b5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1148bac60>]}
[0m14:59:15.836840 [error] [Thread-1 (]: 3 of 4 ERROR creating sql table model main.rpt_player_ltv ...................... [[31mERROR[0m in 0.02s]
[0m14:59:15.837101 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.rpt_player_ltv
[0m14:59:15.837281 [debug] [Thread-1 (]: Began running node model.quest_kingdom.rpt_sku_performance
[0m14:59:15.837506 [debug] [Thread-4 (]: Marking all children of 'model.quest_kingdom.rpt_player_ltv' to be skipped because of status 'error'.  Reason: Runtime Error in model rpt_player_ltv (models/marts/monetization/rpt_player_ltv.sql)
  Parser Error: syntax error at or near "p"
  
  LINE 56:         p.total_play_time_minutes,
                   ^.
[0m14:59:15.837727 [info ] [Thread-1 (]: 4 of 4 START sql table model main.rpt_sku_performance .......................... [RUN]
[0m14:59:15.838312 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.quest_kingdom.rpt_player_ltv, now model.quest_kingdom.rpt_sku_performance)
[0m14:59:15.838503 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.rpt_sku_performance
[0m14:59:15.840491 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.rpt_sku_performance"
[0m14:59:15.841009 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.rpt_sku_performance
[0m14:59:15.842672 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.rpt_sku_performance"
[0m14:59:15.843230 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_sku_performance"
[0m14:59:15.843412 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_sku_performance: BEGIN
[0m14:59:15.843565 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:59:15.843950 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m14:59:15.844108 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_sku_performance"
[0m14:59:15.844323 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_sku_performance: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_sku_performance"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_sku_performance__dbt_tmp"
  
    as (
      

with transactions as (
    select * from "quest_kingdom"."main"."stg_iap_transactions"
),

players as (
    select * from "quest_kingdom"."main"."dim_players"
),

--aggregate by SKU
sku_metrics as (
    select 
        t.sku,
        --purchase counts
        count(*) as total_purchases,
        count(distinct t.player_id) as unique_buyers,

        --revenue
        sum(t.price_usd) as total_revenue,
        avg(t.price_usd) as avg_price,

        --virtual currency
        sum(t.gems_purchased) as total_gems_sold,
        avg(t.gems_purchased) as avg_gems_per_purchase,

        --platform split
        sum(case when t.platform = 'ios' then t.price_usd else 0 end) as ios_revenue,
        sum(case when t.platform = 'android' then t.price_usd else 0 end) as android_revenue,

        --timing
        min(t.purchased_at) as first_purchase_date,
        max(t.purchased_at) as last_purchase_date
    from transactions t 
    group by t.sku
),

--get buyer segments for each SKU
sku_by_segment as (
    select 
        t.sku,
        p.player_segment,
        count(*) as purchases,
        sum(t.price_usd) as revenue
    from transactions t 
    inner join players p on t.player_id = p.player_id 
    group by t.sku, p.player_segment 
),

--pivot segments
sku_segment_pivot as (
    select 
        sku,
        sum(case when player_segment = 'whale' then purchases else 0 end) as whale_purchases,
        sum(case when player_segment = 'dolphin' then purchases else 0 end) as dolphin_purchases,
        sum(case when player_segment = 'minnow' then purchases else 0 end) as minnow_purchases,
        sum(case when player_segment = 'whale' then revenue else 0 end) as whale_revenue,
        sum(case when player_segment = 'dolphin' then revenue else 0 end) as dolphin_revenue,
        sum(case when player_segment = 'minnow' then revenue else 0 end) as minnow_revenue
    from sku_by_segment
    group by sku

),

--combine
final as (
    select 
        sm.*,
        sp.whale_purchases,
        sp.dolphin_purchases,
        sp.minnow_purchases,
        sp.whale_revenue,
        sp.dolphin_revenue,
        sp.minnow_revenue,

        --derived metrics
        sm.total_revenue / sm.total_purchases as revenue_per_purchase,
        sm.total_purchases::float / sm.unique_buyers as purchases_per_buyer,

        --revenue share
        round(sm.total_revenue / sum(sm.total_revenue) over() * 100, 2) as revenue_share_pct
    from sku_metrics sm 
    left join sku_segment_pivot sp on sm.sku = sp.sku 
)

select * from final 
order by total_revenue desc
    );
  
  
[0m14:59:15.858358 [debug] [Thread-1 (]: SQL status: OK in 0.014 seconds
[0m14:59:15.859366 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_sku_performance"
[0m14:59:15.859614 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_sku_performance: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_sku_performance"} */

    SELECT index_name
    FROM duckdb_indexes()
    WHERE schema_name = 'main'
      AND table_name = 'rpt_sku_performance'
  
[0m14:59:15.860354 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m14:59:15.862623 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_sku_performance"
[0m14:59:15.863386 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_sku_performance: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_sku_performance"} */

    SELECT COUNT(*) as remaining_indexes
    FROM duckdb_indexes()
    WHERE schema_name = 'main'
      AND table_name = 'rpt_sku_performance'
  
[0m14:59:15.864105 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m14:59:15.865898 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_sku_performance"
[0m14:59:15.867071 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_sku_performance: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_sku_performance"} */
alter table "quest_kingdom"."main"."rpt_sku_performance" rename to "rpt_sku_performance__dbt_backup"
[0m14:59:15.867532 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m14:59:15.869192 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_sku_performance"
[0m14:59:15.869411 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_sku_performance: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_sku_performance"} */
alter table "quest_kingdom"."main"."rpt_sku_performance__dbt_tmp" rename to "rpt_sku_performance"
[0m14:59:15.869810 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m14:59:15.870621 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_sku_performance: COMMIT
[0m14:59:15.870790 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_sku_performance"
[0m14:59:15.870940 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_sku_performance: COMMIT
[0m14:59:15.871585 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m14:59:15.876989 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_sku_performance"
[0m14:59:15.877211 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_sku_performance: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_sku_performance"} */

      drop table if exists "quest_kingdom"."main"."rpt_sku_performance__dbt_backup" cascade
    
[0m14:59:15.877840 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m14:59:15.878574 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_sku_performance: Close
[0m14:59:15.878866 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9ee9977f-8db2-4048-8b42-c2f7ad7179b5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1148a8110>]}
[0m14:59:15.879172 [info ] [Thread-1 (]: 4 of 4 OK created sql table model main.rpt_sku_performance ..................... [[32mOK[0m in 0.04s]
[0m14:59:15.879434 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.rpt_sku_performance
[0m14:59:15.880071 [debug] [MainThread]: Using duckdb connection "master"
[0m14:59:15.880256 [debug] [MainThread]: On master: BEGIN
[0m14:59:15.880399 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m14:59:15.880744 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m14:59:15.880878 [debug] [MainThread]: On master: COMMIT
[0m14:59:15.881004 [debug] [MainThread]: Using duckdb connection "master"
[0m14:59:15.881122 [debug] [MainThread]: On master: COMMIT
[0m14:59:15.881364 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m14:59:15.881516 [debug] [MainThread]: On master: Close
[0m14:59:15.881704 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:59:15.881826 [debug] [MainThread]: Connection 'model.quest_kingdom.rpt_sku_performance' was properly closed.
[0m14:59:15.882003 [info ] [MainThread]: 
[0m14:59:15.882160 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 0.23 seconds (0.23s).
[0m14:59:15.882611 [debug] [MainThread]: Command end result
[0m14:59:15.899832 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/manifest.json
[0m14:59:15.900906 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/semantic_manifest.json
[0m14:59:15.903940 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/run_results.json
[0m14:59:15.904107 [info ] [MainThread]: 
[0m14:59:15.904277 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m14:59:15.904415 [info ] [MainThread]: 
[0m14:59:15.904583 [error] [MainThread]: [31mFailure in model rpt_player_ltv (models/marts/monetization/rpt_player_ltv.sql)[0m
[0m14:59:15.904746 [error] [MainThread]:   Runtime Error in model rpt_player_ltv (models/marts/monetization/rpt_player_ltv.sql)
  Parser Error: syntax error at or near "p"
  
  LINE 56:         p.total_play_time_minutes,
                   ^
[0m14:59:15.904872 [info ] [MainThread]: 
[0m14:59:15.905022 [info ] [MainThread]:   compiled code at target/compiled/quest_kingdom/models/marts/monetization/rpt_player_ltv.sql
[0m14:59:15.905150 [info ] [MainThread]: 
[0m14:59:15.905287 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=4
[0m14:59:15.906697 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.8989353, "process_in_blocks": "0", "process_kernel_time": 0.203503, "process_mem_max_rss": "193069056", "process_out_blocks": "0", "process_user_time": 1.34149}
[0m14:59:15.906910 [debug] [MainThread]: Command `dbt run` failed at 14:59:15.906872 after 0.90 seconds
[0m14:59:15.907079 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112fb59a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113aaaf30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114c6ffb0>]}
[0m14:59:15.907237 [debug] [MainThread]: Flushing usage events
[0m14:59:16.034252 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m14:59:42.536445 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1086a1940>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108d59940>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108d596d0>]}


============================== 14:59:42.540946 | a4e686e1-cc13-4666-a1d5-0e85715a0f99 ==============================
[0m14:59:42.540946 [info ] [MainThread]: Running with dbt=1.11.4
[0m14:59:42.541306 [debug] [MainThread]: running dbt with arguments {'cache_selected_only': 'False', 'write_json': 'True', 'printer_width': '80', 'profiles_dir': '/Users/hazeldonaldson/.dbt', 'send_anonymous_usage_stats': 'True', 'invocation_command': 'dbt run --select path:models/marts/monetization', 'target_path': 'None', 'empty': 'False', 'fail_fast': 'False', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'static_parser': 'True', 'log_path': '/Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/logs', 'debug': 'False', 'partial_parse': 'True', 'log_cache_events': 'False', 'use_colors': 'True', 'warn_error': 'None', 'version_check': 'True', 'no_print': 'None', 'introspect': 'True', 'use_experimental_parser': 'False', 'indirect_selection': 'eager', 'log_format': 'default'}
[0m14:59:42.710819 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a4e686e1-cc13-4666-a1d5-0e85715a0f99', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108ef66f0>]}
[0m14:59:42.740748 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a4e686e1-cc13-4666-a1d5-0e85715a0f99', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107739f70>]}
[0m14:59:42.763790 [info ] [MainThread]: Registered adapter: duckdb=1.10.0
[0m14:59:42.825019 [debug] [MainThread]: checksum: 092b177ba87eb6bb3c55954c38aa57900eebac336561eb9ee32218428aa81d43, vars: {}, profile: , target: , version: 1.11.4
[0m14:59:42.890401 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m14:59:42.890865 [debug] [MainThread]: Partial parsing: updated file: quest_kingdom://models/marts/monetization/rpt_player_ltv.sql
[0m14:59:43.086929 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a4e686e1-cc13-4666-a1d5-0e85715a0f99', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10943a1b0>]}
[0m14:59:43.168174 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/manifest.json
[0m14:59:43.169940 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/semantic_manifest.json
[0m14:59:43.182672 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a4e686e1-cc13-4666-a1d5-0e85715a0f99', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10968dee0>]}
[0m14:59:43.182946 [info ] [MainThread]: Found 15 models, 40 data tests, 5 sources, 472 macros
[0m14:59:43.183128 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a4e686e1-cc13-4666-a1d5-0e85715a0f99', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10968d910>]}
[0m14:59:43.184949 [info ] [MainThread]: 
[0m14:59:43.185136 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m14:59:43.185275 [info ] [MainThread]: 
[0m14:59:43.185507 [debug] [MainThread]: Acquiring new duckdb connection 'master'
[0m14:59:43.187695 [debug] [ThreadPool]: Acquiring new duckdb connection 'list_quest_kingdom'
[0m14:59:43.229056 [debug] [ThreadPool]: Using duckdb connection "list_quest_kingdom"
[0m14:59:43.229314 [debug] [ThreadPool]: On list_quest_kingdom: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "list_quest_kingdom"} */

    
    select schema_name
    from system.information_schema.schemata
    
    where lower(catalog_name) = '"quest_kingdom"'
    
  
  
[0m14:59:43.229467 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:59:43.248162 [debug] [ThreadPool]: SQL status: OK in 0.019 seconds
[0m14:59:43.249131 [debug] [ThreadPool]: On list_quest_kingdom: Close
[0m14:59:43.249473 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_quest_kingdom, now create_quest_kingdom_main)
[0m14:59:43.249689 [debug] [ThreadPool]: Creating schema "database: "quest_kingdom"
schema: "main"
"
[0m14:59:43.252990 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m14:59:43.253169 [debug] [ThreadPool]: On create_quest_kingdom_main: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "create_quest_kingdom_main"} */

    
        select type from duckdb_databases()
        where lower(database_name)='quest_kingdom'
        and type='sqlite'
    
  
[0m14:59:43.253308 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:59:43.254050 [debug] [ThreadPool]: SQL status: OK in 0.001 seconds
[0m14:59:43.254679 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m14:59:43.254812 [debug] [ThreadPool]: On create_quest_kingdom_main: BEGIN
[0m14:59:43.255022 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m14:59:43.255144 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m14:59:43.255270 [debug] [ThreadPool]: On create_quest_kingdom_main: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "create_quest_kingdom_main"} */

    
    
        create schema if not exists "quest_kingdom"."main"
    
[0m14:59:43.255773 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m14:59:43.256162 [debug] [ThreadPool]: On create_quest_kingdom_main: COMMIT
[0m14:59:43.256297 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m14:59:43.256414 [debug] [ThreadPool]: On create_quest_kingdom_main: COMMIT
[0m14:59:43.256618 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m14:59:43.256755 [debug] [ThreadPool]: On create_quest_kingdom_main: Close
[0m14:59:43.257587 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_quest_kingdom_main, now list_quest_kingdom_main)
[0m14:59:43.260255 [debug] [ThreadPool]: Using duckdb connection "list_quest_kingdom_main"
[0m14:59:43.260414 [debug] [ThreadPool]: On list_quest_kingdom_main: BEGIN
[0m14:59:43.260596 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:59:43.260841 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m14:59:43.260969 [debug] [ThreadPool]: Using duckdb connection "list_quest_kingdom_main"
[0m14:59:43.261098 [debug] [ThreadPool]: On list_quest_kingdom_main: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "list_quest_kingdom_main"} */
select
      'quest_kingdom' as database,
      table_name as name,
      table_schema as schema,
      CASE table_type
        WHEN 'BASE TABLE' THEN 'table'
        WHEN 'VIEW' THEN 'view'
        WHEN 'LOCAL TEMPORARY' THEN 'table'
        END as type
    from system.information_schema.tables
    where lower(table_schema) = 'main'
    and lower(table_catalog) = 'quest_kingdom'
  
[0m14:59:43.272244 [debug] [ThreadPool]: SQL status: OK in 0.011 seconds
[0m14:59:43.273298 [debug] [ThreadPool]: On list_quest_kingdom_main: ROLLBACK
[0m14:59:43.274193 [debug] [ThreadPool]: Failed to rollback 'list_quest_kingdom_main'
[0m14:59:43.274335 [debug] [ThreadPool]: On list_quest_kingdom_main: Close
[0m14:59:43.275542 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a4e686e1-cc13-4666-a1d5-0e85715a0f99', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1094e7590>]}
[0m14:59:43.275807 [debug] [MainThread]: Using duckdb connection "master"
[0m14:59:43.275951 [debug] [MainThread]: On master: BEGIN
[0m14:59:43.276077 [debug] [MainThread]: Opening a new connection, currently in state init
[0m14:59:43.276333 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m14:59:43.276473 [debug] [MainThread]: On master: COMMIT
[0m14:59:43.276603 [debug] [MainThread]: Using duckdb connection "master"
[0m14:59:43.276722 [debug] [MainThread]: On master: COMMIT
[0m14:59:43.276913 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m14:59:43.277039 [debug] [MainThread]: On master: Close
[0m14:59:43.278304 [debug] [Thread-1 (]: Began running node model.quest_kingdom.rpt_conversion_funnel
[0m14:59:43.278543 [info ] [Thread-1 (]: 1 of 4 START sql table model main.rpt_conversion_funnel ........................ [RUN]
[0m14:59:43.278745 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_quest_kingdom_main, now model.quest_kingdom.rpt_conversion_funnel)
[0m14:59:43.278904 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.rpt_conversion_funnel
[0m14:59:43.282560 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.rpt_conversion_funnel"
[0m14:59:43.282978 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.rpt_conversion_funnel
[0m14:59:43.298730 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.rpt_conversion_funnel"
[0m14:59:43.299296 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_conversion_funnel"
[0m14:59:43.299475 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_conversion_funnel: BEGIN
[0m14:59:43.299625 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:59:43.299985 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m14:59:43.300141 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_conversion_funnel"
[0m14:59:43.300308 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_conversion_funnel: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_conversion_funnel"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_conversion_funnel__dbt_tmp"
  
    as (
      

with players as (
    select * from "quest_kingdom"."main"."dim_players"
),

--define funnel stages
player_funnel as (
    select 
        player_id,
        installed_at,
        cohort_week,
        attribution_channel,
        player_segment,
        experiment_variant,

        --funnel stages (boolean)
        true as stage_1_installed,
        tutorial_completed as stage_2_tutorial_completed,
        is_activated as stage_3_had_session,
        max_level_reached >= 5 as stage_4_reached_level_5,
        is_payer as stage_5_first_purchase,

        --time to each stage
        0 as days_to_install,
        case when tutorial_completed then 0 else null end as days_to_tutorial,
        case when is_activated then 0 else null end as days_to_first_session,
        case when max_level_reached >= 5 then days_to_first_purchase else null end as days_to_level_5,
        days_to_first_purchase
    from players 
)

select * from player_funnel
    );
  
  
[0m14:59:43.308641 [debug] [Thread-1 (]: SQL status: OK in 0.008 seconds
[0m14:59:43.311358 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_conversion_funnel"
[0m14:59:43.311556 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_conversion_funnel: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_conversion_funnel"} */

    SELECT index_name
    FROM duckdb_indexes()
    WHERE schema_name = 'main'
      AND table_name = 'rpt_conversion_funnel'
  
[0m14:59:43.312034 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m14:59:43.312707 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_conversion_funnel"
[0m14:59:43.312877 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_conversion_funnel: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_conversion_funnel"} */

    SELECT COUNT(*) as remaining_indexes
    FROM duckdb_indexes()
    WHERE schema_name = 'main'
      AND table_name = 'rpt_conversion_funnel'
  
[0m14:59:43.313902 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m14:59:43.316890 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_conversion_funnel"
[0m14:59:43.317070 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_conversion_funnel: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_conversion_funnel"} */
alter table "quest_kingdom"."main"."rpt_conversion_funnel" rename to "rpt_conversion_funnel__dbt_backup"
[0m14:59:43.317821 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m14:59:43.319139 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_conversion_funnel"
[0m14:59:43.319305 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_conversion_funnel: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_conversion_funnel"} */
alter table "quest_kingdom"."main"."rpt_conversion_funnel__dbt_tmp" rename to "rpt_conversion_funnel"
[0m14:59:43.319582 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m14:59:43.326442 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_conversion_funnel: COMMIT
[0m14:59:43.326647 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_conversion_funnel"
[0m14:59:43.326808 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_conversion_funnel: COMMIT
[0m14:59:43.350085 [debug] [Thread-1 (]: SQL status: OK in 0.023 seconds
[0m14:59:43.354112 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_conversion_funnel"
[0m14:59:43.354339 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_conversion_funnel: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_conversion_funnel"} */

      drop table if exists "quest_kingdom"."main"."rpt_conversion_funnel__dbt_backup" cascade
    
[0m14:59:43.360694 [debug] [Thread-1 (]: SQL status: OK in 0.006 seconds
[0m14:59:43.363581 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_conversion_funnel: Close
[0m14:59:43.366516 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a4e686e1-cc13-4666-a1d5-0e85715a0f99', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1099521e0>]}
[0m14:59:43.366875 [info ] [Thread-1 (]: 1 of 4 OK created sql table model main.rpt_conversion_funnel ................... [[32mOK[0m in 0.09s]
[0m14:59:43.367188 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.rpt_conversion_funnel
[0m14:59:43.367404 [debug] [Thread-1 (]: Began running node model.quest_kingdom.rpt_daily_revenue
[0m14:59:43.367669 [info ] [Thread-1 (]: 2 of 4 START sql table model main.rpt_daily_revenue ............................ [RUN]
[0m14:59:43.367897 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.quest_kingdom.rpt_conversion_funnel, now model.quest_kingdom.rpt_daily_revenue)
[0m14:59:43.368079 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.rpt_daily_revenue
[0m14:59:43.370219 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.rpt_daily_revenue"
[0m14:59:43.370705 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.rpt_daily_revenue
[0m14:59:43.372694 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.rpt_daily_revenue"
[0m14:59:43.373189 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_daily_revenue"
[0m14:59:43.373377 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_daily_revenue: BEGIN
[0m14:59:43.373542 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:59:43.373975 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m14:59:43.374177 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_daily_revenue"
[0m14:59:43.374433 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_daily_revenue: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_daily_revenue"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_daily_revenue__dbt_tmp"
  
    as (
      

with daily_active_users as (
    select * from "quest_kingdom"."main"."fct_daily_active_users"
),

iap_transactions as (
    select * from "quest_kingdom"."main"."stg_iap_transactions"
),

ad_impressions as (
    select * from "quest_kingdom"."main"."stg_ad_impressions"
),

--daily IAP revenue
daily_iap as (
    select
        purchase_date as revenue_date,
        count(distinct player_id) as paying_users,
        count(*) as transactions,
        sum(price_usd) as iap_revenue,
        avg(price_usd) as avg_transaction_value
    from iap_transactions
    group by purchase_date
),

--daily ad revenue
daily_ads as (
    select 
        ad_date as revenue_date,
        count(distinct player_id) as users_with_ads,
        count(*) as impressions,
        sum(revenue_usd) as ad_revenue,
        sum(case when clicked then 1 else 0 end) as clicks
    from ad_impressions
    group by ad_date 
),

--daily active users
daily_dau as (
    select 
        activity_date as revenue_date,
        count(distinct player_id) as dau 
    from daily_active_users
    group by activity_date
),

--combine all metrics
final as (
    select
        coalesce(d.revenue_date, i.revenue_date, a.revenue_date) as revenue_date,
        --user counts
        coalesce(d.dau, 0) as dau,
        coalesce(i.paying_users, 0) as paying_users,
        coalesce(a.users_with_ads, 0) as users_with_ads,
        --revenue
        coalesce(i.iap_revenue, 0) as iap_revenue,
        coalesce(a.ad_revenue, 0) as ad_revenue,
        coalesce(i.iap_revenue, 0) + coalesce(a.ad_revenue, 0) as total_revenue,
        --transactions and impressions
        coalesce(i.transactions, 0) as iap_transactions,
        coalesce(a.impressions, 0) as ad_impressions,
        coalesce(a.clicks, 0) as ad_clicks,
        --per-transaction metrics
        i.avg_transaction_value,
        --ARPDAU (average revenue per daily active user)
        case
            when coalesce(d.dau, 0) > 0
            then (coalesce(i.iap_revenue, 0) + coalesce(a.ad_revenue, 0)) / d.dau
            else 0
        end as arpdau,
        --ARPPU (average revenue per paying user)
        case
            when coalesce(i.paying_users, 0) > 0
            then coalesce(i.iap_revenue, 0) / i.paying_users
            else 0
        end as arppu,
        --conversion rate (paying users /DAU)
        case
            when coalesce(d.dau, 0) > 0
            then coalesce(i.paying_users, 0)::float / d.dau * 100
            else 0
        end as daily_conversion_rate,
        --ad metrics
        case 
            when coalesce(a.impressions, 0) > 0
            then coalesce(a.clicks, 0)::float / a.impressions * 100
            else 0
        end as ad_ctr
    from daily_dau d 
    full outer join daily_iap i on d.revenue_date = i.revenue_date
    full outer join daily_ads a on d.revenue_date = a.revenue_date
)

select * from final
order by revenue_date
    );
  
  
[0m14:59:43.393330 [debug] [Thread-1 (]: SQL status: OK in 0.019 seconds
[0m14:59:43.398381 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_daily_revenue"
[0m14:59:43.398610 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_daily_revenue: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_daily_revenue"} */

    SELECT index_name
    FROM duckdb_indexes()
    WHERE schema_name = 'main'
      AND table_name = 'rpt_daily_revenue'
  
[0m14:59:43.399178 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m14:59:43.399981 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_daily_revenue"
[0m14:59:43.400171 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_daily_revenue: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_daily_revenue"} */

    SELECT COUNT(*) as remaining_indexes
    FROM duckdb_indexes()
    WHERE schema_name = 'main'
      AND table_name = 'rpt_daily_revenue'
  
[0m14:59:43.400649 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m14:59:43.402487 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_daily_revenue"
[0m14:59:43.406398 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_daily_revenue: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_daily_revenue"} */
alter table "quest_kingdom"."main"."rpt_daily_revenue" rename to "rpt_daily_revenue__dbt_backup"
[0m14:59:43.407538 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m14:59:43.411257 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_daily_revenue"
[0m14:59:43.411461 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_daily_revenue: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_daily_revenue"} */
alter table "quest_kingdom"."main"."rpt_daily_revenue__dbt_tmp" rename to "rpt_daily_revenue"
[0m14:59:43.411793 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m14:59:43.412644 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_daily_revenue: COMMIT
[0m14:59:43.412828 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_daily_revenue"
[0m14:59:43.412986 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_daily_revenue: COMMIT
[0m14:59:43.413584 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m14:59:43.414912 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_daily_revenue"
[0m14:59:43.415113 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_daily_revenue: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_daily_revenue"} */

      drop table if exists "quest_kingdom"."main"."rpt_daily_revenue__dbt_backup" cascade
    
[0m14:59:43.415577 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m14:59:43.416262 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_daily_revenue: Close
[0m14:59:43.416569 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a4e686e1-cc13-4666-a1d5-0e85715a0f99', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109950770>]}
[0m14:59:43.416888 [info ] [Thread-1 (]: 2 of 4 OK created sql table model main.rpt_daily_revenue ....................... [[32mOK[0m in 0.05s]
[0m14:59:43.417174 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.rpt_daily_revenue
[0m14:59:43.417368 [debug] [Thread-1 (]: Began running node model.quest_kingdom.rpt_player_ltv
[0m14:59:43.417622 [info ] [Thread-1 (]: 3 of 4 START sql table model main.rpt_player_ltv ............................... [RUN]
[0m14:59:43.417826 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.quest_kingdom.rpt_daily_revenue, now model.quest_kingdom.rpt_player_ltv)
[0m14:59:43.417999 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.rpt_player_ltv
[0m14:59:43.419867 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.rpt_player_ltv"
[0m14:59:43.420302 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.rpt_player_ltv
[0m14:59:43.422349 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.rpt_player_ltv"
[0m14:59:43.422837 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_player_ltv"
[0m14:59:43.423008 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_player_ltv: BEGIN
[0m14:59:43.423160 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:59:43.423597 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m14:59:43.423782 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_player_ltv"
[0m14:59:43.423999 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_player_ltv: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_player_ltv"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_player_ltv__dbt_tmp"
  
    as (
      

with players as (
    select * from "quest_kingdom"."main"."dim_players"
),

daily_activity as (
    select * from "quest_kingdom"."main"."fct_daily_active_users"
),

--count active days per player
player_active_days as (
    select 
        player_id,
        count(distinct activity_date) as total_active_days
),

--calculate LTV for each player
player_ltv as (
    select 
        p.player_id,
        p.installed_at,
        p.cohort_week,
        p.cohort_month,
        p.attribution_channel,
        p.country,
        p.device_type,
        p.player_segment,
        p.experiment_variant,
        p.tutorial_completed,

        --revenue
        p.total_iap_revenue,
        p.total_ad_revenue,
        p.total_revenue,

        --purchase behavior
        p.total_purchases,
        p.first_purchase_at,
        p.days_to_first_purchase,
        p.avg_purchase_value,

        --engagement
        p.total_sessions,
        coalesce(pad.total_active_days, 0) as total_active_days,
        p.total_play_time_minutes,
        p.max_level_reached,

        --derived metrics
        case
            when coalesce(pad.total_active_days, 0) > 0
            then p.total_revenue / pad.total_active_days
            else 0
        end as revenue_per_active_day,
        case
            when p.total_sessions > 0
            then p.total_revenue / p.total_sessions
            else 0
        end as revenue_per_session,
        case
            when p.total_purchases > 0
            then p.total_iap_revenue / p.total_purchases
            else 0
        end as avg_iap_value,

        --days since install
        p.days_since_install,

        --flags
        p.is_payer,
        case 
            when p.total_revenue > 0 and p.days_to_first_purchase <= 1 then 'Fast Converted'
            when p.total_revenue > 0 and p.days_to_first_purchase <= 7 then 'Week 1 Converted'
            when p.total_revenue > 0 and p.days_to_first_purchase <= 30 then 'Month 1 Converted'
            when p.total_revenue > 0 then 'Late Converted'
            else 'Non-Payer'
        end as converter_type
    from players p
    left join player_active_days pad on p.player_id = pad.player_id
)

select * from player_ltv
    );
  
  
[0m14:59:43.428428 [debug] [Thread-1 (]: DuckDB adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_player_ltv"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_player_ltv__dbt_tmp"
  
    as (
      

with players as (
    select * from "quest_kingdom"."main"."dim_players"
),

daily_activity as (
    select * from "quest_kingdom"."main"."fct_daily_active_users"
),

--count active days per player
player_active_days as (
    select 
        player_id,
        count(distinct activity_date) as total_active_days
),

--calculate LTV for each player
player_ltv as (
    select 
        p.player_id,
        p.installed_at,
        p.cohort_week,
        p.cohort_month,
        p.attribution_channel,
        p.country,
        p.device_type,
        p.player_segment,
        p.experiment_variant,
        p.tutorial_completed,

        --revenue
        p.total_iap_revenue,
        p.total_ad_revenue,
        p.total_revenue,

        --purchase behavior
        p.total_purchases,
        p.first_purchase_at,
        p.days_to_first_purchase,
        p.avg_purchase_value,

        --engagement
        p.total_sessions,
        coalesce(pad.total_active_days, 0) as total_active_days,
        p.total_play_time_minutes,
        p.max_level_reached,

        --derived metrics
        case
            when coalesce(pad.total_active_days, 0) > 0
            then p.total_revenue / pad.total_active_days
            else 0
        end as revenue_per_active_day,
        case
            when p.total_sessions > 0
            then p.total_revenue / p.total_sessions
            else 0
        end as revenue_per_session,
        case
            when p.total_purchases > 0
            then p.total_iap_revenue / p.total_purchases
            else 0
        end as avg_iap_value,

        --days since install
        p.days_since_install,

        --flags
        p.is_payer,
        case 
            when p.total_revenue > 0 and p.days_to_first_purchase <= 1 then 'Fast Converted'
            when p.total_revenue > 0 and p.days_to_first_purchase <= 7 then 'Week 1 Converted'
            when p.total_revenue > 0 and p.days_to_first_purchase <= 30 then 'Month 1 Converted'
            when p.total_revenue > 0 then 'Late Converted'
            else 'Non-Payer'
        end as converter_type
    from players p
    left join player_active_days pad on p.player_id = pad.player_id
)

select * from player_ltv
    );
  
  
[0m14:59:43.428737 [debug] [Thread-1 (]: DuckDB adapter: Rolling back transaction.
[0m14:59:43.428974 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_player_ltv: ROLLBACK
[0m14:59:43.433283 [debug] [Thread-1 (]: Failed to rollback 'model.quest_kingdom.rpt_player_ltv'
[0m14:59:43.433472 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_player_ltv: Close
[0m14:59:43.434667 [debug] [Thread-1 (]: Runtime Error in model rpt_player_ltv (models/marts/monetization/rpt_player_ltv.sql)
  Binder Error: Referenced column "player_id" was not found because the FROM clause is missing
  
  LINE 24:         player_id,
                   ^
[0m14:59:43.434895 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a4e686e1-cc13-4666-a1d5-0e85715a0f99', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109952120>]}
[0m14:59:43.435196 [error] [Thread-1 (]: 3 of 4 ERROR creating sql table model main.rpt_player_ltv ...................... [[31mERROR[0m in 0.02s]
[0m14:59:43.435457 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.rpt_player_ltv
[0m14:59:43.435638 [debug] [Thread-1 (]: Began running node model.quest_kingdom.rpt_sku_performance
[0m14:59:43.435867 [debug] [Thread-4 (]: Marking all children of 'model.quest_kingdom.rpt_player_ltv' to be skipped because of status 'error'.  Reason: Runtime Error in model rpt_player_ltv (models/marts/monetization/rpt_player_ltv.sql)
  Binder Error: Referenced column "player_id" was not found because the FROM clause is missing
  
  LINE 24:         player_id,
                   ^.
[0m14:59:43.436085 [info ] [Thread-1 (]: 4 of 4 START sql table model main.rpt_sku_performance .......................... [RUN]
[0m14:59:43.436648 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.quest_kingdom.rpt_player_ltv, now model.quest_kingdom.rpt_sku_performance)
[0m14:59:43.436824 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.rpt_sku_performance
[0m14:59:43.438601 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.rpt_sku_performance"
[0m14:59:43.439001 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.rpt_sku_performance
[0m14:59:43.440640 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.rpt_sku_performance"
[0m14:59:43.441034 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_sku_performance"
[0m14:59:43.441200 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_sku_performance: BEGIN
[0m14:59:43.441393 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:59:43.441819 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m14:59:43.441971 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_sku_performance"
[0m14:59:43.442183 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_sku_performance: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_sku_performance"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_sku_performance__dbt_tmp"
  
    as (
      

with transactions as (
    select * from "quest_kingdom"."main"."stg_iap_transactions"
),

players as (
    select * from "quest_kingdom"."main"."dim_players"
),

--aggregate by SKU
sku_metrics as (
    select 
        t.sku,
        --purchase counts
        count(*) as total_purchases,
        count(distinct t.player_id) as unique_buyers,

        --revenue
        sum(t.price_usd) as total_revenue,
        avg(t.price_usd) as avg_price,

        --virtual currency
        sum(t.gems_purchased) as total_gems_sold,
        avg(t.gems_purchased) as avg_gems_per_purchase,

        --platform split
        sum(case when t.platform = 'ios' then t.price_usd else 0 end) as ios_revenue,
        sum(case when t.platform = 'android' then t.price_usd else 0 end) as android_revenue,

        --timing
        min(t.purchased_at) as first_purchase_date,
        max(t.purchased_at) as last_purchase_date
    from transactions t 
    group by t.sku
),

--get buyer segments for each SKU
sku_by_segment as (
    select 
        t.sku,
        p.player_segment,
        count(*) as purchases,
        sum(t.price_usd) as revenue
    from transactions t 
    inner join players p on t.player_id = p.player_id 
    group by t.sku, p.player_segment 
),

--pivot segments
sku_segment_pivot as (
    select 
        sku,
        sum(case when player_segment = 'whale' then purchases else 0 end) as whale_purchases,
        sum(case when player_segment = 'dolphin' then purchases else 0 end) as dolphin_purchases,
        sum(case when player_segment = 'minnow' then purchases else 0 end) as minnow_purchases,
        sum(case when player_segment = 'whale' then revenue else 0 end) as whale_revenue,
        sum(case when player_segment = 'dolphin' then revenue else 0 end) as dolphin_revenue,
        sum(case when player_segment = 'minnow' then revenue else 0 end) as minnow_revenue
    from sku_by_segment
    group by sku

),

--combine
final as (
    select 
        sm.*,
        sp.whale_purchases,
        sp.dolphin_purchases,
        sp.minnow_purchases,
        sp.whale_revenue,
        sp.dolphin_revenue,
        sp.minnow_revenue,

        --derived metrics
        sm.total_revenue / sm.total_purchases as revenue_per_purchase,
        sm.total_purchases::float / sm.unique_buyers as purchases_per_buyer,

        --revenue share
        round(sm.total_revenue / sum(sm.total_revenue) over() * 100, 2) as revenue_share_pct
    from sku_metrics sm 
    left join sku_segment_pivot sp on sm.sku = sp.sku 
)

select * from final 
order by total_revenue desc
    );
  
  
[0m14:59:43.453052 [debug] [Thread-1 (]: SQL status: OK in 0.011 seconds
[0m14:59:43.453718 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_sku_performance"
[0m14:59:43.453893 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_sku_performance: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_sku_performance"} */

    SELECT index_name
    FROM duckdb_indexes()
    WHERE schema_name = 'main'
      AND table_name = 'rpt_sku_performance'
  
[0m14:59:43.454342 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m14:59:43.455977 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_sku_performance"
[0m14:59:43.456143 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_sku_performance: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_sku_performance"} */

    SELECT COUNT(*) as remaining_indexes
    FROM duckdb_indexes()
    WHERE schema_name = 'main'
      AND table_name = 'rpt_sku_performance'
  
[0m14:59:43.456678 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m14:59:43.458582 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_sku_performance"
[0m14:59:43.458897 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_sku_performance: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_sku_performance"} */
alter table "quest_kingdom"."main"."rpt_sku_performance" rename to "rpt_sku_performance__dbt_backup"
[0m14:59:43.459472 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m14:59:43.461254 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_sku_performance"
[0m14:59:43.461435 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_sku_performance: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_sku_performance"} */
alter table "quest_kingdom"."main"."rpt_sku_performance__dbt_tmp" rename to "rpt_sku_performance"
[0m14:59:43.461748 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m14:59:43.462507 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_sku_performance: COMMIT
[0m14:59:43.462665 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_sku_performance"
[0m14:59:43.462804 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_sku_performance: COMMIT
[0m14:59:43.463236 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m14:59:43.464406 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_sku_performance"
[0m14:59:43.464574 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_sku_performance: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_sku_performance"} */

      drop table if exists "quest_kingdom"."main"."rpt_sku_performance__dbt_backup" cascade
    
[0m14:59:43.464998 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m14:59:43.465585 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_sku_performance: Close
[0m14:59:43.465865 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a4e686e1-cc13-4666-a1d5-0e85715a0f99', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10985b050>]}
[0m14:59:43.466154 [info ] [Thread-1 (]: 4 of 4 OK created sql table model main.rpt_sku_performance ..................... [[32mOK[0m in 0.03s]
[0m14:59:43.466407 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.rpt_sku_performance
[0m14:59:43.466969 [debug] [MainThread]: Using duckdb connection "master"
[0m14:59:43.467110 [debug] [MainThread]: On master: BEGIN
[0m14:59:43.467232 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m14:59:43.467495 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m14:59:43.467627 [debug] [MainThread]: On master: COMMIT
[0m14:59:43.467754 [debug] [MainThread]: Using duckdb connection "master"
[0m14:59:43.467875 [debug] [MainThread]: On master: COMMIT
[0m14:59:43.468103 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m14:59:43.468238 [debug] [MainThread]: On master: Close
[0m14:59:43.468432 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:59:43.468602 [debug] [MainThread]: Connection 'model.quest_kingdom.rpt_sku_performance' was properly closed.
[0m14:59:43.468794 [info ] [MainThread]: 
[0m14:59:43.471228 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 0.28 seconds (0.28s).
[0m14:59:43.473043 [debug] [MainThread]: Command end result
[0m14:59:43.490560 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/manifest.json
[0m14:59:43.492073 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/semantic_manifest.json
[0m14:59:43.495576 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/run_results.json
[0m14:59:43.495763 [info ] [MainThread]: 
[0m14:59:43.495934 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m14:59:43.496073 [info ] [MainThread]: 
[0m14:59:43.496245 [error] [MainThread]: [31mFailure in model rpt_player_ltv (models/marts/monetization/rpt_player_ltv.sql)[0m
[0m14:59:43.496411 [error] [MainThread]:   Runtime Error in model rpt_player_ltv (models/marts/monetization/rpt_player_ltv.sql)
  Binder Error: Referenced column "player_id" was not found because the FROM clause is missing
  
  LINE 24:         player_id,
                   ^
[0m14:59:43.496537 [info ] [MainThread]: 
[0m14:59:43.496687 [info ] [MainThread]:   compiled code at target/compiled/quest_kingdom/models/marts/monetization/rpt_player_ltv.sql
[0m14:59:43.496815 [info ] [MainThread]: 
[0m14:59:43.496955 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=4
[0m14:59:43.498362 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.9979172, "process_in_blocks": "0", "process_kernel_time": 0.202537, "process_mem_max_rss": "191840256", "process_out_blocks": "0", "process_user_time": 1.363685}
[0m14:59:43.498596 [debug] [MainThread]: Command `dbt run` failed at 14:59:43.498555 after 1.00 seconds
[0m14:59:43.498780 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108d59790>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108005610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109a0d820>]}
[0m14:59:43.498947 [debug] [MainThread]: Flushing usage events
[0m14:59:43.593059 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m15:00:32.752126 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108219430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108feda00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108fed7f0>]}


============================== 15:00:32.758788 | 400a3177-e60a-422d-b149-e0611f8d8925 ==============================
[0m15:00:32.758788 [info ] [MainThread]: Running with dbt=1.11.4
[0m15:00:32.759141 [debug] [MainThread]: running dbt with arguments {'send_anonymous_usage_stats': 'True', 'static_parser': 'True', 'indirect_selection': 'eager', 'log_format': 'default', 'version_check': 'True', 'partial_parse': 'True', 'invocation_command': 'dbt run --select path:models/marts/monetization', 'fail_fast': 'False', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'use_colors': 'True', 'printer_width': '80', 'cache_selected_only': 'False', 'debug': 'False', 'log_cache_events': 'False', 'no_print': 'None', 'introspect': 'True', 'write_json': 'True', 'profiles_dir': '/Users/hazeldonaldson/.dbt', 'quiet': 'False', 'use_experimental_parser': 'False', 'warn_error': 'None', 'log_path': '/Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/logs', 'empty': 'False'}
[0m15:00:32.919831 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '400a3177-e60a-422d-b149-e0611f8d8925', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106697e90>]}
[0m15:00:32.948449 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '400a3177-e60a-422d-b149-e0611f8d8925', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108fef8c0>]}
[0m15:00:32.949737 [info ] [MainThread]: Registered adapter: duckdb=1.10.0
[0m15:00:33.001606 [debug] [MainThread]: checksum: 092b177ba87eb6bb3c55954c38aa57900eebac336561eb9ee32218428aa81d43, vars: {}, profile: , target: , version: 1.11.4
[0m15:00:33.067876 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m15:00:33.068119 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m15:00:33.068254 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m15:00:33.090007 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '400a3177-e60a-422d-b149-e0611f8d8925', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1092b3c80>]}
[0m15:00:33.132898 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/manifest.json
[0m15:00:33.134429 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/semantic_manifest.json
[0m15:00:33.147209 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '400a3177-e60a-422d-b149-e0611f8d8925', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109695820>]}
[0m15:00:33.147483 [info ] [MainThread]: Found 15 models, 40 data tests, 5 sources, 472 macros
[0m15:00:33.147658 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '400a3177-e60a-422d-b149-e0611f8d8925', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109294b90>]}
[0m15:00:33.149484 [info ] [MainThread]: 
[0m15:00:33.149667 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:00:33.149813 [info ] [MainThread]: 
[0m15:00:33.150068 [debug] [MainThread]: Acquiring new duckdb connection 'master'
[0m15:00:33.152259 [debug] [ThreadPool]: Acquiring new duckdb connection 'list_quest_kingdom'
[0m15:00:33.184328 [debug] [ThreadPool]: Using duckdb connection "list_quest_kingdom"
[0m15:00:33.184574 [debug] [ThreadPool]: On list_quest_kingdom: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "list_quest_kingdom"} */

    
    select schema_name
    from system.information_schema.schemata
    
    where lower(catalog_name) = '"quest_kingdom"'
    
  
  
[0m15:00:33.185061 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:00:33.202980 [debug] [ThreadPool]: SQL status: OK in 0.018 seconds
[0m15:00:33.203967 [debug] [ThreadPool]: On list_quest_kingdom: Close
[0m15:00:33.204338 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_quest_kingdom, now create_quest_kingdom_main)
[0m15:00:33.204731 [debug] [ThreadPool]: Creating schema "database: "quest_kingdom"
schema: "main"
"
[0m15:00:33.208150 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m15:00:33.208328 [debug] [ThreadPool]: On create_quest_kingdom_main: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "create_quest_kingdom_main"} */

    
        select type from duckdb_databases()
        where lower(database_name)='quest_kingdom'
        and type='sqlite'
    
  
[0m15:00:33.208466 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:00:33.209311 [debug] [ThreadPool]: SQL status: OK in 0.001 seconds
[0m15:00:33.209929 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m15:00:33.210073 [debug] [ThreadPool]: On create_quest_kingdom_main: BEGIN
[0m15:00:33.210292 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m15:00:33.210418 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m15:00:33.210540 [debug] [ThreadPool]: On create_quest_kingdom_main: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "create_quest_kingdom_main"} */

    
    
        create schema if not exists "quest_kingdom"."main"
    
[0m15:00:33.211005 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m15:00:33.211371 [debug] [ThreadPool]: On create_quest_kingdom_main: COMMIT
[0m15:00:33.211500 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m15:00:33.211614 [debug] [ThreadPool]: On create_quest_kingdom_main: COMMIT
[0m15:00:33.211804 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m15:00:33.211935 [debug] [ThreadPool]: On create_quest_kingdom_main: Close
[0m15:00:33.212779 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_quest_kingdom_main, now list_quest_kingdom_main)
[0m15:00:33.215420 [debug] [ThreadPool]: Using duckdb connection "list_quest_kingdom_main"
[0m15:00:33.215582 [debug] [ThreadPool]: On list_quest_kingdom_main: BEGIN
[0m15:00:33.215709 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:00:33.215956 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m15:00:33.216089 [debug] [ThreadPool]: Using duckdb connection "list_quest_kingdom_main"
[0m15:00:33.216224 [debug] [ThreadPool]: On list_quest_kingdom_main: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "list_quest_kingdom_main"} */
select
      'quest_kingdom' as database,
      table_name as name,
      table_schema as schema,
      CASE table_type
        WHEN 'BASE TABLE' THEN 'table'
        WHEN 'VIEW' THEN 'view'
        WHEN 'LOCAL TEMPORARY' THEN 'table'
        END as type
    from system.information_schema.tables
    where lower(table_schema) = 'main'
    and lower(table_catalog) = 'quest_kingdom'
  
[0m15:00:33.227161 [debug] [ThreadPool]: SQL status: OK in 0.011 seconds
[0m15:00:33.228004 [debug] [ThreadPool]: On list_quest_kingdom_main: ROLLBACK
[0m15:00:33.228974 [debug] [ThreadPool]: Failed to rollback 'list_quest_kingdom_main'
[0m15:00:33.229113 [debug] [ThreadPool]: On list_quest_kingdom_main: Close
[0m15:00:33.230555 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '400a3177-e60a-422d-b149-e0611f8d8925', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10676f770>]}
[0m15:00:33.230795 [debug] [MainThread]: Using duckdb connection "master"
[0m15:00:33.230932 [debug] [MainThread]: On master: BEGIN
[0m15:00:33.231055 [debug] [MainThread]: Opening a new connection, currently in state init
[0m15:00:33.231327 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m15:00:33.231459 [debug] [MainThread]: On master: COMMIT
[0m15:00:33.231582 [debug] [MainThread]: Using duckdb connection "master"
[0m15:00:33.231700 [debug] [MainThread]: On master: COMMIT
[0m15:00:33.231887 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m15:00:33.232010 [debug] [MainThread]: On master: Close
[0m15:00:33.233245 [debug] [Thread-1 (]: Began running node model.quest_kingdom.rpt_conversion_funnel
[0m15:00:33.233480 [info ] [Thread-1 (]: 1 of 4 START sql table model main.rpt_conversion_funnel ........................ [RUN]
[0m15:00:33.233674 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_quest_kingdom_main, now model.quest_kingdom.rpt_conversion_funnel)
[0m15:00:33.233831 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.rpt_conversion_funnel
[0m15:00:33.238092 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.rpt_conversion_funnel"
[0m15:00:33.238521 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.rpt_conversion_funnel
[0m15:00:33.253833 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.rpt_conversion_funnel"
[0m15:00:33.254364 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_conversion_funnel"
[0m15:00:33.254544 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_conversion_funnel: BEGIN
[0m15:00:33.254689 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:00:33.255036 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m15:00:33.255179 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_conversion_funnel"
[0m15:00:33.255342 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_conversion_funnel: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_conversion_funnel"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_conversion_funnel__dbt_tmp"
  
    as (
      

with players as (
    select * from "quest_kingdom"."main"."dim_players"
),

--define funnel stages
player_funnel as (
    select 
        player_id,
        installed_at,
        cohort_week,
        attribution_channel,
        player_segment,
        experiment_variant,

        --funnel stages (boolean)
        true as stage_1_installed,
        tutorial_completed as stage_2_tutorial_completed,
        is_activated as stage_3_had_session,
        max_level_reached >= 5 as stage_4_reached_level_5,
        is_payer as stage_5_first_purchase,

        --time to each stage
        0 as days_to_install,
        case when tutorial_completed then 0 else null end as days_to_tutorial,
        case when is_activated then 0 else null end as days_to_first_session,
        case when max_level_reached >= 5 then days_to_first_purchase else null end as days_to_level_5,
        days_to_first_purchase
    from players 
)

select * from player_funnel
    );
  
  
[0m15:00:33.262902 [debug] [Thread-1 (]: SQL status: OK in 0.007 seconds
[0m15:00:33.265665 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_conversion_funnel"
[0m15:00:33.265860 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_conversion_funnel: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_conversion_funnel"} */

    SELECT index_name
    FROM duckdb_indexes()
    WHERE schema_name = 'main'
      AND table_name = 'rpt_conversion_funnel'
  
[0m15:00:33.266335 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m15:00:33.266938 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_conversion_funnel"
[0m15:00:33.267097 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_conversion_funnel: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_conversion_funnel"} */

    SELECT COUNT(*) as remaining_indexes
    FROM duckdb_indexes()
    WHERE schema_name = 'main'
      AND table_name = 'rpt_conversion_funnel'
  
[0m15:00:33.267967 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m15:00:33.270956 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_conversion_funnel"
[0m15:00:33.271135 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_conversion_funnel: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_conversion_funnel"} */
alter table "quest_kingdom"."main"."rpt_conversion_funnel" rename to "rpt_conversion_funnel__dbt_backup"
[0m15:00:33.271908 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m15:00:33.273294 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_conversion_funnel"
[0m15:00:33.273474 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_conversion_funnel: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_conversion_funnel"} */
alter table "quest_kingdom"."main"."rpt_conversion_funnel__dbt_tmp" rename to "rpt_conversion_funnel"
[0m15:00:33.273769 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m15:00:33.280730 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_conversion_funnel: COMMIT
[0m15:00:33.280917 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_conversion_funnel"
[0m15:00:33.281062 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_conversion_funnel: COMMIT
[0m15:00:33.283985 [debug] [Thread-1 (]: SQL status: OK in 0.003 seconds
[0m15:00:33.286562 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_conversion_funnel"
[0m15:00:33.286742 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_conversion_funnel: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_conversion_funnel"} */

      drop table if exists "quest_kingdom"."main"."rpt_conversion_funnel__dbt_backup" cascade
    
[0m15:00:33.287413 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m15:00:33.288503 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_conversion_funnel: Close
[0m15:00:33.289446 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '400a3177-e60a-422d-b149-e0611f8d8925', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106697140>]}
[0m15:00:33.289800 [info ] [Thread-1 (]: 1 of 4 OK created sql table model main.rpt_conversion_funnel ................... [[32mOK[0m in 0.06s]
[0m15:00:33.290183 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.rpt_conversion_funnel
[0m15:00:33.290382 [debug] [Thread-1 (]: Began running node model.quest_kingdom.rpt_daily_revenue
[0m15:00:33.290628 [info ] [Thread-1 (]: 2 of 4 START sql table model main.rpt_daily_revenue ............................ [RUN]
[0m15:00:33.290850 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.quest_kingdom.rpt_conversion_funnel, now model.quest_kingdom.rpt_daily_revenue)
[0m15:00:33.291015 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.rpt_daily_revenue
[0m15:00:33.292823 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.rpt_daily_revenue"
[0m15:00:33.293225 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.rpt_daily_revenue
[0m15:00:33.294798 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.rpt_daily_revenue"
[0m15:00:33.295136 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_daily_revenue"
[0m15:00:33.295295 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_daily_revenue: BEGIN
[0m15:00:33.295437 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:00:33.295760 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m15:00:33.295944 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_daily_revenue"
[0m15:00:33.296197 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_daily_revenue: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_daily_revenue"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_daily_revenue__dbt_tmp"
  
    as (
      

with daily_active_users as (
    select * from "quest_kingdom"."main"."fct_daily_active_users"
),

iap_transactions as (
    select * from "quest_kingdom"."main"."stg_iap_transactions"
),

ad_impressions as (
    select * from "quest_kingdom"."main"."stg_ad_impressions"
),

--daily IAP revenue
daily_iap as (
    select
        purchase_date as revenue_date,
        count(distinct player_id) as paying_users,
        count(*) as transactions,
        sum(price_usd) as iap_revenue,
        avg(price_usd) as avg_transaction_value
    from iap_transactions
    group by purchase_date
),

--daily ad revenue
daily_ads as (
    select 
        ad_date as revenue_date,
        count(distinct player_id) as users_with_ads,
        count(*) as impressions,
        sum(revenue_usd) as ad_revenue,
        sum(case when clicked then 1 else 0 end) as clicks
    from ad_impressions
    group by ad_date 
),

--daily active users
daily_dau as (
    select 
        activity_date as revenue_date,
        count(distinct player_id) as dau 
    from daily_active_users
    group by activity_date
),

--combine all metrics
final as (
    select
        coalesce(d.revenue_date, i.revenue_date, a.revenue_date) as revenue_date,
        --user counts
        coalesce(d.dau, 0) as dau,
        coalesce(i.paying_users, 0) as paying_users,
        coalesce(a.users_with_ads, 0) as users_with_ads,
        --revenue
        coalesce(i.iap_revenue, 0) as iap_revenue,
        coalesce(a.ad_revenue, 0) as ad_revenue,
        coalesce(i.iap_revenue, 0) + coalesce(a.ad_revenue, 0) as total_revenue,
        --transactions and impressions
        coalesce(i.transactions, 0) as iap_transactions,
        coalesce(a.impressions, 0) as ad_impressions,
        coalesce(a.clicks, 0) as ad_clicks,
        --per-transaction metrics
        i.avg_transaction_value,
        --ARPDAU (average revenue per daily active user)
        case
            when coalesce(d.dau, 0) > 0
            then (coalesce(i.iap_revenue, 0) + coalesce(a.ad_revenue, 0)) / d.dau
            else 0
        end as arpdau,
        --ARPPU (average revenue per paying user)
        case
            when coalesce(i.paying_users, 0) > 0
            then coalesce(i.iap_revenue, 0) / i.paying_users
            else 0
        end as arppu,
        --conversion rate (paying users /DAU)
        case
            when coalesce(d.dau, 0) > 0
            then coalesce(i.paying_users, 0)::float / d.dau * 100
            else 0
        end as daily_conversion_rate,
        --ad metrics
        case 
            when coalesce(a.impressions, 0) > 0
            then coalesce(a.clicks, 0)::float / a.impressions * 100
            else 0
        end as ad_ctr
    from daily_dau d 
    full outer join daily_iap i on d.revenue_date = i.revenue_date
    full outer join daily_ads a on d.revenue_date = a.revenue_date
)

select * from final
order by revenue_date
    );
  
  
[0m15:00:33.310828 [debug] [Thread-1 (]: SQL status: OK in 0.014 seconds
[0m15:00:33.311522 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_daily_revenue"
[0m15:00:33.311702 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_daily_revenue: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_daily_revenue"} */

    SELECT index_name
    FROM duckdb_indexes()
    WHERE schema_name = 'main'
      AND table_name = 'rpt_daily_revenue'
  
[0m15:00:33.312177 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m15:00:33.312771 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_daily_revenue"
[0m15:00:33.312931 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_daily_revenue: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_daily_revenue"} */

    SELECT COUNT(*) as remaining_indexes
    FROM duckdb_indexes()
    WHERE schema_name = 'main'
      AND table_name = 'rpt_daily_revenue'
  
[0m15:00:33.313335 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m15:00:33.314884 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_daily_revenue"
[0m15:00:33.315056 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_daily_revenue: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_daily_revenue"} */
alter table "quest_kingdom"."main"."rpt_daily_revenue" rename to "rpt_daily_revenue__dbt_backup"
[0m15:00:33.315359 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m15:00:33.317414 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_daily_revenue"
[0m15:00:33.317578 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_daily_revenue: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_daily_revenue"} */
alter table "quest_kingdom"."main"."rpt_daily_revenue__dbt_tmp" rename to "rpt_daily_revenue"
[0m15:00:33.317856 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m15:00:33.318590 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_daily_revenue: COMMIT
[0m15:00:33.318740 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_daily_revenue"
[0m15:00:33.318875 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_daily_revenue: COMMIT
[0m15:00:33.319440 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m15:00:33.350741 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_daily_revenue"
[0m15:00:33.350995 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_daily_revenue: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_daily_revenue"} */

      drop table if exists "quest_kingdom"."main"."rpt_daily_revenue__dbt_backup" cascade
    
[0m15:00:33.351548 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m15:00:33.352196 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_daily_revenue: Close
[0m15:00:33.352462 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '400a3177-e60a-422d-b149-e0611f8d8925', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109606660>]}
[0m15:00:33.352745 [info ] [Thread-1 (]: 2 of 4 OK created sql table model main.rpt_daily_revenue ....................... [[32mOK[0m in 0.06s]
[0m15:00:33.352994 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.rpt_daily_revenue
[0m15:00:33.353167 [debug] [Thread-1 (]: Began running node model.quest_kingdom.rpt_player_ltv
[0m15:00:33.353380 [info ] [Thread-1 (]: 3 of 4 START sql table model main.rpt_player_ltv ............................... [RUN]
[0m15:00:33.353560 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.quest_kingdom.rpt_daily_revenue, now model.quest_kingdom.rpt_player_ltv)
[0m15:00:33.353713 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.rpt_player_ltv
[0m15:00:33.355355 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.rpt_player_ltv"
[0m15:00:33.355762 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.rpt_player_ltv
[0m15:00:33.357414 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.rpt_player_ltv"
[0m15:00:33.357784 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_player_ltv"
[0m15:00:33.357945 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_player_ltv: BEGIN
[0m15:00:33.358084 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:00:33.358387 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m15:00:33.358532 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_player_ltv"
[0m15:00:33.358737 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_player_ltv: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_player_ltv"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_player_ltv__dbt_tmp"
  
    as (
      

with players as (
    select * from "quest_kingdom"."main"."dim_players"
),

daily_activity as (
    select * from "quest_kingdom"."main"."fct_daily_active_users"
),

--count active days per player
player_active_days as (
    select 
        player_id,
        count(distinct activity_date) as total_active_days
),

--calculate LTV for each player
player_ltv as (
    select 
        p.player_id,
        p.installed_at,
        p.cohort_week,
        p.cohort_month,
        p.attribution_channel,
        p.country,
        p.device_type,
        p.player_segment,
        p.experiment_variant,
        p.tutorial_completed,

        --revenue
        p.total_iap_revenue,
        p.total_ad_revenue,
        p.total_revenue,

        --purchase behavior
        p.total_purchases,
        p.first_purchase_at,
        p.days_to_first_purchase,
        p.avg_purchase_value,

        --engagement
        p.total_sessions,
        coalesce(pad.total_active_days, 0) as total_active_days,
        p.total_play_time_minutes,
        p.max_level_reached,

        --derived metrics
        case
            when coalesce(pad.total_active_days, 0) > 0
            then p.total_revenue / pad.total_active_days
            else 0
        end as revenue_per_active_day,
        case
            when p.total_sessions > 0
            then p.total_revenue / p.total_sessions
            else 0
        end as revenue_per_session,
        case
            when p.total_purchases > 0
            then p.total_iap_revenue / p.total_purchases
            else 0
        end as avg_iap_value,

        --days since install
        p.days_since_install,

        --flags
        p.is_payer,
        case 
            when p.total_revenue > 0 and p.days_to_first_purchase <= 1 then 'Fast Converted'
            when p.total_revenue > 0 and p.days_to_first_purchase <= 7 then 'Week 1 Converted'
            when p.total_revenue > 0 and p.days_to_first_purchase <= 30 then 'Month 1 Converted'
            when p.total_revenue > 0 then 'Late Converted'
            else 'Non-Payer'
        end as converter_type
    from players p
    left join player_active_days pad on p.player_id = pad.player_id
)

select * from player_ltv
    );
  
  
[0m15:00:33.362640 [debug] [Thread-1 (]: DuckDB adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_player_ltv"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_player_ltv__dbt_tmp"
  
    as (
      

with players as (
    select * from "quest_kingdom"."main"."dim_players"
),

daily_activity as (
    select * from "quest_kingdom"."main"."fct_daily_active_users"
),

--count active days per player
player_active_days as (
    select 
        player_id,
        count(distinct activity_date) as total_active_days
),

--calculate LTV for each player
player_ltv as (
    select 
        p.player_id,
        p.installed_at,
        p.cohort_week,
        p.cohort_month,
        p.attribution_channel,
        p.country,
        p.device_type,
        p.player_segment,
        p.experiment_variant,
        p.tutorial_completed,

        --revenue
        p.total_iap_revenue,
        p.total_ad_revenue,
        p.total_revenue,

        --purchase behavior
        p.total_purchases,
        p.first_purchase_at,
        p.days_to_first_purchase,
        p.avg_purchase_value,

        --engagement
        p.total_sessions,
        coalesce(pad.total_active_days, 0) as total_active_days,
        p.total_play_time_minutes,
        p.max_level_reached,

        --derived metrics
        case
            when coalesce(pad.total_active_days, 0) > 0
            then p.total_revenue / pad.total_active_days
            else 0
        end as revenue_per_active_day,
        case
            when p.total_sessions > 0
            then p.total_revenue / p.total_sessions
            else 0
        end as revenue_per_session,
        case
            when p.total_purchases > 0
            then p.total_iap_revenue / p.total_purchases
            else 0
        end as avg_iap_value,

        --days since install
        p.days_since_install,

        --flags
        p.is_payer,
        case 
            when p.total_revenue > 0 and p.days_to_first_purchase <= 1 then 'Fast Converted'
            when p.total_revenue > 0 and p.days_to_first_purchase <= 7 then 'Week 1 Converted'
            when p.total_revenue > 0 and p.days_to_first_purchase <= 30 then 'Month 1 Converted'
            when p.total_revenue > 0 then 'Late Converted'
            else 'Non-Payer'
        end as converter_type
    from players p
    left join player_active_days pad on p.player_id = pad.player_id
)

select * from player_ltv
    );
  
  
[0m15:00:33.362870 [debug] [Thread-1 (]: DuckDB adapter: Rolling back transaction.
[0m15:00:33.363069 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_player_ltv: ROLLBACK
[0m15:00:33.367303 [debug] [Thread-1 (]: Failed to rollback 'model.quest_kingdom.rpt_player_ltv'
[0m15:00:33.367466 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_player_ltv: Close
[0m15:00:33.368595 [debug] [Thread-1 (]: Runtime Error in model rpt_player_ltv (models/marts/monetization/rpt_player_ltv.sql)
  Binder Error: Referenced column "player_id" was not found because the FROM clause is missing
  
  LINE 24:         player_id,
                   ^
[0m15:00:33.368806 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '400a3177-e60a-422d-b149-e0611f8d8925', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109a924b0>]}
[0m15:00:33.369082 [error] [Thread-1 (]: 3 of 4 ERROR creating sql table model main.rpt_player_ltv ...................... [[31mERROR[0m in 0.02s]
[0m15:00:33.369331 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.rpt_player_ltv
[0m15:00:33.369505 [debug] [Thread-1 (]: Began running node model.quest_kingdom.rpt_sku_performance
[0m15:00:33.369716 [debug] [Thread-4 (]: Marking all children of 'model.quest_kingdom.rpt_player_ltv' to be skipped because of status 'error'.  Reason: Runtime Error in model rpt_player_ltv (models/marts/monetization/rpt_player_ltv.sql)
  Binder Error: Referenced column "player_id" was not found because the FROM clause is missing
  
  LINE 24:         player_id,
                   ^.
[0m15:00:33.369923 [info ] [Thread-1 (]: 4 of 4 START sql table model main.rpt_sku_performance .......................... [RUN]
[0m15:00:33.370439 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.quest_kingdom.rpt_player_ltv, now model.quest_kingdom.rpt_sku_performance)
[0m15:00:33.370595 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.rpt_sku_performance
[0m15:00:33.372512 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.rpt_sku_performance"
[0m15:00:33.372952 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.rpt_sku_performance
[0m15:00:33.374925 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.rpt_sku_performance"
[0m15:00:33.377522 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_sku_performance"
[0m15:00:33.377762 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_sku_performance: BEGIN
[0m15:00:33.378014 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:00:33.378433 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m15:00:33.378608 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_sku_performance"
[0m15:00:33.378831 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_sku_performance: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_sku_performance"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_sku_performance__dbt_tmp"
  
    as (
      

with transactions as (
    select * from "quest_kingdom"."main"."stg_iap_transactions"
),

players as (
    select * from "quest_kingdom"."main"."dim_players"
),

--aggregate by SKU
sku_metrics as (
    select 
        t.sku,
        --purchase counts
        count(*) as total_purchases,
        count(distinct t.player_id) as unique_buyers,

        --revenue
        sum(t.price_usd) as total_revenue,
        avg(t.price_usd) as avg_price,

        --virtual currency
        sum(t.gems_purchased) as total_gems_sold,
        avg(t.gems_purchased) as avg_gems_per_purchase,

        --platform split
        sum(case when t.platform = 'ios' then t.price_usd else 0 end) as ios_revenue,
        sum(case when t.platform = 'android' then t.price_usd else 0 end) as android_revenue,

        --timing
        min(t.purchased_at) as first_purchase_date,
        max(t.purchased_at) as last_purchase_date
    from transactions t 
    group by t.sku
),

--get buyer segments for each SKU
sku_by_segment as (
    select 
        t.sku,
        p.player_segment,
        count(*) as purchases,
        sum(t.price_usd) as revenue
    from transactions t 
    inner join players p on t.player_id = p.player_id 
    group by t.sku, p.player_segment 
),

--pivot segments
sku_segment_pivot as (
    select 
        sku,
        sum(case when player_segment = 'whale' then purchases else 0 end) as whale_purchases,
        sum(case when player_segment = 'dolphin' then purchases else 0 end) as dolphin_purchases,
        sum(case when player_segment = 'minnow' then purchases else 0 end) as minnow_purchases,
        sum(case when player_segment = 'whale' then revenue else 0 end) as whale_revenue,
        sum(case when player_segment = 'dolphin' then revenue else 0 end) as dolphin_revenue,
        sum(case when player_segment = 'minnow' then revenue else 0 end) as minnow_revenue
    from sku_by_segment
    group by sku

),

--combine
final as (
    select 
        sm.*,
        sp.whale_purchases,
        sp.dolphin_purchases,
        sp.minnow_purchases,
        sp.whale_revenue,
        sp.dolphin_revenue,
        sp.minnow_revenue,

        --derived metrics
        sm.total_revenue / sm.total_purchases as revenue_per_purchase,
        sm.total_purchases::float / sm.unique_buyers as purchases_per_buyer,

        --revenue share
        round(sm.total_revenue / sum(sm.total_revenue) over() * 100, 2) as revenue_share_pct
    from sku_metrics sm 
    left join sku_segment_pivot sp on sm.sku = sp.sku 
)

select * from final 
order by total_revenue desc
    );
  
  
[0m15:00:33.396957 [debug] [Thread-1 (]: SQL status: OK in 0.018 seconds
[0m15:00:33.397669 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_sku_performance"
[0m15:00:33.397849 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_sku_performance: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_sku_performance"} */

    SELECT index_name
    FROM duckdb_indexes()
    WHERE schema_name = 'main'
      AND table_name = 'rpt_sku_performance'
  
[0m15:00:33.398335 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m15:00:33.398928 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_sku_performance"
[0m15:00:33.399089 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_sku_performance: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_sku_performance"} */

    SELECT COUNT(*) as remaining_indexes
    FROM duckdb_indexes()
    WHERE schema_name = 'main'
      AND table_name = 'rpt_sku_performance'
  
[0m15:00:33.399512 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m15:00:33.401228 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_sku_performance"
[0m15:00:33.401404 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_sku_performance: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_sku_performance"} */
alter table "quest_kingdom"."main"."rpt_sku_performance" rename to "rpt_sku_performance__dbt_backup"
[0m15:00:33.401734 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m15:00:33.403041 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_sku_performance"
[0m15:00:33.403202 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_sku_performance: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_sku_performance"} */
alter table "quest_kingdom"."main"."rpt_sku_performance__dbt_tmp" rename to "rpt_sku_performance"
[0m15:00:33.403473 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m15:00:33.404226 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_sku_performance: COMMIT
[0m15:00:33.404379 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_sku_performance"
[0m15:00:33.404519 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_sku_performance: COMMIT
[0m15:00:33.404953 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m15:00:33.406132 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_sku_performance"
[0m15:00:33.406294 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_sku_performance: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_sku_performance"} */

      drop table if exists "quest_kingdom"."main"."rpt_sku_performance__dbt_backup" cascade
    
[0m15:00:33.406772 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m15:00:33.407462 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_sku_performance: Close
[0m15:00:33.407733 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '400a3177-e60a-422d-b149-e0611f8d8925', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109a93740>]}
[0m15:00:33.408024 [info ] [Thread-1 (]: 4 of 4 OK created sql table model main.rpt_sku_performance ..................... [[32mOK[0m in 0.04s]
[0m15:00:33.408300 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.rpt_sku_performance
[0m15:00:33.408909 [debug] [MainThread]: Using duckdb connection "master"
[0m15:00:33.409061 [debug] [MainThread]: On master: BEGIN
[0m15:00:33.409188 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m15:00:33.409488 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m15:00:33.409620 [debug] [MainThread]: On master: COMMIT
[0m15:00:33.409745 [debug] [MainThread]: Using duckdb connection "master"
[0m15:00:33.409868 [debug] [MainThread]: On master: COMMIT
[0m15:00:33.410064 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m15:00:33.410194 [debug] [MainThread]: On master: Close
[0m15:00:33.410361 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:00:33.410481 [debug] [MainThread]: Connection 'model.quest_kingdom.rpt_sku_performance' was properly closed.
[0m15:00:33.410657 [info ] [MainThread]: 
[0m15:00:33.410807 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 0.26 seconds (0.26s).
[0m15:00:33.411274 [debug] [MainThread]: Command end result
[0m15:00:33.432300 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/manifest.json
[0m15:00:33.433485 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/semantic_manifest.json
[0m15:00:33.436385 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/run_results.json
[0m15:00:33.436553 [info ] [MainThread]: 
[0m15:00:33.436721 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m15:00:33.436865 [info ] [MainThread]: 
[0m15:00:33.437034 [error] [MainThread]: [31mFailure in model rpt_player_ltv (models/marts/monetization/rpt_player_ltv.sql)[0m
[0m15:00:33.437196 [error] [MainThread]:   Runtime Error in model rpt_player_ltv (models/marts/monetization/rpt_player_ltv.sql)
  Binder Error: Referenced column "player_id" was not found because the FROM clause is missing
  
  LINE 24:         player_id,
                   ^
[0m15:00:33.437323 [info ] [MainThread]: 
[0m15:00:33.437468 [info ] [MainThread]:   compiled code at target/compiled/quest_kingdom/models/marts/monetization/rpt_player_ltv.sql
[0m15:00:33.437598 [info ] [MainThread]: 
[0m15:00:33.437738 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=4
[0m15:00:33.439105 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.72345364, "process_in_blocks": "0", "process_kernel_time": 0.197459, "process_mem_max_rss": "191774720", "process_out_blocks": "0", "process_user_time": 1.176462}
[0m15:00:33.439314 [debug] [MainThread]: Command `dbt run` failed at 15:00:33.439275 after 0.72 seconds
[0m15:00:33.439485 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1082982f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109a00830>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109a01bb0>]}
[0m15:00:33.439644 [debug] [MainThread]: Flushing usage events
[0m15:00:33.552533 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m15:01:06.944619 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106b3dd90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1073b5a90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1073b5850>]}


============================== 15:01:06.947813 | c7b29830-09e5-4650-80b0-175e5cb0fac7 ==============================
[0m15:01:06.947813 [info ] [MainThread]: Running with dbt=1.11.4
[0m15:01:06.948129 [debug] [MainThread]: running dbt with arguments {'warn_error': 'None', 'send_anonymous_usage_stats': 'True', 'use_colors': 'True', 'log_cache_events': 'False', 'profiles_dir': '/Users/hazeldonaldson/.dbt', 'indirect_selection': 'eager', 'debug': 'False', 'no_print': 'None', 'static_parser': 'True', 'partial_parse': 'True', 'log_path': '/Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/logs', 'invocation_command': 'dbt run --select path:models/marts/monetization', 'version_check': 'True', 'log_format': 'default', 'cache_selected_only': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'target_path': 'None', 'empty': 'False', 'write_json': 'True', 'introspect': 'True', 'fail_fast': 'False', 'quiet': 'False', 'printer_width': '80', 'use_experimental_parser': 'False'}
[0m15:01:07.113834 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c7b29830-09e5-4650-80b0-175e5cb0fac7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1061616a0>]}
[0m15:01:07.143244 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c7b29830-09e5-4650-80b0-175e5cb0fac7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106ad8440>]}
[0m15:01:07.144672 [info ] [MainThread]: Registered adapter: duckdb=1.10.0
[0m15:01:07.197645 [debug] [MainThread]: checksum: 092b177ba87eb6bb3c55954c38aa57900eebac336561eb9ee32218428aa81d43, vars: {}, profile: , target: , version: 1.11.4
[0m15:01:07.267976 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m15:01:07.268247 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m15:01:07.268384 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m15:01:07.293069 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c7b29830-09e5-4650-80b0-175e5cb0fac7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107423380>]}
[0m15:01:07.336454 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/manifest.json
[0m15:01:07.337787 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/semantic_manifest.json
[0m15:01:07.351146 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c7b29830-09e5-4650-80b0-175e5cb0fac7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107c71eb0>]}
[0m15:01:07.351434 [info ] [MainThread]: Found 15 models, 40 data tests, 5 sources, 472 macros
[0m15:01:07.351614 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c7b29830-09e5-4650-80b0-175e5cb0fac7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107c4fe30>]}
[0m15:01:07.353406 [info ] [MainThread]: 
[0m15:01:07.353593 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:01:07.353738 [info ] [MainThread]: 
[0m15:01:07.353991 [debug] [MainThread]: Acquiring new duckdb connection 'master'
[0m15:01:07.356147 [debug] [ThreadPool]: Acquiring new duckdb connection 'list_quest_kingdom'
[0m15:01:07.384842 [debug] [ThreadPool]: Using duckdb connection "list_quest_kingdom"
[0m15:01:07.385080 [debug] [ThreadPool]: On list_quest_kingdom: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "list_quest_kingdom"} */

    
    select schema_name
    from system.information_schema.schemata
    
    where lower(catalog_name) = '"quest_kingdom"'
    
  
  
[0m15:01:07.385356 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:01:07.403309 [debug] [ThreadPool]: SQL status: OK in 0.018 seconds
[0m15:01:07.404328 [debug] [ThreadPool]: On list_quest_kingdom: Close
[0m15:01:07.404672 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_quest_kingdom, now create_quest_kingdom_main)
[0m15:01:07.404904 [debug] [ThreadPool]: Creating schema "database: "quest_kingdom"
schema: "main"
"
[0m15:01:07.408326 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m15:01:07.408500 [debug] [ThreadPool]: On create_quest_kingdom_main: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "create_quest_kingdom_main"} */

    
        select type from duckdb_databases()
        where lower(database_name)='quest_kingdom'
        and type='sqlite'
    
  
[0m15:01:07.408632 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:01:07.409576 [debug] [ThreadPool]: SQL status: OK in 0.001 seconds
[0m15:01:07.410216 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m15:01:07.410349 [debug] [ThreadPool]: On create_quest_kingdom_main: BEGIN
[0m15:01:07.410559 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m15:01:07.410686 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m15:01:07.410809 [debug] [ThreadPool]: On create_quest_kingdom_main: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "create_quest_kingdom_main"} */

    
    
        create schema if not exists "quest_kingdom"."main"
    
[0m15:01:07.411275 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m15:01:07.411652 [debug] [ThreadPool]: On create_quest_kingdom_main: COMMIT
[0m15:01:07.411784 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m15:01:07.411897 [debug] [ThreadPool]: On create_quest_kingdom_main: COMMIT
[0m15:01:07.412086 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m15:01:07.412213 [debug] [ThreadPool]: On create_quest_kingdom_main: Close
[0m15:01:07.413067 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_quest_kingdom_main, now list_quest_kingdom_main)
[0m15:01:07.415671 [debug] [ThreadPool]: Using duckdb connection "list_quest_kingdom_main"
[0m15:01:07.415829 [debug] [ThreadPool]: On list_quest_kingdom_main: BEGIN
[0m15:01:07.415954 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:01:07.416208 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m15:01:07.416343 [debug] [ThreadPool]: Using duckdb connection "list_quest_kingdom_main"
[0m15:01:07.416477 [debug] [ThreadPool]: On list_quest_kingdom_main: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "list_quest_kingdom_main"} */
select
      'quest_kingdom' as database,
      table_name as name,
      table_schema as schema,
      CASE table_type
        WHEN 'BASE TABLE' THEN 'table'
        WHEN 'VIEW' THEN 'view'
        WHEN 'LOCAL TEMPORARY' THEN 'table'
        END as type
    from system.information_schema.tables
    where lower(table_schema) = 'main'
    and lower(table_catalog) = 'quest_kingdom'
  
[0m15:01:07.427297 [debug] [ThreadPool]: SQL status: OK in 0.011 seconds
[0m15:01:07.428202 [debug] [ThreadPool]: On list_quest_kingdom_main: ROLLBACK
[0m15:01:07.429198 [debug] [ThreadPool]: Failed to rollback 'list_quest_kingdom_main'
[0m15:01:07.429356 [debug] [ThreadPool]: On list_quest_kingdom_main: Close
[0m15:01:07.430568 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c7b29830-09e5-4650-80b0-175e5cb0fac7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10748f230>]}
[0m15:01:07.430821 [debug] [MainThread]: Using duckdb connection "master"
[0m15:01:07.430965 [debug] [MainThread]: On master: BEGIN
[0m15:01:07.431086 [debug] [MainThread]: Opening a new connection, currently in state init
[0m15:01:07.431342 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m15:01:07.431472 [debug] [MainThread]: On master: COMMIT
[0m15:01:07.431597 [debug] [MainThread]: Using duckdb connection "master"
[0m15:01:07.431718 [debug] [MainThread]: On master: COMMIT
[0m15:01:07.431932 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m15:01:07.432072 [debug] [MainThread]: On master: Close
[0m15:01:07.433391 [debug] [Thread-1 (]: Began running node model.quest_kingdom.rpt_conversion_funnel
[0m15:01:07.433629 [info ] [Thread-1 (]: 1 of 4 START sql table model main.rpt_conversion_funnel ........................ [RUN]
[0m15:01:07.433827 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_quest_kingdom_main, now model.quest_kingdom.rpt_conversion_funnel)
[0m15:01:07.433984 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.rpt_conversion_funnel
[0m15:01:07.438225 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.rpt_conversion_funnel"
[0m15:01:07.438621 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.rpt_conversion_funnel
[0m15:01:07.454233 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.rpt_conversion_funnel"
[0m15:01:07.454720 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_conversion_funnel"
[0m15:01:07.454888 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_conversion_funnel: BEGIN
[0m15:01:07.455036 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:01:07.455384 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m15:01:07.455529 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_conversion_funnel"
[0m15:01:07.455699 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_conversion_funnel: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_conversion_funnel"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_conversion_funnel__dbt_tmp"
  
    as (
      

with players as (
    select * from "quest_kingdom"."main"."dim_players"
),

--define funnel stages
player_funnel as (
    select 
        player_id,
        installed_at,
        cohort_week,
        attribution_channel,
        player_segment,
        experiment_variant,

        --funnel stages (boolean)
        true as stage_1_installed,
        tutorial_completed as stage_2_tutorial_completed,
        is_activated as stage_3_had_session,
        max_level_reached >= 5 as stage_4_reached_level_5,
        is_payer as stage_5_first_purchase,

        --time to each stage
        0 as days_to_install,
        case when tutorial_completed then 0 else null end as days_to_tutorial,
        case when is_activated then 0 else null end as days_to_first_session,
        case when max_level_reached >= 5 then days_to_first_purchase else null end as days_to_level_5,
        days_to_first_purchase
    from players 
)

select * from player_funnel
    );
  
  
[0m15:01:07.463236 [debug] [Thread-1 (]: SQL status: OK in 0.007 seconds
[0m15:01:07.465909 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_conversion_funnel"
[0m15:01:07.466105 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_conversion_funnel: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_conversion_funnel"} */

    SELECT index_name
    FROM duckdb_indexes()
    WHERE schema_name = 'main'
      AND table_name = 'rpt_conversion_funnel'
  
[0m15:01:07.466567 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m15:01:07.467161 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_conversion_funnel"
[0m15:01:07.467321 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_conversion_funnel: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_conversion_funnel"} */

    SELECT COUNT(*) as remaining_indexes
    FROM duckdb_indexes()
    WHERE schema_name = 'main'
      AND table_name = 'rpt_conversion_funnel'
  
[0m15:01:07.468184 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m15:01:07.471159 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_conversion_funnel"
[0m15:01:07.471342 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_conversion_funnel: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_conversion_funnel"} */
alter table "quest_kingdom"."main"."rpt_conversion_funnel" rename to "rpt_conversion_funnel__dbt_backup"
[0m15:01:07.472120 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m15:01:07.473543 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_conversion_funnel"
[0m15:01:07.473725 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_conversion_funnel: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_conversion_funnel"} */
alter table "quest_kingdom"."main"."rpt_conversion_funnel__dbt_tmp" rename to "rpt_conversion_funnel"
[0m15:01:07.474024 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m15:01:07.480762 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_conversion_funnel: COMMIT
[0m15:01:07.480950 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_conversion_funnel"
[0m15:01:07.481098 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_conversion_funnel: COMMIT
[0m15:01:07.483473 [debug] [Thread-1 (]: SQL status: OK in 0.002 seconds
[0m15:01:07.486006 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_conversion_funnel"
[0m15:01:07.486184 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_conversion_funnel: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_conversion_funnel"} */

      drop table if exists "quest_kingdom"."main"."rpt_conversion_funnel__dbt_backup" cascade
    
[0m15:01:07.486843 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m15:01:07.487911 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_conversion_funnel: Close
[0m15:01:07.488821 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c7b29830-09e5-4650-80b0-175e5cb0fac7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111b922d0>]}
[0m15:01:07.489119 [info ] [Thread-1 (]: 1 of 4 OK created sql table model main.rpt_conversion_funnel ................... [[32mOK[0m in 0.05s]
[0m15:01:07.489380 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.rpt_conversion_funnel
[0m15:01:07.489566 [debug] [Thread-1 (]: Began running node model.quest_kingdom.rpt_daily_revenue
[0m15:01:07.489821 [info ] [Thread-1 (]: 2 of 4 START sql table model main.rpt_daily_revenue ............................ [RUN]
[0m15:01:07.490040 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.quest_kingdom.rpt_conversion_funnel, now model.quest_kingdom.rpt_daily_revenue)
[0m15:01:07.490200 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.rpt_daily_revenue
[0m15:01:07.492104 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.rpt_daily_revenue"
[0m15:01:07.492460 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.rpt_daily_revenue
[0m15:01:07.494056 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.rpt_daily_revenue"
[0m15:01:07.494362 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_daily_revenue"
[0m15:01:07.494517 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_daily_revenue: BEGIN
[0m15:01:07.494658 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:01:07.494973 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m15:01:07.495119 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_daily_revenue"
[0m15:01:07.495341 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_daily_revenue: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_daily_revenue"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_daily_revenue__dbt_tmp"
  
    as (
      

with daily_active_users as (
    select * from "quest_kingdom"."main"."fct_daily_active_users"
),

iap_transactions as (
    select * from "quest_kingdom"."main"."stg_iap_transactions"
),

ad_impressions as (
    select * from "quest_kingdom"."main"."stg_ad_impressions"
),

--daily IAP revenue
daily_iap as (
    select
        purchase_date as revenue_date,
        count(distinct player_id) as paying_users,
        count(*) as transactions,
        sum(price_usd) as iap_revenue,
        avg(price_usd) as avg_transaction_value
    from iap_transactions
    group by purchase_date
),

--daily ad revenue
daily_ads as (
    select 
        ad_date as revenue_date,
        count(distinct player_id) as users_with_ads,
        count(*) as impressions,
        sum(revenue_usd) as ad_revenue,
        sum(case when clicked then 1 else 0 end) as clicks
    from ad_impressions
    group by ad_date 
),

--daily active users
daily_dau as (
    select 
        activity_date as revenue_date,
        count(distinct player_id) as dau 
    from daily_active_users
    group by activity_date
),

--combine all metrics
final as (
    select
        coalesce(d.revenue_date, i.revenue_date, a.revenue_date) as revenue_date,
        --user counts
        coalesce(d.dau, 0) as dau,
        coalesce(i.paying_users, 0) as paying_users,
        coalesce(a.users_with_ads, 0) as users_with_ads,
        --revenue
        coalesce(i.iap_revenue, 0) as iap_revenue,
        coalesce(a.ad_revenue, 0) as ad_revenue,
        coalesce(i.iap_revenue, 0) + coalesce(a.ad_revenue, 0) as total_revenue,
        --transactions and impressions
        coalesce(i.transactions, 0) as iap_transactions,
        coalesce(a.impressions, 0) as ad_impressions,
        coalesce(a.clicks, 0) as ad_clicks,
        --per-transaction metrics
        i.avg_transaction_value,
        --ARPDAU (average revenue per daily active user)
        case
            when coalesce(d.dau, 0) > 0
            then (coalesce(i.iap_revenue, 0) + coalesce(a.ad_revenue, 0)) / d.dau
            else 0
        end as arpdau,
        --ARPPU (average revenue per paying user)
        case
            when coalesce(i.paying_users, 0) > 0
            then coalesce(i.iap_revenue, 0) / i.paying_users
            else 0
        end as arppu,
        --conversion rate (paying users /DAU)
        case
            when coalesce(d.dau, 0) > 0
            then coalesce(i.paying_users, 0)::float / d.dau * 100
            else 0
        end as daily_conversion_rate,
        --ad metrics
        case 
            when coalesce(a.impressions, 0) > 0
            then coalesce(a.clicks, 0)::float / a.impressions * 100
            else 0
        end as ad_ctr
    from daily_dau d 
    full outer join daily_iap i on d.revenue_date = i.revenue_date
    full outer join daily_ads a on d.revenue_date = a.revenue_date
)

select * from final
order by revenue_date
    );
  
  
[0m15:01:07.509403 [debug] [Thread-1 (]: SQL status: OK in 0.014 seconds
[0m15:01:07.510277 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_daily_revenue"
[0m15:01:07.510483 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_daily_revenue: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_daily_revenue"} */

    SELECT index_name
    FROM duckdb_indexes()
    WHERE schema_name = 'main'
      AND table_name = 'rpt_daily_revenue'
  
[0m15:01:07.511010 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m15:01:07.511592 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_daily_revenue"
[0m15:01:07.511753 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_daily_revenue: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_daily_revenue"} */

    SELECT COUNT(*) as remaining_indexes
    FROM duckdb_indexes()
    WHERE schema_name = 'main'
      AND table_name = 'rpt_daily_revenue'
  
[0m15:01:07.512194 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m15:01:07.513829 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_daily_revenue"
[0m15:01:07.514010 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_daily_revenue: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_daily_revenue"} */
alter table "quest_kingdom"."main"."rpt_daily_revenue" rename to "rpt_daily_revenue__dbt_backup"
[0m15:01:07.514331 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m15:01:07.516384 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_daily_revenue"
[0m15:01:07.516553 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_daily_revenue: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_daily_revenue"} */
alter table "quest_kingdom"."main"."rpt_daily_revenue__dbt_tmp" rename to "rpt_daily_revenue"
[0m15:01:07.516843 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m15:01:07.517574 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_daily_revenue: COMMIT
[0m15:01:07.517725 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_daily_revenue"
[0m15:01:07.517863 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_daily_revenue: COMMIT
[0m15:01:07.518386 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m15:01:07.553616 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_daily_revenue"
[0m15:01:07.553862 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_daily_revenue: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_daily_revenue"} */

      drop table if exists "quest_kingdom"."main"."rpt_daily_revenue__dbt_backup" cascade
    
[0m15:01:07.554428 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m15:01:07.555123 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_daily_revenue: Close
[0m15:01:07.555409 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c7b29830-09e5-4650-80b0-175e5cb0fac7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111bd81a0>]}
[0m15:01:07.555693 [info ] [Thread-1 (]: 2 of 4 OK created sql table model main.rpt_daily_revenue ....................... [[32mOK[0m in 0.07s]
[0m15:01:07.555943 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.rpt_daily_revenue
[0m15:01:07.556112 [debug] [Thread-1 (]: Began running node model.quest_kingdom.rpt_player_ltv
[0m15:01:07.556292 [info ] [Thread-1 (]: 3 of 4 START sql table model main.rpt_player_ltv ............................... [RUN]
[0m15:01:07.556685 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.quest_kingdom.rpt_daily_revenue, now model.quest_kingdom.rpt_player_ltv)
[0m15:01:07.556921 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.rpt_player_ltv
[0m15:01:07.558668 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.rpt_player_ltv"
[0m15:01:07.559062 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.rpt_player_ltv
[0m15:01:07.560807 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.rpt_player_ltv"
[0m15:01:07.561230 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_player_ltv"
[0m15:01:07.564505 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_player_ltv: BEGIN
[0m15:01:07.564674 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:01:07.565044 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m15:01:07.565195 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_player_ltv"
[0m15:01:07.565393 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_player_ltv: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_player_ltv"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_player_ltv__dbt_tmp"
  
    as (
      

with players as (
    select * from "quest_kingdom"."main"."dim_players"
),

daily_activity as (
    select * from "quest_kingdom"."main"."fct_daily_active_users"
),

--count active days per player
player_active_days as (
    select 
        player_id,
        count(distinct activity_date) as total_active_days
),

--calculate LTV for each player
player_ltv as (
    select 
        p.player_id,
        p.installed_at,
        p.cohort_week,
        p.cohort_month,
        p.attribution_channel,
        p.country,
        p.device_type,
        p.player_segment,
        p.experiment_variant,
        p.tutorial_completed,

        --revenue
        p.total_iap_revenue,
        p.total_ad_revenue,
        p.total_revenue,

        --purchase behavior
        p.total_purchases,
        p.first_purchase_at,
        p.days_to_first_purchase,
        p.avg_purchase_value,

        --engagement
        p.total_sessions,
        coalesce(pad.total_active_days, 0) as total_active_days,
        p.total_play_time_minutes,
        p.max_level_reached,

        --derived metrics
        case
            when coalesce(pad.total_active_days, 0) > 0
            then p.total_revenue / pad.total_active_days
            else 0
        end as revenue_per_active_day,
        case
            when p.total_sessions > 0
            then p.total_revenue / p.total_sessions
            else 0
        end as revenue_per_session,
        case
            when p.total_purchases > 0
            then p.total_iap_revenue / p.total_purchases
            else 0
        end as avg_iap_value,

        --days since install
        p.days_since_install,

        --flags
        p.is_payer,
        case 
            when p.total_revenue > 0 and p.days_to_first_purchase <= 1 then 'Fast Converted'
            when p.total_revenue > 0 and p.days_to_first_purchase <= 7 then 'Week 1 Converted'
            when p.total_revenue > 0 and p.days_to_first_purchase <= 30 then 'Month 1 Converted'
            when p.total_revenue > 0 then 'Late Converted'
            else 'Non-Payer'
        end as converter_type
    from players p
    left join player_active_days pad on p.player_id = pad.player_id
)

select * from player_ltv
    );
  
  
[0m15:01:07.569196 [debug] [Thread-1 (]: DuckDB adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_player_ltv"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_player_ltv__dbt_tmp"
  
    as (
      

with players as (
    select * from "quest_kingdom"."main"."dim_players"
),

daily_activity as (
    select * from "quest_kingdom"."main"."fct_daily_active_users"
),

--count active days per player
player_active_days as (
    select 
        player_id,
        count(distinct activity_date) as total_active_days
),

--calculate LTV for each player
player_ltv as (
    select 
        p.player_id,
        p.installed_at,
        p.cohort_week,
        p.cohort_month,
        p.attribution_channel,
        p.country,
        p.device_type,
        p.player_segment,
        p.experiment_variant,
        p.tutorial_completed,

        --revenue
        p.total_iap_revenue,
        p.total_ad_revenue,
        p.total_revenue,

        --purchase behavior
        p.total_purchases,
        p.first_purchase_at,
        p.days_to_first_purchase,
        p.avg_purchase_value,

        --engagement
        p.total_sessions,
        coalesce(pad.total_active_days, 0) as total_active_days,
        p.total_play_time_minutes,
        p.max_level_reached,

        --derived metrics
        case
            when coalesce(pad.total_active_days, 0) > 0
            then p.total_revenue / pad.total_active_days
            else 0
        end as revenue_per_active_day,
        case
            when p.total_sessions > 0
            then p.total_revenue / p.total_sessions
            else 0
        end as revenue_per_session,
        case
            when p.total_purchases > 0
            then p.total_iap_revenue / p.total_purchases
            else 0
        end as avg_iap_value,

        --days since install
        p.days_since_install,

        --flags
        p.is_payer,
        case 
            when p.total_revenue > 0 and p.days_to_first_purchase <= 1 then 'Fast Converted'
            when p.total_revenue > 0 and p.days_to_first_purchase <= 7 then 'Week 1 Converted'
            when p.total_revenue > 0 and p.days_to_first_purchase <= 30 then 'Month 1 Converted'
            when p.total_revenue > 0 then 'Late Converted'
            else 'Non-Payer'
        end as converter_type
    from players p
    left join player_active_days pad on p.player_id = pad.player_id
)

select * from player_ltv
    );
  
  
[0m15:01:07.569433 [debug] [Thread-1 (]: DuckDB adapter: Rolling back transaction.
[0m15:01:07.569640 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_player_ltv: ROLLBACK
[0m15:01:07.573873 [debug] [Thread-1 (]: Failed to rollback 'model.quest_kingdom.rpt_player_ltv'
[0m15:01:07.574086 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_player_ltv: Close
[0m15:01:07.575554 [debug] [Thread-1 (]: Runtime Error in model rpt_player_ltv (models/marts/monetization/rpt_player_ltv.sql)
  Binder Error: Referenced column "player_id" was not found because the FROM clause is missing
  
  LINE 24:         player_id,
                   ^
[0m15:01:07.575913 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c7b29830-09e5-4650-80b0-175e5cb0fac7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111bb3080>]}
[0m15:01:07.576340 [error] [Thread-1 (]: 3 of 4 ERROR creating sql table model main.rpt_player_ltv ...................... [[31mERROR[0m in 0.02s]
[0m15:01:07.576652 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.rpt_player_ltv
[0m15:01:07.576845 [debug] [Thread-1 (]: Began running node model.quest_kingdom.rpt_sku_performance
[0m15:01:07.577076 [debug] [Thread-4 (]: Marking all children of 'model.quest_kingdom.rpt_player_ltv' to be skipped because of status 'error'.  Reason: Runtime Error in model rpt_player_ltv (models/marts/monetization/rpt_player_ltv.sql)
  Binder Error: Referenced column "player_id" was not found because the FROM clause is missing
  
  LINE 24:         player_id,
                   ^.
[0m15:01:07.577293 [info ] [Thread-1 (]: 4 of 4 START sql table model main.rpt_sku_performance .......................... [RUN]
[0m15:01:07.577866 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.quest_kingdom.rpt_player_ltv, now model.quest_kingdom.rpt_sku_performance)
[0m15:01:07.578045 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.rpt_sku_performance
[0m15:01:07.579841 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.rpt_sku_performance"
[0m15:01:07.580259 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.rpt_sku_performance
[0m15:01:07.581890 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.rpt_sku_performance"
[0m15:01:07.582205 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_sku_performance"
[0m15:01:07.582362 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_sku_performance: BEGIN
[0m15:01:07.582509 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:01:07.582929 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m15:01:07.583080 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_sku_performance"
[0m15:01:07.583289 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_sku_performance: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_sku_performance"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_sku_performance__dbt_tmp"
  
    as (
      

with transactions as (
    select * from "quest_kingdom"."main"."stg_iap_transactions"
),

players as (
    select * from "quest_kingdom"."main"."dim_players"
),

--aggregate by SKU
sku_metrics as (
    select 
        t.sku,
        --purchase counts
        count(*) as total_purchases,
        count(distinct t.player_id) as unique_buyers,

        --revenue
        sum(t.price_usd) as total_revenue,
        avg(t.price_usd) as avg_price,

        --virtual currency
        sum(t.gems_purchased) as total_gems_sold,
        avg(t.gems_purchased) as avg_gems_per_purchase,

        --platform split
        sum(case when t.platform = 'ios' then t.price_usd else 0 end) as ios_revenue,
        sum(case when t.platform = 'android' then t.price_usd else 0 end) as android_revenue,

        --timing
        min(t.purchased_at) as first_purchase_date,
        max(t.purchased_at) as last_purchase_date
    from transactions t 
    group by t.sku
),

--get buyer segments for each SKU
sku_by_segment as (
    select 
        t.sku,
        p.player_segment,
        count(*) as purchases,
        sum(t.price_usd) as revenue
    from transactions t 
    inner join players p on t.player_id = p.player_id 
    group by t.sku, p.player_segment 
),

--pivot segments
sku_segment_pivot as (
    select 
        sku,
        sum(case when player_segment = 'whale' then purchases else 0 end) as whale_purchases,
        sum(case when player_segment = 'dolphin' then purchases else 0 end) as dolphin_purchases,
        sum(case when player_segment = 'minnow' then purchases else 0 end) as minnow_purchases,
        sum(case when player_segment = 'whale' then revenue else 0 end) as whale_revenue,
        sum(case when player_segment = 'dolphin' then revenue else 0 end) as dolphin_revenue,
        sum(case when player_segment = 'minnow' then revenue else 0 end) as minnow_revenue
    from sku_by_segment
    group by sku

),

--combine
final as (
    select 
        sm.*,
        sp.whale_purchases,
        sp.dolphin_purchases,
        sp.minnow_purchases,
        sp.whale_revenue,
        sp.dolphin_revenue,
        sp.minnow_revenue,

        --derived metrics
        sm.total_revenue / sm.total_purchases as revenue_per_purchase,
        sm.total_purchases::float / sm.unique_buyers as purchases_per_buyer,

        --revenue share
        round(sm.total_revenue / sum(sm.total_revenue) over() * 100, 2) as revenue_share_pct
    from sku_metrics sm 
    left join sku_segment_pivot sp on sm.sku = sp.sku 
)

select * from final 
order by total_revenue desc
    );
  
  
[0m15:01:07.597051 [debug] [Thread-1 (]: SQL status: OK in 0.013 seconds
[0m15:01:07.597797 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_sku_performance"
[0m15:01:07.597977 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_sku_performance: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_sku_performance"} */

    SELECT index_name
    FROM duckdb_indexes()
    WHERE schema_name = 'main'
      AND table_name = 'rpt_sku_performance'
  
[0m15:01:07.598515 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m15:01:07.599203 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_sku_performance"
[0m15:01:07.599380 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_sku_performance: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_sku_performance"} */

    SELECT COUNT(*) as remaining_indexes
    FROM duckdb_indexes()
    WHERE schema_name = 'main'
      AND table_name = 'rpt_sku_performance'
  
[0m15:01:07.599804 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m15:01:07.601436 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_sku_performance"
[0m15:01:07.601602 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_sku_performance: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_sku_performance"} */
alter table "quest_kingdom"."main"."rpt_sku_performance" rename to "rpt_sku_performance__dbt_backup"
[0m15:01:07.601957 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m15:01:07.603298 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_sku_performance"
[0m15:01:07.603464 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_sku_performance: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_sku_performance"} */
alter table "quest_kingdom"."main"."rpt_sku_performance__dbt_tmp" rename to "rpt_sku_performance"
[0m15:01:07.603747 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m15:01:07.604510 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_sku_performance: COMMIT
[0m15:01:07.604664 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_sku_performance"
[0m15:01:07.604804 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_sku_performance: COMMIT
[0m15:01:07.605222 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m15:01:07.606293 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_sku_performance"
[0m15:01:07.606473 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_sku_performance: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_sku_performance"} */

      drop table if exists "quest_kingdom"."main"."rpt_sku_performance__dbt_backup" cascade
    
[0m15:01:07.606898 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m15:01:07.607573 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_sku_performance: Close
[0m15:01:07.607851 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c7b29830-09e5-4650-80b0-175e5cb0fac7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107840830>]}
[0m15:01:07.608133 [info ] [Thread-1 (]: 4 of 4 OK created sql table model main.rpt_sku_performance ..................... [[32mOK[0m in 0.03s]
[0m15:01:07.608381 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.rpt_sku_performance
[0m15:01:07.609056 [debug] [MainThread]: Using duckdb connection "master"
[0m15:01:07.609196 [debug] [MainThread]: On master: BEGIN
[0m15:01:07.609313 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m15:01:07.609554 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m15:01:07.609678 [debug] [MainThread]: On master: COMMIT
[0m15:01:07.609796 [debug] [MainThread]: Using duckdb connection "master"
[0m15:01:07.609910 [debug] [MainThread]: On master: COMMIT
[0m15:01:07.610091 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m15:01:07.610211 [debug] [MainThread]: On master: Close
[0m15:01:07.610362 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:01:07.610476 [debug] [MainThread]: Connection 'model.quest_kingdom.rpt_sku_performance' was properly closed.
[0m15:01:07.610625 [info ] [MainThread]: 
[0m15:01:07.610762 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 0.26 seconds (0.26s).
[0m15:01:07.611196 [debug] [MainThread]: Command end result
[0m15:01:07.628022 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/manifest.json
[0m15:01:07.629114 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/semantic_manifest.json
[0m15:01:07.632170 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/run_results.json
[0m15:01:07.632340 [info ] [MainThread]: 
[0m15:01:07.632513 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m15:01:07.632659 [info ] [MainThread]: 
[0m15:01:07.632830 [error] [MainThread]: [31mFailure in model rpt_player_ltv (models/marts/monetization/rpt_player_ltv.sql)[0m
[0m15:01:07.632997 [error] [MainThread]:   Runtime Error in model rpt_player_ltv (models/marts/monetization/rpt_player_ltv.sql)
  Binder Error: Referenced column "player_id" was not found because the FROM clause is missing
  
  LINE 24:         player_id,
                   ^
[0m15:01:07.633121 [info ] [MainThread]: 
[0m15:01:07.633266 [info ] [MainThread]:   compiled code at target/compiled/quest_kingdom/models/marts/monetization/rpt_player_ltv.sql
[0m15:01:07.633395 [info ] [MainThread]: 
[0m15:01:07.633535 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=4
[0m15:01:07.634607 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.7250027, "process_in_blocks": "0", "process_kernel_time": 0.167697, "process_mem_max_rss": "187924480", "process_out_blocks": "0", "process_user_time": 1.175698}
[0m15:01:07.634811 [debug] [MainThread]: Command `dbt run` failed at 15:01:07.634775 after 0.73 seconds
[0m15:01:07.634979 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104885ac0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106b3dd90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107c4dc10>]}
[0m15:01:07.635136 [debug] [MainThread]: Flushing usage events
[0m15:01:07.724302 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m15:01:49.415888 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10866c890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1086b5c40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1086b58e0>]}


============================== 15:01:49.419290 | 77c836f2-f79b-46a6-a886-9fcc3ecf3b79 ==============================
[0m15:01:49.419290 [info ] [MainThread]: Running with dbt=1.11.4
[0m15:01:49.419622 [debug] [MainThread]: running dbt with arguments {'use_colors': 'True', 'version_check': 'True', 'static_parser': 'True', 'fail_fast': 'False', 'debug': 'False', 'cache_selected_only': 'False', 'target_path': 'None', 'send_anonymous_usage_stats': 'True', 'empty': 'False', 'introspect': 'True', 'printer_width': '80', 'warn_error': 'None', 'log_path': '/Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/logs', 'log_cache_events': 'False', 'partial_parse': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_format': 'default', 'use_experimental_parser': 'False', 'indirect_selection': 'eager', 'write_json': 'True', 'no_print': 'None', 'invocation_command': 'dbt run --select path:models/marts/monetization', 'profiles_dir': '/Users/hazeldonaldson/.dbt', 'quiet': 'False'}
[0m15:01:49.580843 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '77c836f2-f79b-46a6-a886-9fcc3ecf3b79', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108791d90>]}
[0m15:01:49.609357 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '77c836f2-f79b-46a6-a886-9fcc3ecf3b79', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108757ad0>]}
[0m15:01:49.611483 [info ] [MainThread]: Registered adapter: duckdb=1.10.0
[0m15:01:49.662197 [debug] [MainThread]: checksum: 092b177ba87eb6bb3c55954c38aa57900eebac336561eb9ee32218428aa81d43, vars: {}, profile: , target: , version: 1.11.4
[0m15:01:49.730905 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m15:01:49.731383 [debug] [MainThread]: Partial parsing: updated file: quest_kingdom://models/marts/monetization/rpt_player_ltv.sql
[0m15:01:49.919000 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '77c836f2-f79b-46a6-a886-9fcc3ecf3b79', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1092a80b0>]}
[0m15:01:50.002464 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/manifest.json
[0m15:01:50.003796 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/semantic_manifest.json
[0m15:01:50.016146 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '77c836f2-f79b-46a6-a886-9fcc3ecf3b79', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108f258b0>]}
[0m15:01:50.016417 [info ] [MainThread]: Found 15 models, 40 data tests, 5 sources, 472 macros
[0m15:01:50.016593 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '77c836f2-f79b-46a6-a886-9fcc3ecf3b79', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1093e8ef0>]}
[0m15:01:50.018332 [info ] [MainThread]: 
[0m15:01:50.018515 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:01:50.018653 [info ] [MainThread]: 
[0m15:01:50.018874 [debug] [MainThread]: Acquiring new duckdb connection 'master'
[0m15:01:50.021011 [debug] [ThreadPool]: Acquiring new duckdb connection 'list_quest_kingdom'
[0m15:01:50.047964 [debug] [ThreadPool]: Using duckdb connection "list_quest_kingdom"
[0m15:01:50.048222 [debug] [ThreadPool]: On list_quest_kingdom: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "list_quest_kingdom"} */

    
    select schema_name
    from system.information_schema.schemata
    
    where lower(catalog_name) = '"quest_kingdom"'
    
  
  
[0m15:01:50.048490 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:01:50.066371 [debug] [ThreadPool]: SQL status: OK in 0.018 seconds
[0m15:01:50.067357 [debug] [ThreadPool]: On list_quest_kingdom: Close
[0m15:01:50.067701 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_quest_kingdom, now create_quest_kingdom_main)
[0m15:01:50.067925 [debug] [ThreadPool]: Creating schema "database: "quest_kingdom"
schema: "main"
"
[0m15:01:50.071192 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m15:01:50.071359 [debug] [ThreadPool]: On create_quest_kingdom_main: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "create_quest_kingdom_main"} */

    
        select type from duckdb_databases()
        where lower(database_name)='quest_kingdom'
        and type='sqlite'
    
  
[0m15:01:50.071494 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:01:50.072229 [debug] [ThreadPool]: SQL status: OK in 0.001 seconds
[0m15:01:50.072837 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m15:01:50.072976 [debug] [ThreadPool]: On create_quest_kingdom_main: BEGIN
[0m15:01:50.073189 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m15:01:50.073342 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m15:01:50.073471 [debug] [ThreadPool]: On create_quest_kingdom_main: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "create_quest_kingdom_main"} */

    
    
        create schema if not exists "quest_kingdom"."main"
    
[0m15:01:50.073927 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m15:01:50.074325 [debug] [ThreadPool]: On create_quest_kingdom_main: COMMIT
[0m15:01:50.074466 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m15:01:50.074587 [debug] [ThreadPool]: On create_quest_kingdom_main: COMMIT
[0m15:01:50.074790 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m15:01:50.075077 [debug] [ThreadPool]: On create_quest_kingdom_main: Close
[0m15:01:50.076010 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_quest_kingdom_main, now list_quest_kingdom_main)
[0m15:01:50.078664 [debug] [ThreadPool]: Using duckdb connection "list_quest_kingdom_main"
[0m15:01:50.078821 [debug] [ThreadPool]: On list_quest_kingdom_main: BEGIN
[0m15:01:50.079000 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:01:50.079260 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m15:01:50.079390 [debug] [ThreadPool]: Using duckdb connection "list_quest_kingdom_main"
[0m15:01:50.079521 [debug] [ThreadPool]: On list_quest_kingdom_main: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "list_quest_kingdom_main"} */
select
      'quest_kingdom' as database,
      table_name as name,
      table_schema as schema,
      CASE table_type
        WHEN 'BASE TABLE' THEN 'table'
        WHEN 'VIEW' THEN 'view'
        WHEN 'LOCAL TEMPORARY' THEN 'table'
        END as type
    from system.information_schema.tables
    where lower(table_schema) = 'main'
    and lower(table_catalog) = 'quest_kingdom'
  
[0m15:01:50.090350 [debug] [ThreadPool]: SQL status: OK in 0.011 seconds
[0m15:01:50.091167 [debug] [ThreadPool]: On list_quest_kingdom_main: ROLLBACK
[0m15:01:50.092109 [debug] [ThreadPool]: Failed to rollback 'list_quest_kingdom_main'
[0m15:01:50.092272 [debug] [ThreadPool]: On list_quest_kingdom_main: Close
[0m15:01:50.093492 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '77c836f2-f79b-46a6-a886-9fcc3ecf3b79', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1093d9910>]}
[0m15:01:50.093721 [debug] [MainThread]: Using duckdb connection "master"
[0m15:01:50.093856 [debug] [MainThread]: On master: BEGIN
[0m15:01:50.093980 [debug] [MainThread]: Opening a new connection, currently in state init
[0m15:01:50.094219 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m15:01:50.094349 [debug] [MainThread]: On master: COMMIT
[0m15:01:50.094471 [debug] [MainThread]: Using duckdb connection "master"
[0m15:01:50.094589 [debug] [MainThread]: On master: COMMIT
[0m15:01:50.094780 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m15:01:50.094905 [debug] [MainThread]: On master: Close
[0m15:01:50.096094 [debug] [Thread-1 (]: Began running node model.quest_kingdom.rpt_conversion_funnel
[0m15:01:50.096336 [info ] [Thread-1 (]: 1 of 4 START sql table model main.rpt_conversion_funnel ........................ [RUN]
[0m15:01:50.096543 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_quest_kingdom_main, now model.quest_kingdom.rpt_conversion_funnel)
[0m15:01:50.096706 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.rpt_conversion_funnel
[0m15:01:50.100373 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.rpt_conversion_funnel"
[0m15:01:50.100752 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.rpt_conversion_funnel
[0m15:01:50.116251 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.rpt_conversion_funnel"
[0m15:01:50.116793 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_conversion_funnel"
[0m15:01:50.116967 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_conversion_funnel: BEGIN
[0m15:01:50.117117 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:01:50.117467 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m15:01:50.117610 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_conversion_funnel"
[0m15:01:50.117776 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_conversion_funnel: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_conversion_funnel"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_conversion_funnel__dbt_tmp"
  
    as (
      

with players as (
    select * from "quest_kingdom"."main"."dim_players"
),

--define funnel stages
player_funnel as (
    select 
        player_id,
        installed_at,
        cohort_week,
        attribution_channel,
        player_segment,
        experiment_variant,

        --funnel stages (boolean)
        true as stage_1_installed,
        tutorial_completed as stage_2_tutorial_completed,
        is_activated as stage_3_had_session,
        max_level_reached >= 5 as stage_4_reached_level_5,
        is_payer as stage_5_first_purchase,

        --time to each stage
        0 as days_to_install,
        case when tutorial_completed then 0 else null end as days_to_tutorial,
        case when is_activated then 0 else null end as days_to_first_session,
        case when max_level_reached >= 5 then days_to_first_purchase else null end as days_to_level_5,
        days_to_first_purchase
    from players 
)

select * from player_funnel
    );
  
  
[0m15:01:50.125365 [debug] [Thread-1 (]: SQL status: OK in 0.007 seconds
[0m15:01:50.128080 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_conversion_funnel"
[0m15:01:50.128281 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_conversion_funnel: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_conversion_funnel"} */

    SELECT index_name
    FROM duckdb_indexes()
    WHERE schema_name = 'main'
      AND table_name = 'rpt_conversion_funnel'
  
[0m15:01:50.128760 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m15:01:50.129435 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_conversion_funnel"
[0m15:01:50.129608 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_conversion_funnel: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_conversion_funnel"} */

    SELECT COUNT(*) as remaining_indexes
    FROM duckdb_indexes()
    WHERE schema_name = 'main'
      AND table_name = 'rpt_conversion_funnel'
  
[0m15:01:50.130476 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m15:01:50.133449 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_conversion_funnel"
[0m15:01:50.133628 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_conversion_funnel: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_conversion_funnel"} */
alter table "quest_kingdom"."main"."rpt_conversion_funnel" rename to "rpt_conversion_funnel__dbt_backup"
[0m15:01:50.134402 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m15:01:50.135728 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_conversion_funnel"
[0m15:01:50.135888 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_conversion_funnel: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_conversion_funnel"} */
alter table "quest_kingdom"."main"."rpt_conversion_funnel__dbt_tmp" rename to "rpt_conversion_funnel"
[0m15:01:50.136162 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m15:01:50.143132 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_conversion_funnel: COMMIT
[0m15:01:50.143335 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_conversion_funnel"
[0m15:01:50.143494 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_conversion_funnel: COMMIT
[0m15:01:50.145959 [debug] [Thread-1 (]: SQL status: OK in 0.002 seconds
[0m15:01:50.149303 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_conversion_funnel"
[0m15:01:50.149489 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_conversion_funnel: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_conversion_funnel"} */

      drop table if exists "quest_kingdom"."main"."rpt_conversion_funnel__dbt_backup" cascade
    
[0m15:01:50.150176 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m15:01:50.151259 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_conversion_funnel: Close
[0m15:01:50.152180 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '77c836f2-f79b-46a6-a886-9fcc3ecf3b79', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106d2f4d0>]}
[0m15:01:50.152479 [info ] [Thread-1 (]: 1 of 4 OK created sql table model main.rpt_conversion_funnel ................... [[32mOK[0m in 0.05s]
[0m15:01:50.152741 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.rpt_conversion_funnel
[0m15:01:50.152929 [debug] [Thread-1 (]: Began running node model.quest_kingdom.rpt_daily_revenue
[0m15:01:50.153163 [info ] [Thread-1 (]: 2 of 4 START sql table model main.rpt_daily_revenue ............................ [RUN]
[0m15:01:50.153356 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.quest_kingdom.rpt_conversion_funnel, now model.quest_kingdom.rpt_daily_revenue)
[0m15:01:50.153514 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.rpt_daily_revenue
[0m15:01:50.155220 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.rpt_daily_revenue"
[0m15:01:50.155734 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.rpt_daily_revenue
[0m15:01:50.157371 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.rpt_daily_revenue"
[0m15:01:50.157750 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_daily_revenue"
[0m15:01:50.157921 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_daily_revenue: BEGIN
[0m15:01:50.158069 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:01:50.158406 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m15:01:50.158565 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_daily_revenue"
[0m15:01:50.158886 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_daily_revenue: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_daily_revenue"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_daily_revenue__dbt_tmp"
  
    as (
      

with daily_active_users as (
    select * from "quest_kingdom"."main"."fct_daily_active_users"
),

iap_transactions as (
    select * from "quest_kingdom"."main"."stg_iap_transactions"
),

ad_impressions as (
    select * from "quest_kingdom"."main"."stg_ad_impressions"
),

--daily IAP revenue
daily_iap as (
    select
        purchase_date as revenue_date,
        count(distinct player_id) as paying_users,
        count(*) as transactions,
        sum(price_usd) as iap_revenue,
        avg(price_usd) as avg_transaction_value
    from iap_transactions
    group by purchase_date
),

--daily ad revenue
daily_ads as (
    select 
        ad_date as revenue_date,
        count(distinct player_id) as users_with_ads,
        count(*) as impressions,
        sum(revenue_usd) as ad_revenue,
        sum(case when clicked then 1 else 0 end) as clicks
    from ad_impressions
    group by ad_date 
),

--daily active users
daily_dau as (
    select 
        activity_date as revenue_date,
        count(distinct player_id) as dau 
    from daily_active_users
    group by activity_date
),

--combine all metrics
final as (
    select
        coalesce(d.revenue_date, i.revenue_date, a.revenue_date) as revenue_date,
        --user counts
        coalesce(d.dau, 0) as dau,
        coalesce(i.paying_users, 0) as paying_users,
        coalesce(a.users_with_ads, 0) as users_with_ads,
        --revenue
        coalesce(i.iap_revenue, 0) as iap_revenue,
        coalesce(a.ad_revenue, 0) as ad_revenue,
        coalesce(i.iap_revenue, 0) + coalesce(a.ad_revenue, 0) as total_revenue,
        --transactions and impressions
        coalesce(i.transactions, 0) as iap_transactions,
        coalesce(a.impressions, 0) as ad_impressions,
        coalesce(a.clicks, 0) as ad_clicks,
        --per-transaction metrics
        i.avg_transaction_value,
        --ARPDAU (average revenue per daily active user)
        case
            when coalesce(d.dau, 0) > 0
            then (coalesce(i.iap_revenue, 0) + coalesce(a.ad_revenue, 0)) / d.dau
            else 0
        end as arpdau,
        --ARPPU (average revenue per paying user)
        case
            when coalesce(i.paying_users, 0) > 0
            then coalesce(i.iap_revenue, 0) / i.paying_users
            else 0
        end as arppu,
        --conversion rate (paying users /DAU)
        case
            when coalesce(d.dau, 0) > 0
            then coalesce(i.paying_users, 0)::float / d.dau * 100
            else 0
        end as daily_conversion_rate,
        --ad metrics
        case 
            when coalesce(a.impressions, 0) > 0
            then coalesce(a.clicks, 0)::float / a.impressions * 100
            else 0
        end as ad_ctr
    from daily_dau d 
    full outer join daily_iap i on d.revenue_date = i.revenue_date
    full outer join daily_ads a on d.revenue_date = a.revenue_date
)

select * from final
order by revenue_date
    );
  
  
[0m15:01:50.173334 [debug] [Thread-1 (]: SQL status: OK in 0.014 seconds
[0m15:01:50.174115 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_daily_revenue"
[0m15:01:50.174296 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_daily_revenue: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_daily_revenue"} */

    SELECT index_name
    FROM duckdb_indexes()
    WHERE schema_name = 'main'
      AND table_name = 'rpt_daily_revenue'
  
[0m15:01:50.174790 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m15:01:50.175446 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_daily_revenue"
[0m15:01:50.175614 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_daily_revenue: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_daily_revenue"} */

    SELECT COUNT(*) as remaining_indexes
    FROM duckdb_indexes()
    WHERE schema_name = 'main'
      AND table_name = 'rpt_daily_revenue'
  
[0m15:01:50.176022 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m15:01:50.177504 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_daily_revenue"
[0m15:01:50.177734 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_daily_revenue: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_daily_revenue"} */
alter table "quest_kingdom"."main"."rpt_daily_revenue" rename to "rpt_daily_revenue__dbt_backup"
[0m15:01:50.178043 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m15:01:50.179322 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_daily_revenue"
[0m15:01:50.179479 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_daily_revenue: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_daily_revenue"} */
alter table "quest_kingdom"."main"."rpt_daily_revenue__dbt_tmp" rename to "rpt_daily_revenue"
[0m15:01:50.179750 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m15:01:50.180472 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_daily_revenue: COMMIT
[0m15:01:50.180620 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_daily_revenue"
[0m15:01:50.180754 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_daily_revenue: COMMIT
[0m15:01:50.181248 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m15:01:50.182373 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_daily_revenue"
[0m15:01:50.182542 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_daily_revenue: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_daily_revenue"} */

      drop table if exists "quest_kingdom"."main"."rpt_daily_revenue__dbt_backup" cascade
    
[0m15:01:50.182926 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m15:01:50.183519 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_daily_revenue: Close
[0m15:01:50.183784 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '77c836f2-f79b-46a6-a886-9fcc3ecf3b79', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1095b6e40>]}
[0m15:01:50.184063 [info ] [Thread-1 (]: 2 of 4 OK created sql table model main.rpt_daily_revenue ....................... [[32mOK[0m in 0.03s]
[0m15:01:50.184310 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.rpt_daily_revenue
[0m15:01:50.184492 [debug] [Thread-1 (]: Began running node model.quest_kingdom.rpt_player_ltv
[0m15:01:50.184719 [info ] [Thread-1 (]: 3 of 4 START sql table model main.rpt_player_ltv ............................... [RUN]
[0m15:01:50.184903 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.quest_kingdom.rpt_daily_revenue, now model.quest_kingdom.rpt_player_ltv)
[0m15:01:50.185062 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.rpt_player_ltv
[0m15:01:50.186692 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.rpt_player_ltv"
[0m15:01:50.187042 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.rpt_player_ltv
[0m15:01:50.188582 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.rpt_player_ltv"
[0m15:01:50.188879 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_player_ltv"
[0m15:01:50.189032 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_player_ltv: BEGIN
[0m15:01:50.189168 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:01:50.189446 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m15:01:50.189590 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_player_ltv"
[0m15:01:50.189789 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_player_ltv: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_player_ltv"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_player_ltv__dbt_tmp"
  
    as (
      

with players as (

    select * from "quest_kingdom"."main"."dim_players"

),

daily_activity as (

    select * from "quest_kingdom"."main"."fct_daily_active_users"

),

-- Count active days per player
player_active_days as (

    select
        player_id,
        count(distinct activity_date) as total_active_days

    from daily_activity
    group by player_id

),

-- Calculate LTV for each player
player_ltv as (

    select
        p.player_id,
        p.installed_at,
        p.cohort_week,
        p.cohort_month,
        p.attribution_channel,
        p.country,
        p.device_type,
        p.player_segment,
        p.experiment_variant,
        p.tutorial_completed,
        
        -- Revenue
        p.total_iap_revenue,
        p.total_ad_revenue,
        p.total_revenue,
        
        -- Purchase behavior
        p.total_purchases,
        p.first_purchase_at,
        p.days_to_first_purchase,
        p.avg_purchase_value,
        
        -- Engagement
        p.total_sessions,
        coalesce(pad.total_active_days, 0) as total_active_days,
        p.total_play_time_minutes,
        p.max_level_reached,
        
        -- Derived metrics
        case 
            when coalesce(pad.total_active_days, 0) > 0 
            then p.total_revenue / pad.total_active_days
            else 0
        end as revenue_per_active_day,
        
        case 
            when p.total_sessions > 0 
            then p.total_revenue / p.total_sessions
            else 0
        end as revenue_per_session,
        
        case 
            when p.total_purchases > 0 
            then p.total_iap_revenue / p.total_purchases
            else 0
        end as avg_iap_value,
        
        -- Days since install
        p.days_since_install,
        
        -- Flags
        p.is_payer,
        case 
            when p.total_revenue > 0 and p.days_to_first_purchase <= 1 then 'Fast Converter'
            when p.total_revenue > 0 and p.days_to_first_purchase <= 7 then 'Week 1 Converter'
            when p.total_revenue > 0 and p.days_to_first_purchase <= 30 then 'Month 1 Converter'
            when p.total_revenue > 0 then 'Late Converter'
            else 'Non-Payer'
        end as converter_type

    from players p
    left join player_active_days pad on p.player_id = pad.player_id

)

select * from player_ltv
    );
  
  
[0m15:01:50.208838 [debug] [Thread-1 (]: SQL status: OK in 0.019 seconds
[0m15:01:50.210558 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_player_ltv"
[0m15:01:50.210736 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_player_ltv: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_player_ltv"} */
alter table "quest_kingdom"."main"."rpt_player_ltv__dbt_tmp" rename to "rpt_player_ltv"
[0m15:01:50.211107 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m15:01:50.211842 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_player_ltv: COMMIT
[0m15:01:50.211994 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_player_ltv"
[0m15:01:50.212132 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_player_ltv: COMMIT
[0m15:01:50.216454 [debug] [Thread-1 (]: SQL status: OK in 0.004 seconds
[0m15:01:50.217619 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_player_ltv"
[0m15:01:50.217782 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_player_ltv: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_player_ltv"} */

      drop table if exists "quest_kingdom"."main"."rpt_player_ltv__dbt_backup" cascade
    
[0m15:01:50.218069 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m15:01:50.218702 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_player_ltv: Close
[0m15:01:50.218951 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '77c836f2-f79b-46a6-a886-9fcc3ecf3b79', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1096e4ce0>]}
[0m15:01:50.219224 [info ] [Thread-1 (]: 3 of 4 OK created sql table model main.rpt_player_ltv .......................... [[32mOK[0m in 0.03s]
[0m15:01:50.219469 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.rpt_player_ltv
[0m15:01:50.219644 [debug] [Thread-1 (]: Began running node model.quest_kingdom.rpt_sku_performance
[0m15:01:50.219866 [info ] [Thread-1 (]: 4 of 4 START sql table model main.rpt_sku_performance .......................... [RUN]
[0m15:01:50.220047 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.quest_kingdom.rpt_player_ltv, now model.quest_kingdom.rpt_sku_performance)
[0m15:01:50.220202 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.rpt_sku_performance
[0m15:01:50.222782 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.rpt_sku_performance"
[0m15:01:50.223195 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.rpt_sku_performance
[0m15:01:50.225406 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.rpt_sku_performance"
[0m15:01:50.226242 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_sku_performance"
[0m15:01:50.226461 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_sku_performance: BEGIN
[0m15:01:50.229943 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:01:50.230600 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m15:01:50.230816 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_sku_performance"
[0m15:01:50.231043 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_sku_performance: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_sku_performance"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_sku_performance__dbt_tmp"
  
    as (
      

with transactions as (
    select * from "quest_kingdom"."main"."stg_iap_transactions"
),

players as (
    select * from "quest_kingdom"."main"."dim_players"
),

--aggregate by SKU
sku_metrics as (
    select 
        t.sku,
        --purchase counts
        count(*) as total_purchases,
        count(distinct t.player_id) as unique_buyers,

        --revenue
        sum(t.price_usd) as total_revenue,
        avg(t.price_usd) as avg_price,

        --virtual currency
        sum(t.gems_purchased) as total_gems_sold,
        avg(t.gems_purchased) as avg_gems_per_purchase,

        --platform split
        sum(case when t.platform = 'ios' then t.price_usd else 0 end) as ios_revenue,
        sum(case when t.platform = 'android' then t.price_usd else 0 end) as android_revenue,

        --timing
        min(t.purchased_at) as first_purchase_date,
        max(t.purchased_at) as last_purchase_date
    from transactions t 
    group by t.sku
),

--get buyer segments for each SKU
sku_by_segment as (
    select 
        t.sku,
        p.player_segment,
        count(*) as purchases,
        sum(t.price_usd) as revenue
    from transactions t 
    inner join players p on t.player_id = p.player_id 
    group by t.sku, p.player_segment 
),

--pivot segments
sku_segment_pivot as (
    select 
        sku,
        sum(case when player_segment = 'whale' then purchases else 0 end) as whale_purchases,
        sum(case when player_segment = 'dolphin' then purchases else 0 end) as dolphin_purchases,
        sum(case when player_segment = 'minnow' then purchases else 0 end) as minnow_purchases,
        sum(case when player_segment = 'whale' then revenue else 0 end) as whale_revenue,
        sum(case when player_segment = 'dolphin' then revenue else 0 end) as dolphin_revenue,
        sum(case when player_segment = 'minnow' then revenue else 0 end) as minnow_revenue
    from sku_by_segment
    group by sku

),

--combine
final as (
    select 
        sm.*,
        sp.whale_purchases,
        sp.dolphin_purchases,
        sp.minnow_purchases,
        sp.whale_revenue,
        sp.dolphin_revenue,
        sp.minnow_revenue,

        --derived metrics
        sm.total_revenue / sm.total_purchases as revenue_per_purchase,
        sm.total_purchases::float / sm.unique_buyers as purchases_per_buyer,

        --revenue share
        round(sm.total_revenue / sum(sm.total_revenue) over() * 100, 2) as revenue_share_pct
    from sku_metrics sm 
    left join sku_segment_pivot sp on sm.sku = sp.sku 
)

select * from final 
order by total_revenue desc
    );
  
  
[0m15:01:50.241978 [debug] [Thread-1 (]: SQL status: OK in 0.011 seconds
[0m15:01:50.242651 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_sku_performance"
[0m15:01:50.242832 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_sku_performance: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_sku_performance"} */

    SELECT index_name
    FROM duckdb_indexes()
    WHERE schema_name = 'main'
      AND table_name = 'rpt_sku_performance'
  
[0m15:01:50.243304 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m15:01:50.243878 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_sku_performance"
[0m15:01:50.244036 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_sku_performance: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_sku_performance"} */

    SELECT COUNT(*) as remaining_indexes
    FROM duckdb_indexes()
    WHERE schema_name = 'main'
      AND table_name = 'rpt_sku_performance'
  
[0m15:01:50.244439 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m15:01:50.245989 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_sku_performance"
[0m15:01:50.246229 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_sku_performance: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_sku_performance"} */
alter table "quest_kingdom"."main"."rpt_sku_performance" rename to "rpt_sku_performance__dbt_backup"
[0m15:01:50.246542 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m15:01:50.247831 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_sku_performance"
[0m15:01:50.247989 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_sku_performance: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_sku_performance"} */
alter table "quest_kingdom"."main"."rpt_sku_performance__dbt_tmp" rename to "rpt_sku_performance"
[0m15:01:50.248294 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m15:01:50.249082 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_sku_performance: COMMIT
[0m15:01:50.249249 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_sku_performance"
[0m15:01:50.249393 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_sku_performance: COMMIT
[0m15:01:50.249840 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m15:01:50.250903 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_sku_performance"
[0m15:01:50.251061 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_sku_performance: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_sku_performance"} */

      drop table if exists "quest_kingdom"."main"."rpt_sku_performance__dbt_backup" cascade
    
[0m15:01:50.251450 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m15:01:50.252013 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_sku_performance: Close
[0m15:01:50.252259 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '77c836f2-f79b-46a6-a886-9fcc3ecf3b79', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1096f0bc0>]}
[0m15:01:50.252530 [info ] [Thread-1 (]: 4 of 4 OK created sql table model main.rpt_sku_performance ..................... [[32mOK[0m in 0.03s]
[0m15:01:50.252766 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.rpt_sku_performance
[0m15:01:50.253294 [debug] [MainThread]: Using duckdb connection "master"
[0m15:01:50.253436 [debug] [MainThread]: On master: BEGIN
[0m15:01:50.253551 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m15:01:50.253779 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m15:01:50.253905 [debug] [MainThread]: On master: COMMIT
[0m15:01:50.254025 [debug] [MainThread]: Using duckdb connection "master"
[0m15:01:50.254135 [debug] [MainThread]: On master: COMMIT
[0m15:01:50.254316 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m15:01:50.254438 [debug] [MainThread]: On master: Close
[0m15:01:50.254590 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:01:50.254700 [debug] [MainThread]: Connection 'model.quest_kingdom.rpt_sku_performance' was properly closed.
[0m15:01:50.254846 [info ] [MainThread]: 
[0m15:01:50.254981 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 0.24 seconds (0.24s).
[0m15:01:50.255403 [debug] [MainThread]: Command end result
[0m15:01:50.271179 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/manifest.json
[0m15:01:50.272184 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/semantic_manifest.json
[0m15:01:50.275126 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/run_results.json
[0m15:01:50.275303 [info ] [MainThread]: 
[0m15:01:50.275482 [info ] [MainThread]: [32mCompleted successfully[0m
[0m15:01:50.275620 [info ] [MainThread]: 
[0m15:01:50.275763 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=4
[0m15:01:50.277214 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 0.8987532, "process_in_blocks": "0", "process_kernel_time": 0.193799, "process_mem_max_rss": "201900032", "process_out_blocks": "0", "process_user_time": 1.370563}
[0m15:01:50.277448 [debug] [MainThread]: Command `dbt run` succeeded at 15:01:50.277406 after 0.90 seconds
[0m15:01:50.277617 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1086b5b20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108fff320>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1095b88c0>]}
[0m15:01:50.277782 [debug] [MainThread]: Flushing usage events
[0m15:01:50.379839 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m15:02:22.026587 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1050b3ef0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1057698b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105769640>]}


============================== 15:02:22.029690 | c03aa5e5-e319-4d53-8034-1157949e253e ==============================
[0m15:02:22.029690 [info ] [MainThread]: Running with dbt=1.11.4
[0m15:02:22.030015 [debug] [MainThread]: running dbt with arguments {'fail_fast': 'False', 'write_json': 'True', 'log_format': 'default', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'static_parser': 'True', 'empty': 'None', 'partial_parse': 'True', 'no_print': 'None', 'cache_selected_only': 'False', 'target_path': 'None', 'log_path': '/Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/logs', 'introspect': 'True', 'log_cache_events': 'False', 'indirect_selection': 'eager', 'send_anonymous_usage_stats': 'True', 'profiles_dir': '/Users/hazeldonaldson/.dbt', 'printer_width': '80', 'debug': 'False', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'quiet': 'False', 'invocation_command': 'dbt test --select path:models/marts/monetization'}
[0m15:02:22.199596 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c03aa5e5-e319-4d53-8034-1157949e253e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105906c90>]}
[0m15:02:22.227781 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c03aa5e5-e319-4d53-8034-1157949e253e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1055738f0>]}
[0m15:02:22.229053 [info ] [MainThread]: Registered adapter: duckdb=1.10.0
[0m15:02:22.280284 [debug] [MainThread]: checksum: 092b177ba87eb6bb3c55954c38aa57900eebac336561eb9ee32218428aa81d43, vars: {}, profile: , target: , version: 1.11.4
[0m15:02:22.350933 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m15:02:22.351196 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m15:02:22.351333 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m15:02:22.373529 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c03aa5e5-e319-4d53-8034-1157949e253e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105a2db20>]}
[0m15:02:22.417106 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/manifest.json
[0m15:02:22.418434 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/semantic_manifest.json
[0m15:02:22.436238 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c03aa5e5-e319-4d53-8034-1157949e253e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105796f90>]}
[0m15:02:22.436532 [info ] [MainThread]: Found 15 models, 40 data tests, 5 sources, 472 macros
[0m15:02:22.436709 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c03aa5e5-e319-4d53-8034-1157949e253e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105b44e60>]}
[0m15:02:22.438612 [info ] [MainThread]: 
[0m15:02:22.438795 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:02:22.438936 [info ] [MainThread]: 
[0m15:02:22.439182 [debug] [MainThread]: Acquiring new duckdb connection 'master'
[0m15:02:22.441759 [debug] [ThreadPool]: Acquiring new duckdb connection 'list_quest_kingdom_main'
[0m15:02:22.469290 [debug] [ThreadPool]: Using duckdb connection "list_quest_kingdom_main"
[0m15:02:22.469527 [debug] [ThreadPool]: On list_quest_kingdom_main: BEGIN
[0m15:02:22.469747 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:02:22.483297 [debug] [ThreadPool]: SQL status: OK in 0.014 seconds
[0m15:02:22.483545 [debug] [ThreadPool]: Using duckdb connection "list_quest_kingdom_main"
[0m15:02:22.483711 [debug] [ThreadPool]: On list_quest_kingdom_main: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "list_quest_kingdom_main"} */
select
      'quest_kingdom' as database,
      table_name as name,
      table_schema as schema,
      CASE table_type
        WHEN 'BASE TABLE' THEN 'table'
        WHEN 'VIEW' THEN 'view'
        WHEN 'LOCAL TEMPORARY' THEN 'table'
        END as type
    from system.information_schema.tables
    where lower(table_schema) = 'main'
    and lower(table_catalog) = 'quest_kingdom'
  
[0m15:02:22.500500 [debug] [ThreadPool]: SQL status: OK in 0.017 seconds
[0m15:02:22.501675 [debug] [ThreadPool]: On list_quest_kingdom_main: ROLLBACK
[0m15:02:22.502624 [debug] [ThreadPool]: Failed to rollback 'list_quest_kingdom_main'
[0m15:02:22.502794 [debug] [ThreadPool]: On list_quest_kingdom_main: Close
[0m15:02:22.504402 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c03aa5e5-e319-4d53-8034-1157949e253e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105c2ade0>]}
[0m15:02:22.504629 [debug] [MainThread]: Using duckdb connection "master"
[0m15:02:22.504762 [debug] [MainThread]: On master: BEGIN
[0m15:02:22.504886 [debug] [MainThread]: Opening a new connection, currently in state init
[0m15:02:22.505170 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m15:02:22.505306 [debug] [MainThread]: On master: COMMIT
[0m15:02:22.505434 [debug] [MainThread]: Using duckdb connection "master"
[0m15:02:22.505557 [debug] [MainThread]: On master: COMMIT
[0m15:02:22.505777 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m15:02:22.505904 [debug] [MainThread]: On master: Close
[0m15:02:22.507393 [debug] [Thread-1 (]: Began running node test.quest_kingdom.not_null_rpt_conversion_funnel_player_id.6458d30c2b
[0m15:02:22.507604 [info ] [Thread-1 (]: 1 of 8 START test not_null_rpt_conversion_funnel_player_id ..................... [RUN]
[0m15:02:22.507825 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_quest_kingdom_main, now test.quest_kingdom.not_null_rpt_conversion_funnel_player_id.6458d30c2b)
[0m15:02:22.507989 [debug] [Thread-1 (]: Began compiling node test.quest_kingdom.not_null_rpt_conversion_funnel_player_id.6458d30c2b
[0m15:02:22.515699 [debug] [Thread-1 (]: Writing injected SQL for node "test.quest_kingdom.not_null_rpt_conversion_funnel_player_id.6458d30c2b"
[0m15:02:22.516318 [debug] [Thread-1 (]: Began executing node test.quest_kingdom.not_null_rpt_conversion_funnel_player_id.6458d30c2b
[0m15:02:22.524833 [debug] [Thread-1 (]: Writing runtime sql for node "test.quest_kingdom.not_null_rpt_conversion_funnel_player_id.6458d30c2b"
[0m15:02:22.525404 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.not_null_rpt_conversion_funnel_player_id.6458d30c2b"
[0m15:02:22.525578 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_rpt_conversion_funnel_player_id.6458d30c2b: BEGIN
[0m15:02:22.525727 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:02:22.526084 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m15:02:22.526236 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.not_null_rpt_conversion_funnel_player_id.6458d30c2b"
[0m15:02:22.526393 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_rpt_conversion_funnel_player_id.6458d30c2b: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "test.quest_kingdom.not_null_rpt_conversion_funnel_player_id.6458d30c2b"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select player_id
from "quest_kingdom"."main"."rpt_conversion_funnel"
where player_id is null



  
  
      
    ) dbt_internal_test
[0m15:02:22.527679 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m15:02:22.529731 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_rpt_conversion_funnel_player_id.6458d30c2b: ROLLBACK
[0m15:02:22.530203 [debug] [Thread-1 (]: Failed to rollback 'test.quest_kingdom.not_null_rpt_conversion_funnel_player_id.6458d30c2b'
[0m15:02:22.530365 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_rpt_conversion_funnel_player_id.6458d30c2b: Close
[0m15:02:22.530637 [info ] [Thread-1 (]: 1 of 8 PASS not_null_rpt_conversion_funnel_player_id ........................... [[32mPASS[0m in 0.02s]
[0m15:02:22.530891 [debug] [Thread-1 (]: Finished running node test.quest_kingdom.not_null_rpt_conversion_funnel_player_id.6458d30c2b
[0m15:02:22.531070 [debug] [Thread-1 (]: Began running node test.quest_kingdom.not_null_rpt_daily_revenue_revenue_date.a766781718
[0m15:02:22.531280 [info ] [Thread-1 (]: 2 of 8 START test not_null_rpt_daily_revenue_revenue_date ...................... [RUN]
[0m15:02:22.531490 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.quest_kingdom.not_null_rpt_conversion_funnel_player_id.6458d30c2b, now test.quest_kingdom.not_null_rpt_daily_revenue_revenue_date.a766781718)
[0m15:02:22.531649 [debug] [Thread-1 (]: Began compiling node test.quest_kingdom.not_null_rpt_daily_revenue_revenue_date.a766781718
[0m15:02:22.533590 [debug] [Thread-1 (]: Writing injected SQL for node "test.quest_kingdom.not_null_rpt_daily_revenue_revenue_date.a766781718"
[0m15:02:22.533956 [debug] [Thread-1 (]: Began executing node test.quest_kingdom.not_null_rpt_daily_revenue_revenue_date.a766781718
[0m15:02:22.535062 [debug] [Thread-1 (]: Writing runtime sql for node "test.quest_kingdom.not_null_rpt_daily_revenue_revenue_date.a766781718"
[0m15:02:22.535374 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.not_null_rpt_daily_revenue_revenue_date.a766781718"
[0m15:02:22.535529 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_rpt_daily_revenue_revenue_date.a766781718: BEGIN
[0m15:02:22.535666 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:02:22.535966 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m15:02:22.536115 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.not_null_rpt_daily_revenue_revenue_date.a766781718"
[0m15:02:22.536265 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_rpt_daily_revenue_revenue_date.a766781718: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "test.quest_kingdom.not_null_rpt_daily_revenue_revenue_date.a766781718"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select revenue_date
from "quest_kingdom"."main"."rpt_daily_revenue"
where revenue_date is null



  
  
      
    ) dbt_internal_test
[0m15:02:22.536741 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m15:02:22.537450 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_rpt_daily_revenue_revenue_date.a766781718: ROLLBACK
[0m15:02:22.537929 [debug] [Thread-1 (]: Failed to rollback 'test.quest_kingdom.not_null_rpt_daily_revenue_revenue_date.a766781718'
[0m15:02:22.538127 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_rpt_daily_revenue_revenue_date.a766781718: Close
[0m15:02:22.538406 [info ] [Thread-1 (]: 2 of 8 PASS not_null_rpt_daily_revenue_revenue_date ............................ [[32mPASS[0m in 0.01s]
[0m15:02:22.538657 [debug] [Thread-1 (]: Finished running node test.quest_kingdom.not_null_rpt_daily_revenue_revenue_date.a766781718
[0m15:02:22.538830 [debug] [Thread-1 (]: Began running node test.quest_kingdom.not_null_rpt_player_ltv_player_id.c84b384877
[0m15:02:22.539018 [info ] [Thread-1 (]: 3 of 8 START test not_null_rpt_player_ltv_player_id ............................ [RUN]
[0m15:02:22.539218 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.quest_kingdom.not_null_rpt_daily_revenue_revenue_date.a766781718, now test.quest_kingdom.not_null_rpt_player_ltv_player_id.c84b384877)
[0m15:02:22.539378 [debug] [Thread-1 (]: Began compiling node test.quest_kingdom.not_null_rpt_player_ltv_player_id.c84b384877
[0m15:02:22.541650 [debug] [Thread-1 (]: Writing injected SQL for node "test.quest_kingdom.not_null_rpt_player_ltv_player_id.c84b384877"
[0m15:02:22.542141 [debug] [Thread-1 (]: Began executing node test.quest_kingdom.not_null_rpt_player_ltv_player_id.c84b384877
[0m15:02:22.543849 [debug] [Thread-1 (]: Writing runtime sql for node "test.quest_kingdom.not_null_rpt_player_ltv_player_id.c84b384877"
[0m15:02:22.544282 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.not_null_rpt_player_ltv_player_id.c84b384877"
[0m15:02:22.544538 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_rpt_player_ltv_player_id.c84b384877: BEGIN
[0m15:02:22.544719 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:02:22.545101 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m15:02:22.545261 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.not_null_rpt_player_ltv_player_id.c84b384877"
[0m15:02:22.545422 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_rpt_player_ltv_player_id.c84b384877: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "test.quest_kingdom.not_null_rpt_player_ltv_player_id.c84b384877"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select player_id
from "quest_kingdom"."main"."rpt_player_ltv"
where player_id is null



  
  
      
    ) dbt_internal_test
[0m15:02:22.545963 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m15:02:22.546693 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_rpt_player_ltv_player_id.c84b384877: ROLLBACK
[0m15:02:22.547135 [debug] [Thread-1 (]: Failed to rollback 'test.quest_kingdom.not_null_rpt_player_ltv_player_id.c84b384877'
[0m15:02:22.547283 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_rpt_player_ltv_player_id.c84b384877: Close
[0m15:02:22.547529 [info ] [Thread-1 (]: 3 of 8 PASS not_null_rpt_player_ltv_player_id .................................. [[32mPASS[0m in 0.01s]
[0m15:02:22.547761 [debug] [Thread-1 (]: Finished running node test.quest_kingdom.not_null_rpt_player_ltv_player_id.c84b384877
[0m15:02:22.547930 [debug] [Thread-1 (]: Began running node test.quest_kingdom.not_null_rpt_sku_performance_sku.c63ef89596
[0m15:02:22.548110 [info ] [Thread-1 (]: 4 of 8 START test not_null_rpt_sku_performance_sku ............................. [RUN]
[0m15:02:22.548288 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.quest_kingdom.not_null_rpt_player_ltv_player_id.c84b384877, now test.quest_kingdom.not_null_rpt_sku_performance_sku.c63ef89596)
[0m15:02:22.548441 [debug] [Thread-1 (]: Began compiling node test.quest_kingdom.not_null_rpt_sku_performance_sku.c63ef89596
[0m15:02:22.550368 [debug] [Thread-1 (]: Writing injected SQL for node "test.quest_kingdom.not_null_rpt_sku_performance_sku.c63ef89596"
[0m15:02:22.550721 [debug] [Thread-1 (]: Began executing node test.quest_kingdom.not_null_rpt_sku_performance_sku.c63ef89596
[0m15:02:22.552620 [debug] [Thread-1 (]: Writing runtime sql for node "test.quest_kingdom.not_null_rpt_sku_performance_sku.c63ef89596"
[0m15:02:22.552930 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.not_null_rpt_sku_performance_sku.c63ef89596"
[0m15:02:22.553077 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_rpt_sku_performance_sku.c63ef89596: BEGIN
[0m15:02:22.553208 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:02:22.553501 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m15:02:22.553642 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.not_null_rpt_sku_performance_sku.c63ef89596"
[0m15:02:22.553789 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_rpt_sku_performance_sku.c63ef89596: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "test.quest_kingdom.not_null_rpt_sku_performance_sku.c63ef89596"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select sku
from "quest_kingdom"."main"."rpt_sku_performance"
where sku is null



  
  
      
    ) dbt_internal_test
[0m15:02:22.554352 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m15:02:22.555090 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_rpt_sku_performance_sku.c63ef89596: ROLLBACK
[0m15:02:22.555542 [debug] [Thread-1 (]: Failed to rollback 'test.quest_kingdom.not_null_rpt_sku_performance_sku.c63ef89596'
[0m15:02:22.555696 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_rpt_sku_performance_sku.c63ef89596: Close
[0m15:02:22.555952 [info ] [Thread-1 (]: 4 of 8 PASS not_null_rpt_sku_performance_sku ................................... [[32mPASS[0m in 0.01s]
[0m15:02:22.556185 [debug] [Thread-1 (]: Finished running node test.quest_kingdom.not_null_rpt_sku_performance_sku.c63ef89596
[0m15:02:22.556353 [debug] [Thread-1 (]: Began running node test.quest_kingdom.unique_rpt_conversion_funnel_player_id.1ae46d00bb
[0m15:02:22.556523 [info ] [Thread-1 (]: 5 of 8 START test unique_rpt_conversion_funnel_player_id ....................... [RUN]
[0m15:02:22.556725 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.quest_kingdom.not_null_rpt_sku_performance_sku.c63ef89596, now test.quest_kingdom.unique_rpt_conversion_funnel_player_id.1ae46d00bb)
[0m15:02:22.556934 [debug] [Thread-1 (]: Began compiling node test.quest_kingdom.unique_rpt_conversion_funnel_player_id.1ae46d00bb
[0m15:02:22.601481 [debug] [Thread-1 (]: Writing injected SQL for node "test.quest_kingdom.unique_rpt_conversion_funnel_player_id.1ae46d00bb"
[0m15:02:22.601968 [debug] [Thread-1 (]: Began executing node test.quest_kingdom.unique_rpt_conversion_funnel_player_id.1ae46d00bb
[0m15:02:22.603125 [debug] [Thread-1 (]: Writing runtime sql for node "test.quest_kingdom.unique_rpt_conversion_funnel_player_id.1ae46d00bb"
[0m15:02:22.603454 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.unique_rpt_conversion_funnel_player_id.1ae46d00bb"
[0m15:02:22.603615 [debug] [Thread-1 (]: On test.quest_kingdom.unique_rpt_conversion_funnel_player_id.1ae46d00bb: BEGIN
[0m15:02:22.603758 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:02:22.604110 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m15:02:22.604253 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.unique_rpt_conversion_funnel_player_id.1ae46d00bb"
[0m15:02:22.604405 [debug] [Thread-1 (]: On test.quest_kingdom.unique_rpt_conversion_funnel_player_id.1ae46d00bb: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "test.quest_kingdom.unique_rpt_conversion_funnel_player_id.1ae46d00bb"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    player_id as unique_field,
    count(*) as n_records

from "quest_kingdom"."main"."rpt_conversion_funnel"
where player_id is not null
group by player_id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m15:02:22.609606 [debug] [Thread-1 (]: SQL status: OK in 0.005 seconds
[0m15:02:22.610611 [debug] [Thread-1 (]: On test.quest_kingdom.unique_rpt_conversion_funnel_player_id.1ae46d00bb: ROLLBACK
[0m15:02:22.611092 [debug] [Thread-1 (]: Failed to rollback 'test.quest_kingdom.unique_rpt_conversion_funnel_player_id.1ae46d00bb'
[0m15:02:22.611257 [debug] [Thread-1 (]: On test.quest_kingdom.unique_rpt_conversion_funnel_player_id.1ae46d00bb: Close
[0m15:02:22.611539 [info ] [Thread-1 (]: 5 of 8 PASS unique_rpt_conversion_funnel_player_id ............................. [[32mPASS[0m in 0.05s]
[0m15:02:22.611793 [debug] [Thread-1 (]: Finished running node test.quest_kingdom.unique_rpt_conversion_funnel_player_id.1ae46d00bb
[0m15:02:22.611973 [debug] [Thread-1 (]: Began running node test.quest_kingdom.unique_rpt_daily_revenue_revenue_date.b08d1ce632
[0m15:02:22.612157 [info ] [Thread-1 (]: 6 of 8 START test unique_rpt_daily_revenue_revenue_date ........................ [RUN]
[0m15:02:22.612339 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.quest_kingdom.unique_rpt_conversion_funnel_player_id.1ae46d00bb, now test.quest_kingdom.unique_rpt_daily_revenue_revenue_date.b08d1ce632)
[0m15:02:22.612495 [debug] [Thread-1 (]: Began compiling node test.quest_kingdom.unique_rpt_daily_revenue_revenue_date.b08d1ce632
[0m15:02:22.614780 [debug] [Thread-1 (]: Writing injected SQL for node "test.quest_kingdom.unique_rpt_daily_revenue_revenue_date.b08d1ce632"
[0m15:02:22.615219 [debug] [Thread-1 (]: Began executing node test.quest_kingdom.unique_rpt_daily_revenue_revenue_date.b08d1ce632
[0m15:02:22.616353 [debug] [Thread-1 (]: Writing runtime sql for node "test.quest_kingdom.unique_rpt_daily_revenue_revenue_date.b08d1ce632"
[0m15:02:22.616695 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.unique_rpt_daily_revenue_revenue_date.b08d1ce632"
[0m15:02:22.616860 [debug] [Thread-1 (]: On test.quest_kingdom.unique_rpt_daily_revenue_revenue_date.b08d1ce632: BEGIN
[0m15:02:22.617009 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:02:22.617353 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m15:02:22.617508 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.unique_rpt_daily_revenue_revenue_date.b08d1ce632"
[0m15:02:22.617669 [debug] [Thread-1 (]: On test.quest_kingdom.unique_rpt_daily_revenue_revenue_date.b08d1ce632: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "test.quest_kingdom.unique_rpt_daily_revenue_revenue_date.b08d1ce632"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    revenue_date as unique_field,
    count(*) as n_records

from "quest_kingdom"."main"."rpt_daily_revenue"
where revenue_date is not null
group by revenue_date
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m15:02:22.619037 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m15:02:22.619996 [debug] [Thread-1 (]: On test.quest_kingdom.unique_rpt_daily_revenue_revenue_date.b08d1ce632: ROLLBACK
[0m15:02:22.620687 [debug] [Thread-1 (]: Failed to rollback 'test.quest_kingdom.unique_rpt_daily_revenue_revenue_date.b08d1ce632'
[0m15:02:22.620920 [debug] [Thread-1 (]: On test.quest_kingdom.unique_rpt_daily_revenue_revenue_date.b08d1ce632: Close
[0m15:02:22.621249 [info ] [Thread-1 (]: 6 of 8 PASS unique_rpt_daily_revenue_revenue_date .............................. [[32mPASS[0m in 0.01s]
[0m15:02:22.621513 [debug] [Thread-1 (]: Finished running node test.quest_kingdom.unique_rpt_daily_revenue_revenue_date.b08d1ce632
[0m15:02:22.621693 [debug] [Thread-1 (]: Began running node test.quest_kingdom.unique_rpt_player_ltv_player_id.6372e2b28d
[0m15:02:22.621892 [info ] [Thread-1 (]: 7 of 8 START test unique_rpt_player_ltv_player_id .............................. [RUN]
[0m15:02:22.622118 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.quest_kingdom.unique_rpt_daily_revenue_revenue_date.b08d1ce632, now test.quest_kingdom.unique_rpt_player_ltv_player_id.6372e2b28d)
[0m15:02:22.622289 [debug] [Thread-1 (]: Began compiling node test.quest_kingdom.unique_rpt_player_ltv_player_id.6372e2b28d
[0m15:02:22.624493 [debug] [Thread-1 (]: Writing injected SQL for node "test.quest_kingdom.unique_rpt_player_ltv_player_id.6372e2b28d"
[0m15:02:22.624937 [debug] [Thread-1 (]: Began executing node test.quest_kingdom.unique_rpt_player_ltv_player_id.6372e2b28d
[0m15:02:22.626105 [debug] [Thread-1 (]: Writing runtime sql for node "test.quest_kingdom.unique_rpt_player_ltv_player_id.6372e2b28d"
[0m15:02:22.626438 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.unique_rpt_player_ltv_player_id.6372e2b28d"
[0m15:02:22.626600 [debug] [Thread-1 (]: On test.quest_kingdom.unique_rpt_player_ltv_player_id.6372e2b28d: BEGIN
[0m15:02:22.626742 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:02:22.627092 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m15:02:22.627336 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.unique_rpt_player_ltv_player_id.6372e2b28d"
[0m15:02:22.627506 [debug] [Thread-1 (]: On test.quest_kingdom.unique_rpt_player_ltv_player_id.6372e2b28d: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "test.quest_kingdom.unique_rpt_player_ltv_player_id.6372e2b28d"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    player_id as unique_field,
    count(*) as n_records

from "quest_kingdom"."main"."rpt_player_ltv"
where player_id is not null
group by player_id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m15:02:22.629225 [debug] [Thread-1 (]: SQL status: OK in 0.002 seconds
[0m15:02:22.630060 [debug] [Thread-1 (]: On test.quest_kingdom.unique_rpt_player_ltv_player_id.6372e2b28d: ROLLBACK
[0m15:02:22.630546 [debug] [Thread-1 (]: Failed to rollback 'test.quest_kingdom.unique_rpt_player_ltv_player_id.6372e2b28d'
[0m15:02:22.630709 [debug] [Thread-1 (]: On test.quest_kingdom.unique_rpt_player_ltv_player_id.6372e2b28d: Close
[0m15:02:22.630975 [info ] [Thread-1 (]: 7 of 8 PASS unique_rpt_player_ltv_player_id .................................... [[32mPASS[0m in 0.01s]
[0m15:02:22.631222 [debug] [Thread-1 (]: Finished running node test.quest_kingdom.unique_rpt_player_ltv_player_id.6372e2b28d
[0m15:02:22.631397 [debug] [Thread-1 (]: Began running node test.quest_kingdom.unique_rpt_sku_performance_sku.7c3dbebf0d
[0m15:02:22.631579 [info ] [Thread-1 (]: 8 of 8 START test unique_rpt_sku_performance_sku ............................... [RUN]
[0m15:02:22.631764 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.quest_kingdom.unique_rpt_player_ltv_player_id.6372e2b28d, now test.quest_kingdom.unique_rpt_sku_performance_sku.7c3dbebf0d)
[0m15:02:22.631921 [debug] [Thread-1 (]: Began compiling node test.quest_kingdom.unique_rpt_sku_performance_sku.7c3dbebf0d
[0m15:02:22.633908 [debug] [Thread-1 (]: Writing injected SQL for node "test.quest_kingdom.unique_rpt_sku_performance_sku.7c3dbebf0d"
[0m15:02:22.634319 [debug] [Thread-1 (]: Began executing node test.quest_kingdom.unique_rpt_sku_performance_sku.7c3dbebf0d
[0m15:02:22.635420 [debug] [Thread-1 (]: Writing runtime sql for node "test.quest_kingdom.unique_rpt_sku_performance_sku.7c3dbebf0d"
[0m15:02:22.635733 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.unique_rpt_sku_performance_sku.7c3dbebf0d"
[0m15:02:22.635892 [debug] [Thread-1 (]: On test.quest_kingdom.unique_rpt_sku_performance_sku.7c3dbebf0d: BEGIN
[0m15:02:22.636030 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:02:22.636333 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m15:02:22.636481 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.unique_rpt_sku_performance_sku.7c3dbebf0d"
[0m15:02:22.636636 [debug] [Thread-1 (]: On test.quest_kingdom.unique_rpt_sku_performance_sku.7c3dbebf0d: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "test.quest_kingdom.unique_rpt_sku_performance_sku.7c3dbebf0d"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    sku as unique_field,
    count(*) as n_records

from "quest_kingdom"."main"."rpt_sku_performance"
where sku is not null
group by sku
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m15:02:22.638052 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m15:02:22.638938 [debug] [Thread-1 (]: On test.quest_kingdom.unique_rpt_sku_performance_sku.7c3dbebf0d: ROLLBACK
[0m15:02:22.639399 [debug] [Thread-1 (]: Failed to rollback 'test.quest_kingdom.unique_rpt_sku_performance_sku.7c3dbebf0d'
[0m15:02:22.639556 [debug] [Thread-1 (]: On test.quest_kingdom.unique_rpt_sku_performance_sku.7c3dbebf0d: Close
[0m15:02:22.639820 [info ] [Thread-1 (]: 8 of 8 PASS unique_rpt_sku_performance_sku ..................................... [[32mPASS[0m in 0.01s]
[0m15:02:22.640092 [debug] [Thread-1 (]: Finished running node test.quest_kingdom.unique_rpt_sku_performance_sku.7c3dbebf0d
[0m15:02:22.640743 [debug] [MainThread]: Using duckdb connection "master"
[0m15:02:22.640941 [debug] [MainThread]: On master: BEGIN
[0m15:02:22.641117 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m15:02:22.641471 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m15:02:22.641613 [debug] [MainThread]: On master: COMMIT
[0m15:02:22.641745 [debug] [MainThread]: Using duckdb connection "master"
[0m15:02:22.641863 [debug] [MainThread]: On master: COMMIT
[0m15:02:22.642052 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m15:02:22.642181 [debug] [MainThread]: On master: Close
[0m15:02:22.642363 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:02:22.642486 [debug] [MainThread]: Connection 'test.quest_kingdom.unique_rpt_sku_performance_sku.7c3dbebf0d' was properly closed.
[0m15:02:22.642626 [info ] [MainThread]: 
[0m15:02:22.642777 [info ] [MainThread]: Finished running 8 data tests in 0 hours 0 minutes and 0.20 seconds (0.20s).
[0m15:02:22.643419 [debug] [MainThread]: Command end result
[0m15:02:22.660567 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/manifest.json
[0m15:02:22.661642 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/semantic_manifest.json
[0m15:02:22.665188 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/run_results.json
[0m15:02:22.665368 [info ] [MainThread]: 
[0m15:02:22.665554 [info ] [MainThread]: [32mCompleted successfully[0m
[0m15:02:22.665701 [info ] [MainThread]: 
[0m15:02:22.665851 [info ] [MainThread]: Done. PASS=8 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=8
[0m15:02:22.667276 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 0.67604643, "process_in_blocks": "0", "process_kernel_time": 0.183959, "process_mem_max_rss": "152076288", "process_out_blocks": "0", "process_user_time": 1.137691}
[0m15:02:22.667484 [debug] [MainThread]: Command `dbt test` succeeded at 15:02:22.667447 after 0.68 seconds
[0m15:02:22.667647 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x120a9dd90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x120a9db20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104a14830>]}
[0m15:02:22.667807 [debug] [MainThread]: Flushing usage events
[0m15:02:22.783742 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m15:56:13.477324 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103f24380>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103e9f2f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104cd5670>]}


============================== 15:56:13.487378 | efa278de-af31-40a6-84d9-120a6206685d ==============================
[0m15:56:13.487378 [info ] [MainThread]: Running with dbt=1.11.4
[0m15:56:13.487729 [debug] [MainThread]: running dbt with arguments {'log_path': '/Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/logs', 'no_print': 'None', 'debug': 'False', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt run --select path:models/marts/product', 'fail_fast': 'False', 'send_anonymous_usage_stats': 'True', 'cache_selected_only': 'False', 'partial_parse': 'True', 'introspect': 'True', 'empty': 'False', 'write_json': 'True', 'static_parser': 'True', 'quiet': 'False', 'printer_width': '80', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'use_experimental_parser': 'False', 'profiles_dir': '/Users/hazeldonaldson/.dbt', 'indirect_selection': 'eager', 'log_cache_events': 'False'}
[0m15:56:13.653007 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'efa278de-af31-40a6-84d9-120a6206685d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10519e270>]}
[0m15:56:13.681760 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'efa278de-af31-40a6-84d9-120a6206685d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104c8e1b0>]}
[0m15:56:13.683027 [info ] [MainThread]: Registered adapter: duckdb=1.10.0
[0m15:56:13.734701 [debug] [MainThread]: checksum: 092b177ba87eb6bb3c55954c38aa57900eebac336561eb9ee32218428aa81d43, vars: {}, profile: , target: , version: 1.11.4
[0m15:56:13.783547 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m15:56:13.783841 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'efa278de-af31-40a6-84d9-120a6206685d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10461f230>]}
[0m15:56:14.382774 [warn ] [MainThread]: [[33mWARNING[0m]: Did not find matching node for patch with name 'rpt_level_progression' in the 'models' section of file 'models/marts/product/product.yml'
[0m15:56:14.412808 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.quest_kingdom.rpt_level_funnel' (models/marts/product/rpt_level_funnel.sql) depends on a node named 'rpt_level_progression' which was not found
[0m15:56:14.415124 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.97753906, "process_in_blocks": "0", "process_kernel_time": 0.195185, "process_mem_max_rss": "137412608", "process_out_blocks": "0", "process_user_time": 1.471316}
[0m15:56:14.415468 [debug] [MainThread]: Command `dbt run` failed at 15:56:14.415415 after 0.98 seconds
[0m15:56:14.415683 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104cd5850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10575e060>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1057ab470>]}
[0m15:56:14.415871 [debug] [MainThread]: Flushing usage events
[0m15:56:14.534166 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m15:56:52.934153 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10663b680>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106cf1b20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106cf1910>]}


============================== 15:56:52.938437 | f98d4839-cab4-436a-ac25-c87db90e860d ==============================
[0m15:56:52.938437 [info ] [MainThread]: Running with dbt=1.11.4
[0m15:56:52.938788 [debug] [MainThread]: running dbt with arguments {'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'static_parser': 'True', 'version_check': 'True', 'profiles_dir': '/Users/hazeldonaldson/.dbt', 'warn_error': 'None', 'partial_parse': 'True', 'send_anonymous_usage_stats': 'True', 'printer_width': '80', 'log_format': 'default', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'fail_fast': 'False', 'debug': 'False', 'log_cache_events': 'False', 'log_path': '/Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/logs', 'introspect': 'True', 'invocation_command': 'dbt run --select path:models/marts/product', 'no_print': 'None', 'write_json': 'True', 'quiet': 'False', 'use_colors': 'True', 'target_path': 'None', 'empty': 'False', 'cache_selected_only': 'False'}
[0m15:56:53.098879 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f98d4839-cab4-436a-ac25-c87db90e860d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1066b0d40>]}
[0m15:56:53.126952 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f98d4839-cab4-436a-ac25-c87db90e860d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106dcdfa0>]}
[0m15:56:53.128246 [info ] [MainThread]: Registered adapter: duckdb=1.10.0
[0m15:56:53.179047 [debug] [MainThread]: checksum: 092b177ba87eb6bb3c55954c38aa57900eebac336561eb9ee32218428aa81d43, vars: {}, profile: , target: , version: 1.11.4
[0m15:56:53.228258 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m15:56:53.228559 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'f98d4839-cab4-436a-ac25-c87db90e860d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10663aff0>]}
[0m15:56:53.907143 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f98d4839-cab4-436a-ac25-c87db90e860d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10744b500>]}
[0m15:56:53.986054 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/manifest.json
[0m15:56:53.988597 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/semantic_manifest.json
[0m15:56:54.004323 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f98d4839-cab4-436a-ac25-c87db90e860d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10769d9d0>]}
[0m15:56:54.004617 [info ] [MainThread]: Found 19 models, 48 data tests, 5 sources, 472 macros
[0m15:56:54.004794 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f98d4839-cab4-436a-ac25-c87db90e860d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1075efc50>]}
[0m15:56:54.006755 [info ] [MainThread]: 
[0m15:56:54.006933 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:56:54.007074 [info ] [MainThread]: 
[0m15:56:54.007304 [debug] [MainThread]: Acquiring new duckdb connection 'master'
[0m15:56:54.009504 [debug] [ThreadPool]: Acquiring new duckdb connection 'list_quest_kingdom'
[0m15:56:54.051216 [debug] [ThreadPool]: Using duckdb connection "list_quest_kingdom"
[0m15:56:54.051459 [debug] [ThreadPool]: On list_quest_kingdom: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "list_quest_kingdom"} */

    
    select schema_name
    from system.information_schema.schemata
    
    where lower(catalog_name) = '"quest_kingdom"'
    
  
  
[0m15:56:54.051608 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:56:54.070251 [debug] [ThreadPool]: SQL status: OK in 0.019 seconds
[0m15:56:54.071232 [debug] [ThreadPool]: On list_quest_kingdom: Close
[0m15:56:54.071585 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_quest_kingdom, now create_quest_kingdom_main)
[0m15:56:54.071834 [debug] [ThreadPool]: Creating schema "database: "quest_kingdom"
schema: "main"
"
[0m15:56:54.075074 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m15:56:54.075248 [debug] [ThreadPool]: On create_quest_kingdom_main: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "create_quest_kingdom_main"} */

    
        select type from duckdb_databases()
        where lower(database_name)='quest_kingdom'
        and type='sqlite'
    
  
[0m15:56:54.075390 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:56:54.076145 [debug] [ThreadPool]: SQL status: OK in 0.001 seconds
[0m15:56:54.076747 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m15:56:54.076886 [debug] [ThreadPool]: On create_quest_kingdom_main: BEGIN
[0m15:56:54.077169 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m15:56:54.077357 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m15:56:54.077508 [debug] [ThreadPool]: On create_quest_kingdom_main: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "create_quest_kingdom_main"} */

    
    
        create schema if not exists "quest_kingdom"."main"
    
[0m15:56:54.078014 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m15:56:54.078438 [debug] [ThreadPool]: On create_quest_kingdom_main: COMMIT
[0m15:56:54.078576 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m15:56:54.078698 [debug] [ThreadPool]: On create_quest_kingdom_main: COMMIT
[0m15:56:54.078905 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m15:56:54.079037 [debug] [ThreadPool]: On create_quest_kingdom_main: Close
[0m15:56:54.079979 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_quest_kingdom_main, now list_quest_kingdom_main)
[0m15:56:54.082565 [debug] [ThreadPool]: Using duckdb connection "list_quest_kingdom_main"
[0m15:56:54.082716 [debug] [ThreadPool]: On list_quest_kingdom_main: BEGIN
[0m15:56:54.082899 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:56:54.083145 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m15:56:54.083273 [debug] [ThreadPool]: Using duckdb connection "list_quest_kingdom_main"
[0m15:56:54.083402 [debug] [ThreadPool]: On list_quest_kingdom_main: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "list_quest_kingdom_main"} */
select
      'quest_kingdom' as database,
      table_name as name,
      table_schema as schema,
      CASE table_type
        WHEN 'BASE TABLE' THEN 'table'
        WHEN 'VIEW' THEN 'view'
        WHEN 'LOCAL TEMPORARY' THEN 'table'
        END as type
    from system.information_schema.tables
    where lower(table_schema) = 'main'
    and lower(table_catalog) = 'quest_kingdom'
  
[0m15:56:54.094075 [debug] [ThreadPool]: SQL status: OK in 0.011 seconds
[0m15:56:54.094907 [debug] [ThreadPool]: On list_quest_kingdom_main: ROLLBACK
[0m15:56:54.095871 [debug] [ThreadPool]: Failed to rollback 'list_quest_kingdom_main'
[0m15:56:54.096020 [debug] [ThreadPool]: On list_quest_kingdom_main: Close
[0m15:56:54.097274 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f98d4839-cab4-436a-ac25-c87db90e860d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10762ac30>]}
[0m15:56:54.097503 [debug] [MainThread]: Using duckdb connection "master"
[0m15:56:54.097641 [debug] [MainThread]: On master: BEGIN
[0m15:56:54.097760 [debug] [MainThread]: Opening a new connection, currently in state init
[0m15:56:54.098037 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m15:56:54.098223 [debug] [MainThread]: On master: COMMIT
[0m15:56:54.098372 [debug] [MainThread]: Using duckdb connection "master"
[0m15:56:54.098493 [debug] [MainThread]: On master: COMMIT
[0m15:56:54.098705 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m15:56:54.098837 [debug] [MainThread]: On master: Close
[0m15:56:54.100160 [debug] [Thread-1 (]: Began running node model.quest_kingdom.rpt_feature_engagement
[0m15:56:54.100392 [info ] [Thread-1 (]: 1 of 4 START sql table model main.rpt_feature_engagement ....................... [RUN]
[0m15:56:54.100598 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_quest_kingdom_main, now model.quest_kingdom.rpt_feature_engagement)
[0m15:56:54.100757 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.rpt_feature_engagement
[0m15:56:54.105364 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.rpt_feature_engagement"
[0m15:56:54.105875 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.rpt_feature_engagement
[0m15:56:54.121230 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.rpt_feature_engagement"
[0m15:56:54.121868 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_feature_engagement"
[0m15:56:54.122047 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_feature_engagement: BEGIN
[0m15:56:54.122193 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:56:54.122575 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m15:56:54.122739 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_feature_engagement"
[0m15:56:54.122947 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_feature_engagement: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_feature_engagement"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_feature_engagement__dbt_tmp"
  
    as (
      

with events as (
    select * from "quest_kingdom"."main"."stg_events"
),

players as (
    select * from "quest_kingdom"."main"."dim_players"
),

--aggregate events per player
player_events as (
    select 
        player_id,

        --event counts
        count(*) as total_events,
        count(distinct event_name) as unique_event_types,

        --specific events
        sum(case when event_name = 'tutorial_completed' then 1 else 0 end) as tutorial_completions,
        sum(case when event_name = 'level_completed' then 1 else 0 end) as level_completions,
        sum(case when event_name = 'boss_defeated' then 1 else 0 end) as boss_defeats,

        --timing
        min(event_at) as first_event_at,
        max(event_at) as last_event_at
    from events 
    group by player_id 

),

--combine with player data
final as (
    select 
        p.player_id,
        p.installed_at,
        p.cohort_week,
        p.attribution_channel,
        p.player_segment,
        p.experiment_variant,
        p.is_payer,

        --events
        coalesce(pe.total_events, 0) as total_events,
        coalesce(pe.unique_event_types, 0) as unique_event_types,
        coalesce(pe.tutorial_completions, 0) as tutorial_completions,
        coalesce(pe.boss_defeats, 0) as boss_defeats,

        --derived
        case 
            when pe.tutorial_completions > 0 then true 
            else false 
        end as completed_tutorial,

        case
            when pe.boss_defeats > 0 then true
            else false 
        end defeated_boss,

        --events per session (if they have sessions)
        case
            when p.total_sessions > 0 
            then coalesce(pe.total_events, 0)::float / p.total_sessions
            else 0
        end events_per_session,

        --engagement level based on events
        case 
            when coalesce(pe.total_events, 0) >= 50 then 'Power User (50+)'
            when coalesce(pe.total_events, 0) >= 20 then 'Engaged (20-49)'
            when coalesce(pe.total_events, 0) >= 5 then 'Active (5-19)'
            when coalesce(pe.total_events, 0) >= 1 then 'Casual (1-4)'
            else 'No Events'
        end as event_engagement_tier
    from players p 
    left join player_events pe on p.player_id = pe.player_id 
 )

 
 select * from final
    );
  
  
[0m15:56:54.144850 [debug] [Thread-1 (]: SQL status: OK in 0.022 seconds
[0m15:56:54.148094 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_feature_engagement"
[0m15:56:54.148288 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_feature_engagement: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_feature_engagement"} */
alter table "quest_kingdom"."main"."rpt_feature_engagement__dbt_tmp" rename to "rpt_feature_engagement"
[0m15:56:54.149233 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m15:56:54.155949 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_feature_engagement: COMMIT
[0m15:56:54.156196 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_feature_engagement"
[0m15:56:54.156361 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_feature_engagement: COMMIT
[0m15:56:54.159308 [debug] [Thread-1 (]: SQL status: OK in 0.003 seconds
[0m15:56:54.162118 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_feature_engagement"
[0m15:56:54.162315 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_feature_engagement: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_feature_engagement"} */

      drop table if exists "quest_kingdom"."main"."rpt_feature_engagement__dbt_backup" cascade
    
[0m15:56:54.162879 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m15:56:54.164022 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_feature_engagement: Close
[0m15:56:54.164974 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f98d4839-cab4-436a-ac25-c87db90e860d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10439b200>]}
[0m15:56:54.165285 [info ] [Thread-1 (]: 1 of 4 OK created sql table model main.rpt_feature_engagement .................. [[32mOK[0m in 0.06s]
[0m15:56:54.165553 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.rpt_feature_engagement
[0m15:56:54.165741 [debug] [Thread-1 (]: Began running node model.quest_kingdom.rpt_level_progression
[0m15:56:54.165974 [info ] [Thread-1 (]: 2 of 4 START sql table model main.rpt_level_progression ........................ [RUN]
[0m15:56:54.166170 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.quest_kingdom.rpt_feature_engagement, now model.quest_kingdom.rpt_level_progression)
[0m15:56:54.166334 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.rpt_level_progression
[0m15:56:54.168041 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.rpt_level_progression"
[0m15:56:54.168394 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.rpt_level_progression
[0m15:56:54.169993 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.rpt_level_progression"
[0m15:56:54.170311 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_level_progression"
[0m15:56:54.170469 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_level_progression: BEGIN
[0m15:56:54.170611 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:56:54.170916 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m15:56:54.172430 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_level_progression"
[0m15:56:54.172694 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_level_progression: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_level_progression"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_level_progression__dbt_tmp"
  
    as (
      

with sessions as (
    select * from "quest_kingdom"."main"."fct_sessions"
),

players as (
    select * from "quest_kingdom"."main"."dim_players"
),

--track level progression per player
player_levels as (
    select 
        player_id,
        min(session_started_at) as first_session_at,
        max(ending_level) as max_level_reached,
        sum(levels_gained) as total_levels_gained,

        --time to reach certain milestones
        min(case when ending_level >= 5 then session_started_at end) as reached_level_5_at,
        min(case when ending_level >= 10 then session_started_at end) as reached_level_10_at,
        min(case when ending_level >= 20 then session_started_at end) as reached_level_20_at,
        min(case when ending_level >= 30 then session_started_at end) as reached_level_30_at,
        min(case when ending_level >= 40 then session_started_at end) as reached_level_40_at,
        min(case when ending_level >= 50 then session_started_at end) as reached_level_50_at,

        --progression metrics
        count(*) as total_sessions,
        sum(session_duration_minutes) as total_play_time,
        avg(session_duration_minutes) as avg_session_duration
    from sessions 
    group by player_id 
),

--combine with player attributes
final as (
    select 
        pl.player_id,
        p.installed_at,
        p.cohort_week,
        p.attribution_channel,
        p.player_segment,
        p.experiment_variant,
        p.is_payer,

        --progression
        pl.max_level_reached,
        pl.total_levels_gained,

        --milestones
        pl.reached_level_5_at,
        pl.reached_level_10_at,
        pl.reached_level_20_at,
        pl.reached_level_30_at,
        pl.reached_level_40_at,
        pl.reached_level_50_at,

        --time to milestones (in hours)
        case 
            when pl.reached_level_5_at is not null 
            then datediff('hour', pl.first_session_at, pl.reached_level_5_at)
        end as hours_to_level_5,
        case 
            when pl.reached_level_10_at is not null 
            then datediff('hour', pl.first_session_at, pl.reached_level_10_at)
        end as hours_to_level_10,
        case 
            when pl.reached_level_20_at is not null 
            then datediff('hour', pl.first_session_at, pl.reached_level_20_at)
        end as hours_to_level_20,
       
       --engagement
       pl.total_sessions,
       pl.total_play_time,
       pl.avg_session_duration,

       --progression velocity (levels per hour player)
       case 
            when pl.total_play_time > 0 
            then pl.total_levels_gained::float / (pl.total_player / 60)
            else 0
        end as levels_per_hour,

        --progression tiers
        case 
            when pl.max_level_reached >= 40 then 'End Game (40+)'
            when pl.max_level_reached >= 30 then 'Late Game (30-39)'
            when pl.max_level_reached >= 20 then 'Mid Game (20-29)'
            when pl.max_level_reached >= 10 then 'Early Game (10-19)'
            when pl.max_level_reached >= 5 then 'Tutorial+ (5-9)'
            else 'Tutorial (1-4)'
        end as progression_tier 
    from player_levels pl 
    inner join players p on pl.player_id = p.player 
)

select * from final
    );
  
  
[0m15:56:54.177428 [debug] [Thread-1 (]: DuckDB adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_level_progression"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_level_progression__dbt_tmp"
  
    as (
      

with sessions as (
    select * from "quest_kingdom"."main"."fct_sessions"
),

players as (
    select * from "quest_kingdom"."main"."dim_players"
),

--track level progression per player
player_levels as (
    select 
        player_id,
        min(session_started_at) as first_session_at,
        max(ending_level) as max_level_reached,
        sum(levels_gained) as total_levels_gained,

        --time to reach certain milestones
        min(case when ending_level >= 5 then session_started_at end) as reached_level_5_at,
        min(case when ending_level >= 10 then session_started_at end) as reached_level_10_at,
        min(case when ending_level >= 20 then session_started_at end) as reached_level_20_at,
        min(case when ending_level >= 30 then session_started_at end) as reached_level_30_at,
        min(case when ending_level >= 40 then session_started_at end) as reached_level_40_at,
        min(case when ending_level >= 50 then session_started_at end) as reached_level_50_at,

        --progression metrics
        count(*) as total_sessions,
        sum(session_duration_minutes) as total_play_time,
        avg(session_duration_minutes) as avg_session_duration
    from sessions 
    group by player_id 
),

--combine with player attributes
final as (
    select 
        pl.player_id,
        p.installed_at,
        p.cohort_week,
        p.attribution_channel,
        p.player_segment,
        p.experiment_variant,
        p.is_payer,

        --progression
        pl.max_level_reached,
        pl.total_levels_gained,

        --milestones
        pl.reached_level_5_at,
        pl.reached_level_10_at,
        pl.reached_level_20_at,
        pl.reached_level_30_at,
        pl.reached_level_40_at,
        pl.reached_level_50_at,

        --time to milestones (in hours)
        case 
            when pl.reached_level_5_at is not null 
            then datediff('hour', pl.first_session_at, pl.reached_level_5_at)
        end as hours_to_level_5,
        case 
            when pl.reached_level_10_at is not null 
            then datediff('hour', pl.first_session_at, pl.reached_level_10_at)
        end as hours_to_level_10,
        case 
            when pl.reached_level_20_at is not null 
            then datediff('hour', pl.first_session_at, pl.reached_level_20_at)
        end as hours_to_level_20,
       
       --engagement
       pl.total_sessions,
       pl.total_play_time,
       pl.avg_session_duration,

       --progression velocity (levels per hour player)
       case 
            when pl.total_play_time > 0 
            then pl.total_levels_gained::float / (pl.total_player / 60)
            else 0
        end as levels_per_hour,

        --progression tiers
        case 
            when pl.max_level_reached >= 40 then 'End Game (40+)'
            when pl.max_level_reached >= 30 then 'Late Game (30-39)'
            when pl.max_level_reached >= 20 then 'Mid Game (20-29)'
            when pl.max_level_reached >= 10 then 'Early Game (10-19)'
            when pl.max_level_reached >= 5 then 'Tutorial+ (5-9)'
            else 'Tutorial (1-4)'
        end as progression_tier 
    from player_levels pl 
    inner join players p on pl.player_id = p.player 
)

select * from final
    );
  
  
[0m15:56:54.177899 [debug] [Thread-1 (]: DuckDB adapter: Rolling back transaction.
[0m15:56:54.178184 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_level_progression: ROLLBACK
[0m15:56:54.183543 [debug] [Thread-1 (]: Failed to rollback 'model.quest_kingdom.rpt_level_progression'
[0m15:56:54.183741 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_level_progression: Close
[0m15:56:54.184949 [debug] [Thread-1 (]: Runtime Error in model rpt_level_progression (models/marts/product/rpt_level_progression.sql)
  Binder Error: Values list "p" does not have a column named "player"
  
  LINE 104:     inner join players p on pl.player_id = p.player 
                                                       ^
[0m15:56:54.185206 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f98d4839-cab4-436a-ac25-c87db90e860d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1075e0650>]}
[0m15:56:54.185727 [error] [Thread-1 (]: 2 of 4 ERROR creating sql table model main.rpt_level_progression ............... [[31mERROR[0m in 0.02s]
[0m15:56:54.186088 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.rpt_level_progression
[0m15:56:54.186303 [debug] [Thread-1 (]: Began running node model.quest_kingdom.rpt_session_quality
[0m15:56:54.186526 [debug] [Thread-4 (]: Marking all children of 'model.quest_kingdom.rpt_level_progression' to be skipped because of status 'error'.  Reason: Runtime Error in model rpt_level_progression (models/marts/product/rpt_level_progression.sql)
  Binder Error: Values list "p" does not have a column named "player"
  
  LINE 104:     inner join players p on pl.player_id = p.player 
                                                       ^.
[0m15:56:54.186756 [info ] [Thread-1 (]: 3 of 4 START sql table model main.rpt_session_quality .......................... [RUN]
[0m15:56:54.187426 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.quest_kingdom.rpt_level_progression, now model.quest_kingdom.rpt_session_quality)
[0m15:56:54.187601 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.rpt_session_quality
[0m15:56:54.189279 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.rpt_session_quality"
[0m15:56:54.189643 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.rpt_session_quality
[0m15:56:54.192097 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.rpt_session_quality"
[0m15:56:54.192712 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_session_quality"
[0m15:56:54.192884 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_session_quality: BEGIN
[0m15:56:54.193033 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:56:54.193383 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m15:56:54.193678 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_session_quality"
[0m15:56:54.194006 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_session_quality: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_session_quality"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_session_quality__dbt_tmp"
  
    as (
      

with sessions as (
    select * from "quest_kingdom"."main"."fct_sessions"
),

--aggregate sesion metrics
session_metrics as (
    select
        player_id,
        attribution_channel,
        player_segment,
        experiment_variant,

        --session counts
        count(*) as total_sessions,
        count(case when is_quality_session then 1 end) as quality_sessions,
        count(case when had_progression then 1 end) as sessions_with_progression,

        --duration metrics
        avg(session_duration_minutes) as avg_session_duration,
        sum(session_duration_minutes) as total_play_time,
        max(session_duration_minutes) as longest_session,

        --progression metrics
        sum(levels_gained) as total_levels_gained,
        avg(levels_gained) as avg_levels_per_session,

        --time of day patterns
        count(case when time_of_day = 'morning' then 1 end) as morning_sessions,
        count(case when time_of_day = 'afternoon' then 1 end) as afternoon_session,
        count(case when time_of_day = 'evening' then 1 end) as evening_sessions,
        count(case when time_of_day = 'night' then 1 end) as night_sessions,

        --weekend vs weekday
        count(case is_weekend then 1 end) as weekend_sessions,
        count(case when not is_weekedn then 1 end) as weekday_sessions,

        --session spacings (days btwn sessions)
        avg(datediff('day',
            lag(session_started_at) over (partition by player_id order by session_started_at),
            session_started_at)) as avg_days_between_sessions
    from sessions 
    group by player_id, attribution_channel, player_segment, experiment_variant
),

--adding derived metrics
 final as (
    select 
        *,

        --quality rates
        round(quality_sessions::float / total_sessions * 100, 1) as quality_session_pct,
        round(sessions_with_progression::float / total_sessions * 100, 1) as progression_session_pct,

        --engagement patterns
        round(weekend_sessions::float / total_sessions * 100, 1) as weekend_session_pct,

        --preferred time of day
        case 
            when evening_sessions > morning_sessions
                and evening_sessions > afternoon_sessions
                and evening_sessions > night_sessions
            then 'Evening'
            when morning_sessions > afternoon_sessions
                and morning_sessions > night_sessions
            then 'Morning'
            when afternoon_session > night_sessions then 'Afternoon'
            else 'Night'
        end preferred_play_time,

        --engagement tier
        case
            when total_sessions >= 20 then 'Power User (20+)'
            when total_sessions >= 10 then 'Engaged (10-19)'
            when total_sessions >= 5 then 'Regular (5-9)'
            else 'Casual (1-4)'
        end as engagement_tier
    fron session_metrics
 )

 select * from final
    );
  
  
[0m15:56:54.195300 [debug] [Thread-1 (]: DuckDB adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_session_quality"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_session_quality__dbt_tmp"
  
    as (
      

with sessions as (
    select * from "quest_kingdom"."main"."fct_sessions"
),

--aggregate sesion metrics
session_metrics as (
    select
        player_id,
        attribution_channel,
        player_segment,
        experiment_variant,

        --session counts
        count(*) as total_sessions,
        count(case when is_quality_session then 1 end) as quality_sessions,
        count(case when had_progression then 1 end) as sessions_with_progression,

        --duration metrics
        avg(session_duration_minutes) as avg_session_duration,
        sum(session_duration_minutes) as total_play_time,
        max(session_duration_minutes) as longest_session,

        --progression metrics
        sum(levels_gained) as total_levels_gained,
        avg(levels_gained) as avg_levels_per_session,

        --time of day patterns
        count(case when time_of_day = 'morning' then 1 end) as morning_sessions,
        count(case when time_of_day = 'afternoon' then 1 end) as afternoon_session,
        count(case when time_of_day = 'evening' then 1 end) as evening_sessions,
        count(case when time_of_day = 'night' then 1 end) as night_sessions,

        --weekend vs weekday
        count(case is_weekend then 1 end) as weekend_sessions,
        count(case when not is_weekedn then 1 end) as weekday_sessions,

        --session spacings (days btwn sessions)
        avg(datediff('day',
            lag(session_started_at) over (partition by player_id order by session_started_at),
            session_started_at)) as avg_days_between_sessions
    from sessions 
    group by player_id, attribution_channel, player_segment, experiment_variant
),

--adding derived metrics
 final as (
    select 
        *,

        --quality rates
        round(quality_sessions::float / total_sessions * 100, 1) as quality_session_pct,
        round(sessions_with_progression::float / total_sessions * 100, 1) as progression_session_pct,

        --engagement patterns
        round(weekend_sessions::float / total_sessions * 100, 1) as weekend_session_pct,

        --preferred time of day
        case 
            when evening_sessions > morning_sessions
                and evening_sessions > afternoon_sessions
                and evening_sessions > night_sessions
            then 'Evening'
            when morning_sessions > afternoon_sessions
                and morning_sessions > night_sessions
            then 'Morning'
            when afternoon_session > night_sessions then 'Afternoon'
            else 'Night'
        end preferred_play_time,

        --engagement tier
        case
            when total_sessions >= 20 then 'Power User (20+)'
            when total_sessions >= 10 then 'Engaged (10-19)'
            when total_sessions >= 5 then 'Regular (5-9)'
            else 'Casual (1-4)'
        end as engagement_tier
    fron session_metrics
 )

 select * from final
    );
  
  
[0m15:56:54.195599 [debug] [Thread-1 (]: DuckDB adapter: Rolling back transaction.
[0m15:56:54.195846 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_session_quality: ROLLBACK
[0m15:56:54.197611 [debug] [Thread-1 (]: Failed to rollback 'model.quest_kingdom.rpt_session_quality'
[0m15:56:54.197896 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_session_quality: Close
[0m15:56:54.199106 [debug] [Thread-1 (]: Runtime Error in model rpt_session_quality (models/marts/product/rpt_session_quality.sql)
  Parser Error: syntax error at or near "then"
  
  LINE 46:         count(case is_weekend then 1 end) as weekend_sessions,
                                         ^
[0m15:56:54.199350 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f98d4839-cab4-436a-ac25-c87db90e860d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107a0fd10>]}
[0m15:56:54.199662 [error] [Thread-1 (]: 3 of 4 ERROR creating sql table model main.rpt_session_quality ................. [[31mERROR[0m in 0.01s]
[0m15:56:54.199921 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.rpt_session_quality
[0m15:56:54.200097 [debug] [Thread-1 (]: Began running node model.quest_kingdom.rpt_level_funnel
[0m15:56:54.200305 [debug] [Thread-4 (]: Marking all children of 'model.quest_kingdom.rpt_session_quality' to be skipped because of status 'error'.  Reason: Runtime Error in model rpt_session_quality (models/marts/product/rpt_session_quality.sql)
  Parser Error: syntax error at or near "then"
  
  LINE 46:         count(case is_weekend then 1 end) as weekend_sessions,
                                         ^.
[0m15:56:54.200496 [info ] [Thread-1 (]: 4 of 4 SKIP relation main.rpt_level_funnel ..................................... [[33mSKIP[0m]
[0m15:56:54.200745 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.rpt_level_funnel
[0m15:56:54.201277 [debug] [MainThread]: Using duckdb connection "master"
[0m15:56:54.201454 [debug] [MainThread]: On master: BEGIN
[0m15:56:54.201589 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m15:56:54.201914 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m15:56:54.202048 [debug] [MainThread]: On master: COMMIT
[0m15:56:54.202171 [debug] [MainThread]: Using duckdb connection "master"
[0m15:56:54.202281 [debug] [MainThread]: On master: COMMIT
[0m15:56:54.202468 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m15:56:54.202591 [debug] [MainThread]: On master: Close
[0m15:56:54.202748 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:56:54.202861 [debug] [MainThread]: Connection 'model.quest_kingdom.rpt_session_quality' was properly closed.
[0m15:56:54.203016 [info ] [MainThread]: 
[0m15:56:54.203290 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 0.20 seconds (0.20s).
[0m15:56:54.203715 [debug] [MainThread]: Command end result
[0m15:56:54.227833 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/manifest.json
[0m15:56:54.228970 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/semantic_manifest.json
[0m15:56:54.232099 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/run_results.json
[0m15:56:54.232274 [info ] [MainThread]: 
[0m15:56:54.232452 [info ] [MainThread]: [31mCompleted with 2 errors, 0 partial successes, and 0 warnings:[0m
[0m15:56:54.232595 [info ] [MainThread]: 
[0m15:56:54.232770 [error] [MainThread]: [31mFailure in model rpt_level_progression (models/marts/product/rpt_level_progression.sql)[0m
[0m15:56:54.232941 [error] [MainThread]:   Runtime Error in model rpt_level_progression (models/marts/product/rpt_level_progression.sql)
  Binder Error: Values list "p" does not have a column named "player"
  
  LINE 104:     inner join players p on pl.player_id = p.player 
                                                       ^
[0m15:56:54.233071 [info ] [MainThread]: 
[0m15:56:54.233222 [info ] [MainThread]:   compiled code at target/compiled/quest_kingdom/models/marts/product/rpt_level_progression.sql
[0m15:56:54.233360 [info ] [MainThread]: 
[0m15:56:54.233509 [error] [MainThread]: [31mFailure in model rpt_session_quality (models/marts/product/rpt_session_quality.sql)[0m
[0m15:56:54.233662 [error] [MainThread]:   Runtime Error in model rpt_session_quality (models/marts/product/rpt_session_quality.sql)
  Parser Error: syntax error at or near "then"
  
  LINE 46:         count(case is_weekend then 1 end) as weekend_sessions,
                                         ^
[0m15:56:54.233786 [info ] [MainThread]: 
[0m15:56:54.233928 [info ] [MainThread]:   compiled code at target/compiled/quest_kingdom/models/marts/product/rpt_session_quality.sql
[0m15:56:54.234047 [info ] [MainThread]: 
[0m15:56:54.234190 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=2 SKIP=1 NO-OP=0 TOTAL=4
[0m15:56:54.235578 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 1.33905, "process_in_blocks": "0", "process_kernel_time": 0.200769, "process_mem_max_rss": "169984000", "process_out_blocks": "0", "process_user_time": 1.761922}
[0m15:56:54.235784 [debug] [MainThread]: Command `dbt run` failed at 15:56:54.235746 after 1.34 seconds
[0m15:56:54.235960 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106cf1130>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1076d1a60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107963ec0>]}
[0m15:56:54.236130 [debug] [MainThread]: Flushing usage events
[0m15:56:54.327601 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m15:57:16.458142 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104cdc6b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104d25af0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104d25790>]}


============================== 15:57:16.463405 | c5865417-1412-48d4-a2e7-91d4cefeb494 ==============================
[0m15:57:16.463405 [info ] [MainThread]: Running with dbt=1.11.4
[0m15:57:16.463759 [debug] [MainThread]: running dbt with arguments {'log_path': '/Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/logs', 'empty': 'False', 'profiles_dir': '/Users/hazeldonaldson/.dbt', 'target_path': 'None', 'printer_width': '80', 'no_print': 'None', 'log_cache_events': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'partial_parse': 'True', 'version_check': 'True', 'fail_fast': 'False', 'write_json': 'True', 'use_experimental_parser': 'False', 'use_colors': 'True', 'debug': 'False', 'invocation_command': 'dbt run --select path:models/marts/product', 'quiet': 'False', 'introspect': 'True', 'cache_selected_only': 'False', 'static_parser': 'True', 'indirect_selection': 'eager', 'send_anonymous_usage_stats': 'True', 'warn_error': 'None', 'log_format': 'default'}
[0m15:57:16.625781 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c5865417-1412-48d4-a2e7-91d4cefeb494', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104dadeb0>]}
[0m15:57:16.653939 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c5865417-1412-48d4-a2e7-91d4cefeb494', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1025596a0>]}
[0m15:57:16.655258 [info ] [MainThread]: Registered adapter: duckdb=1.10.0
[0m15:57:16.708446 [debug] [MainThread]: checksum: 092b177ba87eb6bb3c55954c38aa57900eebac336561eb9ee32218428aa81d43, vars: {}, profile: , target: , version: 1.11.4
[0m15:57:16.775597 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m15:57:16.776061 [debug] [MainThread]: Partial parsing: updated file: quest_kingdom://models/marts/product/rpt_session_quality.sql
[0m15:57:16.965986 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c5865417-1412-48d4-a2e7-91d4cefeb494', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1054ad7f0>]}
[0m15:57:17.042845 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/manifest.json
[0m15:57:17.044229 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/semantic_manifest.json
[0m15:57:17.057662 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c5865417-1412-48d4-a2e7-91d4cefeb494', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1054dacf0>]}
[0m15:57:17.057960 [info ] [MainThread]: Found 19 models, 48 data tests, 5 sources, 472 macros
[0m15:57:17.058141 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c5865417-1412-48d4-a2e7-91d4cefeb494', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10558e7e0>]}
[0m15:57:17.060090 [info ] [MainThread]: 
[0m15:57:17.060278 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:57:17.060419 [info ] [MainThread]: 
[0m15:57:17.060653 [debug] [MainThread]: Acquiring new duckdb connection 'master'
[0m15:57:17.062818 [debug] [ThreadPool]: Acquiring new duckdb connection 'list_quest_kingdom'
[0m15:57:17.092181 [debug] [ThreadPool]: Using duckdb connection "list_quest_kingdom"
[0m15:57:17.092419 [debug] [ThreadPool]: On list_quest_kingdom: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "list_quest_kingdom"} */

    
    select schema_name
    from system.information_schema.schemata
    
    where lower(catalog_name) = '"quest_kingdom"'
    
  
  
[0m15:57:17.092576 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:57:17.112361 [debug] [ThreadPool]: SQL status: OK in 0.020 seconds
[0m15:57:17.113349 [debug] [ThreadPool]: On list_quest_kingdom: Close
[0m15:57:17.113709 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_quest_kingdom, now create_quest_kingdom_main)
[0m15:57:17.113971 [debug] [ThreadPool]: Creating schema "database: "quest_kingdom"
schema: "main"
"
[0m15:57:17.117484 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m15:57:17.117666 [debug] [ThreadPool]: On create_quest_kingdom_main: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "create_quest_kingdom_main"} */

    
        select type from duckdb_databases()
        where lower(database_name)='quest_kingdom'
        and type='sqlite'
    
  
[0m15:57:17.117805 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:57:17.118617 [debug] [ThreadPool]: SQL status: OK in 0.001 seconds
[0m15:57:17.119255 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m15:57:17.119384 [debug] [ThreadPool]: On create_quest_kingdom_main: BEGIN
[0m15:57:17.119597 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m15:57:17.119722 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m15:57:17.119844 [debug] [ThreadPool]: On create_quest_kingdom_main: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "create_quest_kingdom_main"} */

    
    
        create schema if not exists "quest_kingdom"."main"
    
[0m15:57:17.120291 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m15:57:17.120668 [debug] [ThreadPool]: On create_quest_kingdom_main: COMMIT
[0m15:57:17.120803 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m15:57:17.120921 [debug] [ThreadPool]: On create_quest_kingdom_main: COMMIT
[0m15:57:17.121117 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m15:57:17.121244 [debug] [ThreadPool]: On create_quest_kingdom_main: Close
[0m15:57:17.122181 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_quest_kingdom_main, now list_quest_kingdom_main)
[0m15:57:17.124769 [debug] [ThreadPool]: Using duckdb connection "list_quest_kingdom_main"
[0m15:57:17.124923 [debug] [ThreadPool]: On list_quest_kingdom_main: BEGIN
[0m15:57:17.125093 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:57:17.125328 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m15:57:17.125454 [debug] [ThreadPool]: Using duckdb connection "list_quest_kingdom_main"
[0m15:57:17.125582 [debug] [ThreadPool]: On list_quest_kingdom_main: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "list_quest_kingdom_main"} */
select
      'quest_kingdom' as database,
      table_name as name,
      table_schema as schema,
      CASE table_type
        WHEN 'BASE TABLE' THEN 'table'
        WHEN 'VIEW' THEN 'view'
        WHEN 'LOCAL TEMPORARY' THEN 'table'
        END as type
    from system.information_schema.tables
    where lower(table_schema) = 'main'
    and lower(table_catalog) = 'quest_kingdom'
  
[0m15:57:17.136275 [debug] [ThreadPool]: SQL status: OK in 0.011 seconds
[0m15:57:17.137129 [debug] [ThreadPool]: On list_quest_kingdom_main: ROLLBACK
[0m15:57:17.138119 [debug] [ThreadPool]: Failed to rollback 'list_quest_kingdom_main'
[0m15:57:17.138283 [debug] [ThreadPool]: On list_quest_kingdom_main: Close
[0m15:57:17.139650 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c5865417-1412-48d4-a2e7-91d4cefeb494', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1054ce870>]}
[0m15:57:17.139924 [debug] [MainThread]: Using duckdb connection "master"
[0m15:57:17.140076 [debug] [MainThread]: On master: BEGIN
[0m15:57:17.140206 [debug] [MainThread]: Opening a new connection, currently in state init
[0m15:57:17.140454 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m15:57:17.140597 [debug] [MainThread]: On master: COMMIT
[0m15:57:17.140728 [debug] [MainThread]: Using duckdb connection "master"
[0m15:57:17.140850 [debug] [MainThread]: On master: COMMIT
[0m15:57:17.141057 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m15:57:17.141185 [debug] [MainThread]: On master: Close
[0m15:57:17.142440 [debug] [Thread-1 (]: Began running node model.quest_kingdom.rpt_feature_engagement
[0m15:57:17.142668 [info ] [Thread-1 (]: 1 of 4 START sql table model main.rpt_feature_engagement ....................... [RUN]
[0m15:57:17.142871 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_quest_kingdom_main, now model.quest_kingdom.rpt_feature_engagement)
[0m15:57:17.143030 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.rpt_feature_engagement
[0m15:57:17.147030 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.rpt_feature_engagement"
[0m15:57:17.147511 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.rpt_feature_engagement
[0m15:57:17.163898 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.rpt_feature_engagement"
[0m15:57:17.164499 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_feature_engagement"
[0m15:57:17.164672 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_feature_engagement: BEGIN
[0m15:57:17.164821 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:57:17.165177 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m15:57:17.165324 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_feature_engagement"
[0m15:57:17.165517 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_feature_engagement: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_feature_engagement"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_feature_engagement__dbt_tmp"
  
    as (
      

with events as (
    select * from "quest_kingdom"."main"."stg_events"
),

players as (
    select * from "quest_kingdom"."main"."dim_players"
),

--aggregate events per player
player_events as (
    select 
        player_id,

        --event counts
        count(*) as total_events,
        count(distinct event_name) as unique_event_types,

        --specific events
        sum(case when event_name = 'tutorial_completed' then 1 else 0 end) as tutorial_completions,
        sum(case when event_name = 'level_completed' then 1 else 0 end) as level_completions,
        sum(case when event_name = 'boss_defeated' then 1 else 0 end) as boss_defeats,

        --timing
        min(event_at) as first_event_at,
        max(event_at) as last_event_at
    from events 
    group by player_id 

),

--combine with player data
final as (
    select 
        p.player_id,
        p.installed_at,
        p.cohort_week,
        p.attribution_channel,
        p.player_segment,
        p.experiment_variant,
        p.is_payer,

        --events
        coalesce(pe.total_events, 0) as total_events,
        coalesce(pe.unique_event_types, 0) as unique_event_types,
        coalesce(pe.tutorial_completions, 0) as tutorial_completions,
        coalesce(pe.boss_defeats, 0) as boss_defeats,

        --derived
        case 
            when pe.tutorial_completions > 0 then true 
            else false 
        end as completed_tutorial,

        case
            when pe.boss_defeats > 0 then true
            else false 
        end defeated_boss,

        --events per session (if they have sessions)
        case
            when p.total_sessions > 0 
            then coalesce(pe.total_events, 0)::float / p.total_sessions
            else 0
        end events_per_session,

        --engagement level based on events
        case 
            when coalesce(pe.total_events, 0) >= 50 then 'Power User (50+)'
            when coalesce(pe.total_events, 0) >= 20 then 'Engaged (20-49)'
            when coalesce(pe.total_events, 0) >= 5 then 'Active (5-19)'
            when coalesce(pe.total_events, 0) >= 1 then 'Casual (1-4)'
            else 'No Events'
        end as event_engagement_tier
    from players p 
    left join player_events pe on p.player_id = pe.player_id 
 )

 
 select * from final
    );
  
  
[0m15:57:17.185524 [debug] [Thread-1 (]: SQL status: OK in 0.020 seconds
[0m15:57:17.188426 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_feature_engagement"
[0m15:57:17.188626 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_feature_engagement: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_feature_engagement"} */

    SELECT index_name
    FROM duckdb_indexes()
    WHERE schema_name = 'main'
      AND table_name = 'rpt_feature_engagement'
  
[0m15:57:17.189123 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m15:57:17.189735 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_feature_engagement"
[0m15:57:17.189902 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_feature_engagement: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_feature_engagement"} */

    SELECT COUNT(*) as remaining_indexes
    FROM duckdb_indexes()
    WHERE schema_name = 'main'
      AND table_name = 'rpt_feature_engagement'
  
[0m15:57:17.190795 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m15:57:17.194113 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_feature_engagement"
[0m15:57:17.194342 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_feature_engagement: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_feature_engagement"} */
alter table "quest_kingdom"."main"."rpt_feature_engagement" rename to "rpt_feature_engagement__dbt_backup"
[0m15:57:17.195256 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m15:57:17.196690 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_feature_engagement"
[0m15:57:17.196858 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_feature_engagement: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_feature_engagement"} */
alter table "quest_kingdom"."main"."rpt_feature_engagement__dbt_tmp" rename to "rpt_feature_engagement"
[0m15:57:17.197141 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m15:57:17.204850 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_feature_engagement: COMMIT
[0m15:57:17.205090 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_feature_engagement"
[0m15:57:17.205252 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_feature_engagement: COMMIT
[0m15:57:17.207837 [debug] [Thread-1 (]: SQL status: OK in 0.002 seconds
[0m15:57:17.210586 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_feature_engagement"
[0m15:57:17.210829 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_feature_engagement: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_feature_engagement"} */

      drop table if exists "quest_kingdom"."main"."rpt_feature_engagement__dbt_backup" cascade
    
[0m15:57:17.211673 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m15:57:17.212830 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_feature_engagement: Close
[0m15:57:17.213767 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c5865417-1412-48d4-a2e7-91d4cefeb494', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1023cf4d0>]}
[0m15:57:17.214077 [info ] [Thread-1 (]: 1 of 4 OK created sql table model main.rpt_feature_engagement .................. [[32mOK[0m in 0.07s]
[0m15:57:17.214360 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.rpt_feature_engagement
[0m15:57:17.214555 [debug] [Thread-1 (]: Began running node model.quest_kingdom.rpt_level_progression
[0m15:57:17.214799 [info ] [Thread-1 (]: 2 of 4 START sql table model main.rpt_level_progression ........................ [RUN]
[0m15:57:17.215001 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.quest_kingdom.rpt_feature_engagement, now model.quest_kingdom.rpt_level_progression)
[0m15:57:17.215167 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.rpt_level_progression
[0m15:57:17.216885 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.rpt_level_progression"
[0m15:57:17.217267 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.rpt_level_progression
[0m15:57:17.218866 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.rpt_level_progression"
[0m15:57:17.219196 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_level_progression"
[0m15:57:17.219356 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_level_progression: BEGIN
[0m15:57:17.219502 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:57:17.219825 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m15:57:17.219980 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_level_progression"
[0m15:57:17.220214 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_level_progression: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_level_progression"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_level_progression__dbt_tmp"
  
    as (
      

with sessions as (
    select * from "quest_kingdom"."main"."fct_sessions"
),

players as (
    select * from "quest_kingdom"."main"."dim_players"
),

--track level progression per player
player_levels as (
    select 
        player_id,
        min(session_started_at) as first_session_at,
        max(ending_level) as max_level_reached,
        sum(levels_gained) as total_levels_gained,

        --time to reach certain milestones
        min(case when ending_level >= 5 then session_started_at end) as reached_level_5_at,
        min(case when ending_level >= 10 then session_started_at end) as reached_level_10_at,
        min(case when ending_level >= 20 then session_started_at end) as reached_level_20_at,
        min(case when ending_level >= 30 then session_started_at end) as reached_level_30_at,
        min(case when ending_level >= 40 then session_started_at end) as reached_level_40_at,
        min(case when ending_level >= 50 then session_started_at end) as reached_level_50_at,

        --progression metrics
        count(*) as total_sessions,
        sum(session_duration_minutes) as total_play_time,
        avg(session_duration_minutes) as avg_session_duration
    from sessions 
    group by player_id 
),

--combine with player attributes
final as (
    select 
        pl.player_id,
        p.installed_at,
        p.cohort_week,
        p.attribution_channel,
        p.player_segment,
        p.experiment_variant,
        p.is_payer,

        --progression
        pl.max_level_reached,
        pl.total_levels_gained,

        --milestones
        pl.reached_level_5_at,
        pl.reached_level_10_at,
        pl.reached_level_20_at,
        pl.reached_level_30_at,
        pl.reached_level_40_at,
        pl.reached_level_50_at,

        --time to milestones (in hours)
        case 
            when pl.reached_level_5_at is not null 
            then datediff('hour', pl.first_session_at, pl.reached_level_5_at)
        end as hours_to_level_5,
        case 
            when pl.reached_level_10_at is not null 
            then datediff('hour', pl.first_session_at, pl.reached_level_10_at)
        end as hours_to_level_10,
        case 
            when pl.reached_level_20_at is not null 
            then datediff('hour', pl.first_session_at, pl.reached_level_20_at)
        end as hours_to_level_20,
       
       --engagement
       pl.total_sessions,
       pl.total_play_time,
       pl.avg_session_duration,

       --progression velocity (levels per hour player)
       case 
            when pl.total_play_time > 0 
            then pl.total_levels_gained::float / (pl.total_player / 60)
            else 0
        end as levels_per_hour,

        --progression tiers
        case 
            when pl.max_level_reached >= 40 then 'End Game (40+)'
            when pl.max_level_reached >= 30 then 'Late Game (30-39)'
            when pl.max_level_reached >= 20 then 'Mid Game (20-29)'
            when pl.max_level_reached >= 10 then 'Early Game (10-19)'
            when pl.max_level_reached >= 5 then 'Tutorial+ (5-9)'
            else 'Tutorial (1-4)'
        end as progression_tier 
    from player_levels pl 
    inner join players p on pl.player_id = p.player 
)

select * from final
    );
  
  
[0m15:57:17.224427 [debug] [Thread-1 (]: DuckDB adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_level_progression"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_level_progression__dbt_tmp"
  
    as (
      

with sessions as (
    select * from "quest_kingdom"."main"."fct_sessions"
),

players as (
    select * from "quest_kingdom"."main"."dim_players"
),

--track level progression per player
player_levels as (
    select 
        player_id,
        min(session_started_at) as first_session_at,
        max(ending_level) as max_level_reached,
        sum(levels_gained) as total_levels_gained,

        --time to reach certain milestones
        min(case when ending_level >= 5 then session_started_at end) as reached_level_5_at,
        min(case when ending_level >= 10 then session_started_at end) as reached_level_10_at,
        min(case when ending_level >= 20 then session_started_at end) as reached_level_20_at,
        min(case when ending_level >= 30 then session_started_at end) as reached_level_30_at,
        min(case when ending_level >= 40 then session_started_at end) as reached_level_40_at,
        min(case when ending_level >= 50 then session_started_at end) as reached_level_50_at,

        --progression metrics
        count(*) as total_sessions,
        sum(session_duration_minutes) as total_play_time,
        avg(session_duration_minutes) as avg_session_duration
    from sessions 
    group by player_id 
),

--combine with player attributes
final as (
    select 
        pl.player_id,
        p.installed_at,
        p.cohort_week,
        p.attribution_channel,
        p.player_segment,
        p.experiment_variant,
        p.is_payer,

        --progression
        pl.max_level_reached,
        pl.total_levels_gained,

        --milestones
        pl.reached_level_5_at,
        pl.reached_level_10_at,
        pl.reached_level_20_at,
        pl.reached_level_30_at,
        pl.reached_level_40_at,
        pl.reached_level_50_at,

        --time to milestones (in hours)
        case 
            when pl.reached_level_5_at is not null 
            then datediff('hour', pl.first_session_at, pl.reached_level_5_at)
        end as hours_to_level_5,
        case 
            when pl.reached_level_10_at is not null 
            then datediff('hour', pl.first_session_at, pl.reached_level_10_at)
        end as hours_to_level_10,
        case 
            when pl.reached_level_20_at is not null 
            then datediff('hour', pl.first_session_at, pl.reached_level_20_at)
        end as hours_to_level_20,
       
       --engagement
       pl.total_sessions,
       pl.total_play_time,
       pl.avg_session_duration,

       --progression velocity (levels per hour player)
       case 
            when pl.total_play_time > 0 
            then pl.total_levels_gained::float / (pl.total_player / 60)
            else 0
        end as levels_per_hour,

        --progression tiers
        case 
            when pl.max_level_reached >= 40 then 'End Game (40+)'
            when pl.max_level_reached >= 30 then 'Late Game (30-39)'
            when pl.max_level_reached >= 20 then 'Mid Game (20-29)'
            when pl.max_level_reached >= 10 then 'Early Game (10-19)'
            when pl.max_level_reached >= 5 then 'Tutorial+ (5-9)'
            else 'Tutorial (1-4)'
        end as progression_tier 
    from player_levels pl 
    inner join players p on pl.player_id = p.player 
)

select * from final
    );
  
  
[0m15:57:17.224784 [debug] [Thread-1 (]: DuckDB adapter: Rolling back transaction.
[0m15:57:17.225015 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_level_progression: ROLLBACK
[0m15:57:17.229553 [debug] [Thread-1 (]: Failed to rollback 'model.quest_kingdom.rpt_level_progression'
[0m15:57:17.229755 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_level_progression: Close
[0m15:57:17.230968 [debug] [Thread-1 (]: Runtime Error in model rpt_level_progression (models/marts/product/rpt_level_progression.sql)
  Binder Error: Values list "p" does not have a column named "player"
  
  LINE 104:     inner join players p on pl.player_id = p.player 
                                                       ^
[0m15:57:17.231202 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c5865417-1412-48d4-a2e7-91d4cefeb494', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105955bb0>]}
[0m15:57:17.231497 [error] [Thread-1 (]: 2 of 4 ERROR creating sql table model main.rpt_level_progression ............... [[31mERROR[0m in 0.02s]
[0m15:57:17.231757 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.rpt_level_progression
[0m15:57:17.231938 [debug] [Thread-1 (]: Began running node model.quest_kingdom.rpt_session_quality
[0m15:57:17.232177 [debug] [Thread-4 (]: Marking all children of 'model.quest_kingdom.rpt_level_progression' to be skipped because of status 'error'.  Reason: Runtime Error in model rpt_level_progression (models/marts/product/rpt_level_progression.sql)
  Binder Error: Values list "p" does not have a column named "player"
  
  LINE 104:     inner join players p on pl.player_id = p.player 
                                                       ^.
[0m15:57:17.232404 [info ] [Thread-1 (]: 3 of 4 START sql table model main.rpt_session_quality .......................... [RUN]
[0m15:57:17.232984 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.quest_kingdom.rpt_level_progression, now model.quest_kingdom.rpt_session_quality)
[0m15:57:17.233152 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.rpt_session_quality
[0m15:57:17.234819 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.rpt_session_quality"
[0m15:57:17.235350 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.rpt_session_quality
[0m15:57:17.236945 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.rpt_session_quality"
[0m15:57:17.237260 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_session_quality"
[0m15:57:17.237412 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_session_quality: BEGIN
[0m15:57:17.237558 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:57:17.238016 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m15:57:17.238189 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_session_quality"
[0m15:57:17.238426 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_session_quality: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_session_quality"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_session_quality__dbt_tmp"
  
    as (
      

with sessions as (
    select * from "quest_kingdom"."main"."fct_sessions"
),

--aggregate sesion metrics
session_metrics as (
    select
        player_id,
        attribution_channel,
        player_segment,
        experiment_variant,

        --session counts
        count(*) as total_sessions,
        count(case when is_quality_session then 1 end) as quality_sessions,
        count(case when had_progression then 1 end) as sessions_with_progression,

        --duration metrics
        avg(session_duration_minutes) as avg_session_duration,
        sum(session_duration_minutes) as total_play_time,
        max(session_duration_minutes) as longest_session,

        --progression metrics
        sum(levels_gained) as total_levels_gained,
        avg(levels_gained) as avg_levels_per_session,

        --time of day patterns
        count(case when time_of_day = 'morning' then 1 end) as morning_sessions,
        count(case when time_of_day = 'afternoon' then 1 end) as afternoon_session,
        count(case when time_of_day = 'evening' then 1 end) as evening_sessions,
        count(case when time_of_day = 'night' then 1 end) as night_sessions,

        --weekend vs weekday
        count(case when is_weekend then 1 end) as weekend_sessions,
        count(case when not is_weekedn then 1 end) as weekday_sessions,

        --session spacings (days btwn sessions)
        avg(datediff('day',
            lag(session_started_at) over (partition by player_id order by session_started_at),
            session_started_at)) as avg_days_between_sessions
    from sessions 
    group by player_id, attribution_channel, player_segment, experiment_variant
),

--adding derived metrics
 final as (
    select 
        *,

        --quality rates
        round(quality_sessions::float / total_sessions * 100, 1) as quality_session_pct,
        round(sessions_with_progression::float / total_sessions * 100, 1) as progression_session_pct,

        --engagement patterns
        round(weekend_sessions::float / total_sessions * 100, 1) as weekend_session_pct,

        --preferred time of day
        case 
            when evening_sessions > morning_sessions
                and evening_sessions > afternoon_sessions
                and evening_sessions > night_sessions
            then 'Evening'
            when morning_sessions > afternoon_sessions
                and morning_sessions > night_sessions
            then 'Morning'
            when afternoon_session > night_sessions then 'Afternoon'
            else 'Night'
        end preferred_play_time,

        --engagement tier
        case
            when total_sessions >= 20 then 'Power User (20+)'
            when total_sessions >= 10 then 'Engaged (10-19)'
            when total_sessions >= 5 then 'Regular (5-9)'
            else 'Casual (1-4)'
        end as engagement_tier
    fron session_metrics
 )

 select * from final
    );
  
  
[0m15:57:17.244428 [debug] [Thread-1 (]: DuckDB adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_session_quality"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_session_quality__dbt_tmp"
  
    as (
      

with sessions as (
    select * from "quest_kingdom"."main"."fct_sessions"
),

--aggregate sesion metrics
session_metrics as (
    select
        player_id,
        attribution_channel,
        player_segment,
        experiment_variant,

        --session counts
        count(*) as total_sessions,
        count(case when is_quality_session then 1 end) as quality_sessions,
        count(case when had_progression then 1 end) as sessions_with_progression,

        --duration metrics
        avg(session_duration_minutes) as avg_session_duration,
        sum(session_duration_minutes) as total_play_time,
        max(session_duration_minutes) as longest_session,

        --progression metrics
        sum(levels_gained) as total_levels_gained,
        avg(levels_gained) as avg_levels_per_session,

        --time of day patterns
        count(case when time_of_day = 'morning' then 1 end) as morning_sessions,
        count(case when time_of_day = 'afternoon' then 1 end) as afternoon_session,
        count(case when time_of_day = 'evening' then 1 end) as evening_sessions,
        count(case when time_of_day = 'night' then 1 end) as night_sessions,

        --weekend vs weekday
        count(case when is_weekend then 1 end) as weekend_sessions,
        count(case when not is_weekedn then 1 end) as weekday_sessions,

        --session spacings (days btwn sessions)
        avg(datediff('day',
            lag(session_started_at) over (partition by player_id order by session_started_at),
            session_started_at)) as avg_days_between_sessions
    from sessions 
    group by player_id, attribution_channel, player_segment, experiment_variant
),

--adding derived metrics
 final as (
    select 
        *,

        --quality rates
        round(quality_sessions::float / total_sessions * 100, 1) as quality_session_pct,
        round(sessions_with_progression::float / total_sessions * 100, 1) as progression_session_pct,

        --engagement patterns
        round(weekend_sessions::float / total_sessions * 100, 1) as weekend_session_pct,

        --preferred time of day
        case 
            when evening_sessions > morning_sessions
                and evening_sessions > afternoon_sessions
                and evening_sessions > night_sessions
            then 'Evening'
            when morning_sessions > afternoon_sessions
                and morning_sessions > night_sessions
            then 'Morning'
            when afternoon_session > night_sessions then 'Afternoon'
            else 'Night'
        end preferred_play_time,

        --engagement tier
        case
            when total_sessions >= 20 then 'Power User (20+)'
            when total_sessions >= 10 then 'Engaged (10-19)'
            when total_sessions >= 5 then 'Regular (5-9)'
            else 'Casual (1-4)'
        end as engagement_tier
    fron session_metrics
 )

 select * from final
    );
  
  
[0m15:57:17.246325 [debug] [Thread-1 (]: DuckDB adapter: Rolling back transaction.
[0m15:57:17.247261 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_session_quality: ROLLBACK
[0m15:57:17.261152 [debug] [Thread-1 (]: Failed to rollback 'model.quest_kingdom.rpt_session_quality'
[0m15:57:17.261470 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_session_quality: Close
[0m15:57:17.267016 [debug] [Thread-1 (]: Runtime Error in model rpt_session_quality (models/marts/product/rpt_session_quality.sql)
  Parser Error: syntax error at or near "fron"
  
  LINE 89:     fron session_metrics
               ^
[0m15:57:17.267368 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c5865417-1412-48d4-a2e7-91d4cefeb494', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1059e04a0>]}
[0m15:57:17.267722 [error] [Thread-1 (]: 3 of 4 ERROR creating sql table model main.rpt_session_quality ................. [[31mERROR[0m in 0.03s]
[0m15:57:17.279099 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.rpt_session_quality
[0m15:57:17.279452 [debug] [Thread-1 (]: Began running node model.quest_kingdom.rpt_level_funnel
[0m15:57:17.279693 [debug] [Thread-4 (]: Marking all children of 'model.quest_kingdom.rpt_session_quality' to be skipped because of status 'error'.  Reason: Runtime Error in model rpt_session_quality (models/marts/product/rpt_session_quality.sql)
  Parser Error: syntax error at or near "fron"
  
  LINE 89:     fron session_metrics
               ^.
[0m15:57:17.279909 [info ] [Thread-1 (]: 4 of 4 SKIP relation main.rpt_level_funnel ..................................... [[33mSKIP[0m]
[0m15:57:17.280200 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.rpt_level_funnel
[0m15:57:17.280865 [debug] [MainThread]: Using duckdb connection "master"
[0m15:57:17.281028 [debug] [MainThread]: On master: BEGIN
[0m15:57:17.281557 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m15:57:17.281988 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m15:57:17.282144 [debug] [MainThread]: On master: COMMIT
[0m15:57:17.282353 [debug] [MainThread]: Using duckdb connection "master"
[0m15:57:17.282530 [debug] [MainThread]: On master: COMMIT
[0m15:57:17.282793 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m15:57:17.282943 [debug] [MainThread]: On master: Close
[0m15:57:17.283153 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:57:17.283285 [debug] [MainThread]: Connection 'model.quest_kingdom.rpt_session_quality' was properly closed.
[0m15:57:17.283459 [info ] [MainThread]: 
[0m15:57:17.283618 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 0.22 seconds (0.22s).
[0m15:57:17.284304 [debug] [MainThread]: Command end result
[0m15:57:17.319788 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/manifest.json
[0m15:57:17.321046 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/semantic_manifest.json
[0m15:57:17.324299 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/run_results.json
[0m15:57:17.324526 [info ] [MainThread]: 
[0m15:57:17.324705 [info ] [MainThread]: [31mCompleted with 2 errors, 0 partial successes, and 0 warnings:[0m
[0m15:57:17.324849 [info ] [MainThread]: 
[0m15:57:17.325032 [error] [MainThread]: [31mFailure in model rpt_level_progression (models/marts/product/rpt_level_progression.sql)[0m
[0m15:57:17.325202 [error] [MainThread]:   Runtime Error in model rpt_level_progression (models/marts/product/rpt_level_progression.sql)
  Binder Error: Values list "p" does not have a column named "player"
  
  LINE 104:     inner join players p on pl.player_id = p.player 
                                                       ^
[0m15:57:17.325330 [info ] [MainThread]: 
[0m15:57:17.325486 [info ] [MainThread]:   compiled code at target/compiled/quest_kingdom/models/marts/product/rpt_level_progression.sql
[0m15:57:17.325617 [info ] [MainThread]: 
[0m15:57:17.325771 [error] [MainThread]: [31mFailure in model rpt_session_quality (models/marts/product/rpt_session_quality.sql)[0m
[0m15:57:17.325927 [error] [MainThread]:   Runtime Error in model rpt_session_quality (models/marts/product/rpt_session_quality.sql)
  Parser Error: syntax error at or near "fron"
  
  LINE 89:     fron session_metrics
               ^
[0m15:57:17.326052 [info ] [MainThread]: 
[0m15:57:17.326197 [info ] [MainThread]:   compiled code at target/compiled/quest_kingdom/models/marts/product/rpt_session_quality.sql
[0m15:57:17.326322 [info ] [MainThread]: 
[0m15:57:17.326467 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=2 SKIP=1 NO-OP=0 TOTAL=4
[0m15:57:17.327795 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.9061755, "process_in_blocks": "0", "process_kernel_time": 0.196179, "process_mem_max_rss": "171081728", "process_out_blocks": "0", "process_user_time": 1.308508}
[0m15:57:17.328056 [debug] [MainThread]: Command `dbt run` failed at 15:57:17.328012 after 0.91 seconds
[0m15:57:17.328250 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104d259a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104d25b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1051ede50>]}
[0m15:57:17.328424 [debug] [MainThread]: Flushing usage events
[0m15:57:17.425009 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m15:57:32.510386 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107d49760>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108ad1970>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108ad1700>]}


============================== 15:57:32.517856 | c44c648e-6181-46e0-855c-355ab00f81d3 ==============================
[0m15:57:32.517856 [info ] [MainThread]: Running with dbt=1.11.4
[0m15:57:32.518223 [debug] [MainThread]: running dbt with arguments {'partial_parse': 'True', 'write_json': 'True', 'send_anonymous_usage_stats': 'True', 'warn_error': 'None', 'indirect_selection': 'eager', 'fail_fast': 'False', 'profiles_dir': '/Users/hazeldonaldson/.dbt', 'target_path': 'None', 'no_print': 'None', 'printer_width': '80', 'introspect': 'True', 'use_colors': 'True', 'cache_selected_only': 'False', 'static_parser': 'True', 'use_experimental_parser': 'False', 'invocation_command': 'dbt run --select path:models/marts/product', 'empty': 'False', 'log_cache_events': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_path': '/Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/logs', 'debug': 'False', 'version_check': 'True', 'quiet': 'False', 'log_format': 'default'}
[0m15:57:32.687049 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c44c648e-6181-46e0-855c-355ab00f81d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108ce7200>]}
[0m15:57:32.716179 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c44c648e-6181-46e0-855c-355ab00f81d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108990740>]}
[0m15:57:32.717694 [info ] [MainThread]: Registered adapter: duckdb=1.10.0
[0m15:57:32.770415 [debug] [MainThread]: checksum: 092b177ba87eb6bb3c55954c38aa57900eebac336561eb9ee32218428aa81d43, vars: {}, profile: , target: , version: 1.11.4
[0m15:57:32.839363 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m15:57:32.839883 [debug] [MainThread]: Partial parsing: updated file: quest_kingdom://models/marts/product/rpt_session_quality.sql
[0m15:57:33.028899 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c44c648e-6181-46e0-855c-355ab00f81d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10938a360>]}
[0m15:57:33.108500 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/manifest.json
[0m15:57:33.109823 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/semantic_manifest.json
[0m15:57:33.123063 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c44c648e-6181-46e0-855c-355ab00f81d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10925af90>]}
[0m15:57:33.123354 [info ] [MainThread]: Found 19 models, 48 data tests, 5 sources, 472 macros
[0m15:57:33.123526 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c44c648e-6181-46e0-855c-355ab00f81d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10928b320>]}
[0m15:57:33.125458 [info ] [MainThread]: 
[0m15:57:33.125640 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:57:33.125781 [info ] [MainThread]: 
[0m15:57:33.126014 [debug] [MainThread]: Acquiring new duckdb connection 'master'
[0m15:57:33.128197 [debug] [ThreadPool]: Acquiring new duckdb connection 'list_quest_kingdom'
[0m15:57:33.157790 [debug] [ThreadPool]: Using duckdb connection "list_quest_kingdom"
[0m15:57:33.158048 [debug] [ThreadPool]: On list_quest_kingdom: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "list_quest_kingdom"} */

    
    select schema_name
    from system.information_schema.schemata
    
    where lower(catalog_name) = '"quest_kingdom"'
    
  
  
[0m15:57:33.158197 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:57:33.177891 [debug] [ThreadPool]: SQL status: OK in 0.020 seconds
[0m15:57:33.178938 [debug] [ThreadPool]: On list_quest_kingdom: Close
[0m15:57:33.179318 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_quest_kingdom, now create_quest_kingdom_main)
[0m15:57:33.179569 [debug] [ThreadPool]: Creating schema "database: "quest_kingdom"
schema: "main"
"
[0m15:57:33.182981 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m15:57:33.183159 [debug] [ThreadPool]: On create_quest_kingdom_main: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "create_quest_kingdom_main"} */

    
        select type from duckdb_databases()
        where lower(database_name)='quest_kingdom'
        and type='sqlite'
    
  
[0m15:57:33.183291 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:57:33.183982 [debug] [ThreadPool]: SQL status: OK in 0.001 seconds
[0m15:57:33.184781 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m15:57:33.184910 [debug] [ThreadPool]: On create_quest_kingdom_main: BEGIN
[0m15:57:33.185123 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m15:57:33.185245 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m15:57:33.185365 [debug] [ThreadPool]: On create_quest_kingdom_main: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "create_quest_kingdom_main"} */

    
    
        create schema if not exists "quest_kingdom"."main"
    
[0m15:57:33.185600 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m15:57:33.185977 [debug] [ThreadPool]: On create_quest_kingdom_main: COMMIT
[0m15:57:33.186107 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m15:57:33.186221 [debug] [ThreadPool]: On create_quest_kingdom_main: COMMIT
[0m15:57:33.186414 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m15:57:33.186543 [debug] [ThreadPool]: On create_quest_kingdom_main: Close
[0m15:57:33.187495 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_quest_kingdom_main, now list_quest_kingdom_main)
[0m15:57:33.190095 [debug] [ThreadPool]: Using duckdb connection "list_quest_kingdom_main"
[0m15:57:33.190256 [debug] [ThreadPool]: On list_quest_kingdom_main: BEGIN
[0m15:57:33.190436 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:57:33.190681 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m15:57:33.190814 [debug] [ThreadPool]: Using duckdb connection "list_quest_kingdom_main"
[0m15:57:33.190949 [debug] [ThreadPool]: On list_quest_kingdom_main: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "list_quest_kingdom_main"} */
select
      'quest_kingdom' as database,
      table_name as name,
      table_schema as schema,
      CASE table_type
        WHEN 'BASE TABLE' THEN 'table'
        WHEN 'VIEW' THEN 'view'
        WHEN 'LOCAL TEMPORARY' THEN 'table'
        END as type
    from system.information_schema.tables
    where lower(table_schema) = 'main'
    and lower(table_catalog) = 'quest_kingdom'
  
[0m15:57:33.202125 [debug] [ThreadPool]: SQL status: OK in 0.011 seconds
[0m15:57:33.202959 [debug] [ThreadPool]: On list_quest_kingdom_main: ROLLBACK
[0m15:57:33.203910 [debug] [ThreadPool]: Failed to rollback 'list_quest_kingdom_main'
[0m15:57:33.204081 [debug] [ThreadPool]: On list_quest_kingdom_main: Close
[0m15:57:33.205621 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c44c648e-6181-46e0-855c-355ab00f81d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10929fd10>]}
[0m15:57:33.205859 [debug] [MainThread]: Using duckdb connection "master"
[0m15:57:33.205995 [debug] [MainThread]: On master: BEGIN
[0m15:57:33.206113 [debug] [MainThread]: Opening a new connection, currently in state init
[0m15:57:33.206363 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m15:57:33.206498 [debug] [MainThread]: On master: COMMIT
[0m15:57:33.206623 [debug] [MainThread]: Using duckdb connection "master"
[0m15:57:33.206739 [debug] [MainThread]: On master: COMMIT
[0m15:57:33.206924 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m15:57:33.207051 [debug] [MainThread]: On master: Close
[0m15:57:33.208219 [debug] [Thread-1 (]: Began running node model.quest_kingdom.rpt_feature_engagement
[0m15:57:33.208450 [info ] [Thread-1 (]: 1 of 4 START sql table model main.rpt_feature_engagement ....................... [RUN]
[0m15:57:33.208645 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_quest_kingdom_main, now model.quest_kingdom.rpt_feature_engagement)
[0m15:57:33.208803 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.rpt_feature_engagement
[0m15:57:33.212765 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.rpt_feature_engagement"
[0m15:57:33.213246 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.rpt_feature_engagement
[0m15:57:33.229612 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.rpt_feature_engagement"
[0m15:57:33.230168 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_feature_engagement"
[0m15:57:33.230338 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_feature_engagement: BEGIN
[0m15:57:33.230485 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:57:33.230856 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m15:57:33.231000 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_feature_engagement"
[0m15:57:33.231196 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_feature_engagement: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_feature_engagement"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_feature_engagement__dbt_tmp"
  
    as (
      

with events as (
    select * from "quest_kingdom"."main"."stg_events"
),

players as (
    select * from "quest_kingdom"."main"."dim_players"
),

--aggregate events per player
player_events as (
    select 
        player_id,

        --event counts
        count(*) as total_events,
        count(distinct event_name) as unique_event_types,

        --specific events
        sum(case when event_name = 'tutorial_completed' then 1 else 0 end) as tutorial_completions,
        sum(case when event_name = 'level_completed' then 1 else 0 end) as level_completions,
        sum(case when event_name = 'boss_defeated' then 1 else 0 end) as boss_defeats,

        --timing
        min(event_at) as first_event_at,
        max(event_at) as last_event_at
    from events 
    group by player_id 

),

--combine with player data
final as (
    select 
        p.player_id,
        p.installed_at,
        p.cohort_week,
        p.attribution_channel,
        p.player_segment,
        p.experiment_variant,
        p.is_payer,

        --events
        coalesce(pe.total_events, 0) as total_events,
        coalesce(pe.unique_event_types, 0) as unique_event_types,
        coalesce(pe.tutorial_completions, 0) as tutorial_completions,
        coalesce(pe.boss_defeats, 0) as boss_defeats,

        --derived
        case 
            when pe.tutorial_completions > 0 then true 
            else false 
        end as completed_tutorial,

        case
            when pe.boss_defeats > 0 then true
            else false 
        end defeated_boss,

        --events per session (if they have sessions)
        case
            when p.total_sessions > 0 
            then coalesce(pe.total_events, 0)::float / p.total_sessions
            else 0
        end events_per_session,

        --engagement level based on events
        case 
            when coalesce(pe.total_events, 0) >= 50 then 'Power User (50+)'
            when coalesce(pe.total_events, 0) >= 20 then 'Engaged (20-49)'
            when coalesce(pe.total_events, 0) >= 5 then 'Active (5-19)'
            when coalesce(pe.total_events, 0) >= 1 then 'Casual (1-4)'
            else 'No Events'
        end as event_engagement_tier
    from players p 
    left join player_events pe on p.player_id = pe.player_id 
 )

 
 select * from final
    );
  
  
[0m15:57:33.252155 [debug] [Thread-1 (]: SQL status: OK in 0.021 seconds
[0m15:57:33.255038 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_feature_engagement"
[0m15:57:33.255234 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_feature_engagement: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_feature_engagement"} */

    SELECT index_name
    FROM duckdb_indexes()
    WHERE schema_name = 'main'
      AND table_name = 'rpt_feature_engagement'
  
[0m15:57:33.255744 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m15:57:33.256362 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_feature_engagement"
[0m15:57:33.256529 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_feature_engagement: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_feature_engagement"} */

    SELECT COUNT(*) as remaining_indexes
    FROM duckdb_indexes()
    WHERE schema_name = 'main'
      AND table_name = 'rpt_feature_engagement'
  
[0m15:57:33.258455 [debug] [Thread-1 (]: SQL status: OK in 0.002 seconds
[0m15:57:33.261732 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_feature_engagement"
[0m15:57:33.261941 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_feature_engagement: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_feature_engagement"} */
alter table "quest_kingdom"."main"."rpt_feature_engagement" rename to "rpt_feature_engagement__dbt_backup"
[0m15:57:33.262884 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m15:57:33.264323 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_feature_engagement"
[0m15:57:33.264488 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_feature_engagement: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_feature_engagement"} */
alter table "quest_kingdom"."main"."rpt_feature_engagement__dbt_tmp" rename to "rpt_feature_engagement"
[0m15:57:33.264777 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m15:57:33.272230 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_feature_engagement: COMMIT
[0m15:57:33.272471 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_feature_engagement"
[0m15:57:33.272627 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_feature_engagement: COMMIT
[0m15:57:33.275292 [debug] [Thread-1 (]: SQL status: OK in 0.002 seconds
[0m15:57:33.278046 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_feature_engagement"
[0m15:57:33.278243 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_feature_engagement: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_feature_engagement"} */

      drop table if exists "quest_kingdom"."main"."rpt_feature_engagement__dbt_backup" cascade
    
[0m15:57:33.279054 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m15:57:33.280203 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_feature_engagement: Close
[0m15:57:33.281144 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c44c648e-6181-46e0-855c-355ab00f81d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1092655b0>]}
[0m15:57:33.281448 [info ] [Thread-1 (]: 1 of 4 OK created sql table model main.rpt_feature_engagement .................. [[32mOK[0m in 0.07s]
[0m15:57:33.281717 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.rpt_feature_engagement
[0m15:57:33.281906 [debug] [Thread-1 (]: Began running node model.quest_kingdom.rpt_level_progression
[0m15:57:33.282143 [info ] [Thread-1 (]: 2 of 4 START sql table model main.rpt_level_progression ........................ [RUN]
[0m15:57:33.282342 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.quest_kingdom.rpt_feature_engagement, now model.quest_kingdom.rpt_level_progression)
[0m15:57:33.282505 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.rpt_level_progression
[0m15:57:33.284235 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.rpt_level_progression"
[0m15:57:33.284604 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.rpt_level_progression
[0m15:57:33.286176 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.rpt_level_progression"
[0m15:57:33.286501 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_level_progression"
[0m15:57:33.286657 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_level_progression: BEGIN
[0m15:57:33.286799 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:57:33.287101 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m15:57:33.287246 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_level_progression"
[0m15:57:33.287508 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_level_progression: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_level_progression"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_level_progression__dbt_tmp"
  
    as (
      

with sessions as (
    select * from "quest_kingdom"."main"."fct_sessions"
),

players as (
    select * from "quest_kingdom"."main"."dim_players"
),

--track level progression per player
player_levels as (
    select 
        player_id,
        min(session_started_at) as first_session_at,
        max(ending_level) as max_level_reached,
        sum(levels_gained) as total_levels_gained,

        --time to reach certain milestones
        min(case when ending_level >= 5 then session_started_at end) as reached_level_5_at,
        min(case when ending_level >= 10 then session_started_at end) as reached_level_10_at,
        min(case when ending_level >= 20 then session_started_at end) as reached_level_20_at,
        min(case when ending_level >= 30 then session_started_at end) as reached_level_30_at,
        min(case when ending_level >= 40 then session_started_at end) as reached_level_40_at,
        min(case when ending_level >= 50 then session_started_at end) as reached_level_50_at,

        --progression metrics
        count(*) as total_sessions,
        sum(session_duration_minutes) as total_play_time,
        avg(session_duration_minutes) as avg_session_duration
    from sessions 
    group by player_id 
),

--combine with player attributes
final as (
    select 
        pl.player_id,
        p.installed_at,
        p.cohort_week,
        p.attribution_channel,
        p.player_segment,
        p.experiment_variant,
        p.is_payer,

        --progression
        pl.max_level_reached,
        pl.total_levels_gained,

        --milestones
        pl.reached_level_5_at,
        pl.reached_level_10_at,
        pl.reached_level_20_at,
        pl.reached_level_30_at,
        pl.reached_level_40_at,
        pl.reached_level_50_at,

        --time to milestones (in hours)
        case 
            when pl.reached_level_5_at is not null 
            then datediff('hour', pl.first_session_at, pl.reached_level_5_at)
        end as hours_to_level_5,
        case 
            when pl.reached_level_10_at is not null 
            then datediff('hour', pl.first_session_at, pl.reached_level_10_at)
        end as hours_to_level_10,
        case 
            when pl.reached_level_20_at is not null 
            then datediff('hour', pl.first_session_at, pl.reached_level_20_at)
        end as hours_to_level_20,
       
       --engagement
       pl.total_sessions,
       pl.total_play_time,
       pl.avg_session_duration,

       --progression velocity (levels per hour player)
       case 
            when pl.total_play_time > 0 
            then pl.total_levels_gained::float / (pl.total_player / 60)
            else 0
        end as levels_per_hour,

        --progression tiers
        case 
            when pl.max_level_reached >= 40 then 'End Game (40+)'
            when pl.max_level_reached >= 30 then 'Late Game (30-39)'
            when pl.max_level_reached >= 20 then 'Mid Game (20-29)'
            when pl.max_level_reached >= 10 then 'Early Game (10-19)'
            when pl.max_level_reached >= 5 then 'Tutorial+ (5-9)'
            else 'Tutorial (1-4)'
        end as progression_tier 
    from player_levels pl 
    inner join players p on pl.player_id = p.player 
)

select * from final
    );
  
  
[0m15:57:33.291529 [debug] [Thread-1 (]: DuckDB adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_level_progression"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_level_progression__dbt_tmp"
  
    as (
      

with sessions as (
    select * from "quest_kingdom"."main"."fct_sessions"
),

players as (
    select * from "quest_kingdom"."main"."dim_players"
),

--track level progression per player
player_levels as (
    select 
        player_id,
        min(session_started_at) as first_session_at,
        max(ending_level) as max_level_reached,
        sum(levels_gained) as total_levels_gained,

        --time to reach certain milestones
        min(case when ending_level >= 5 then session_started_at end) as reached_level_5_at,
        min(case when ending_level >= 10 then session_started_at end) as reached_level_10_at,
        min(case when ending_level >= 20 then session_started_at end) as reached_level_20_at,
        min(case when ending_level >= 30 then session_started_at end) as reached_level_30_at,
        min(case when ending_level >= 40 then session_started_at end) as reached_level_40_at,
        min(case when ending_level >= 50 then session_started_at end) as reached_level_50_at,

        --progression metrics
        count(*) as total_sessions,
        sum(session_duration_minutes) as total_play_time,
        avg(session_duration_minutes) as avg_session_duration
    from sessions 
    group by player_id 
),

--combine with player attributes
final as (
    select 
        pl.player_id,
        p.installed_at,
        p.cohort_week,
        p.attribution_channel,
        p.player_segment,
        p.experiment_variant,
        p.is_payer,

        --progression
        pl.max_level_reached,
        pl.total_levels_gained,

        --milestones
        pl.reached_level_5_at,
        pl.reached_level_10_at,
        pl.reached_level_20_at,
        pl.reached_level_30_at,
        pl.reached_level_40_at,
        pl.reached_level_50_at,

        --time to milestones (in hours)
        case 
            when pl.reached_level_5_at is not null 
            then datediff('hour', pl.first_session_at, pl.reached_level_5_at)
        end as hours_to_level_5,
        case 
            when pl.reached_level_10_at is not null 
            then datediff('hour', pl.first_session_at, pl.reached_level_10_at)
        end as hours_to_level_10,
        case 
            when pl.reached_level_20_at is not null 
            then datediff('hour', pl.first_session_at, pl.reached_level_20_at)
        end as hours_to_level_20,
       
       --engagement
       pl.total_sessions,
       pl.total_play_time,
       pl.avg_session_duration,

       --progression velocity (levels per hour player)
       case 
            when pl.total_play_time > 0 
            then pl.total_levels_gained::float / (pl.total_player / 60)
            else 0
        end as levels_per_hour,

        --progression tiers
        case 
            when pl.max_level_reached >= 40 then 'End Game (40+)'
            when pl.max_level_reached >= 30 then 'Late Game (30-39)'
            when pl.max_level_reached >= 20 then 'Mid Game (20-29)'
            when pl.max_level_reached >= 10 then 'Early Game (10-19)'
            when pl.max_level_reached >= 5 then 'Tutorial+ (5-9)'
            else 'Tutorial (1-4)'
        end as progression_tier 
    from player_levels pl 
    inner join players p on pl.player_id = p.player 
)

select * from final
    );
  
  
[0m15:57:33.291857 [debug] [Thread-1 (]: DuckDB adapter: Rolling back transaction.
[0m15:57:33.292085 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_level_progression: ROLLBACK
[0m15:57:33.296279 [debug] [Thread-1 (]: Failed to rollback 'model.quest_kingdom.rpt_level_progression'
[0m15:57:33.296459 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_level_progression: Close
[0m15:57:33.297660 [debug] [Thread-1 (]: Runtime Error in model rpt_level_progression (models/marts/product/rpt_level_progression.sql)
  Binder Error: Values list "p" does not have a column named "player"
  
  LINE 104:     inner join players p on pl.player_id = p.player 
                                                       ^
[0m15:57:33.297894 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c44c648e-6181-46e0-855c-355ab00f81d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1096f2540>]}
[0m15:57:33.298188 [error] [Thread-1 (]: 2 of 4 ERROR creating sql table model main.rpt_level_progression ............... [[31mERROR[0m in 0.02s]
[0m15:57:33.298445 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.rpt_level_progression
[0m15:57:33.298625 [debug] [Thread-1 (]: Began running node model.quest_kingdom.rpt_session_quality
[0m15:57:33.298855 [debug] [Thread-4 (]: Marking all children of 'model.quest_kingdom.rpt_level_progression' to be skipped because of status 'error'.  Reason: Runtime Error in model rpt_level_progression (models/marts/product/rpt_level_progression.sql)
  Binder Error: Values list "p" does not have a column named "player"
  
  LINE 104:     inner join players p on pl.player_id = p.player 
                                                       ^.
[0m15:57:33.299081 [info ] [Thread-1 (]: 3 of 4 START sql table model main.rpt_session_quality .......................... [RUN]
[0m15:57:33.299657 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.quest_kingdom.rpt_level_progression, now model.quest_kingdom.rpt_session_quality)
[0m15:57:33.299818 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.rpt_session_quality
[0m15:57:33.301482 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.rpt_session_quality"
[0m15:57:33.302045 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.rpt_session_quality
[0m15:57:33.303634 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.rpt_session_quality"
[0m15:57:33.304136 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_session_quality"
[0m15:57:33.304343 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_session_quality: BEGIN
[0m15:57:33.304517 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:57:33.304915 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m15:57:33.305103 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_session_quality"
[0m15:57:33.305333 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_session_quality: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_session_quality"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_session_quality__dbt_tmp"
  
    as (
      

with sessions as (
    select * from "quest_kingdom"."main"."fct_sessions"
),

--aggregate sesion metrics
session_metrics as (
    select
        player_id,
        attribution_channel,
        player_segment,
        experiment_variant,

        --session counts
        count(*) as total_sessions,
        count(case when is_quality_session then 1 end) as quality_sessions,
        count(case when had_progression then 1 end) as sessions_with_progression,

        --duration metrics
        avg(session_duration_minutes) as avg_session_duration,
        sum(session_duration_minutes) as total_play_time,
        max(session_duration_minutes) as longest_session,

        --progression metrics
        sum(levels_gained) as total_levels_gained,
        avg(levels_gained) as avg_levels_per_session,

        --time of day patterns
        count(case when time_of_day = 'morning' then 1 end) as morning_sessions,
        count(case when time_of_day = 'afternoon' then 1 end) as afternoon_session,
        count(case when time_of_day = 'evening' then 1 end) as evening_sessions,
        count(case when time_of_day = 'night' then 1 end) as night_sessions,

        --weekend vs weekday
        count(case when is_weekend then 1 end) as weekend_sessions,
        count(case when not is_weekedn then 1 end) as weekday_sessions,

        --session spacings (days btwn sessions)
        avg(datediff('day',
            lag(session_started_at) over (partition by player_id order by session_started_at),
            session_started_at)) as avg_days_between_sessions
    from sessions 
    group by player_id, attribution_channel, player_segment, experiment_variant
),

--adding derived metrics
 final as (
    select 
        *,

        --quality rates
        round(quality_sessions::float / total_sessions * 100, 1) as quality_session_pct,
        round(sessions_with_progression::float / total_sessions * 100, 1) as progression_session_pct,

        --engagement patterns
        round(weekend_sessions::float / total_sessions * 100, 1) as weekend_session_pct,

        --preferred time of day
        case 
            when evening_sessions > morning_sessions
                and evening_sessions > afternoon_sessions
                and evening_sessions > night_sessions
            then 'Evening'
            when morning_sessions > afternoon_sessions
                and morning_sessions > night_sessions
            then 'Morning'
            when afternoon_session > night_sessions then 'Afternoon'
            else 'Night'
        end preferred_play_time,

        --engagement tier
        case
            when total_sessions >= 20 then 'Power User (20+)'
            when total_sessions >= 10 then 'Engaged (10-19)'
            when total_sessions >= 5 then 'Regular (5-9)'
            else 'Casual (1-4)'
        end as engagement_tier
    from session_metrics
 )

 select * from final
    );
  
  
[0m15:57:33.306475 [debug] [Thread-1 (]: DuckDB adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_session_quality"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_session_quality__dbt_tmp"
  
    as (
      

with sessions as (
    select * from "quest_kingdom"."main"."fct_sessions"
),

--aggregate sesion metrics
session_metrics as (
    select
        player_id,
        attribution_channel,
        player_segment,
        experiment_variant,

        --session counts
        count(*) as total_sessions,
        count(case when is_quality_session then 1 end) as quality_sessions,
        count(case when had_progression then 1 end) as sessions_with_progression,

        --duration metrics
        avg(session_duration_minutes) as avg_session_duration,
        sum(session_duration_minutes) as total_play_time,
        max(session_duration_minutes) as longest_session,

        --progression metrics
        sum(levels_gained) as total_levels_gained,
        avg(levels_gained) as avg_levels_per_session,

        --time of day patterns
        count(case when time_of_day = 'morning' then 1 end) as morning_sessions,
        count(case when time_of_day = 'afternoon' then 1 end) as afternoon_session,
        count(case when time_of_day = 'evening' then 1 end) as evening_sessions,
        count(case when time_of_day = 'night' then 1 end) as night_sessions,

        --weekend vs weekday
        count(case when is_weekend then 1 end) as weekend_sessions,
        count(case when not is_weekedn then 1 end) as weekday_sessions,

        --session spacings (days btwn sessions)
        avg(datediff('day',
            lag(session_started_at) over (partition by player_id order by session_started_at),
            session_started_at)) as avg_days_between_sessions
    from sessions 
    group by player_id, attribution_channel, player_segment, experiment_variant
),

--adding derived metrics
 final as (
    select 
        *,

        --quality rates
        round(quality_sessions::float / total_sessions * 100, 1) as quality_session_pct,
        round(sessions_with_progression::float / total_sessions * 100, 1) as progression_session_pct,

        --engagement patterns
        round(weekend_sessions::float / total_sessions * 100, 1) as weekend_session_pct,

        --preferred time of day
        case 
            when evening_sessions > morning_sessions
                and evening_sessions > afternoon_sessions
                and evening_sessions > night_sessions
            then 'Evening'
            when morning_sessions > afternoon_sessions
                and morning_sessions > night_sessions
            then 'Morning'
            when afternoon_session > night_sessions then 'Afternoon'
            else 'Night'
        end preferred_play_time,

        --engagement tier
        case
            when total_sessions >= 20 then 'Power User (20+)'
            when total_sessions >= 10 then 'Engaged (10-19)'
            when total_sessions >= 5 then 'Regular (5-9)'
            else 'Casual (1-4)'
        end as engagement_tier
    from session_metrics
 )

 select * from final
    );
  
  
[0m15:57:33.306717 [debug] [Thread-1 (]: DuckDB adapter: Rolling back transaction.
[0m15:57:33.306926 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_session_quality: ROLLBACK
[0m15:57:33.309141 [debug] [Thread-1 (]: Failed to rollback 'model.quest_kingdom.rpt_session_quality'
[0m15:57:33.309314 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_session_quality: Close
[0m15:57:33.310467 [debug] [Thread-1 (]: Runtime Error in model rpt_session_quality (models/marts/product/rpt_session_quality.sql)
  Binder Error: Referenced column "had_progression" not found in FROM clause!
  Candidate bindings: "has_progression", "player_id", "session_duration_minutes", "player_segment", "is_quality_session"
  
  LINE 28:         count(case when had_progression then 1 end) as sessions_with_progression,
                                   ^
[0m15:57:33.310698 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c44c648e-6181-46e0-855c-355ab00f81d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10978c080>]}
[0m15:57:33.311124 [error] [Thread-1 (]: 3 of 4 ERROR creating sql table model main.rpt_session_quality ................. [[31mERROR[0m in 0.01s]
[0m15:57:33.311512 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.rpt_session_quality
[0m15:57:33.311697 [debug] [Thread-1 (]: Began running node model.quest_kingdom.rpt_level_funnel
[0m15:57:33.311917 [debug] [Thread-4 (]: Marking all children of 'model.quest_kingdom.rpt_session_quality' to be skipped because of status 'error'.  Reason: Runtime Error in model rpt_session_quality (models/marts/product/rpt_session_quality.sql)
  Binder Error: Referenced column "had_progression" not found in FROM clause!
  Candidate bindings: "has_progression", "player_id", "session_duration_minutes", "player_segment", "is_quality_session"
  
  LINE 28:         count(case when had_progression then 1 end) as sessions_with_progression,
                                   ^.
[0m15:57:33.312126 [info ] [Thread-1 (]: 4 of 4 SKIP relation main.rpt_level_funnel ..................................... [[33mSKIP[0m]
[0m15:57:33.312404 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.rpt_level_funnel
[0m15:57:33.313020 [debug] [MainThread]: Using duckdb connection "master"
[0m15:57:33.313330 [debug] [MainThread]: On master: BEGIN
[0m15:57:33.313507 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m15:57:33.313909 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m15:57:33.314237 [debug] [MainThread]: On master: COMMIT
[0m15:57:33.314385 [debug] [MainThread]: Using duckdb connection "master"
[0m15:57:33.314510 [debug] [MainThread]: On master: COMMIT
[0m15:57:33.314775 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m15:57:33.315407 [debug] [MainThread]: On master: Close
[0m15:57:33.315596 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:57:33.315742 [debug] [MainThread]: Connection 'model.quest_kingdom.rpt_session_quality' was properly closed.
[0m15:57:33.315908 [info ] [MainThread]: 
[0m15:57:33.316234 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 0.19 seconds (0.19s).
[0m15:57:33.316672 [debug] [MainThread]: Command end result
[0m15:57:33.344812 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/manifest.json
[0m15:57:33.345916 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/semantic_manifest.json
[0m15:57:33.348641 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/run_results.json
[0m15:57:33.348811 [info ] [MainThread]: 
[0m15:57:33.348990 [info ] [MainThread]: [31mCompleted with 2 errors, 0 partial successes, and 0 warnings:[0m
[0m15:57:33.349131 [info ] [MainThread]: 
[0m15:57:33.349305 [error] [MainThread]: [31mFailure in model rpt_level_progression (models/marts/product/rpt_level_progression.sql)[0m
[0m15:57:33.349685 [error] [MainThread]:   Runtime Error in model rpt_level_progression (models/marts/product/rpt_level_progression.sql)
  Binder Error: Values list "p" does not have a column named "player"
  
  LINE 104:     inner join players p on pl.player_id = p.player 
                                                       ^
[0m15:57:33.349817 [info ] [MainThread]: 
[0m15:57:33.349971 [info ] [MainThread]:   compiled code at target/compiled/quest_kingdom/models/marts/product/rpt_level_progression.sql
[0m15:57:33.350100 [info ] [MainThread]: 
[0m15:57:33.350254 [error] [MainThread]: [31mFailure in model rpt_session_quality (models/marts/product/rpt_session_quality.sql)[0m
[0m15:57:33.350470 [error] [MainThread]:   Runtime Error in model rpt_session_quality (models/marts/product/rpt_session_quality.sql)
  Binder Error: Referenced column "had_progression" not found in FROM clause!
  Candidate bindings: "has_progression", "player_id", "session_duration_minutes", "player_segment", "is_quality_session"
  
  LINE 28:         count(case when had_progression then 1 end) as sessions_with_progression,
                                   ^
[0m15:57:33.350600 [info ] [MainThread]: 
[0m15:57:33.350844 [info ] [MainThread]:   compiled code at target/compiled/quest_kingdom/models/marts/product/rpt_session_quality.sql
[0m15:57:33.350966 [info ] [MainThread]: 
[0m15:57:33.351108 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=2 SKIP=1 NO-OP=0 TOTAL=4
[0m15:57:33.352142 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.8787156, "process_in_blocks": "0", "process_kernel_time": 0.196826, "process_mem_max_rss": "171491328", "process_out_blocks": "0", "process_user_time": 1.314704}
[0m15:57:33.352430 [debug] [MainThread]: Command `dbt run` failed at 15:57:33.352387 after 0.88 seconds
[0m15:57:33.352676 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108ad17f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1093677d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10841a990>]}
[0m15:57:33.352854 [debug] [MainThread]: Flushing usage events
[0m15:57:33.461281 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m15:59:18.205472 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106186bd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1221b5ac0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1221b5880>]}


============================== 15:59:18.215737 | 92f5a6c8-887e-4053-afa9-c436e42bb9cd ==============================
[0m15:59:18.215737 [info ] [MainThread]: Running with dbt=1.11.4
[0m15:59:18.216072 [debug] [MainThread]: running dbt with arguments {'use_colors': 'True', 'target_path': 'None', 'printer_width': '80', 'write_json': 'True', 'debug': 'False', 'use_experimental_parser': 'False', 'send_anonymous_usage_stats': 'True', 'static_parser': 'True', 'warn_error': 'None', 'no_print': 'None', 'partial_parse': 'True', 'invocation_command': 'dbt run --select path:models/marts/product', 'profiles_dir': '/Users/hazeldonaldson/.dbt', 'log_path': '/Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/logs', 'indirect_selection': 'eager', 'log_format': 'default', 'quiet': 'False', 'log_cache_events': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'fail_fast': 'False', 'empty': 'False', 'cache_selected_only': 'False', 'version_check': 'True', 'introspect': 'True'}
[0m15:59:18.378269 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '92f5a6c8-887e-4053-afa9-c436e42bb9cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x122222240>]}
[0m15:59:18.405927 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '92f5a6c8-887e-4053-afa9-c436e42bb9cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106b5c740>]}
[0m15:59:18.407288 [info ] [MainThread]: Registered adapter: duckdb=1.10.0
[0m15:59:18.459320 [debug] [MainThread]: checksum: 092b177ba87eb6bb3c55954c38aa57900eebac336561eb9ee32218428aa81d43, vars: {}, profile: , target: , version: 1.11.4
[0m15:59:18.528331 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m15:59:18.528831 [debug] [MainThread]: Partial parsing: updated file: quest_kingdom://models/marts/product/rpt_session_quality.sql
[0m15:59:18.719448 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '92f5a6c8-887e-4053-afa9-c436e42bb9cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x122def950>]}
[0m15:59:18.797614 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/manifest.json
[0m15:59:18.799105 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/semantic_manifest.json
[0m15:59:18.813445 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '92f5a6c8-887e-4053-afa9-c436e42bb9cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x122d6ca10>]}
[0m15:59:18.813734 [info ] [MainThread]: Found 19 models, 48 data tests, 5 sources, 472 macros
[0m15:59:18.813910 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '92f5a6c8-887e-4053-afa9-c436e42bb9cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x122910da0>]}
[0m15:59:18.815888 [info ] [MainThread]: 
[0m15:59:18.816080 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:59:18.816228 [info ] [MainThread]: 
[0m15:59:18.816469 [debug] [MainThread]: Acquiring new duckdb connection 'master'
[0m15:59:18.818592 [debug] [ThreadPool]: Acquiring new duckdb connection 'list_quest_kingdom'
[0m15:59:18.847432 [debug] [ThreadPool]: Using duckdb connection "list_quest_kingdom"
[0m15:59:18.847674 [debug] [ThreadPool]: On list_quest_kingdom: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "list_quest_kingdom"} */

    
    select schema_name
    from system.information_schema.schemata
    
    where lower(catalog_name) = '"quest_kingdom"'
    
  
  
[0m15:59:18.847816 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:59:18.867148 [debug] [ThreadPool]: SQL status: OK in 0.019 seconds
[0m15:59:18.868269 [debug] [ThreadPool]: On list_quest_kingdom: Close
[0m15:59:18.868633 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_quest_kingdom, now create_quest_kingdom_main)
[0m15:59:18.868888 [debug] [ThreadPool]: Creating schema "database: "quest_kingdom"
schema: "main"
"
[0m15:59:18.873080 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m15:59:18.873364 [debug] [ThreadPool]: On create_quest_kingdom_main: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "create_quest_kingdom_main"} */

    
        select type from duckdb_databases()
        where lower(database_name)='quest_kingdom'
        and type='sqlite'
    
  
[0m15:59:18.873526 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:59:18.874709 [debug] [ThreadPool]: SQL status: OK in 0.001 seconds
[0m15:59:18.875530 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m15:59:18.875684 [debug] [ThreadPool]: On create_quest_kingdom_main: BEGIN
[0m15:59:18.875931 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m15:59:18.876068 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m15:59:18.876199 [debug] [ThreadPool]: On create_quest_kingdom_main: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "create_quest_kingdom_main"} */

    
    
        create schema if not exists "quest_kingdom"."main"
    
[0m15:59:18.876744 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m15:59:18.877189 [debug] [ThreadPool]: On create_quest_kingdom_main: COMMIT
[0m15:59:18.877331 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m15:59:18.877453 [debug] [ThreadPool]: On create_quest_kingdom_main: COMMIT
[0m15:59:18.877661 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m15:59:18.877796 [debug] [ThreadPool]: On create_quest_kingdom_main: Close
[0m15:59:18.879022 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_quest_kingdom_main, now list_quest_kingdom_main)
[0m15:59:18.881766 [debug] [ThreadPool]: Using duckdb connection "list_quest_kingdom_main"
[0m15:59:18.881926 [debug] [ThreadPool]: On list_quest_kingdom_main: BEGIN
[0m15:59:18.882111 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:59:18.882392 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m15:59:18.882521 [debug] [ThreadPool]: Using duckdb connection "list_quest_kingdom_main"
[0m15:59:18.882651 [debug] [ThreadPool]: On list_quest_kingdom_main: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "list_quest_kingdom_main"} */
select
      'quest_kingdom' as database,
      table_name as name,
      table_schema as schema,
      CASE table_type
        WHEN 'BASE TABLE' THEN 'table'
        WHEN 'VIEW' THEN 'view'
        WHEN 'LOCAL TEMPORARY' THEN 'table'
        END as type
    from system.information_schema.tables
    where lower(table_schema) = 'main'
    and lower(table_catalog) = 'quest_kingdom'
  
[0m15:59:18.892829 [debug] [ThreadPool]: SQL status: OK in 0.010 seconds
[0m15:59:18.893866 [debug] [ThreadPool]: On list_quest_kingdom_main: ROLLBACK
[0m15:59:18.894795 [debug] [ThreadPool]: Failed to rollback 'list_quest_kingdom_main'
[0m15:59:18.894957 [debug] [ThreadPool]: On list_quest_kingdom_main: Close
[0m15:59:18.896298 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '92f5a6c8-887e-4053-afa9-c436e42bb9cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x122d1db80>]}
[0m15:59:18.896546 [debug] [MainThread]: Using duckdb connection "master"
[0m15:59:18.896682 [debug] [MainThread]: On master: BEGIN
[0m15:59:18.896795 [debug] [MainThread]: Opening a new connection, currently in state init
[0m15:59:18.897067 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m15:59:18.897193 [debug] [MainThread]: On master: COMMIT
[0m15:59:18.897314 [debug] [MainThread]: Using duckdb connection "master"
[0m15:59:18.897434 [debug] [MainThread]: On master: COMMIT
[0m15:59:18.897619 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m15:59:18.897745 [debug] [MainThread]: On master: Close
[0m15:59:18.899045 [debug] [Thread-1 (]: Began running node model.quest_kingdom.rpt_feature_engagement
[0m15:59:18.899280 [info ] [Thread-1 (]: 1 of 4 START sql table model main.rpt_feature_engagement ....................... [RUN]
[0m15:59:18.899488 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_quest_kingdom_main, now model.quest_kingdom.rpt_feature_engagement)
[0m15:59:18.899652 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.rpt_feature_engagement
[0m15:59:18.903508 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.rpt_feature_engagement"
[0m15:59:18.904259 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.rpt_feature_engagement
[0m15:59:18.920572 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.rpt_feature_engagement"
[0m15:59:18.921545 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_feature_engagement"
[0m15:59:18.921713 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_feature_engagement: BEGIN
[0m15:59:18.921854 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:59:18.922194 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m15:59:18.922340 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_feature_engagement"
[0m15:59:18.922536 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_feature_engagement: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_feature_engagement"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_feature_engagement__dbt_tmp"
  
    as (
      

with events as (
    select * from "quest_kingdom"."main"."stg_events"
),

players as (
    select * from "quest_kingdom"."main"."dim_players"
),

--aggregate events per player
player_events as (
    select 
        player_id,

        --event counts
        count(*) as total_events,
        count(distinct event_name) as unique_event_types,

        --specific events
        sum(case when event_name = 'tutorial_completed' then 1 else 0 end) as tutorial_completions,
        sum(case when event_name = 'level_completed' then 1 else 0 end) as level_completions,
        sum(case when event_name = 'boss_defeated' then 1 else 0 end) as boss_defeats,

        --timing
        min(event_at) as first_event_at,
        max(event_at) as last_event_at
    from events 
    group by player_id 

),

--combine with player data
final as (
    select 
        p.player_id,
        p.installed_at,
        p.cohort_week,
        p.attribution_channel,
        p.player_segment,
        p.experiment_variant,
        p.is_payer,

        --events
        coalesce(pe.total_events, 0) as total_events,
        coalesce(pe.unique_event_types, 0) as unique_event_types,
        coalesce(pe.tutorial_completions, 0) as tutorial_completions,
        coalesce(pe.boss_defeats, 0) as boss_defeats,

        --derived
        case 
            when pe.tutorial_completions > 0 then true 
            else false 
        end as completed_tutorial,

        case
            when pe.boss_defeats > 0 then true
            else false 
        end defeated_boss,

        --events per session (if they have sessions)
        case
            when p.total_sessions > 0 
            then coalesce(pe.total_events, 0)::float / p.total_sessions
            else 0
        end events_per_session,

        --engagement level based on events
        case 
            when coalesce(pe.total_events, 0) >= 50 then 'Power User (50+)'
            when coalesce(pe.total_events, 0) >= 20 then 'Engaged (20-49)'
            when coalesce(pe.total_events, 0) >= 5 then 'Active (5-19)'
            when coalesce(pe.total_events, 0) >= 1 then 'Casual (1-4)'
            else 'No Events'
        end as event_engagement_tier
    from players p 
    left join player_events pe on p.player_id = pe.player_id 
 )

 
 select * from final
    );
  
  
[0m15:59:18.942046 [debug] [Thread-1 (]: SQL status: OK in 0.019 seconds
[0m15:59:18.944849 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_feature_engagement"
[0m15:59:18.945045 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_feature_engagement: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_feature_engagement"} */

    SELECT index_name
    FROM duckdb_indexes()
    WHERE schema_name = 'main'
      AND table_name = 'rpt_feature_engagement'
  
[0m15:59:18.945564 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m15:59:18.946172 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_feature_engagement"
[0m15:59:18.946335 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_feature_engagement: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_feature_engagement"} */

    SELECT COUNT(*) as remaining_indexes
    FROM duckdb_indexes()
    WHERE schema_name = 'main'
      AND table_name = 'rpt_feature_engagement'
  
[0m15:59:18.947080 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m15:59:18.950165 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_feature_engagement"
[0m15:59:18.950350 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_feature_engagement: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_feature_engagement"} */
alter table "quest_kingdom"."main"."rpt_feature_engagement" rename to "rpt_feature_engagement__dbt_backup"
[0m15:59:18.951142 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m15:59:18.952486 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_feature_engagement"
[0m15:59:18.952646 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_feature_engagement: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_feature_engagement"} */
alter table "quest_kingdom"."main"."rpt_feature_engagement__dbt_tmp" rename to "rpt_feature_engagement"
[0m15:59:18.952928 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m15:59:18.960221 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_feature_engagement: COMMIT
[0m15:59:18.960476 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_feature_engagement"
[0m15:59:18.960631 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_feature_engagement: COMMIT
[0m15:59:18.963484 [debug] [Thread-1 (]: SQL status: OK in 0.003 seconds
[0m15:59:18.966213 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_feature_engagement"
[0m15:59:18.966395 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_feature_engagement: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_feature_engagement"} */

      drop table if exists "quest_kingdom"."main"."rpt_feature_engagement__dbt_backup" cascade
    
[0m15:59:18.967161 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m15:59:18.968371 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_feature_engagement: Close
[0m15:59:18.969370 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '92f5a6c8-887e-4053-afa9-c436e42bb9cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12490d0d0>]}
[0m15:59:18.969680 [info ] [Thread-1 (]: 1 of 4 OK created sql table model main.rpt_feature_engagement .................. [[32mOK[0m in 0.07s]
[0m15:59:18.969947 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.rpt_feature_engagement
[0m15:59:18.970142 [debug] [Thread-1 (]: Began running node model.quest_kingdom.rpt_level_progression
[0m15:59:18.970382 [info ] [Thread-1 (]: 2 of 4 START sql table model main.rpt_level_progression ........................ [RUN]
[0m15:59:18.970583 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.quest_kingdom.rpt_feature_engagement, now model.quest_kingdom.rpt_level_progression)
[0m15:59:18.970747 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.rpt_level_progression
[0m15:59:18.972495 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.rpt_level_progression"
[0m15:59:18.973143 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.rpt_level_progression
[0m15:59:18.974775 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.rpt_level_progression"
[0m15:59:18.975437 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_level_progression"
[0m15:59:18.975612 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_level_progression: BEGIN
[0m15:59:18.975761 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:59:18.976102 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m15:59:18.976262 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_level_progression"
[0m15:59:18.976503 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_level_progression: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_level_progression"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_level_progression__dbt_tmp"
  
    as (
      

with sessions as (
    select * from "quest_kingdom"."main"."fct_sessions"
),

players as (
    select * from "quest_kingdom"."main"."dim_players"
),

--track level progression per player
player_levels as (
    select 
        player_id,
        min(session_started_at) as first_session_at,
        max(ending_level) as max_level_reached,
        sum(levels_gained) as total_levels_gained,

        --time to reach certain milestones
        min(case when ending_level >= 5 then session_started_at end) as reached_level_5_at,
        min(case when ending_level >= 10 then session_started_at end) as reached_level_10_at,
        min(case when ending_level >= 20 then session_started_at end) as reached_level_20_at,
        min(case when ending_level >= 30 then session_started_at end) as reached_level_30_at,
        min(case when ending_level >= 40 then session_started_at end) as reached_level_40_at,
        min(case when ending_level >= 50 then session_started_at end) as reached_level_50_at,

        --progression metrics
        count(*) as total_sessions,
        sum(session_duration_minutes) as total_play_time,
        avg(session_duration_minutes) as avg_session_duration
    from sessions 
    group by player_id 
),

--combine with player attributes
final as (
    select 
        pl.player_id,
        p.installed_at,
        p.cohort_week,
        p.attribution_channel,
        p.player_segment,
        p.experiment_variant,
        p.is_payer,

        --progression
        pl.max_level_reached,
        pl.total_levels_gained,

        --milestones
        pl.reached_level_5_at,
        pl.reached_level_10_at,
        pl.reached_level_20_at,
        pl.reached_level_30_at,
        pl.reached_level_40_at,
        pl.reached_level_50_at,

        --time to milestones (in hours)
        case 
            when pl.reached_level_5_at is not null 
            then datediff('hour', pl.first_session_at, pl.reached_level_5_at)
        end as hours_to_level_5,
        case 
            when pl.reached_level_10_at is not null 
            then datediff('hour', pl.first_session_at, pl.reached_level_10_at)
        end as hours_to_level_10,
        case 
            when pl.reached_level_20_at is not null 
            then datediff('hour', pl.first_session_at, pl.reached_level_20_at)
        end as hours_to_level_20,
       
       --engagement
       pl.total_sessions,
       pl.total_play_time,
       pl.avg_session_duration,

       --progression velocity (levels per hour player)
       case 
            when pl.total_play_time > 0 
            then pl.total_levels_gained::float / (pl.total_player / 60)
            else 0
        end as levels_per_hour,

        --progression tiers
        case 
            when pl.max_level_reached >= 40 then 'End Game (40+)'
            when pl.max_level_reached >= 30 then 'Late Game (30-39)'
            when pl.max_level_reached >= 20 then 'Mid Game (20-29)'
            when pl.max_level_reached >= 10 then 'Early Game (10-19)'
            when pl.max_level_reached >= 5 then 'Tutorial+ (5-9)'
            else 'Tutorial (1-4)'
        end as progression_tier 
    from player_levels pl 
    inner join players p on pl.player_id = p.player 
)

select * from final
    );
  
  
[0m15:59:18.980760 [debug] [Thread-1 (]: DuckDB adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_level_progression"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_level_progression__dbt_tmp"
  
    as (
      

with sessions as (
    select * from "quest_kingdom"."main"."fct_sessions"
),

players as (
    select * from "quest_kingdom"."main"."dim_players"
),

--track level progression per player
player_levels as (
    select 
        player_id,
        min(session_started_at) as first_session_at,
        max(ending_level) as max_level_reached,
        sum(levels_gained) as total_levels_gained,

        --time to reach certain milestones
        min(case when ending_level >= 5 then session_started_at end) as reached_level_5_at,
        min(case when ending_level >= 10 then session_started_at end) as reached_level_10_at,
        min(case when ending_level >= 20 then session_started_at end) as reached_level_20_at,
        min(case when ending_level >= 30 then session_started_at end) as reached_level_30_at,
        min(case when ending_level >= 40 then session_started_at end) as reached_level_40_at,
        min(case when ending_level >= 50 then session_started_at end) as reached_level_50_at,

        --progression metrics
        count(*) as total_sessions,
        sum(session_duration_minutes) as total_play_time,
        avg(session_duration_minutes) as avg_session_duration
    from sessions 
    group by player_id 
),

--combine with player attributes
final as (
    select 
        pl.player_id,
        p.installed_at,
        p.cohort_week,
        p.attribution_channel,
        p.player_segment,
        p.experiment_variant,
        p.is_payer,

        --progression
        pl.max_level_reached,
        pl.total_levels_gained,

        --milestones
        pl.reached_level_5_at,
        pl.reached_level_10_at,
        pl.reached_level_20_at,
        pl.reached_level_30_at,
        pl.reached_level_40_at,
        pl.reached_level_50_at,

        --time to milestones (in hours)
        case 
            when pl.reached_level_5_at is not null 
            then datediff('hour', pl.first_session_at, pl.reached_level_5_at)
        end as hours_to_level_5,
        case 
            when pl.reached_level_10_at is not null 
            then datediff('hour', pl.first_session_at, pl.reached_level_10_at)
        end as hours_to_level_10,
        case 
            when pl.reached_level_20_at is not null 
            then datediff('hour', pl.first_session_at, pl.reached_level_20_at)
        end as hours_to_level_20,
       
       --engagement
       pl.total_sessions,
       pl.total_play_time,
       pl.avg_session_duration,

       --progression velocity (levels per hour player)
       case 
            when pl.total_play_time > 0 
            then pl.total_levels_gained::float / (pl.total_player / 60)
            else 0
        end as levels_per_hour,

        --progression tiers
        case 
            when pl.max_level_reached >= 40 then 'End Game (40+)'
            when pl.max_level_reached >= 30 then 'Late Game (30-39)'
            when pl.max_level_reached >= 20 then 'Mid Game (20-29)'
            when pl.max_level_reached >= 10 then 'Early Game (10-19)'
            when pl.max_level_reached >= 5 then 'Tutorial+ (5-9)'
            else 'Tutorial (1-4)'
        end as progression_tier 
    from player_levels pl 
    inner join players p on pl.player_id = p.player 
)

select * from final
    );
  
  
[0m15:59:18.981079 [debug] [Thread-1 (]: DuckDB adapter: Rolling back transaction.
[0m15:59:18.981301 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_level_progression: ROLLBACK
[0m15:59:18.985673 [debug] [Thread-1 (]: Failed to rollback 'model.quest_kingdom.rpt_level_progression'
[0m15:59:18.985856 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_level_progression: Close
[0m15:59:18.987006 [debug] [Thread-1 (]: Runtime Error in model rpt_level_progression (models/marts/product/rpt_level_progression.sql)
  Binder Error: Values list "p" does not have a column named "player"
  
  LINE 104:     inner join players p on pl.player_id = p.player 
                                                       ^
[0m15:59:18.987240 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '92f5a6c8-887e-4053-afa9-c436e42bb9cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1249e8d70>]}
[0m15:59:18.987530 [error] [Thread-1 (]: 2 of 4 ERROR creating sql table model main.rpt_level_progression ............... [[31mERROR[0m in 0.02s]
[0m15:59:18.987784 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.rpt_level_progression
[0m15:59:18.987964 [debug] [Thread-1 (]: Began running node model.quest_kingdom.rpt_session_quality
[0m15:59:18.988192 [debug] [Thread-4 (]: Marking all children of 'model.quest_kingdom.rpt_level_progression' to be skipped because of status 'error'.  Reason: Runtime Error in model rpt_level_progression (models/marts/product/rpt_level_progression.sql)
  Binder Error: Values list "p" does not have a column named "player"
  
  LINE 104:     inner join players p on pl.player_id = p.player 
                                                       ^.
[0m15:59:18.988413 [info ] [Thread-1 (]: 3 of 4 START sql table model main.rpt_session_quality .......................... [RUN]
[0m15:59:18.989031 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.quest_kingdom.rpt_level_progression, now model.quest_kingdom.rpt_session_quality)
[0m15:59:18.989216 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.rpt_session_quality
[0m15:59:18.990910 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.rpt_session_quality"
[0m15:59:18.991610 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.rpt_session_quality
[0m15:59:18.993263 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.rpt_session_quality"
[0m15:59:18.994532 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_session_quality"
[0m15:59:18.994710 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_session_quality: BEGIN
[0m15:59:18.994855 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:59:18.995258 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m15:59:18.995415 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_session_quality"
[0m15:59:18.995673 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_session_quality: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_session_quality"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_session_quality__dbt_tmp"
  
    as (
      

with sessions as (
    select * from "quest_kingdom"."main"."fct_sessions"
),

--aggregate sesion metrics
session_metrics as (
    select
        player_id,
        attribution_channel,
        player_segment,
        experiment_variant,

        --session counts
        count(*) as total_sessions,
        count(case when is_quality_session then 1 end) as quality_sessions,
        count(case when has_progression then 1 end) as sessions_with_progression,

        --duration metrics
        avg(session_duration_minutes) as avg_session_duration,
        sum(session_duration_minutes) as total_play_time,
        max(session_duration_minutes) as longest_session,

        --progression metrics
        sum(levels_gained) as total_levels_gained,
        avg(levels_gained) as avg_levels_per_session,

        --time of day patterns
        count(case when time_of_day = 'morning' then 1 end) as morning_sessions,
        count(case when time_of_day = 'afternoon' then 1 end) as afternoon_session,
        count(case when time_of_day = 'evening' then 1 end) as evening_sessions,
        count(case when time_of_day = 'night' then 1 end) as night_sessions,

        --weekend vs weekday
        count(case when is_weekend then 1 end) as weekend_sessions,
        count(case when not is_weekedn then 1 end) as weekday_sessions,

        --session spacings (days btwn sessions)
        avg(datediff('day',
            lag(session_started_at) over (partition by player_id order by session_started_at),
            session_started_at)) as avg_days_between_sessions
    from sessions 
    group by player_id, attribution_channel, player_segment, experiment_variant
),

--adding derived metrics
 final as (
    select 
        *,

        --quality rates
        round(quality_sessions::float / total_sessions * 100, 1) as quality_session_pct,
        round(sessions_with_progression::float / total_sessions * 100, 1) as progression_session_pct,

        --engagement patterns
        round(weekend_sessions::float / total_sessions * 100, 1) as weekend_session_pct,

        --preferred time of day
        case 
            when evening_sessions > morning_sessions
                and evening_sessions > afternoon_sessions
                and evening_sessions > night_sessions
            then 'Evening'
            when morning_sessions > afternoon_sessions
                and morning_sessions > night_sessions
            then 'Morning'
            when afternoon_session > night_sessions then 'Afternoon'
            else 'Night'
        end preferred_play_time,

        --engagement tier
        case
            when total_sessions >= 20 then 'Power User (20+)'
            when total_sessions >= 10 then 'Engaged (10-19)'
            when total_sessions >= 5 then 'Regular (5-9)'
            else 'Casual (1-4)'
        end as engagement_tier
    from session_metrics
 )

 select * from final
    );
  
  
[0m15:59:18.997014 [debug] [Thread-1 (]: DuckDB adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_session_quality"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_session_quality__dbt_tmp"
  
    as (
      

with sessions as (
    select * from "quest_kingdom"."main"."fct_sessions"
),

--aggregate sesion metrics
session_metrics as (
    select
        player_id,
        attribution_channel,
        player_segment,
        experiment_variant,

        --session counts
        count(*) as total_sessions,
        count(case when is_quality_session then 1 end) as quality_sessions,
        count(case when has_progression then 1 end) as sessions_with_progression,

        --duration metrics
        avg(session_duration_minutes) as avg_session_duration,
        sum(session_duration_minutes) as total_play_time,
        max(session_duration_minutes) as longest_session,

        --progression metrics
        sum(levels_gained) as total_levels_gained,
        avg(levels_gained) as avg_levels_per_session,

        --time of day patterns
        count(case when time_of_day = 'morning' then 1 end) as morning_sessions,
        count(case when time_of_day = 'afternoon' then 1 end) as afternoon_session,
        count(case when time_of_day = 'evening' then 1 end) as evening_sessions,
        count(case when time_of_day = 'night' then 1 end) as night_sessions,

        --weekend vs weekday
        count(case when is_weekend then 1 end) as weekend_sessions,
        count(case when not is_weekedn then 1 end) as weekday_sessions,

        --session spacings (days btwn sessions)
        avg(datediff('day',
            lag(session_started_at) over (partition by player_id order by session_started_at),
            session_started_at)) as avg_days_between_sessions
    from sessions 
    group by player_id, attribution_channel, player_segment, experiment_variant
),

--adding derived metrics
 final as (
    select 
        *,

        --quality rates
        round(quality_sessions::float / total_sessions * 100, 1) as quality_session_pct,
        round(sessions_with_progression::float / total_sessions * 100, 1) as progression_session_pct,

        --engagement patterns
        round(weekend_sessions::float / total_sessions * 100, 1) as weekend_session_pct,

        --preferred time of day
        case 
            when evening_sessions > morning_sessions
                and evening_sessions > afternoon_sessions
                and evening_sessions > night_sessions
            then 'Evening'
            when morning_sessions > afternoon_sessions
                and morning_sessions > night_sessions
            then 'Morning'
            when afternoon_session > night_sessions then 'Afternoon'
            else 'Night'
        end preferred_play_time,

        --engagement tier
        case
            when total_sessions >= 20 then 'Power User (20+)'
            when total_sessions >= 10 then 'Engaged (10-19)'
            when total_sessions >= 5 then 'Regular (5-9)'
            else 'Casual (1-4)'
        end as engagement_tier
    from session_metrics
 )

 select * from final
    );
  
  
[0m15:59:18.997421 [debug] [Thread-1 (]: DuckDB adapter: Rolling back transaction.
[0m15:59:18.997818 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_session_quality: ROLLBACK
[0m15:59:18.999279 [debug] [Thread-1 (]: Failed to rollback 'model.quest_kingdom.rpt_session_quality'
[0m15:59:18.999555 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_session_quality: Close
[0m15:59:19.000751 [debug] [Thread-1 (]: Runtime Error in model rpt_session_quality (models/marts/product/rpt_session_quality.sql)
  Binder Error: Referenced column "is_weekedn" not found in FROM clause!
  Candidate bindings: "is_weekend", "session_ended_at", "player_segment", "session_date", "levels_gained"
  
  LINE 47:         count(case when not is_weekedn then 1 end) as weekday_sessions,
                                       ^
[0m15:59:19.000990 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '92f5a6c8-887e-4053-afa9-c436e42bb9cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x124e70620>]}
[0m15:59:19.001478 [error] [Thread-1 (]: 3 of 4 ERROR creating sql table model main.rpt_session_quality ................. [[31mERROR[0m in 0.01s]
[0m15:59:19.001736 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.rpt_session_quality
[0m15:59:19.001912 [debug] [Thread-1 (]: Began running node model.quest_kingdom.rpt_level_funnel
[0m15:59:19.002139 [debug] [Thread-4 (]: Marking all children of 'model.quest_kingdom.rpt_session_quality' to be skipped because of status 'error'.  Reason: Runtime Error in model rpt_session_quality (models/marts/product/rpt_session_quality.sql)
  Binder Error: Referenced column "is_weekedn" not found in FROM clause!
  Candidate bindings: "is_weekend", "session_ended_at", "player_segment", "session_date", "levels_gained"
  
  LINE 47:         count(case when not is_weekedn then 1 end) as weekday_sessions,
                                       ^.
[0m15:59:19.002326 [info ] [Thread-1 (]: 4 of 4 SKIP relation main.rpt_level_funnel ..................................... [[33mSKIP[0m]
[0m15:59:19.002561 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.rpt_level_funnel
[0m15:59:19.003083 [debug] [MainThread]: Using duckdb connection "master"
[0m15:59:19.003234 [debug] [MainThread]: On master: BEGIN
[0m15:59:19.003354 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m15:59:19.003698 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m15:59:19.003836 [debug] [MainThread]: On master: COMMIT
[0m15:59:19.003961 [debug] [MainThread]: Using duckdb connection "master"
[0m15:59:19.004071 [debug] [MainThread]: On master: COMMIT
[0m15:59:19.004270 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m15:59:19.004398 [debug] [MainThread]: On master: Close
[0m15:59:19.004561 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:59:19.004678 [debug] [MainThread]: Connection 'model.quest_kingdom.rpt_session_quality' was properly closed.
[0m15:59:19.004825 [info ] [MainThread]: 
[0m15:59:19.004959 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 0.19 seconds (0.19s).
[0m15:59:19.005376 [debug] [MainThread]: Command end result
[0m15:59:19.024568 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/manifest.json
[0m15:59:19.028818 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/semantic_manifest.json
[0m15:59:19.031921 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/run_results.json
[0m15:59:19.032092 [info ] [MainThread]: 
[0m15:59:19.032270 [info ] [MainThread]: [31mCompleted with 2 errors, 0 partial successes, and 0 warnings:[0m
[0m15:59:19.032414 [info ] [MainThread]: 
[0m15:59:19.032595 [error] [MainThread]: [31mFailure in model rpt_level_progression (models/marts/product/rpt_level_progression.sql)[0m
[0m15:59:19.032764 [error] [MainThread]:   Runtime Error in model rpt_level_progression (models/marts/product/rpt_level_progression.sql)
  Binder Error: Values list "p" does not have a column named "player"
  
  LINE 104:     inner join players p on pl.player_id = p.player 
                                                       ^
[0m15:59:19.032897 [info ] [MainThread]: 
[0m15:59:19.033050 [info ] [MainThread]:   compiled code at target/compiled/quest_kingdom/models/marts/product/rpt_level_progression.sql
[0m15:59:19.033180 [info ] [MainThread]: 
[0m15:59:19.033331 [error] [MainThread]: [31mFailure in model rpt_session_quality (models/marts/product/rpt_session_quality.sql)[0m
[0m15:59:19.033491 [error] [MainThread]:   Runtime Error in model rpt_session_quality (models/marts/product/rpt_session_quality.sql)
  Binder Error: Referenced column "is_weekedn" not found in FROM clause!
  Candidate bindings: "is_weekend", "session_ended_at", "player_segment", "session_date", "levels_gained"
  
  LINE 47:         count(case when not is_weekedn then 1 end) as weekday_sessions,
                                       ^
[0m15:59:19.033619 [info ] [MainThread]: 
[0m15:59:19.033763 [info ] [MainThread]:   compiled code at target/compiled/quest_kingdom/models/marts/product/rpt_session_quality.sql
[0m15:59:19.033884 [info ] [MainThread]: 
[0m15:59:19.034026 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=2 SKIP=1 NO-OP=0 TOTAL=4
[0m15:59:19.035468 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.8718277, "process_in_blocks": "0", "process_kernel_time": 0.205621, "process_mem_max_rss": "168230912", "process_out_blocks": "0", "process_user_time": 1.297447}
[0m15:59:19.035681 [debug] [MainThread]: Command `dbt run` failed at 15:59:19.035642 after 0.87 seconds
[0m15:59:19.035860 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1221b5160>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1221b58e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1221b5880>]}
[0m15:59:19.036024 [debug] [MainThread]: Flushing usage events
[0m15:59:19.139751 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m15:59:55.121409 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10436a7e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106de5a00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106de56d0>]}


============================== 15:59:55.131460 | 4585bc6f-5cf5-4c35-b5f4-1f2f122bb8d8 ==============================
[0m15:59:55.131460 [info ] [MainThread]: Running with dbt=1.11.4
[0m15:59:55.131807 [debug] [MainThread]: running dbt with arguments {'warn_error': 'None', 'use_colors': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'profiles_dir': '/Users/hazeldonaldson/.dbt', 'no_print': 'None', 'invocation_command': 'dbt run --select path:models/marts/product', 'log_path': '/Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/logs', 'target_path': 'None', 'printer_width': '80', 'use_experimental_parser': 'False', 'partial_parse': 'True', 'write_json': 'True', 'fail_fast': 'False', 'quiet': 'False', 'indirect_selection': 'eager', 'version_check': 'True', 'debug': 'False', 'empty': 'False', 'introspect': 'True', 'send_anonymous_usage_stats': 'True', 'log_format': 'default', 'static_parser': 'True', 'log_cache_events': 'False', 'cache_selected_only': 'False'}
[0m15:59:55.294782 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '4585bc6f-5cf5-4c35-b5f4-1f2f122bb8d8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106de7d10>]}
[0m15:59:55.323117 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '4585bc6f-5cf5-4c35-b5f4-1f2f122bb8d8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1067a3f20>]}
[0m15:59:55.324526 [info ] [MainThread]: Registered adapter: duckdb=1.10.0
[0m15:59:55.376439 [debug] [MainThread]: checksum: 092b177ba87eb6bb3c55954c38aa57900eebac336561eb9ee32218428aa81d43, vars: {}, profile: , target: , version: 1.11.4
[0m15:59:55.447361 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m15:59:55.447843 [debug] [MainThread]: Partial parsing: updated file: quest_kingdom://models/marts/product/rpt_session_quality.sql
[0m15:59:55.638401 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '4585bc6f-5cf5-4c35-b5f4-1f2f122bb8d8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1088efb00>]}
[0m15:59:55.715472 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/manifest.json
[0m15:59:55.716990 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/semantic_manifest.json
[0m15:59:55.731718 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '4585bc6f-5cf5-4c35-b5f4-1f2f122bb8d8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10759b170>]}
[0m15:59:55.732005 [info ] [MainThread]: Found 19 models, 48 data tests, 5 sources, 472 macros
[0m15:59:55.732190 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4585bc6f-5cf5-4c35-b5f4-1f2f122bb8d8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10756fc50>]}
[0m15:59:55.734171 [info ] [MainThread]: 
[0m15:59:55.734355 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:59:55.734498 [info ] [MainThread]: 
[0m15:59:55.734726 [debug] [MainThread]: Acquiring new duckdb connection 'master'
[0m15:59:55.736874 [debug] [ThreadPool]: Acquiring new duckdb connection 'list_quest_kingdom'
[0m15:59:55.765822 [debug] [ThreadPool]: Using duckdb connection "list_quest_kingdom"
[0m15:59:55.766062 [debug] [ThreadPool]: On list_quest_kingdom: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "list_quest_kingdom"} */

    
    select schema_name
    from system.information_schema.schemata
    
    where lower(catalog_name) = '"quest_kingdom"'
    
  
  
[0m15:59:55.766279 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:59:55.784477 [debug] [ThreadPool]: SQL status: OK in 0.018 seconds
[0m15:59:55.785252 [debug] [ThreadPool]: On list_quest_kingdom: Close
[0m15:59:55.785602 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_quest_kingdom, now create_quest_kingdom_main)
[0m15:59:55.785843 [debug] [ThreadPool]: Creating schema "database: "quest_kingdom"
schema: "main"
"
[0m15:59:55.789252 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m15:59:55.789455 [debug] [ThreadPool]: On create_quest_kingdom_main: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "create_quest_kingdom_main"} */

    
        select type from duckdb_databases()
        where lower(database_name)='quest_kingdom'
        and type='sqlite'
    
  
[0m15:59:55.789601 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:59:55.790435 [debug] [ThreadPool]: SQL status: OK in 0.001 seconds
[0m15:59:55.791053 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m15:59:55.791195 [debug] [ThreadPool]: On create_quest_kingdom_main: BEGIN
[0m15:59:55.791416 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m15:59:55.791539 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m15:59:55.791663 [debug] [ThreadPool]: On create_quest_kingdom_main: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "create_quest_kingdom_main"} */

    
    
        create schema if not exists "quest_kingdom"."main"
    
[0m15:59:55.792142 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m15:59:55.792594 [debug] [ThreadPool]: On create_quest_kingdom_main: COMMIT
[0m15:59:55.792741 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m15:59:55.792869 [debug] [ThreadPool]: On create_quest_kingdom_main: COMMIT
[0m15:59:55.793090 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m15:59:55.793226 [debug] [ThreadPool]: On create_quest_kingdom_main: Close
[0m15:59:55.794159 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_quest_kingdom_main, now list_quest_kingdom_main)
[0m15:59:55.796909 [debug] [ThreadPool]: Using duckdb connection "list_quest_kingdom_main"
[0m15:59:55.797070 [debug] [ThreadPool]: On list_quest_kingdom_main: BEGIN
[0m15:59:55.797247 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:59:55.797494 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m15:59:55.797622 [debug] [ThreadPool]: Using duckdb connection "list_quest_kingdom_main"
[0m15:59:55.797753 [debug] [ThreadPool]: On list_quest_kingdom_main: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "list_quest_kingdom_main"} */
select
      'quest_kingdom' as database,
      table_name as name,
      table_schema as schema,
      CASE table_type
        WHEN 'BASE TABLE' THEN 'table'
        WHEN 'VIEW' THEN 'view'
        WHEN 'LOCAL TEMPORARY' THEN 'table'
        END as type
    from system.information_schema.tables
    where lower(table_schema) = 'main'
    and lower(table_catalog) = 'quest_kingdom'
  
[0m15:59:55.808310 [debug] [ThreadPool]: SQL status: OK in 0.010 seconds
[0m15:59:55.809127 [debug] [ThreadPool]: On list_quest_kingdom_main: ROLLBACK
[0m15:59:55.810098 [debug] [ThreadPool]: Failed to rollback 'list_quest_kingdom_main'
[0m15:59:55.810257 [debug] [ThreadPool]: On list_quest_kingdom_main: Close
[0m15:59:55.811558 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4585bc6f-5cf5-4c35-b5f4-1f2f122bb8d8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1089db950>]}
[0m15:59:55.811806 [debug] [MainThread]: Using duckdb connection "master"
[0m15:59:55.811946 [debug] [MainThread]: On master: BEGIN
[0m15:59:55.812069 [debug] [MainThread]: Opening a new connection, currently in state init
[0m15:59:55.812352 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m15:59:55.812487 [debug] [MainThread]: On master: COMMIT
[0m15:59:55.812615 [debug] [MainThread]: Using duckdb connection "master"
[0m15:59:55.812730 [debug] [MainThread]: On master: COMMIT
[0m15:59:55.812922 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m15:59:55.813046 [debug] [MainThread]: On master: Close
[0m15:59:55.814316 [debug] [Thread-1 (]: Began running node model.quest_kingdom.rpt_feature_engagement
[0m15:59:55.814555 [info ] [Thread-1 (]: 1 of 4 START sql table model main.rpt_feature_engagement ....................... [RUN]
[0m15:59:55.814754 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_quest_kingdom_main, now model.quest_kingdom.rpt_feature_engagement)
[0m15:59:55.814918 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.rpt_feature_engagement
[0m15:59:55.818748 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.rpt_feature_engagement"
[0m15:59:55.819385 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.rpt_feature_engagement
[0m15:59:55.835764 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.rpt_feature_engagement"
[0m15:59:55.836824 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_feature_engagement"
[0m15:59:55.836997 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_feature_engagement: BEGIN
[0m15:59:55.837149 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:59:55.837503 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m15:59:55.837647 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_feature_engagement"
[0m15:59:55.837842 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_feature_engagement: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_feature_engagement"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_feature_engagement__dbt_tmp"
  
    as (
      

with events as (
    select * from "quest_kingdom"."main"."stg_events"
),

players as (
    select * from "quest_kingdom"."main"."dim_players"
),

--aggregate events per player
player_events as (
    select 
        player_id,

        --event counts
        count(*) as total_events,
        count(distinct event_name) as unique_event_types,

        --specific events
        sum(case when event_name = 'tutorial_completed' then 1 else 0 end) as tutorial_completions,
        sum(case when event_name = 'level_completed' then 1 else 0 end) as level_completions,
        sum(case when event_name = 'boss_defeated' then 1 else 0 end) as boss_defeats,

        --timing
        min(event_at) as first_event_at,
        max(event_at) as last_event_at
    from events 
    group by player_id 

),

--combine with player data
final as (
    select 
        p.player_id,
        p.installed_at,
        p.cohort_week,
        p.attribution_channel,
        p.player_segment,
        p.experiment_variant,
        p.is_payer,

        --events
        coalesce(pe.total_events, 0) as total_events,
        coalesce(pe.unique_event_types, 0) as unique_event_types,
        coalesce(pe.tutorial_completions, 0) as tutorial_completions,
        coalesce(pe.boss_defeats, 0) as boss_defeats,

        --derived
        case 
            when pe.tutorial_completions > 0 then true 
            else false 
        end as completed_tutorial,

        case
            when pe.boss_defeats > 0 then true
            else false 
        end defeated_boss,

        --events per session (if they have sessions)
        case
            when p.total_sessions > 0 
            then coalesce(pe.total_events, 0)::float / p.total_sessions
            else 0
        end events_per_session,

        --engagement level based on events
        case 
            when coalesce(pe.total_events, 0) >= 50 then 'Power User (50+)'
            when coalesce(pe.total_events, 0) >= 20 then 'Engaged (20-49)'
            when coalesce(pe.total_events, 0) >= 5 then 'Active (5-19)'
            when coalesce(pe.total_events, 0) >= 1 then 'Casual (1-4)'
            else 'No Events'
        end as event_engagement_tier
    from players p 
    left join player_events pe on p.player_id = pe.player_id 
 )

 
 select * from final
    );
  
  
[0m15:59:55.857927 [debug] [Thread-1 (]: SQL status: OK in 0.020 seconds
[0m15:59:55.860896 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_feature_engagement"
[0m15:59:55.861096 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_feature_engagement: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_feature_engagement"} */

    SELECT index_name
    FROM duckdb_indexes()
    WHERE schema_name = 'main'
      AND table_name = 'rpt_feature_engagement'
  
[0m15:59:55.861616 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m15:59:55.862259 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_feature_engagement"
[0m15:59:55.862436 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_feature_engagement: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_feature_engagement"} */

    SELECT COUNT(*) as remaining_indexes
    FROM duckdb_indexes()
    WHERE schema_name = 'main'
      AND table_name = 'rpt_feature_engagement'
  
[0m15:59:55.863706 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m15:59:55.866801 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_feature_engagement"
[0m15:59:55.866989 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_feature_engagement: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_feature_engagement"} */
alter table "quest_kingdom"."main"."rpt_feature_engagement" rename to "rpt_feature_engagement__dbt_backup"
[0m15:59:55.867792 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m15:59:55.869135 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_feature_engagement"
[0m15:59:55.869310 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_feature_engagement: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_feature_engagement"} */
alter table "quest_kingdom"."main"."rpt_feature_engagement__dbt_tmp" rename to "rpt_feature_engagement"
[0m15:59:55.869603 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m15:59:55.877062 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_feature_engagement: COMMIT
[0m15:59:55.877322 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_feature_engagement"
[0m15:59:55.877487 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_feature_engagement: COMMIT
[0m15:59:55.881226 [debug] [Thread-1 (]: SQL status: OK in 0.004 seconds
[0m15:59:55.884118 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_feature_engagement"
[0m15:59:55.884317 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_feature_engagement: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_feature_engagement"} */

      drop table if exists "quest_kingdom"."main"."rpt_feature_engagement__dbt_backup" cascade
    
[0m15:59:55.885110 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m15:59:55.886284 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_feature_engagement: Close
[0m15:59:55.887238 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4585bc6f-5cf5-4c35-b5f4-1f2f122bb8d8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10448f0e0>]}
[0m15:59:55.887555 [info ] [Thread-1 (]: 1 of 4 OK created sql table model main.rpt_feature_engagement .................. [[32mOK[0m in 0.07s]
[0m15:59:55.887824 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.rpt_feature_engagement
[0m15:59:55.888015 [debug] [Thread-1 (]: Began running node model.quest_kingdom.rpt_level_progression
[0m15:59:55.888254 [info ] [Thread-1 (]: 2 of 4 START sql table model main.rpt_level_progression ........................ [RUN]
[0m15:59:55.888452 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.quest_kingdom.rpt_feature_engagement, now model.quest_kingdom.rpt_level_progression)
[0m15:59:55.888616 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.rpt_level_progression
[0m15:59:55.890285 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.rpt_level_progression"
[0m15:59:55.890893 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.rpt_level_progression
[0m15:59:55.892487 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.rpt_level_progression"
[0m15:59:55.893028 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_level_progression"
[0m15:59:55.893183 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_level_progression: BEGIN
[0m15:59:55.893330 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:59:55.893672 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m15:59:55.893843 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_level_progression"
[0m15:59:55.894081 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_level_progression: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_level_progression"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_level_progression__dbt_tmp"
  
    as (
      

with sessions as (
    select * from "quest_kingdom"."main"."fct_sessions"
),

players as (
    select * from "quest_kingdom"."main"."dim_players"
),

--track level progression per player
player_levels as (
    select 
        player_id,
        min(session_started_at) as first_session_at,
        max(ending_level) as max_level_reached,
        sum(levels_gained) as total_levels_gained,

        --time to reach certain milestones
        min(case when ending_level >= 5 then session_started_at end) as reached_level_5_at,
        min(case when ending_level >= 10 then session_started_at end) as reached_level_10_at,
        min(case when ending_level >= 20 then session_started_at end) as reached_level_20_at,
        min(case when ending_level >= 30 then session_started_at end) as reached_level_30_at,
        min(case when ending_level >= 40 then session_started_at end) as reached_level_40_at,
        min(case when ending_level >= 50 then session_started_at end) as reached_level_50_at,

        --progression metrics
        count(*) as total_sessions,
        sum(session_duration_minutes) as total_play_time,
        avg(session_duration_minutes) as avg_session_duration
    from sessions 
    group by player_id 
),

--combine with player attributes
final as (
    select 
        pl.player_id,
        p.installed_at,
        p.cohort_week,
        p.attribution_channel,
        p.player_segment,
        p.experiment_variant,
        p.is_payer,

        --progression
        pl.max_level_reached,
        pl.total_levels_gained,

        --milestones
        pl.reached_level_5_at,
        pl.reached_level_10_at,
        pl.reached_level_20_at,
        pl.reached_level_30_at,
        pl.reached_level_40_at,
        pl.reached_level_50_at,

        --time to milestones (in hours)
        case 
            when pl.reached_level_5_at is not null 
            then datediff('hour', pl.first_session_at, pl.reached_level_5_at)
        end as hours_to_level_5,
        case 
            when pl.reached_level_10_at is not null 
            then datediff('hour', pl.first_session_at, pl.reached_level_10_at)
        end as hours_to_level_10,
        case 
            when pl.reached_level_20_at is not null 
            then datediff('hour', pl.first_session_at, pl.reached_level_20_at)
        end as hours_to_level_20,
       
       --engagement
       pl.total_sessions,
       pl.total_play_time,
       pl.avg_session_duration,

       --progression velocity (levels per hour player)
       case 
            when pl.total_play_time > 0 
            then pl.total_levels_gained::float / (pl.total_player / 60)
            else 0
        end as levels_per_hour,

        --progression tiers
        case 
            when pl.max_level_reached >= 40 then 'End Game (40+)'
            when pl.max_level_reached >= 30 then 'Late Game (30-39)'
            when pl.max_level_reached >= 20 then 'Mid Game (20-29)'
            when pl.max_level_reached >= 10 then 'Early Game (10-19)'
            when pl.max_level_reached >= 5 then 'Tutorial+ (5-9)'
            else 'Tutorial (1-4)'
        end as progression_tier 
    from player_levels pl 
    inner join players p on pl.player_id = p.player 
)

select * from final
    );
  
  
[0m15:59:55.897989 [debug] [Thread-1 (]: DuckDB adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_level_progression"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_level_progression__dbt_tmp"
  
    as (
      

with sessions as (
    select * from "quest_kingdom"."main"."fct_sessions"
),

players as (
    select * from "quest_kingdom"."main"."dim_players"
),

--track level progression per player
player_levels as (
    select 
        player_id,
        min(session_started_at) as first_session_at,
        max(ending_level) as max_level_reached,
        sum(levels_gained) as total_levels_gained,

        --time to reach certain milestones
        min(case when ending_level >= 5 then session_started_at end) as reached_level_5_at,
        min(case when ending_level >= 10 then session_started_at end) as reached_level_10_at,
        min(case when ending_level >= 20 then session_started_at end) as reached_level_20_at,
        min(case when ending_level >= 30 then session_started_at end) as reached_level_30_at,
        min(case when ending_level >= 40 then session_started_at end) as reached_level_40_at,
        min(case when ending_level >= 50 then session_started_at end) as reached_level_50_at,

        --progression metrics
        count(*) as total_sessions,
        sum(session_duration_minutes) as total_play_time,
        avg(session_duration_minutes) as avg_session_duration
    from sessions 
    group by player_id 
),

--combine with player attributes
final as (
    select 
        pl.player_id,
        p.installed_at,
        p.cohort_week,
        p.attribution_channel,
        p.player_segment,
        p.experiment_variant,
        p.is_payer,

        --progression
        pl.max_level_reached,
        pl.total_levels_gained,

        --milestones
        pl.reached_level_5_at,
        pl.reached_level_10_at,
        pl.reached_level_20_at,
        pl.reached_level_30_at,
        pl.reached_level_40_at,
        pl.reached_level_50_at,

        --time to milestones (in hours)
        case 
            when pl.reached_level_5_at is not null 
            then datediff('hour', pl.first_session_at, pl.reached_level_5_at)
        end as hours_to_level_5,
        case 
            when pl.reached_level_10_at is not null 
            then datediff('hour', pl.first_session_at, pl.reached_level_10_at)
        end as hours_to_level_10,
        case 
            when pl.reached_level_20_at is not null 
            then datediff('hour', pl.first_session_at, pl.reached_level_20_at)
        end as hours_to_level_20,
       
       --engagement
       pl.total_sessions,
       pl.total_play_time,
       pl.avg_session_duration,

       --progression velocity (levels per hour player)
       case 
            when pl.total_play_time > 0 
            then pl.total_levels_gained::float / (pl.total_player / 60)
            else 0
        end as levels_per_hour,

        --progression tiers
        case 
            when pl.max_level_reached >= 40 then 'End Game (40+)'
            when pl.max_level_reached >= 30 then 'Late Game (30-39)'
            when pl.max_level_reached >= 20 then 'Mid Game (20-29)'
            when pl.max_level_reached >= 10 then 'Early Game (10-19)'
            when pl.max_level_reached >= 5 then 'Tutorial+ (5-9)'
            else 'Tutorial (1-4)'
        end as progression_tier 
    from player_levels pl 
    inner join players p on pl.player_id = p.player 
)

select * from final
    );
  
  
[0m15:59:55.898320 [debug] [Thread-1 (]: DuckDB adapter: Rolling back transaction.
[0m15:59:55.898546 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_level_progression: ROLLBACK
[0m15:59:55.902774 [debug] [Thread-1 (]: Failed to rollback 'model.quest_kingdom.rpt_level_progression'
[0m15:59:55.902951 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_level_progression: Close
[0m15:59:55.904127 [debug] [Thread-1 (]: Runtime Error in model rpt_level_progression (models/marts/product/rpt_level_progression.sql)
  Binder Error: Values list "p" does not have a column named "player"
  
  LINE 104:     inner join players p on pl.player_id = p.player 
                                                       ^
[0m15:59:55.904375 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4585bc6f-5cf5-4c35-b5f4-1f2f122bb8d8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108ce9b80>]}
[0m15:59:55.904678 [error] [Thread-1 (]: 2 of 4 ERROR creating sql table model main.rpt_level_progression ............... [[31mERROR[0m in 0.02s]
[0m15:59:55.904938 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.rpt_level_progression
[0m15:59:55.905121 [debug] [Thread-1 (]: Began running node model.quest_kingdom.rpt_session_quality
[0m15:59:55.905349 [debug] [Thread-4 (]: Marking all children of 'model.quest_kingdom.rpt_level_progression' to be skipped because of status 'error'.  Reason: Runtime Error in model rpt_level_progression (models/marts/product/rpt_level_progression.sql)
  Binder Error: Values list "p" does not have a column named "player"
  
  LINE 104:     inner join players p on pl.player_id = p.player 
                                                       ^.
[0m15:59:55.905569 [info ] [Thread-1 (]: 3 of 4 START sql table model main.rpt_session_quality .......................... [RUN]
[0m15:59:55.906169 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.quest_kingdom.rpt_level_progression, now model.quest_kingdom.rpt_session_quality)
[0m15:59:55.906346 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.rpt_session_quality
[0m15:59:55.908005 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.rpt_session_quality"
[0m15:59:55.908647 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.rpt_session_quality
[0m15:59:55.910246 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.rpt_session_quality"
[0m15:59:55.910927 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_session_quality"
[0m15:59:55.911096 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_session_quality: BEGIN
[0m15:59:55.911246 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:59:55.911589 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m15:59:55.911743 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_session_quality"
[0m15:59:55.911962 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_session_quality: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_session_quality"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_session_quality__dbt_tmp"
  
    as (
      

with sessions as (
    select * from "quest_kingdom"."main"."fct_sessions"
),

--aggregate sesion metrics
session_metrics as (
    select
        player_id,
        attribution_channel,
        player_segment,
        experiment_variant,

        --session counts
        count(*) as total_sessions,
        count(case when is_quality_session then 1 end) as quality_sessions,
        count(case when has_progression then 1 end) as sessions_with_progression,

        --duration metrics
        avg(session_duration_minutes) as avg_session_duration,
        sum(session_duration_minutes) as total_play_time,
        max(session_duration_minutes) as longest_session,

        --progression metrics
        sum(levels_gained) as total_levels_gained,
        avg(levels_gained) as avg_levels_per_session,

        --time of day patterns
        count(case when time_of_day = 'morning' then 1 end) as morning_sessions,
        count(case when time_of_day = 'afternoon' then 1 end) as afternoon_session,
        count(case when time_of_day = 'evening' then 1 end) as evening_sessions,
        count(case when time_of_day = 'night' then 1 end) as night_sessions,

        --weekend vs weekday
        count(case when is_weekend then 1 end) as weekend_sessions,
        count(case when not is_weekend then 1 end) as weekday_sessions,

        --session spacings (days btwn sessions)
        avg(datediff('day',
            lag(session_started_at) over (partition by player_id order by session_started_at),
            session_started_at)) as avg_days_between_sessions
    from sessions 
    group by player_id, attribution_channel, player_segment, experiment_variant
),

--adding derived metrics
 final as (
    select 
        *,

        --quality rates
        round(quality_sessions::float / total_sessions * 100, 1) as quality_session_pct,
        round(sessions_with_progression::float / total_sessions * 100, 1) as progression_session_pct,

        --engagement patterns
        round(weekend_sessions::float / total_sessions * 100, 1) as weekend_session_pct,

        --preferred time of day
        case 
            when evening_sessions > morning_sessions
                and evening_sessions > afternoon_sessions
                and evening_sessions > night_sessions
            then 'Evening'
            when morning_sessions > afternoon_sessions
                and morning_sessions > night_sessions
            then 'Morning'
            when afternoon_session > night_sessions then 'Afternoon'
            else 'Night'
        end preferred_play_time,

        --engagement tier
        case
            when total_sessions >= 20 then 'Power User (20+)'
            when total_sessions >= 10 then 'Engaged (10-19)'
            when total_sessions >= 5 then 'Regular (5-9)'
            else 'Casual (1-4)'
        end as engagement_tier
    from session_metrics
 )

 select * from final
    );
  
  
[0m15:59:55.913393 [debug] [Thread-1 (]: DuckDB adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_session_quality"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_session_quality__dbt_tmp"
  
    as (
      

with sessions as (
    select * from "quest_kingdom"."main"."fct_sessions"
),

--aggregate sesion metrics
session_metrics as (
    select
        player_id,
        attribution_channel,
        player_segment,
        experiment_variant,

        --session counts
        count(*) as total_sessions,
        count(case when is_quality_session then 1 end) as quality_sessions,
        count(case when has_progression then 1 end) as sessions_with_progression,

        --duration metrics
        avg(session_duration_minutes) as avg_session_duration,
        sum(session_duration_minutes) as total_play_time,
        max(session_duration_minutes) as longest_session,

        --progression metrics
        sum(levels_gained) as total_levels_gained,
        avg(levels_gained) as avg_levels_per_session,

        --time of day patterns
        count(case when time_of_day = 'morning' then 1 end) as morning_sessions,
        count(case when time_of_day = 'afternoon' then 1 end) as afternoon_session,
        count(case when time_of_day = 'evening' then 1 end) as evening_sessions,
        count(case when time_of_day = 'night' then 1 end) as night_sessions,

        --weekend vs weekday
        count(case when is_weekend then 1 end) as weekend_sessions,
        count(case when not is_weekend then 1 end) as weekday_sessions,

        --session spacings (days btwn sessions)
        avg(datediff('day',
            lag(session_started_at) over (partition by player_id order by session_started_at),
            session_started_at)) as avg_days_between_sessions
    from sessions 
    group by player_id, attribution_channel, player_segment, experiment_variant
),

--adding derived metrics
 final as (
    select 
        *,

        --quality rates
        round(quality_sessions::float / total_sessions * 100, 1) as quality_session_pct,
        round(sessions_with_progression::float / total_sessions * 100, 1) as progression_session_pct,

        --engagement patterns
        round(weekend_sessions::float / total_sessions * 100, 1) as weekend_session_pct,

        --preferred time of day
        case 
            when evening_sessions > morning_sessions
                and evening_sessions > afternoon_sessions
                and evening_sessions > night_sessions
            then 'Evening'
            when morning_sessions > afternoon_sessions
                and morning_sessions > night_sessions
            then 'Morning'
            when afternoon_session > night_sessions then 'Afternoon'
            else 'Night'
        end preferred_play_time,

        --engagement tier
        case
            when total_sessions >= 20 then 'Power User (20+)'
            when total_sessions >= 10 then 'Engaged (10-19)'
            when total_sessions >= 5 then 'Regular (5-9)'
            else 'Casual (1-4)'
        end as engagement_tier
    from session_metrics
 )

 select * from final
    );
  
  
[0m15:59:55.913681 [debug] [Thread-1 (]: DuckDB adapter: Rolling back transaction.
[0m15:59:55.913899 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_session_quality: ROLLBACK
[0m15:59:55.915521 [debug] [Thread-1 (]: Failed to rollback 'model.quest_kingdom.rpt_session_quality'
[0m15:59:55.915718 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_session_quality: Close
[0m15:59:55.916853 [debug] [Thread-1 (]: Runtime Error in model rpt_session_quality (models/marts/product/rpt_session_quality.sql)
  Binder Error: aggregate function calls cannot contain window function calls
  
  LINE 51:             lag(session_started_at) over (partition by player_id order...
                       ^
[0m15:59:55.917072 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4585bc6f-5cf5-4c35-b5f4-1f2f122bb8d8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108f70080>]}
[0m15:59:55.917354 [error] [Thread-1 (]: 3 of 4 ERROR creating sql table model main.rpt_session_quality ................. [[31mERROR[0m in 0.01s]
[0m15:59:55.917600 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.rpt_session_quality
[0m15:59:55.917776 [debug] [Thread-1 (]: Began running node model.quest_kingdom.rpt_level_funnel
[0m15:59:55.918003 [debug] [Thread-4 (]: Marking all children of 'model.quest_kingdom.rpt_session_quality' to be skipped because of status 'error'.  Reason: Runtime Error in model rpt_session_quality (models/marts/product/rpt_session_quality.sql)
  Binder Error: aggregate function calls cannot contain window function calls
  
  LINE 51:             lag(session_started_at) over (partition by player_id order...
                       ^.
[0m15:59:55.918198 [info ] [Thread-1 (]: 4 of 4 SKIP relation main.rpt_level_funnel ..................................... [[33mSKIP[0m]
[0m15:59:55.918459 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.rpt_level_funnel
[0m15:59:55.918988 [debug] [MainThread]: Using duckdb connection "master"
[0m15:59:55.919125 [debug] [MainThread]: On master: BEGIN
[0m15:59:55.919239 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m15:59:55.919550 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m15:59:55.919676 [debug] [MainThread]: On master: COMMIT
[0m15:59:55.919799 [debug] [MainThread]: Using duckdb connection "master"
[0m15:59:55.919915 [debug] [MainThread]: On master: COMMIT
[0m15:59:55.920103 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m15:59:55.920225 [debug] [MainThread]: On master: Close
[0m15:59:55.920382 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:59:55.920496 [debug] [MainThread]: Connection 'model.quest_kingdom.rpt_session_quality' was properly closed.
[0m15:59:55.920641 [info ] [MainThread]: 
[0m15:59:55.920777 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 0.19 seconds (0.19s).
[0m15:59:55.921185 [debug] [MainThread]: Command end result
[0m15:59:55.942315 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/manifest.json
[0m15:59:55.946614 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/semantic_manifest.json
[0m15:59:55.949863 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/run_results.json
[0m15:59:55.950037 [info ] [MainThread]: 
[0m15:59:55.950212 [info ] [MainThread]: [31mCompleted with 2 errors, 0 partial successes, and 0 warnings:[0m
[0m15:59:55.950353 [info ] [MainThread]: 
[0m15:59:55.950525 [error] [MainThread]: [31mFailure in model rpt_level_progression (models/marts/product/rpt_level_progression.sql)[0m
[0m15:59:55.950693 [error] [MainThread]:   Runtime Error in model rpt_level_progression (models/marts/product/rpt_level_progression.sql)
  Binder Error: Values list "p" does not have a column named "player"
  
  LINE 104:     inner join players p on pl.player_id = p.player 
                                                       ^
[0m15:59:55.950818 [info ] [MainThread]: 
[0m15:59:55.950965 [info ] [MainThread]:   compiled code at target/compiled/quest_kingdom/models/marts/product/rpt_level_progression.sql
[0m15:59:55.951094 [info ] [MainThread]: 
[0m15:59:55.951451 [error] [MainThread]: [31mFailure in model rpt_session_quality (models/marts/product/rpt_session_quality.sql)[0m
[0m15:59:55.951606 [error] [MainThread]:   Runtime Error in model rpt_session_quality (models/marts/product/rpt_session_quality.sql)
  Binder Error: aggregate function calls cannot contain window function calls
  
  LINE 51:             lag(session_started_at) over (partition by player_id order...
                       ^
[0m15:59:55.951727 [info ] [MainThread]: 
[0m15:59:55.951885 [info ] [MainThread]:   compiled code at target/compiled/quest_kingdom/models/marts/product/rpt_session_quality.sql
[0m15:59:55.952084 [info ] [MainThread]: 
[0m15:59:55.952225 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=2 SKIP=1 NO-OP=0 TOTAL=4
[0m15:59:55.953673 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.87877756, "process_in_blocks": "0", "process_kernel_time": 0.207585, "process_mem_max_rss": "171327488", "process_out_blocks": "0", "process_user_time": 1.302801}
[0m15:59:55.953915 [debug] [MainThread]: Command `dbt run` failed at 15:59:55.953871 after 0.88 seconds
[0m15:59:55.954101 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106090740>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106de5880>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106de57f0>]}
[0m15:59:55.954275 [debug] [MainThread]: Flushing usage events
[0m15:59:56.049506 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m16:01:56.465982 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108a4c800>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1082c5310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108a95880>]}


============================== 16:01:56.469966 | cbdd3c77-eac8-4461-a466-3566590bb496 ==============================
[0m16:01:56.469966 [info ] [MainThread]: Running with dbt=1.11.4
[0m16:01:56.470318 [debug] [MainThread]: running dbt with arguments {'send_anonymous_usage_stats': 'True', 'no_print': 'None', 'debug': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'version_check': 'True', 'log_format': 'default', 'log_path': '/Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/logs', 'log_cache_events': 'False', 'printer_width': '80', 'fail_fast': 'False', 'invocation_command': 'dbt run --select path:models/marts/product', 'target_path': 'None', 'indirect_selection': 'eager', 'use_colors': 'True', 'static_parser': 'True', 'write_json': 'True', 'quiet': 'False', 'cache_selected_only': 'False', 'profiles_dir': '/Users/hazeldonaldson/.dbt', 'partial_parse': 'True', 'introspect': 'True', 'empty': 'False', 'use_experimental_parser': 'False', 'warn_error': 'None'}
[0m16:01:56.630419 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'cbdd3c77-eac8-4461-a466-3566590bb496', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108b03ce0>]}
[0m16:01:56.659177 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'cbdd3c77-eac8-4461-a466-3566590bb496', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1062171a0>]}
[0m16:01:56.661394 [info ] [MainThread]: Registered adapter: duckdb=1.10.0
[0m16:01:56.713879 [debug] [MainThread]: checksum: 092b177ba87eb6bb3c55954c38aa57900eebac336561eb9ee32218428aa81d43, vars: {}, profile: , target: , version: 1.11.4
[0m16:01:56.780511 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m16:01:56.781037 [debug] [MainThread]: Partial parsing: updated file: quest_kingdom://models/marts/product/rpt_level_progression.sql
[0m16:01:56.972153 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'cbdd3c77-eac8-4461-a466-3566590bb496', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109250fe0>]}
[0m16:01:57.056703 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/manifest.json
[0m16:01:57.058081 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/semantic_manifest.json
[0m16:01:57.070933 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'cbdd3c77-eac8-4461-a466-3566590bb496', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1092d58e0>]}
[0m16:01:57.071234 [info ] [MainThread]: Found 19 models, 48 data tests, 5 sources, 472 macros
[0m16:01:57.071413 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'cbdd3c77-eac8-4461-a466-3566590bb496', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1062a3380>]}
[0m16:01:57.073362 [info ] [MainThread]: 
[0m16:01:57.073553 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m16:01:57.073694 [info ] [MainThread]: 
[0m16:01:57.073929 [debug] [MainThread]: Acquiring new duckdb connection 'master'
[0m16:01:57.076091 [debug] [ThreadPool]: Acquiring new duckdb connection 'list_quest_kingdom'
[0m16:01:57.105216 [debug] [ThreadPool]: Using duckdb connection "list_quest_kingdom"
[0m16:01:57.105496 [debug] [ThreadPool]: On list_quest_kingdom: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "list_quest_kingdom"} */

    
    select schema_name
    from system.information_schema.schemata
    
    where lower(catalog_name) = '"quest_kingdom"'
    
  
  
[0m16:01:57.105654 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:01:57.124778 [debug] [ThreadPool]: SQL status: OK in 0.019 seconds
[0m16:01:57.125782 [debug] [ThreadPool]: On list_quest_kingdom: Close
[0m16:01:57.126145 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_quest_kingdom, now create_quest_kingdom_main)
[0m16:01:57.126398 [debug] [ThreadPool]: Creating schema "database: "quest_kingdom"
schema: "main"
"
[0m16:01:57.129882 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m16:01:57.130109 [debug] [ThreadPool]: On create_quest_kingdom_main: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "create_quest_kingdom_main"} */

    
        select type from duckdb_databases()
        where lower(database_name)='quest_kingdom'
        and type='sqlite'
    
  
[0m16:01:57.130255 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:01:57.131205 [debug] [ThreadPool]: SQL status: OK in 0.001 seconds
[0m16:01:57.131939 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m16:01:57.132099 [debug] [ThreadPool]: On create_quest_kingdom_main: BEGIN
[0m16:01:57.132329 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m16:01:57.132456 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m16:01:57.132581 [debug] [ThreadPool]: On create_quest_kingdom_main: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "create_quest_kingdom_main"} */

    
    
        create schema if not exists "quest_kingdom"."main"
    
[0m16:01:57.133059 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m16:01:57.133446 [debug] [ThreadPool]: On create_quest_kingdom_main: COMMIT
[0m16:01:57.133574 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m16:01:57.133686 [debug] [ThreadPool]: On create_quest_kingdom_main: COMMIT
[0m16:01:57.133879 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m16:01:57.134009 [debug] [ThreadPool]: On create_quest_kingdom_main: Close
[0m16:01:57.134949 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_quest_kingdom_main, now list_quest_kingdom_main)
[0m16:01:57.137706 [debug] [ThreadPool]: Using duckdb connection "list_quest_kingdom_main"
[0m16:01:57.137883 [debug] [ThreadPool]: On list_quest_kingdom_main: BEGIN
[0m16:01:57.138224 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:01:57.138758 [debug] [ThreadPool]: SQL status: OK in 0.001 seconds
[0m16:01:57.138919 [debug] [ThreadPool]: Using duckdb connection "list_quest_kingdom_main"
[0m16:01:57.139104 [debug] [ThreadPool]: On list_quest_kingdom_main: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "list_quest_kingdom_main"} */
select
      'quest_kingdom' as database,
      table_name as name,
      table_schema as schema,
      CASE table_type
        WHEN 'BASE TABLE' THEN 'table'
        WHEN 'VIEW' THEN 'view'
        WHEN 'LOCAL TEMPORARY' THEN 'table'
        END as type
    from system.information_schema.tables
    where lower(table_schema) = 'main'
    and lower(table_catalog) = 'quest_kingdom'
  
[0m16:01:57.150182 [debug] [ThreadPool]: SQL status: OK in 0.011 seconds
[0m16:01:57.151037 [debug] [ThreadPool]: On list_quest_kingdom_main: ROLLBACK
[0m16:01:57.151943 [debug] [ThreadPool]: Failed to rollback 'list_quest_kingdom_main'
[0m16:01:57.152089 [debug] [ThreadPool]: On list_quest_kingdom_main: Close
[0m16:01:57.153416 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'cbdd3c77-eac8-4461-a466-3566590bb496', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106217500>]}
[0m16:01:57.153688 [debug] [MainThread]: Using duckdb connection "master"
[0m16:01:57.153831 [debug] [MainThread]: On master: BEGIN
[0m16:01:57.153959 [debug] [MainThread]: Opening a new connection, currently in state init
[0m16:01:57.154221 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m16:01:57.154357 [debug] [MainThread]: On master: COMMIT
[0m16:01:57.154481 [debug] [MainThread]: Using duckdb connection "master"
[0m16:01:57.154597 [debug] [MainThread]: On master: COMMIT
[0m16:01:57.154785 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m16:01:57.154905 [debug] [MainThread]: On master: Close
[0m16:01:57.156170 [debug] [Thread-1 (]: Began running node model.quest_kingdom.rpt_feature_engagement
[0m16:01:57.156421 [info ] [Thread-1 (]: 1 of 4 START sql table model main.rpt_feature_engagement ....................... [RUN]
[0m16:01:57.156622 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_quest_kingdom_main, now model.quest_kingdom.rpt_feature_engagement)
[0m16:01:57.156784 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.rpt_feature_engagement
[0m16:01:57.160660 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.rpt_feature_engagement"
[0m16:01:57.161110 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.rpt_feature_engagement
[0m16:01:57.177734 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.rpt_feature_engagement"
[0m16:01:57.179524 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_feature_engagement"
[0m16:01:57.179716 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_feature_engagement: BEGIN
[0m16:01:57.179918 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:01:57.180332 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:01:57.180501 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_feature_engagement"
[0m16:01:57.180704 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_feature_engagement: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_feature_engagement"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_feature_engagement__dbt_tmp"
  
    as (
      

with events as (
    select * from "quest_kingdom"."main"."stg_events"
),

players as (
    select * from "quest_kingdom"."main"."dim_players"
),

--aggregate events per player
player_events as (
    select 
        player_id,

        --event counts
        count(*) as total_events,
        count(distinct event_name) as unique_event_types,

        --specific events
        sum(case when event_name = 'tutorial_completed' then 1 else 0 end) as tutorial_completions,
        sum(case when event_name = 'level_completed' then 1 else 0 end) as level_completions,
        sum(case when event_name = 'boss_defeated' then 1 else 0 end) as boss_defeats,

        --timing
        min(event_at) as first_event_at,
        max(event_at) as last_event_at
    from events 
    group by player_id 

),

--combine with player data
final as (
    select 
        p.player_id,
        p.installed_at,
        p.cohort_week,
        p.attribution_channel,
        p.player_segment,
        p.experiment_variant,
        p.is_payer,

        --events
        coalesce(pe.total_events, 0) as total_events,
        coalesce(pe.unique_event_types, 0) as unique_event_types,
        coalesce(pe.tutorial_completions, 0) as tutorial_completions,
        coalesce(pe.boss_defeats, 0) as boss_defeats,

        --derived
        case 
            when pe.tutorial_completions > 0 then true 
            else false 
        end as completed_tutorial,

        case
            when pe.boss_defeats > 0 then true
            else false 
        end defeated_boss,

        --events per session (if they have sessions)
        case
            when p.total_sessions > 0 
            then coalesce(pe.total_events, 0)::float / p.total_sessions
            else 0
        end events_per_session,

        --engagement level based on events
        case 
            when coalesce(pe.total_events, 0) >= 50 then 'Power User (50+)'
            when coalesce(pe.total_events, 0) >= 20 then 'Engaged (20-49)'
            when coalesce(pe.total_events, 0) >= 5 then 'Active (5-19)'
            when coalesce(pe.total_events, 0) >= 1 then 'Casual (1-4)'
            else 'No Events'
        end as event_engagement_tier
    from players p 
    left join player_events pe on p.player_id = pe.player_id 
 )

 
 select * from final
    );
  
  
[0m16:01:57.202452 [debug] [Thread-1 (]: SQL status: OK in 0.021 seconds
[0m16:01:57.205389 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_feature_engagement"
[0m16:01:57.205597 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_feature_engagement: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_feature_engagement"} */

    SELECT index_name
    FROM duckdb_indexes()
    WHERE schema_name = 'main'
      AND table_name = 'rpt_feature_engagement'
  
[0m16:01:57.206116 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:01:57.206735 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_feature_engagement"
[0m16:01:57.206903 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_feature_engagement: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_feature_engagement"} */

    SELECT COUNT(*) as remaining_indexes
    FROM duckdb_indexes()
    WHERE schema_name = 'main'
      AND table_name = 'rpt_feature_engagement'
  
[0m16:01:57.207647 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m16:01:57.210879 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_feature_engagement"
[0m16:01:57.211106 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_feature_engagement: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_feature_engagement"} */
alter table "quest_kingdom"."main"."rpt_feature_engagement" rename to "rpt_feature_engagement__dbt_backup"
[0m16:01:57.212017 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m16:01:57.214064 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_feature_engagement"
[0m16:01:57.214343 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_feature_engagement: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_feature_engagement"} */
alter table "quest_kingdom"."main"."rpt_feature_engagement__dbt_tmp" rename to "rpt_feature_engagement"
[0m16:01:57.214793 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:01:57.223149 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_feature_engagement: COMMIT
[0m16:01:57.223450 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_feature_engagement"
[0m16:01:57.223626 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_feature_engagement: COMMIT
[0m16:01:57.226518 [debug] [Thread-1 (]: SQL status: OK in 0.003 seconds
[0m16:01:57.229313 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_feature_engagement"
[0m16:01:57.229503 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_feature_engagement: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_feature_engagement"} */

      drop table if exists "quest_kingdom"."main"."rpt_feature_engagement__dbt_backup" cascade
    
[0m16:01:57.230386 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m16:01:57.231677 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_feature_engagement: Close
[0m16:01:57.233855 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cbdd3c77-eac8-4461-a466-3566590bb496', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10922d790>]}
[0m16:01:57.234194 [info ] [Thread-1 (]: 1 of 4 OK created sql table model main.rpt_feature_engagement .................. [[32mOK[0m in 0.08s]
[0m16:01:57.234472 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.rpt_feature_engagement
[0m16:01:57.234672 [debug] [Thread-1 (]: Began running node model.quest_kingdom.rpt_level_progression
[0m16:01:57.234920 [info ] [Thread-1 (]: 2 of 4 START sql table model main.rpt_level_progression ........................ [RUN]
[0m16:01:57.235136 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.quest_kingdom.rpt_feature_engagement, now model.quest_kingdom.rpt_level_progression)
[0m16:01:57.235303 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.rpt_level_progression
[0m16:01:57.237276 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.rpt_level_progression"
[0m16:01:57.237921 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.rpt_level_progression
[0m16:01:57.239745 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.rpt_level_progression"
[0m16:01:57.240203 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_level_progression"
[0m16:01:57.240370 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_level_progression: BEGIN
[0m16:01:57.240520 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:01:57.240925 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:01:57.241148 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_level_progression"
[0m16:01:57.241466 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_level_progression: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_level_progression"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_level_progression__dbt_tmp"
  
    as (
      

with sessions as (
    select * from "quest_kingdom"."main"."fct_sessions"
),

players as (
    select * from "quest_kingdom"."main"."dim_players"
),

--track level progression per player
player_levels as (
    select 
        player_id,
        min(session_started_at) as first_session_at,
        max(ending_level) as max_level_reached,
        sum(levels_gained) as total_levels_gained,

        --time to reach certain milestones
        min(case when ending_level >= 5 then session_started_at end) as reached_level_5_at,
        min(case when ending_level >= 10 then session_started_at end) as reached_level_10_at,
        min(case when ending_level >= 20 then session_started_at end) as reached_level_20_at,
        min(case when ending_level >= 30 then session_started_at end) as reached_level_30_at,
        min(case when ending_level >= 40 then session_started_at end) as reached_level_40_at,
        min(case when ending_level >= 50 then session_started_at end) as reached_level_50_at,

        --progression metrics
        count(*) as total_sessions,
        sum(session_duration_minutes) as total_play_time,
        avg(session_duration_minutes) as avg_session_duration
    from sessions 
    group by player_id 
),

--combine with player attributes
final as (
    select 
        pl.player_id,
        p.installed_at,
        p.cohort_week,
        p.attribution_channel,
        p.player_segment,
        p.experiment_variant,
        p.is_payer,

        --progression
        pl.max_level_reached,
        pl.total_levels_gained,

        --milestones
        pl.reached_level_5_at,
        pl.reached_level_10_at,
        pl.reached_level_20_at,
        pl.reached_level_30_at,
        pl.reached_level_40_at,
        pl.reached_level_50_at,

        --time to milestones (in hours)
        case 
            when pl.reached_level_5_at is not null 
            then datediff('hour', pl.first_session_at, pl.reached_level_5_at)
        end as hours_to_level_5,
        case 
            when pl.reached_level_10_at is not null 
            then datediff('hour', pl.first_session_at, pl.reached_level_10_at)
        end as hours_to_level_10,
        case 
            when pl.reached_level_20_at is not null 
            then datediff('hour', pl.first_session_at, pl.reached_level_20_at)
        end as hours_to_level_20,
       
       --engagement
       pl.total_sessions,
       pl.total_play_time,
       pl.avg_session_duration,

       --progression velocity (levels per hour player)
       case 
            when pl.total_play_time > 0 
            then pl.total_levels_gained::float / (pl.total_player / 60)
            else 0
        end as levels_per_hour,

        --progression tiers
        case 
            when pl.max_level_reached >= 40 then 'End Game (40+)'
            when pl.max_level_reached >= 30 then 'Late Game (30-39)'
            when pl.max_level_reached >= 20 then 'Mid Game (20-29)'
            when pl.max_level_reached >= 10 then 'Early Game (10-19)'
            when pl.max_level_reached >= 5 then 'Tutorial+ (5-9)'
            else 'Tutorial (1-4)'
        end as progression_tier 
    from player_levels pl 
    inner join players p on pl.player_id = p.player_id
)

select * from final
    );
  
  
[0m16:01:57.246126 [debug] [Thread-1 (]: DuckDB adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_level_progression"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_level_progression__dbt_tmp"
  
    as (
      

with sessions as (
    select * from "quest_kingdom"."main"."fct_sessions"
),

players as (
    select * from "quest_kingdom"."main"."dim_players"
),

--track level progression per player
player_levels as (
    select 
        player_id,
        min(session_started_at) as first_session_at,
        max(ending_level) as max_level_reached,
        sum(levels_gained) as total_levels_gained,

        --time to reach certain milestones
        min(case when ending_level >= 5 then session_started_at end) as reached_level_5_at,
        min(case when ending_level >= 10 then session_started_at end) as reached_level_10_at,
        min(case when ending_level >= 20 then session_started_at end) as reached_level_20_at,
        min(case when ending_level >= 30 then session_started_at end) as reached_level_30_at,
        min(case when ending_level >= 40 then session_started_at end) as reached_level_40_at,
        min(case when ending_level >= 50 then session_started_at end) as reached_level_50_at,

        --progression metrics
        count(*) as total_sessions,
        sum(session_duration_minutes) as total_play_time,
        avg(session_duration_minutes) as avg_session_duration
    from sessions 
    group by player_id 
),

--combine with player attributes
final as (
    select 
        pl.player_id,
        p.installed_at,
        p.cohort_week,
        p.attribution_channel,
        p.player_segment,
        p.experiment_variant,
        p.is_payer,

        --progression
        pl.max_level_reached,
        pl.total_levels_gained,

        --milestones
        pl.reached_level_5_at,
        pl.reached_level_10_at,
        pl.reached_level_20_at,
        pl.reached_level_30_at,
        pl.reached_level_40_at,
        pl.reached_level_50_at,

        --time to milestones (in hours)
        case 
            when pl.reached_level_5_at is not null 
            then datediff('hour', pl.first_session_at, pl.reached_level_5_at)
        end as hours_to_level_5,
        case 
            when pl.reached_level_10_at is not null 
            then datediff('hour', pl.first_session_at, pl.reached_level_10_at)
        end as hours_to_level_10,
        case 
            when pl.reached_level_20_at is not null 
            then datediff('hour', pl.first_session_at, pl.reached_level_20_at)
        end as hours_to_level_20,
       
       --engagement
       pl.total_sessions,
       pl.total_play_time,
       pl.avg_session_duration,

       --progression velocity (levels per hour player)
       case 
            when pl.total_play_time > 0 
            then pl.total_levels_gained::float / (pl.total_player / 60)
            else 0
        end as levels_per_hour,

        --progression tiers
        case 
            when pl.max_level_reached >= 40 then 'End Game (40+)'
            when pl.max_level_reached >= 30 then 'Late Game (30-39)'
            when pl.max_level_reached >= 20 then 'Mid Game (20-29)'
            when pl.max_level_reached >= 10 then 'Early Game (10-19)'
            when pl.max_level_reached >= 5 then 'Tutorial+ (5-9)'
            else 'Tutorial (1-4)'
        end as progression_tier 
    from player_levels pl 
    inner join players p on pl.player_id = p.player_id
)

select * from final
    );
  
  
[0m16:01:57.246659 [debug] [Thread-1 (]: DuckDB adapter: Rolling back transaction.
[0m16:01:57.247238 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_level_progression: ROLLBACK
[0m16:01:57.251998 [debug] [Thread-1 (]: Failed to rollback 'model.quest_kingdom.rpt_level_progression'
[0m16:01:57.252261 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_level_progression: Close
[0m16:01:57.253512 [debug] [Thread-1 (]: Runtime Error in model rpt_level_progression (models/marts/product/rpt_level_progression.sql)
  Binder Error: Values list "pl" does not have a column named "total_player"
  
  LINE 90:             then pl.total_levels_gained::float / (pl.total_player / 60)
                                                             ^
[0m16:01:57.253776 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cbdd3c77-eac8-4461-a466-3566590bb496', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1096c5ac0>]}
[0m16:01:57.254099 [error] [Thread-1 (]: 2 of 4 ERROR creating sql table model main.rpt_level_progression ............... [[31mERROR[0m in 0.02s]
[0m16:01:57.254374 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.rpt_level_progression
[0m16:01:57.254561 [debug] [Thread-1 (]: Began running node model.quest_kingdom.rpt_session_quality
[0m16:01:57.254789 [debug] [Thread-4 (]: Marking all children of 'model.quest_kingdom.rpt_level_progression' to be skipped because of status 'error'.  Reason: Runtime Error in model rpt_level_progression (models/marts/product/rpt_level_progression.sql)
  Binder Error: Values list "pl" does not have a column named "total_player"
  
  LINE 90:             then pl.total_levels_gained::float / (pl.total_player / 60)
                                                             ^.
[0m16:01:57.255034 [info ] [Thread-1 (]: 3 of 4 START sql table model main.rpt_session_quality .......................... [RUN]
[0m16:01:57.255681 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.quest_kingdom.rpt_level_progression, now model.quest_kingdom.rpt_session_quality)
[0m16:01:57.255850 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.rpt_session_quality
[0m16:01:57.257663 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.rpt_session_quality"
[0m16:01:57.258123 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.rpt_session_quality
[0m16:01:57.259858 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.rpt_session_quality"
[0m16:01:57.260290 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_session_quality"
[0m16:01:57.260518 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_session_quality: BEGIN
[0m16:01:57.260672 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:01:57.261045 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:01:57.261194 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_session_quality"
[0m16:01:57.261410 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_session_quality: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_session_quality"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_session_quality__dbt_tmp"
  
    as (
      

with sessions as (
    select * from "quest_kingdom"."main"."fct_sessions"
),

--aggregate sesion metrics
session_metrics as (
    select
        player_id,
        attribution_channel,
        player_segment,
        experiment_variant,

        --session counts
        count(*) as total_sessions,
        count(case when is_quality_session then 1 end) as quality_sessions,
        count(case when has_progression then 1 end) as sessions_with_progression,

        --duration metrics
        avg(session_duration_minutes) as avg_session_duration,
        sum(session_duration_minutes) as total_play_time,
        max(session_duration_minutes) as longest_session,

        --progression metrics
        sum(levels_gained) as total_levels_gained,
        avg(levels_gained) as avg_levels_per_session,

        --time of day patterns
        count(case when time_of_day = 'morning' then 1 end) as morning_sessions,
        count(case when time_of_day = 'afternoon' then 1 end) as afternoon_session,
        count(case when time_of_day = 'evening' then 1 end) as evening_sessions,
        count(case when time_of_day = 'night' then 1 end) as night_sessions,

        --weekend vs weekday
        count(case when is_weekend then 1 end) as weekend_sessions,
        count(case when not is_weekend then 1 end) as weekday_sessions,

        --session spacings (days btwn sessions)
        avg(datediff('day',
            lag(session_started_at) over (partition by player_id order by session_started_at),
            session_started_at)) as avg_days_between_sessions
    from sessions 
    group by player_id, attribution_channel, player_segment, experiment_variant
),

--adding derived metrics
 final as (
    select 
        *,

        --quality rates
        round(quality_sessions::float / total_sessions * 100, 1) as quality_session_pct,
        round(sessions_with_progression::float / total_sessions * 100, 1) as progression_session_pct,

        --engagement patterns
        round(weekend_sessions::float / total_sessions * 100, 1) as weekend_session_pct,

        --preferred time of day
        case 
            when evening_sessions > morning_sessions
                and evening_sessions > afternoon_sessions
                and evening_sessions > night_sessions
            then 'Evening'
            when morning_sessions > afternoon_sessions
                and morning_sessions > night_sessions
            then 'Morning'
            when afternoon_session > night_sessions then 'Afternoon'
            else 'Night'
        end preferred_play_time,

        --engagement tier
        case
            when total_sessions >= 20 then 'Power User (20+)'
            when total_sessions >= 10 then 'Engaged (10-19)'
            when total_sessions >= 5 then 'Regular (5-9)'
            else 'Casual (1-4)'
        end as engagement_tier
    from session_metrics
 )

 select * from final
    );
  
  
[0m16:01:57.262613 [debug] [Thread-1 (]: DuckDB adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_session_quality"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_session_quality__dbt_tmp"
  
    as (
      

with sessions as (
    select * from "quest_kingdom"."main"."fct_sessions"
),

--aggregate sesion metrics
session_metrics as (
    select
        player_id,
        attribution_channel,
        player_segment,
        experiment_variant,

        --session counts
        count(*) as total_sessions,
        count(case when is_quality_session then 1 end) as quality_sessions,
        count(case when has_progression then 1 end) as sessions_with_progression,

        --duration metrics
        avg(session_duration_minutes) as avg_session_duration,
        sum(session_duration_minutes) as total_play_time,
        max(session_duration_minutes) as longest_session,

        --progression metrics
        sum(levels_gained) as total_levels_gained,
        avg(levels_gained) as avg_levels_per_session,

        --time of day patterns
        count(case when time_of_day = 'morning' then 1 end) as morning_sessions,
        count(case when time_of_day = 'afternoon' then 1 end) as afternoon_session,
        count(case when time_of_day = 'evening' then 1 end) as evening_sessions,
        count(case when time_of_day = 'night' then 1 end) as night_sessions,

        --weekend vs weekday
        count(case when is_weekend then 1 end) as weekend_sessions,
        count(case when not is_weekend then 1 end) as weekday_sessions,

        --session spacings (days btwn sessions)
        avg(datediff('day',
            lag(session_started_at) over (partition by player_id order by session_started_at),
            session_started_at)) as avg_days_between_sessions
    from sessions 
    group by player_id, attribution_channel, player_segment, experiment_variant
),

--adding derived metrics
 final as (
    select 
        *,

        --quality rates
        round(quality_sessions::float / total_sessions * 100, 1) as quality_session_pct,
        round(sessions_with_progression::float / total_sessions * 100, 1) as progression_session_pct,

        --engagement patterns
        round(weekend_sessions::float / total_sessions * 100, 1) as weekend_session_pct,

        --preferred time of day
        case 
            when evening_sessions > morning_sessions
                and evening_sessions > afternoon_sessions
                and evening_sessions > night_sessions
            then 'Evening'
            when morning_sessions > afternoon_sessions
                and morning_sessions > night_sessions
            then 'Morning'
            when afternoon_session > night_sessions then 'Afternoon'
            else 'Night'
        end preferred_play_time,

        --engagement tier
        case
            when total_sessions >= 20 then 'Power User (20+)'
            when total_sessions >= 10 then 'Engaged (10-19)'
            when total_sessions >= 5 then 'Regular (5-9)'
            else 'Casual (1-4)'
        end as engagement_tier
    from session_metrics
 )

 select * from final
    );
  
  
[0m16:01:57.262867 [debug] [Thread-1 (]: DuckDB adapter: Rolling back transaction.
[0m16:01:57.263095 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_session_quality: ROLLBACK
[0m16:01:57.265302 [debug] [Thread-1 (]: Failed to rollback 'model.quest_kingdom.rpt_session_quality'
[0m16:01:57.265549 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_session_quality: Close
[0m16:01:57.267235 [debug] [Thread-1 (]: Runtime Error in model rpt_session_quality (models/marts/product/rpt_session_quality.sql)
  Binder Error: aggregate function calls cannot contain window function calls
  
  LINE 51:             lag(session_started_at) over (partition by player_id order...
                       ^
[0m16:01:57.267520 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cbdd3c77-eac8-4461-a466-3566590bb496', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10974ac00>]}
[0m16:01:57.267823 [error] [Thread-1 (]: 3 of 4 ERROR creating sql table model main.rpt_session_quality ................. [[31mERROR[0m in 0.01s]
[0m16:01:57.268085 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.rpt_session_quality
[0m16:01:57.268261 [debug] [Thread-1 (]: Began running node model.quest_kingdom.rpt_level_funnel
[0m16:01:57.268478 [debug] [Thread-4 (]: Marking all children of 'model.quest_kingdom.rpt_session_quality' to be skipped because of status 'error'.  Reason: Runtime Error in model rpt_session_quality (models/marts/product/rpt_session_quality.sql)
  Binder Error: aggregate function calls cannot contain window function calls
  
  LINE 51:             lag(session_started_at) over (partition by player_id order...
                       ^.
[0m16:01:57.268683 [info ] [Thread-1 (]: 4 of 4 SKIP relation main.rpt_level_funnel ..................................... [[33mSKIP[0m]
[0m16:01:57.268934 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.rpt_level_funnel
[0m16:01:57.269502 [debug] [MainThread]: Using duckdb connection "master"
[0m16:01:57.269646 [debug] [MainThread]: On master: BEGIN
[0m16:01:57.269762 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m16:01:57.270078 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m16:01:57.270208 [debug] [MainThread]: On master: COMMIT
[0m16:01:57.270332 [debug] [MainThread]: Using duckdb connection "master"
[0m16:01:57.270447 [debug] [MainThread]: On master: COMMIT
[0m16:01:57.270640 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m16:01:57.270768 [debug] [MainThread]: On master: Close
[0m16:01:57.270933 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:01:57.271055 [debug] [MainThread]: Connection 'model.quest_kingdom.rpt_session_quality' was properly closed.
[0m16:01:57.271213 [info ] [MainThread]: 
[0m16:01:57.271351 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 0.20 seconds (0.20s).
[0m16:01:57.271770 [debug] [MainThread]: Command end result
[0m16:01:57.296369 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/manifest.json
[0m16:01:57.297779 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/semantic_manifest.json
[0m16:01:57.300871 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/run_results.json
[0m16:01:57.301082 [info ] [MainThread]: 
[0m16:01:57.301265 [info ] [MainThread]: [31mCompleted with 2 errors, 0 partial successes, and 0 warnings:[0m
[0m16:01:57.301418 [info ] [MainThread]: 
[0m16:01:57.301845 [error] [MainThread]: [31mFailure in model rpt_level_progression (models/marts/product/rpt_level_progression.sql)[0m
[0m16:01:57.302072 [error] [MainThread]:   Runtime Error in model rpt_level_progression (models/marts/product/rpt_level_progression.sql)
  Binder Error: Values list "pl" does not have a column named "total_player"
  
  LINE 90:             then pl.total_levels_gained::float / (pl.total_player / 60)
                                                             ^
[0m16:01:57.302221 [info ] [MainThread]: 
[0m16:01:57.302389 [info ] [MainThread]:   compiled code at target/compiled/quest_kingdom/models/marts/product/rpt_level_progression.sql
[0m16:01:57.302572 [info ] [MainThread]: 
[0m16:01:57.302735 [error] [MainThread]: [31mFailure in model rpt_session_quality (models/marts/product/rpt_session_quality.sql)[0m
[0m16:01:57.302902 [error] [MainThread]:   Runtime Error in model rpt_session_quality (models/marts/product/rpt_session_quality.sql)
  Binder Error: aggregate function calls cannot contain window function calls
  
  LINE 51:             lag(session_started_at) over (partition by player_id order...
                       ^
[0m16:01:57.303109 [info ] [MainThread]: 
[0m16:01:57.303256 [info ] [MainThread]:   compiled code at target/compiled/quest_kingdom/models/marts/product/rpt_session_quality.sql
[0m16:01:57.303385 [info ] [MainThread]: 
[0m16:01:57.303533 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=2 SKIP=1 NO-OP=0 TOTAL=4
[0m16:01:57.307347 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.8777711, "process_in_blocks": "0", "process_kernel_time": 0.199933, "process_mem_max_rss": "170475520", "process_out_blocks": "0", "process_user_time": 1.323018}
[0m16:01:57.307770 [debug] [MainThread]: Command `dbt run` failed at 16:01:57.307720 after 0.88 seconds
[0m16:01:57.308084 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108a959a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108a95a90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10889ee10>]}
[0m16:01:57.308298 [debug] [MainThread]: Flushing usage events
[0m16:01:57.420248 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m16:30:43.011545 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102d0e990>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1071b5a30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1071b57c0>]}


============================== 16:30:43.023947 | 95405212-7958-46b3-bfa3-9c0ffb2b64b6 ==============================
[0m16:30:43.023947 [info ] [MainThread]: Running with dbt=1.11.4
[0m16:30:43.024274 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'target_path': 'None', 'profiles_dir': '/Users/hazeldonaldson/.dbt', 'no_print': 'None', 'invocation_command': 'dbt run --select path:models/marts/product', 'cache_selected_only': 'False', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'partial_parse': 'True', 'use_colors': 'True', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'write_json': 'True', 'empty': 'False', 'indirect_selection': 'eager', 'log_format': 'default', 'quiet': 'False', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'log_path': '/Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/logs', 'fail_fast': 'False', 'use_experimental_parser': 'False', 'log_cache_events': 'False'}
[0m16:30:43.199415 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '95405212-7958-46b3-bfa3-9c0ffb2b64b6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107257410>]}
[0m16:30:43.227821 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '95405212-7958-46b3-bfa3-9c0ffb2b64b6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10632b800>]}
[0m16:30:43.229226 [info ] [MainThread]: Registered adapter: duckdb=1.10.0
[0m16:30:43.379676 [debug] [MainThread]: checksum: 092b177ba87eb6bb3c55954c38aa57900eebac336561eb9ee32218428aa81d43, vars: {}, profile: , target: , version: 1.11.4
[0m16:30:43.453437 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m16:30:43.453944 [debug] [MainThread]: Partial parsing: updated file: quest_kingdom://models/marts/product/rpt_session_quality.sql
[0m16:30:43.644956 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '95405212-7958-46b3-bfa3-9c0ffb2b64b6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108ef9580>]}
[0m16:30:43.722411 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/manifest.json
[0m16:30:43.723670 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/semantic_manifest.json
[0m16:30:43.737996 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '95405212-7958-46b3-bfa3-9c0ffb2b64b6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108e73a10>]}
[0m16:30:43.738316 [info ] [MainThread]: Found 19 models, 48 data tests, 5 sources, 472 macros
[0m16:30:43.738487 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '95405212-7958-46b3-bfa3-9c0ffb2b64b6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108e62990>]}
[0m16:30:43.740448 [info ] [MainThread]: 
[0m16:30:43.740629 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m16:30:43.740765 [info ] [MainThread]: 
[0m16:30:43.740988 [debug] [MainThread]: Acquiring new duckdb connection 'master'
[0m16:30:43.743216 [debug] [ThreadPool]: Acquiring new duckdb connection 'list_quest_kingdom'
[0m16:30:43.773042 [debug] [ThreadPool]: Using duckdb connection "list_quest_kingdom"
[0m16:30:43.773284 [debug] [ThreadPool]: On list_quest_kingdom: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "list_quest_kingdom"} */

    
    select schema_name
    from system.information_schema.schemata
    
    where lower(catalog_name) = '"quest_kingdom"'
    
  
  
[0m16:30:43.773430 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:30:43.792376 [debug] [ThreadPool]: SQL status: OK in 0.019 seconds
[0m16:30:43.793338 [debug] [ThreadPool]: On list_quest_kingdom: Close
[0m16:30:43.793683 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_quest_kingdom, now create_quest_kingdom_main)
[0m16:30:43.793903 [debug] [ThreadPool]: Creating schema "database: "quest_kingdom"
schema: "main"
"
[0m16:30:43.797340 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m16:30:43.797526 [debug] [ThreadPool]: On create_quest_kingdom_main: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "create_quest_kingdom_main"} */

    
        select type from duckdb_databases()
        where lower(database_name)='quest_kingdom'
        and type='sqlite'
    
  
[0m16:30:43.797657 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:30:43.798449 [debug] [ThreadPool]: SQL status: OK in 0.001 seconds
[0m16:30:43.799123 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m16:30:43.799268 [debug] [ThreadPool]: On create_quest_kingdom_main: BEGIN
[0m16:30:43.799494 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m16:30:43.799625 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m16:30:43.799751 [debug] [ThreadPool]: On create_quest_kingdom_main: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "create_quest_kingdom_main"} */

    
    
        create schema if not exists "quest_kingdom"."main"
    
[0m16:30:43.800216 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m16:30:43.800599 [debug] [ThreadPool]: On create_quest_kingdom_main: COMMIT
[0m16:30:43.800728 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m16:30:43.800842 [debug] [ThreadPool]: On create_quest_kingdom_main: COMMIT
[0m16:30:43.801038 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m16:30:43.801164 [debug] [ThreadPool]: On create_quest_kingdom_main: Close
[0m16:30:43.802085 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_quest_kingdom_main, now list_quest_kingdom_main)
[0m16:30:43.804697 [debug] [ThreadPool]: Using duckdb connection "list_quest_kingdom_main"
[0m16:30:43.804852 [debug] [ThreadPool]: On list_quest_kingdom_main: BEGIN
[0m16:30:43.805027 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:30:43.805355 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m16:30:43.805513 [debug] [ThreadPool]: Using duckdb connection "list_quest_kingdom_main"
[0m16:30:43.805664 [debug] [ThreadPool]: On list_quest_kingdom_main: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "list_quest_kingdom_main"} */
select
      'quest_kingdom' as database,
      table_name as name,
      table_schema as schema,
      CASE table_type
        WHEN 'BASE TABLE' THEN 'table'
        WHEN 'VIEW' THEN 'view'
        WHEN 'LOCAL TEMPORARY' THEN 'table'
        END as type
    from system.information_schema.tables
    where lower(table_schema) = 'main'
    and lower(table_catalog) = 'quest_kingdom'
  
[0m16:30:43.815806 [debug] [ThreadPool]: SQL status: OK in 0.010 seconds
[0m16:30:43.816799 [debug] [ThreadPool]: On list_quest_kingdom_main: ROLLBACK
[0m16:30:43.817730 [debug] [ThreadPool]: Failed to rollback 'list_quest_kingdom_main'
[0m16:30:43.817875 [debug] [ThreadPool]: On list_quest_kingdom_main: Close
[0m16:30:43.819340 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '95405212-7958-46b3-bfa3-9c0ffb2b64b6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108e71850>]}
[0m16:30:43.819569 [debug] [MainThread]: Using duckdb connection "master"
[0m16:30:43.819698 [debug] [MainThread]: On master: BEGIN
[0m16:30:43.819811 [debug] [MainThread]: Opening a new connection, currently in state init
[0m16:30:43.820051 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m16:30:43.820181 [debug] [MainThread]: On master: COMMIT
[0m16:30:43.820303 [debug] [MainThread]: Using duckdb connection "master"
[0m16:30:43.820421 [debug] [MainThread]: On master: COMMIT
[0m16:30:43.820619 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m16:30:43.820751 [debug] [MainThread]: On master: Close
[0m16:30:43.822127 [debug] [Thread-1 (]: Began running node model.quest_kingdom.rpt_feature_engagement
[0m16:30:43.822357 [info ] [Thread-1 (]: 1 of 4 START sql table model main.rpt_feature_engagement ....................... [RUN]
[0m16:30:43.822552 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_quest_kingdom_main, now model.quest_kingdom.rpt_feature_engagement)
[0m16:30:43.822710 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.rpt_feature_engagement
[0m16:30:43.826548 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.rpt_feature_engagement"
[0m16:30:43.827127 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.rpt_feature_engagement
[0m16:30:43.843998 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.rpt_feature_engagement"
[0m16:30:43.844665 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_feature_engagement"
[0m16:30:43.844837 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_feature_engagement: BEGIN
[0m16:30:43.844981 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:30:43.845360 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:30:43.845514 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_feature_engagement"
[0m16:30:43.845718 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_feature_engagement: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_feature_engagement"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_feature_engagement__dbt_tmp"
  
    as (
      

with events as (
    select * from "quest_kingdom"."main"."stg_events"
),

players as (
    select * from "quest_kingdom"."main"."dim_players"
),

--aggregate events per player
player_events as (
    select 
        player_id,

        --event counts
        count(*) as total_events,
        count(distinct event_name) as unique_event_types,

        --specific events
        sum(case when event_name = 'tutorial_completed' then 1 else 0 end) as tutorial_completions,
        sum(case when event_name = 'level_completed' then 1 else 0 end) as level_completions,
        sum(case when event_name = 'boss_defeated' then 1 else 0 end) as boss_defeats,

        --timing
        min(event_at) as first_event_at,
        max(event_at) as last_event_at
    from events 
    group by player_id 

),

--combine with player data
final as (
    select 
        p.player_id,
        p.installed_at,
        p.cohort_week,
        p.attribution_channel,
        p.player_segment,
        p.experiment_variant,
        p.is_payer,

        --events
        coalesce(pe.total_events, 0) as total_events,
        coalesce(pe.unique_event_types, 0) as unique_event_types,
        coalesce(pe.tutorial_completions, 0) as tutorial_completions,
        coalesce(pe.boss_defeats, 0) as boss_defeats,

        --derived
        case 
            when pe.tutorial_completions > 0 then true 
            else false 
        end as completed_tutorial,

        case
            when pe.boss_defeats > 0 then true
            else false 
        end defeated_boss,

        --events per session (if they have sessions)
        case
            when p.total_sessions > 0 
            then coalesce(pe.total_events, 0)::float / p.total_sessions
            else 0
        end events_per_session,

        --engagement level based on events
        case 
            when coalesce(pe.total_events, 0) >= 50 then 'Power User (50+)'
            when coalesce(pe.total_events, 0) >= 20 then 'Engaged (20-49)'
            when coalesce(pe.total_events, 0) >= 5 then 'Active (5-19)'
            when coalesce(pe.total_events, 0) >= 1 then 'Casual (1-4)'
            else 'No Events'
        end as event_engagement_tier
    from players p 
    left join player_events pe on p.player_id = pe.player_id 
 )

 
 select * from final
    );
  
  
[0m16:30:43.864406 [debug] [Thread-1 (]: SQL status: OK in 0.018 seconds
[0m16:30:43.867228 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_feature_engagement"
[0m16:30:43.867422 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_feature_engagement: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_feature_engagement"} */

    SELECT index_name
    FROM duckdb_indexes()
    WHERE schema_name = 'main'
      AND table_name = 'rpt_feature_engagement'
  
[0m16:30:43.867929 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:30:43.868530 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_feature_engagement"
[0m16:30:43.868696 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_feature_engagement: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_feature_engagement"} */

    SELECT COUNT(*) as remaining_indexes
    FROM duckdb_indexes()
    WHERE schema_name = 'main'
      AND table_name = 'rpt_feature_engagement'
  
[0m16:30:43.869699 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m16:30:43.872975 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_feature_engagement"
[0m16:30:43.873160 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_feature_engagement: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_feature_engagement"} */
alter table "quest_kingdom"."main"."rpt_feature_engagement" rename to "rpt_feature_engagement__dbt_backup"
[0m16:30:43.873877 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m16:30:43.875260 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_feature_engagement"
[0m16:30:43.875431 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_feature_engagement: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_feature_engagement"} */
alter table "quest_kingdom"."main"."rpt_feature_engagement__dbt_tmp" rename to "rpt_feature_engagement"
[0m16:30:43.875757 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:30:43.883235 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_feature_engagement: COMMIT
[0m16:30:43.883483 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_feature_engagement"
[0m16:30:43.883650 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_feature_engagement: COMMIT
[0m16:30:43.886902 [debug] [Thread-1 (]: SQL status: OK in 0.003 seconds
[0m16:30:43.889811 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_feature_engagement"
[0m16:30:43.890008 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_feature_engagement: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_feature_engagement"} */

      drop table if exists "quest_kingdom"."main"."rpt_feature_engagement__dbt_backup" cascade
    
[0m16:30:43.890874 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m16:30:43.892002 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_feature_engagement: Close
[0m16:30:43.893056 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '95405212-7958-46b3-bfa3-9c0ffb2b64b6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10592f470>]}
[0m16:30:43.893778 [info ] [Thread-1 (]: 1 of 4 OK created sql table model main.rpt_feature_engagement .................. [[32mOK[0m in 0.07s]
[0m16:30:43.894165 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.rpt_feature_engagement
[0m16:30:43.894397 [debug] [Thread-1 (]: Began running node model.quest_kingdom.rpt_level_progression
[0m16:30:43.894958 [info ] [Thread-1 (]: 2 of 4 START sql table model main.rpt_level_progression ........................ [RUN]
[0m16:30:43.895310 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.quest_kingdom.rpt_feature_engagement, now model.quest_kingdom.rpt_level_progression)
[0m16:30:43.896348 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.rpt_level_progression
[0m16:30:43.898439 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.rpt_level_progression"
[0m16:30:43.898900 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.rpt_level_progression
[0m16:30:43.900682 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.rpt_level_progression"
[0m16:30:43.901153 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_level_progression"
[0m16:30:43.901327 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_level_progression: BEGIN
[0m16:30:43.901484 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:30:43.901912 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:30:43.902107 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_level_progression"
[0m16:30:43.902359 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_level_progression: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_level_progression"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_level_progression__dbt_tmp"
  
    as (
      

with sessions as (
    select * from "quest_kingdom"."main"."fct_sessions"
),

players as (
    select * from "quest_kingdom"."main"."dim_players"
),

--track level progression per player
player_levels as (
    select 
        player_id,
        min(session_started_at) as first_session_at,
        max(ending_level) as max_level_reached,
        sum(levels_gained) as total_levels_gained,

        --time to reach certain milestones
        min(case when ending_level >= 5 then session_started_at end) as reached_level_5_at,
        min(case when ending_level >= 10 then session_started_at end) as reached_level_10_at,
        min(case when ending_level >= 20 then session_started_at end) as reached_level_20_at,
        min(case when ending_level >= 30 then session_started_at end) as reached_level_30_at,
        min(case when ending_level >= 40 then session_started_at end) as reached_level_40_at,
        min(case when ending_level >= 50 then session_started_at end) as reached_level_50_at,

        --progression metrics
        count(*) as total_sessions,
        sum(session_duration_minutes) as total_play_time,
        avg(session_duration_minutes) as avg_session_duration
    from sessions 
    group by player_id 
),

--combine with player attributes
final as (
    select 
        pl.player_id,
        p.installed_at,
        p.cohort_week,
        p.attribution_channel,
        p.player_segment,
        p.experiment_variant,
        p.is_payer,

        --progression
        pl.max_level_reached,
        pl.total_levels_gained,

        --milestones
        pl.reached_level_5_at,
        pl.reached_level_10_at,
        pl.reached_level_20_at,
        pl.reached_level_30_at,
        pl.reached_level_40_at,
        pl.reached_level_50_at,

        --time to milestones (in hours)
        case 
            when pl.reached_level_5_at is not null 
            then datediff('hour', pl.first_session_at, pl.reached_level_5_at)
        end as hours_to_level_5,
        case 
            when pl.reached_level_10_at is not null 
            then datediff('hour', pl.first_session_at, pl.reached_level_10_at)
        end as hours_to_level_10,
        case 
            when pl.reached_level_20_at is not null 
            then datediff('hour', pl.first_session_at, pl.reached_level_20_at)
        end as hours_to_level_20,
       
       --engagement
       pl.total_sessions,
       pl.total_play_time,
       pl.avg_session_duration,

       --progression velocity (levels per hour player)
       case 
            when pl.total_play_time > 0 
            then pl.total_levels_gained::float / (pl.total_player / 60)
            else 0
        end as levels_per_hour,

        --progression tiers
        case 
            when pl.max_level_reached >= 40 then 'End Game (40+)'
            when pl.max_level_reached >= 30 then 'Late Game (30-39)'
            when pl.max_level_reached >= 20 then 'Mid Game (20-29)'
            when pl.max_level_reached >= 10 then 'Early Game (10-19)'
            when pl.max_level_reached >= 5 then 'Tutorial+ (5-9)'
            else 'Tutorial (1-4)'
        end as progression_tier 
    from player_levels pl 
    inner join players p on pl.player_id = p.player_id
)

select * from final
    );
  
  
[0m16:30:43.910734 [debug] [Thread-1 (]: DuckDB adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_level_progression"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_level_progression__dbt_tmp"
  
    as (
      

with sessions as (
    select * from "quest_kingdom"."main"."fct_sessions"
),

players as (
    select * from "quest_kingdom"."main"."dim_players"
),

--track level progression per player
player_levels as (
    select 
        player_id,
        min(session_started_at) as first_session_at,
        max(ending_level) as max_level_reached,
        sum(levels_gained) as total_levels_gained,

        --time to reach certain milestones
        min(case when ending_level >= 5 then session_started_at end) as reached_level_5_at,
        min(case when ending_level >= 10 then session_started_at end) as reached_level_10_at,
        min(case when ending_level >= 20 then session_started_at end) as reached_level_20_at,
        min(case when ending_level >= 30 then session_started_at end) as reached_level_30_at,
        min(case when ending_level >= 40 then session_started_at end) as reached_level_40_at,
        min(case when ending_level >= 50 then session_started_at end) as reached_level_50_at,

        --progression metrics
        count(*) as total_sessions,
        sum(session_duration_minutes) as total_play_time,
        avg(session_duration_minutes) as avg_session_duration
    from sessions 
    group by player_id 
),

--combine with player attributes
final as (
    select 
        pl.player_id,
        p.installed_at,
        p.cohort_week,
        p.attribution_channel,
        p.player_segment,
        p.experiment_variant,
        p.is_payer,

        --progression
        pl.max_level_reached,
        pl.total_levels_gained,

        --milestones
        pl.reached_level_5_at,
        pl.reached_level_10_at,
        pl.reached_level_20_at,
        pl.reached_level_30_at,
        pl.reached_level_40_at,
        pl.reached_level_50_at,

        --time to milestones (in hours)
        case 
            when pl.reached_level_5_at is not null 
            then datediff('hour', pl.first_session_at, pl.reached_level_5_at)
        end as hours_to_level_5,
        case 
            when pl.reached_level_10_at is not null 
            then datediff('hour', pl.first_session_at, pl.reached_level_10_at)
        end as hours_to_level_10,
        case 
            when pl.reached_level_20_at is not null 
            then datediff('hour', pl.first_session_at, pl.reached_level_20_at)
        end as hours_to_level_20,
       
       --engagement
       pl.total_sessions,
       pl.total_play_time,
       pl.avg_session_duration,

       --progression velocity (levels per hour player)
       case 
            when pl.total_play_time > 0 
            then pl.total_levels_gained::float / (pl.total_player / 60)
            else 0
        end as levels_per_hour,

        --progression tiers
        case 
            when pl.max_level_reached >= 40 then 'End Game (40+)'
            when pl.max_level_reached >= 30 then 'Late Game (30-39)'
            when pl.max_level_reached >= 20 then 'Mid Game (20-29)'
            when pl.max_level_reached >= 10 then 'Early Game (10-19)'
            when pl.max_level_reached >= 5 then 'Tutorial+ (5-9)'
            else 'Tutorial (1-4)'
        end as progression_tier 
    from player_levels pl 
    inner join players p on pl.player_id = p.player_id
)

select * from final
    );
  
  
[0m16:30:43.911253 [debug] [Thread-1 (]: DuckDB adapter: Rolling back transaction.
[0m16:30:43.911504 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_level_progression: ROLLBACK
[0m16:30:43.915975 [debug] [Thread-1 (]: Failed to rollback 'model.quest_kingdom.rpt_level_progression'
[0m16:30:43.916158 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_level_progression: Close
[0m16:30:43.917350 [debug] [Thread-1 (]: Runtime Error in model rpt_level_progression (models/marts/product/rpt_level_progression.sql)
  Binder Error: Values list "pl" does not have a column named "total_player"
  
  LINE 90:             then pl.total_levels_gained::float / (pl.total_player / 60)
                                                             ^
[0m16:30:43.917595 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '95405212-7958-46b3-bfa3-9c0ffb2b64b6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1093da0f0>]}
[0m16:30:43.917900 [error] [Thread-1 (]: 2 of 4 ERROR creating sql table model main.rpt_level_progression ............... [[31mERROR[0m in 0.02s]
[0m16:30:43.918164 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.rpt_level_progression
[0m16:30:43.918347 [debug] [Thread-1 (]: Began running node model.quest_kingdom.rpt_session_quality
[0m16:30:43.918556 [debug] [Thread-4 (]: Marking all children of 'model.quest_kingdom.rpt_level_progression' to be skipped because of status 'error'.  Reason: Runtime Error in model rpt_level_progression (models/marts/product/rpt_level_progression.sql)
  Binder Error: Values list "pl" does not have a column named "total_player"
  
  LINE 90:             then pl.total_levels_gained::float / (pl.total_player / 60)
                                                             ^.
[0m16:30:43.918761 [info ] [Thread-1 (]: 3 of 4 START sql table model main.rpt_session_quality .......................... [RUN]
[0m16:30:43.919344 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.quest_kingdom.rpt_level_progression, now model.quest_kingdom.rpt_session_quality)
[0m16:30:43.919516 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.rpt_session_quality
[0m16:30:43.921222 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.rpt_session_quality"
[0m16:30:43.921603 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.rpt_session_quality
[0m16:30:43.923399 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.rpt_session_quality"
[0m16:30:43.923843 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_session_quality"
[0m16:30:43.924047 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_session_quality: BEGIN
[0m16:30:43.924271 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:30:43.924668 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:30:43.924837 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_session_quality"
[0m16:30:43.925083 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_session_quality: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_session_quality"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_session_quality__dbt_tmp"
  
    as (
      

with sessions as (
    select * from "quest_kingdom"."main"."fct_sessions"
),

--calculate days between sessions
session_spacing as (
    select 
        player_id,
        session_started_at,
        datediff('day',
            lag(session_started_at) over (partition by player_id order by session_started_at),
            session_started_at
        ) as days_since_last_session
    from sessions 
),

--aggregate sesion metrics
session_metrics as (
    select
        player_id,
        attribution_channel,
        player_segment,
        experiment_variant,

        --session counts
        count(*) as total_sessions,
        count(case when is_quality_session then 1 end) as quality_sessions,
        count(case when has_progression then 1 end) as sessions_with_progression,

        --duration metrics
        avg(session_duration_minutes) as avg_session_duration,
        sum(session_duration_minutes) as total_play_time,
        max(session_duration_minutes) as longest_session,

        --progression metrics
        sum(levels_gained) as total_levels_gained,
        avg(levels_gained) as avg_levels_per_session,

        --time of day patterns
        count(case when time_of_day = 'morning' then 1 end) as morning_sessions,
        count(case when time_of_day = 'afternoon' then 1 end) as afternoon_session,
        count(case when time_of_day = 'evening' then 1 end) as evening_sessions,
        count(case when time_of_day = 'night' then 1 end) as night_sessions,

        --weekend vs weekday
        count(case when is_weekend then 1 end) as weekend_sessions,
        count(case when not is_weekend then 1 end) as weekday_sessions

    from sessions 
    group by player_id, attribution_channel, player_segment, experiment_variant
),

--calculate average spacing separately
avg_spacing as (
    select 
        player_id,
        avg(days_since_last_session) as avg_days_between_sessions
    from session_spacing
    where days_since_last_session is not null
    group by player_id
),

--adding derived metrics
 final as (
    select 
        sm.*,
        sp.avg_days_between_sessions,

        --quality rates
        round(sm.quality_sessions::float / sm.total_sessions * 100, 1) as quality_session_pct,
        round(sm.sessions_with_progression::float / sm.total_sessions * 100, 1) as progression_session_pct,

        --engagement patterns
        round(sm.weekend_sessions::float / sm.total_sessions * 100, 1) as weekend_session_pct,

        --preferred time of day
        case 
            when sm.evening_sessions > sm.morning_sessions
                and sm.evening_sessions > sm.afternoon_sessions
                and sm.evening_sessions > sm.night_sessions
            then 'Evening'
            when sm.morning_sessions > sm.afternoon_sessions
                and sm.morning_sessions > sm.night_sessions
            then 'Morning'
            when sm.afternoon_session > sm.night_sessions then 'Afternoon'
            else 'Night'
        end preferred_play_time,

        --engagement tier
        case
            when sm.total_sessions >= 20 then 'Power User (20+)'
            when sm.total_sessions >= 10 then 'Engaged (10-19)'
            when sm.total_sessions >= 5 then 'Regular (5-9)'
            else 'Casual (1-4)'
        end as engagement_tier
    from session_metrics sm 
    left join avg_spacing sp on sm.player_id = sp.player_id
 )

 select * from final
    );
  
  
[0m16:30:43.927266 [debug] [Thread-1 (]: DuckDB adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_session_quality"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_session_quality__dbt_tmp"
  
    as (
      

with sessions as (
    select * from "quest_kingdom"."main"."fct_sessions"
),

--calculate days between sessions
session_spacing as (
    select 
        player_id,
        session_started_at,
        datediff('day',
            lag(session_started_at) over (partition by player_id order by session_started_at),
            session_started_at
        ) as days_since_last_session
    from sessions 
),

--aggregate sesion metrics
session_metrics as (
    select
        player_id,
        attribution_channel,
        player_segment,
        experiment_variant,

        --session counts
        count(*) as total_sessions,
        count(case when is_quality_session then 1 end) as quality_sessions,
        count(case when has_progression then 1 end) as sessions_with_progression,

        --duration metrics
        avg(session_duration_minutes) as avg_session_duration,
        sum(session_duration_minutes) as total_play_time,
        max(session_duration_minutes) as longest_session,

        --progression metrics
        sum(levels_gained) as total_levels_gained,
        avg(levels_gained) as avg_levels_per_session,

        --time of day patterns
        count(case when time_of_day = 'morning' then 1 end) as morning_sessions,
        count(case when time_of_day = 'afternoon' then 1 end) as afternoon_session,
        count(case when time_of_day = 'evening' then 1 end) as evening_sessions,
        count(case when time_of_day = 'night' then 1 end) as night_sessions,

        --weekend vs weekday
        count(case when is_weekend then 1 end) as weekend_sessions,
        count(case when not is_weekend then 1 end) as weekday_sessions

    from sessions 
    group by player_id, attribution_channel, player_segment, experiment_variant
),

--calculate average spacing separately
avg_spacing as (
    select 
        player_id,
        avg(days_since_last_session) as avg_days_between_sessions
    from session_spacing
    where days_since_last_session is not null
    group by player_id
),

--adding derived metrics
 final as (
    select 
        sm.*,
        sp.avg_days_between_sessions,

        --quality rates
        round(sm.quality_sessions::float / sm.total_sessions * 100, 1) as quality_session_pct,
        round(sm.sessions_with_progression::float / sm.total_sessions * 100, 1) as progression_session_pct,

        --engagement patterns
        round(sm.weekend_sessions::float / sm.total_sessions * 100, 1) as weekend_session_pct,

        --preferred time of day
        case 
            when sm.evening_sessions > sm.morning_sessions
                and sm.evening_sessions > sm.afternoon_sessions
                and sm.evening_sessions > sm.night_sessions
            then 'Evening'
            when sm.morning_sessions > sm.afternoon_sessions
                and sm.morning_sessions > sm.night_sessions
            then 'Morning'
            when sm.afternoon_session > sm.night_sessions then 'Afternoon'
            else 'Night'
        end preferred_play_time,

        --engagement tier
        case
            when sm.total_sessions >= 20 then 'Power User (20+)'
            when sm.total_sessions >= 10 then 'Engaged (10-19)'
            when sm.total_sessions >= 5 then 'Regular (5-9)'
            else 'Casual (1-4)'
        end as engagement_tier
    from session_metrics sm 
    left join avg_spacing sp on sm.player_id = sp.player_id
 )

 select * from final
    );
  
  
[0m16:30:43.927613 [debug] [Thread-1 (]: DuckDB adapter: Rolling back transaction.
[0m16:30:43.927840 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_session_quality: ROLLBACK
[0m16:30:43.929253 [debug] [Thread-1 (]: Failed to rollback 'model.quest_kingdom.rpt_session_quality'
[0m16:30:43.929427 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_session_quality: Close
[0m16:30:43.930584 [debug] [Thread-1 (]: Runtime Error in model rpt_session_quality (models/marts/product/rpt_session_quality.sql)
  Binder Error: Values list "sm" does not have a column named "afternoon_sessions"
  
  LINE 91:                 and sm.evening_sessions > sm.afternoon_sessions
                                                     ^
[0m16:30:43.930811 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '95405212-7958-46b3-bfa3-9c0ffb2b64b6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1096571a0>]}
[0m16:30:43.931101 [error] [Thread-1 (]: 3 of 4 ERROR creating sql table model main.rpt_session_quality ................. [[31mERROR[0m in 0.01s]
[0m16:30:43.931349 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.rpt_session_quality
[0m16:30:43.931524 [debug] [Thread-1 (]: Began running node model.quest_kingdom.rpt_level_funnel
[0m16:30:43.931730 [debug] [Thread-4 (]: Marking all children of 'model.quest_kingdom.rpt_session_quality' to be skipped because of status 'error'.  Reason: Runtime Error in model rpt_session_quality (models/marts/product/rpt_session_quality.sql)
  Binder Error: Values list "sm" does not have a column named "afternoon_sessions"
  
  LINE 91:                 and sm.evening_sessions > sm.afternoon_sessions
                                                     ^.
[0m16:30:43.931926 [info ] [Thread-1 (]: 4 of 4 SKIP relation main.rpt_level_funnel ..................................... [[33mSKIP[0m]
[0m16:30:43.932175 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.rpt_level_funnel
[0m16:30:43.932706 [debug] [MainThread]: Using duckdb connection "master"
[0m16:30:43.932846 [debug] [MainThread]: On master: BEGIN
[0m16:30:43.932961 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m16:30:43.933279 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m16:30:43.933410 [debug] [MainThread]: On master: COMMIT
[0m16:30:43.933539 [debug] [MainThread]: Using duckdb connection "master"
[0m16:30:43.933655 [debug] [MainThread]: On master: COMMIT
[0m16:30:43.933866 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m16:30:43.933992 [debug] [MainThread]: On master: Close
[0m16:30:43.934150 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:30:43.934263 [debug] [MainThread]: Connection 'model.quest_kingdom.rpt_session_quality' was properly closed.
[0m16:30:43.934411 [info ] [MainThread]: 
[0m16:30:43.934549 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 0.19 seconds (0.19s).
[0m16:30:43.934961 [debug] [MainThread]: Command end result
[0m16:30:43.958042 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/manifest.json
[0m16:30:43.959159 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/semantic_manifest.json
[0m16:30:43.965632 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/run_results.json
[0m16:30:43.965854 [info ] [MainThread]: 
[0m16:30:43.966067 [info ] [MainThread]: [31mCompleted with 2 errors, 0 partial successes, and 0 warnings:[0m
[0m16:30:43.966221 [info ] [MainThread]: 
[0m16:30:43.966402 [error] [MainThread]: [31mFailure in model rpt_level_progression (models/marts/product/rpt_level_progression.sql)[0m
[0m16:30:43.966576 [error] [MainThread]:   Runtime Error in model rpt_level_progression (models/marts/product/rpt_level_progression.sql)
  Binder Error: Values list "pl" does not have a column named "total_player"
  
  LINE 90:             then pl.total_levels_gained::float / (pl.total_player / 60)
                                                             ^
[0m16:30:43.966708 [info ] [MainThread]: 
[0m16:30:43.966858 [info ] [MainThread]:   compiled code at target/compiled/quest_kingdom/models/marts/product/rpt_level_progression.sql
[0m16:30:43.966990 [info ] [MainThread]: 
[0m16:30:43.967146 [error] [MainThread]: [31mFailure in model rpt_session_quality (models/marts/product/rpt_session_quality.sql)[0m
[0m16:30:43.967304 [error] [MainThread]:   Runtime Error in model rpt_session_quality (models/marts/product/rpt_session_quality.sql)
  Binder Error: Values list "sm" does not have a column named "afternoon_sessions"
  
  LINE 91:                 and sm.evening_sessions > sm.afternoon_sessions
                                                     ^
[0m16:30:43.967426 [info ] [MainThread]: 
[0m16:30:43.967570 [info ] [MainThread]:   compiled code at target/compiled/quest_kingdom/models/marts/product/rpt_session_quality.sql
[0m16:30:43.967690 [info ] [MainThread]: 
[0m16:30:43.967826 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=2 SKIP=1 NO-OP=0 TOTAL=4
[0m16:30:43.969068 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.99439025, "process_in_blocks": "0", "process_kernel_time": 0.222222, "process_mem_max_rss": "166445056", "process_out_blocks": "0", "process_user_time": 1.333679}
[0m16:30:43.969320 [debug] [MainThread]: Command `dbt run` failed at 16:30:43.969274 after 0.99 seconds
[0m16:30:43.969520 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108ca3f80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1071b58e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1071b5820>]}
[0m16:30:43.969707 [debug] [MainThread]: Flushing usage events
[0m16:30:44.100961 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m16:31:09.306094 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106811760>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107085af0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1070858e0>]}


============================== 16:31:09.310358 | fe2b08d8-ad75-4df5-af1a-33a020c29b76 ==============================
[0m16:31:09.310358 [info ] [MainThread]: Running with dbt=1.11.4
[0m16:31:09.310693 [debug] [MainThread]: running dbt with arguments {'warn_error': 'None', 'invocation_command': 'dbt run --select path:models/marts/product', 'profiles_dir': '/Users/hazeldonaldson/.dbt', 'use_experimental_parser': 'False', 'printer_width': '80', 'introspect': 'True', 'log_format': 'default', 'static_parser': 'True', 'use_colors': 'True', 'no_print': 'None', 'target_path': 'None', 'indirect_selection': 'eager', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'debug': 'False', 'log_cache_events': 'False', 'log_path': '/Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/logs', 'fail_fast': 'False', 'write_json': 'True', 'cache_selected_only': 'False', 'quiet': 'False', 'empty': 'False', 'partial_parse': 'True', 'send_anonymous_usage_stats': 'True', 'version_check': 'True'}
[0m16:31:09.475684 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'fe2b08d8-ad75-4df5-af1a-33a020c29b76', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10472ffe0>]}
[0m16:31:09.506163 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'fe2b08d8-ad75-4df5-af1a-33a020c29b76', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10723cfe0>]}
[0m16:31:09.507911 [info ] [MainThread]: Registered adapter: duckdb=1.10.0
[0m16:31:09.560185 [debug] [MainThread]: checksum: 092b177ba87eb6bb3c55954c38aa57900eebac336561eb9ee32218428aa81d43, vars: {}, profile: , target: , version: 1.11.4
[0m16:31:09.626823 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m16:31:09.627303 [debug] [MainThread]: Partial parsing: updated file: quest_kingdom://models/marts/product/rpt_session_quality.sql
[0m16:31:09.821725 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'fe2b08d8-ad75-4df5-af1a-33a020c29b76', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10793cce0>]}
[0m16:31:09.898607 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/manifest.json
[0m16:31:09.899989 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/semantic_manifest.json
[0m16:31:09.913357 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'fe2b08d8-ad75-4df5-af1a-33a020c29b76', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10783d040>]}
[0m16:31:09.913652 [info ] [MainThread]: Found 19 models, 48 data tests, 5 sources, 472 macros
[0m16:31:09.913828 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fe2b08d8-ad75-4df5-af1a-33a020c29b76', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107831250>]}
[0m16:31:09.915777 [info ] [MainThread]: 
[0m16:31:09.915967 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m16:31:09.916108 [info ] [MainThread]: 
[0m16:31:09.916334 [debug] [MainThread]: Acquiring new duckdb connection 'master'
[0m16:31:09.918496 [debug] [ThreadPool]: Acquiring new duckdb connection 'list_quest_kingdom'
[0m16:31:09.947081 [debug] [ThreadPool]: Using duckdb connection "list_quest_kingdom"
[0m16:31:09.947320 [debug] [ThreadPool]: On list_quest_kingdom: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "list_quest_kingdom"} */

    
    select schema_name
    from system.information_schema.schemata
    
    where lower(catalog_name) = '"quest_kingdom"'
    
  
  
[0m16:31:09.948032 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:31:09.967211 [debug] [ThreadPool]: SQL status: OK in 0.019 seconds
[0m16:31:09.968167 [debug] [ThreadPool]: On list_quest_kingdom: Close
[0m16:31:09.968531 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_quest_kingdom, now create_quest_kingdom_main)
[0m16:31:09.968767 [debug] [ThreadPool]: Creating schema "database: "quest_kingdom"
schema: "main"
"
[0m16:31:09.972201 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m16:31:09.972398 [debug] [ThreadPool]: On create_quest_kingdom_main: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "create_quest_kingdom_main"} */

    
        select type from duckdb_databases()
        where lower(database_name)='quest_kingdom'
        and type='sqlite'
    
  
[0m16:31:09.972544 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:31:09.973367 [debug] [ThreadPool]: SQL status: OK in 0.001 seconds
[0m16:31:09.974132 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m16:31:09.974270 [debug] [ThreadPool]: On create_quest_kingdom_main: BEGIN
[0m16:31:09.974489 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m16:31:09.974617 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m16:31:09.974742 [debug] [ThreadPool]: On create_quest_kingdom_main: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "create_quest_kingdom_main"} */

    
    
        create schema if not exists "quest_kingdom"."main"
    
[0m16:31:09.975138 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m16:31:09.975516 [debug] [ThreadPool]: On create_quest_kingdom_main: COMMIT
[0m16:31:09.975646 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m16:31:09.975761 [debug] [ThreadPool]: On create_quest_kingdom_main: COMMIT
[0m16:31:09.975951 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m16:31:09.976079 [debug] [ThreadPool]: On create_quest_kingdom_main: Close
[0m16:31:09.977002 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_quest_kingdom_main, now list_quest_kingdom_main)
[0m16:31:09.979656 [debug] [ThreadPool]: Using duckdb connection "list_quest_kingdom_main"
[0m16:31:09.979814 [debug] [ThreadPool]: On list_quest_kingdom_main: BEGIN
[0m16:31:09.979994 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:31:09.980238 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m16:31:09.980368 [debug] [ThreadPool]: Using duckdb connection "list_quest_kingdom_main"
[0m16:31:09.980501 [debug] [ThreadPool]: On list_quest_kingdom_main: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "list_quest_kingdom_main"} */
select
      'quest_kingdom' as database,
      table_name as name,
      table_schema as schema,
      CASE table_type
        WHEN 'BASE TABLE' THEN 'table'
        WHEN 'VIEW' THEN 'view'
        WHEN 'LOCAL TEMPORARY' THEN 'table'
        END as type
    from system.information_schema.tables
    where lower(table_schema) = 'main'
    and lower(table_catalog) = 'quest_kingdom'
  
[0m16:31:09.991467 [debug] [ThreadPool]: SQL status: OK in 0.011 seconds
[0m16:31:09.992328 [debug] [ThreadPool]: On list_quest_kingdom_main: ROLLBACK
[0m16:31:09.993357 [debug] [ThreadPool]: Failed to rollback 'list_quest_kingdom_main'
[0m16:31:09.993524 [debug] [ThreadPool]: On list_quest_kingdom_main: Close
[0m16:31:09.994873 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fe2b08d8-ad75-4df5-af1a-33a020c29b76', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1048078c0>]}
[0m16:31:09.995113 [debug] [MainThread]: Using duckdb connection "master"
[0m16:31:09.995245 [debug] [MainThread]: On master: BEGIN
[0m16:31:09.995369 [debug] [MainThread]: Opening a new connection, currently in state init
[0m16:31:09.995644 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m16:31:09.995770 [debug] [MainThread]: On master: COMMIT
[0m16:31:09.995890 [debug] [MainThread]: Using duckdb connection "master"
[0m16:31:09.996005 [debug] [MainThread]: On master: COMMIT
[0m16:31:09.996190 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m16:31:09.996313 [debug] [MainThread]: On master: Close
[0m16:31:09.998305 [debug] [Thread-1 (]: Began running node model.quest_kingdom.rpt_feature_engagement
[0m16:31:09.998693 [info ] [Thread-1 (]: 1 of 4 START sql table model main.rpt_feature_engagement ....................... [RUN]
[0m16:31:09.999188 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_quest_kingdom_main, now model.quest_kingdom.rpt_feature_engagement)
[0m16:31:09.999435 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.rpt_feature_engagement
[0m16:31:10.003502 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.rpt_feature_engagement"
[0m16:31:10.003992 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.rpt_feature_engagement
[0m16:31:10.020565 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.rpt_feature_engagement"
[0m16:31:10.021112 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_feature_engagement"
[0m16:31:10.021286 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_feature_engagement: BEGIN
[0m16:31:10.021435 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:31:10.021799 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:31:10.021944 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_feature_engagement"
[0m16:31:10.022149 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_feature_engagement: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_feature_engagement"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_feature_engagement__dbt_tmp"
  
    as (
      

with events as (
    select * from "quest_kingdom"."main"."stg_events"
),

players as (
    select * from "quest_kingdom"."main"."dim_players"
),

--aggregate events per player
player_events as (
    select 
        player_id,

        --event counts
        count(*) as total_events,
        count(distinct event_name) as unique_event_types,

        --specific events
        sum(case when event_name = 'tutorial_completed' then 1 else 0 end) as tutorial_completions,
        sum(case when event_name = 'level_completed' then 1 else 0 end) as level_completions,
        sum(case when event_name = 'boss_defeated' then 1 else 0 end) as boss_defeats,

        --timing
        min(event_at) as first_event_at,
        max(event_at) as last_event_at
    from events 
    group by player_id 

),

--combine with player data
final as (
    select 
        p.player_id,
        p.installed_at,
        p.cohort_week,
        p.attribution_channel,
        p.player_segment,
        p.experiment_variant,
        p.is_payer,

        --events
        coalesce(pe.total_events, 0) as total_events,
        coalesce(pe.unique_event_types, 0) as unique_event_types,
        coalesce(pe.tutorial_completions, 0) as tutorial_completions,
        coalesce(pe.boss_defeats, 0) as boss_defeats,

        --derived
        case 
            when pe.tutorial_completions > 0 then true 
            else false 
        end as completed_tutorial,

        case
            when pe.boss_defeats > 0 then true
            else false 
        end defeated_boss,

        --events per session (if they have sessions)
        case
            when p.total_sessions > 0 
            then coalesce(pe.total_events, 0)::float / p.total_sessions
            else 0
        end events_per_session,

        --engagement level based on events
        case 
            when coalesce(pe.total_events, 0) >= 50 then 'Power User (50+)'
            when coalesce(pe.total_events, 0) >= 20 then 'Engaged (20-49)'
            when coalesce(pe.total_events, 0) >= 5 then 'Active (5-19)'
            when coalesce(pe.total_events, 0) >= 1 then 'Casual (1-4)'
            else 'No Events'
        end as event_engagement_tier
    from players p 
    left join player_events pe on p.player_id = pe.player_id 
 )

 
 select * from final
    );
  
  
[0m16:31:10.042132 [debug] [Thread-1 (]: SQL status: OK in 0.020 seconds
[0m16:31:10.045068 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_feature_engagement"
[0m16:31:10.045288 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_feature_engagement: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_feature_engagement"} */

    SELECT index_name
    FROM duckdb_indexes()
    WHERE schema_name = 'main'
      AND table_name = 'rpt_feature_engagement'
  
[0m16:31:10.046019 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:31:10.046669 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_feature_engagement"
[0m16:31:10.046846 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_feature_engagement: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_feature_engagement"} */

    SELECT COUNT(*) as remaining_indexes
    FROM duckdb_indexes()
    WHERE schema_name = 'main'
      AND table_name = 'rpt_feature_engagement'
  
[0m16:31:10.047852 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m16:31:10.051006 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_feature_engagement"
[0m16:31:10.051206 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_feature_engagement: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_feature_engagement"} */
alter table "quest_kingdom"."main"."rpt_feature_engagement" rename to "rpt_feature_engagement__dbt_backup"
[0m16:31:10.052248 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m16:31:10.053629 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_feature_engagement"
[0m16:31:10.053787 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_feature_engagement: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_feature_engagement"} */
alter table "quest_kingdom"."main"."rpt_feature_engagement__dbt_tmp" rename to "rpt_feature_engagement"
[0m16:31:10.054067 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:31:10.061533 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_feature_engagement: COMMIT
[0m16:31:10.061776 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_feature_engagement"
[0m16:31:10.062003 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_feature_engagement: COMMIT
[0m16:31:10.064993 [debug] [Thread-1 (]: SQL status: OK in 0.003 seconds
[0m16:31:10.067690 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_feature_engagement"
[0m16:31:10.067872 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_feature_engagement: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_feature_engagement"} */

      drop table if exists "quest_kingdom"."main"."rpt_feature_engagement__dbt_backup" cascade
    
[0m16:31:10.068582 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m16:31:10.069771 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_feature_engagement: Close
[0m16:31:10.070759 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fe2b08d8-ad75-4df5-af1a-33a020c29b76', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107bdec90>]}
[0m16:31:10.071254 [info ] [Thread-1 (]: 1 of 4 OK created sql table model main.rpt_feature_engagement .................. [[32mOK[0m in 0.07s]
[0m16:31:10.071534 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.rpt_feature_engagement
[0m16:31:10.071725 [debug] [Thread-1 (]: Began running node model.quest_kingdom.rpt_level_progression
[0m16:31:10.071954 [info ] [Thread-1 (]: 2 of 4 START sql table model main.rpt_level_progression ........................ [RUN]
[0m16:31:10.072153 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.quest_kingdom.rpt_feature_engagement, now model.quest_kingdom.rpt_level_progression)
[0m16:31:10.072314 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.rpt_level_progression
[0m16:31:10.074021 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.rpt_level_progression"
[0m16:31:10.074417 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.rpt_level_progression
[0m16:31:10.076012 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.rpt_level_progression"
[0m16:31:10.076369 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_level_progression"
[0m16:31:10.076529 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_level_progression: BEGIN
[0m16:31:10.076677 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:31:10.076997 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:31:10.077147 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_level_progression"
[0m16:31:10.077383 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_level_progression: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_level_progression"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_level_progression__dbt_tmp"
  
    as (
      

with sessions as (
    select * from "quest_kingdom"."main"."fct_sessions"
),

players as (
    select * from "quest_kingdom"."main"."dim_players"
),

--track level progression per player
player_levels as (
    select 
        player_id,
        min(session_started_at) as first_session_at,
        max(ending_level) as max_level_reached,
        sum(levels_gained) as total_levels_gained,

        --time to reach certain milestones
        min(case when ending_level >= 5 then session_started_at end) as reached_level_5_at,
        min(case when ending_level >= 10 then session_started_at end) as reached_level_10_at,
        min(case when ending_level >= 20 then session_started_at end) as reached_level_20_at,
        min(case when ending_level >= 30 then session_started_at end) as reached_level_30_at,
        min(case when ending_level >= 40 then session_started_at end) as reached_level_40_at,
        min(case when ending_level >= 50 then session_started_at end) as reached_level_50_at,

        --progression metrics
        count(*) as total_sessions,
        sum(session_duration_minutes) as total_play_time,
        avg(session_duration_minutes) as avg_session_duration
    from sessions 
    group by player_id 
),

--combine with player attributes
final as (
    select 
        pl.player_id,
        p.installed_at,
        p.cohort_week,
        p.attribution_channel,
        p.player_segment,
        p.experiment_variant,
        p.is_payer,

        --progression
        pl.max_level_reached,
        pl.total_levels_gained,

        --milestones
        pl.reached_level_5_at,
        pl.reached_level_10_at,
        pl.reached_level_20_at,
        pl.reached_level_30_at,
        pl.reached_level_40_at,
        pl.reached_level_50_at,

        --time to milestones (in hours)
        case 
            when pl.reached_level_5_at is not null 
            then datediff('hour', pl.first_session_at, pl.reached_level_5_at)
        end as hours_to_level_5,
        case 
            when pl.reached_level_10_at is not null 
            then datediff('hour', pl.first_session_at, pl.reached_level_10_at)
        end as hours_to_level_10,
        case 
            when pl.reached_level_20_at is not null 
            then datediff('hour', pl.first_session_at, pl.reached_level_20_at)
        end as hours_to_level_20,
       
       --engagement
       pl.total_sessions,
       pl.total_play_time,
       pl.avg_session_duration,

       --progression velocity (levels per hour player)
       case 
            when pl.total_play_time > 0 
            then pl.total_levels_gained::float / (pl.total_player / 60)
            else 0
        end as levels_per_hour,

        --progression tiers
        case 
            when pl.max_level_reached >= 40 then 'End Game (40+)'
            when pl.max_level_reached >= 30 then 'Late Game (30-39)'
            when pl.max_level_reached >= 20 then 'Mid Game (20-29)'
            when pl.max_level_reached >= 10 then 'Early Game (10-19)'
            when pl.max_level_reached >= 5 then 'Tutorial+ (5-9)'
            else 'Tutorial (1-4)'
        end as progression_tier 
    from player_levels pl 
    inner join players p on pl.player_id = p.player_id
)

select * from final
    );
  
  
[0m16:31:10.082128 [debug] [Thread-1 (]: DuckDB adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_level_progression"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_level_progression__dbt_tmp"
  
    as (
      

with sessions as (
    select * from "quest_kingdom"."main"."fct_sessions"
),

players as (
    select * from "quest_kingdom"."main"."dim_players"
),

--track level progression per player
player_levels as (
    select 
        player_id,
        min(session_started_at) as first_session_at,
        max(ending_level) as max_level_reached,
        sum(levels_gained) as total_levels_gained,

        --time to reach certain milestones
        min(case when ending_level >= 5 then session_started_at end) as reached_level_5_at,
        min(case when ending_level >= 10 then session_started_at end) as reached_level_10_at,
        min(case when ending_level >= 20 then session_started_at end) as reached_level_20_at,
        min(case when ending_level >= 30 then session_started_at end) as reached_level_30_at,
        min(case when ending_level >= 40 then session_started_at end) as reached_level_40_at,
        min(case when ending_level >= 50 then session_started_at end) as reached_level_50_at,

        --progression metrics
        count(*) as total_sessions,
        sum(session_duration_minutes) as total_play_time,
        avg(session_duration_minutes) as avg_session_duration
    from sessions 
    group by player_id 
),

--combine with player attributes
final as (
    select 
        pl.player_id,
        p.installed_at,
        p.cohort_week,
        p.attribution_channel,
        p.player_segment,
        p.experiment_variant,
        p.is_payer,

        --progression
        pl.max_level_reached,
        pl.total_levels_gained,

        --milestones
        pl.reached_level_5_at,
        pl.reached_level_10_at,
        pl.reached_level_20_at,
        pl.reached_level_30_at,
        pl.reached_level_40_at,
        pl.reached_level_50_at,

        --time to milestones (in hours)
        case 
            when pl.reached_level_5_at is not null 
            then datediff('hour', pl.first_session_at, pl.reached_level_5_at)
        end as hours_to_level_5,
        case 
            when pl.reached_level_10_at is not null 
            then datediff('hour', pl.first_session_at, pl.reached_level_10_at)
        end as hours_to_level_10,
        case 
            when pl.reached_level_20_at is not null 
            then datediff('hour', pl.first_session_at, pl.reached_level_20_at)
        end as hours_to_level_20,
       
       --engagement
       pl.total_sessions,
       pl.total_play_time,
       pl.avg_session_duration,

       --progression velocity (levels per hour player)
       case 
            when pl.total_play_time > 0 
            then pl.total_levels_gained::float / (pl.total_player / 60)
            else 0
        end as levels_per_hour,

        --progression tiers
        case 
            when pl.max_level_reached >= 40 then 'End Game (40+)'
            when pl.max_level_reached >= 30 then 'Late Game (30-39)'
            when pl.max_level_reached >= 20 then 'Mid Game (20-29)'
            when pl.max_level_reached >= 10 then 'Early Game (10-19)'
            when pl.max_level_reached >= 5 then 'Tutorial+ (5-9)'
            else 'Tutorial (1-4)'
        end as progression_tier 
    from player_levels pl 
    inner join players p on pl.player_id = p.player_id
)

select * from final
    );
  
  
[0m16:31:10.082461 [debug] [Thread-1 (]: DuckDB adapter: Rolling back transaction.
[0m16:31:10.082689 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_level_progression: ROLLBACK
[0m16:31:10.086999 [debug] [Thread-1 (]: Failed to rollback 'model.quest_kingdom.rpt_level_progression'
[0m16:31:10.087182 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_level_progression: Close
[0m16:31:10.088347 [debug] [Thread-1 (]: Runtime Error in model rpt_level_progression (models/marts/product/rpt_level_progression.sql)
  Binder Error: Values list "pl" does not have a column named "total_player"
  
  LINE 90:             then pl.total_levels_gained::float / (pl.total_player / 60)
                                                             ^
[0m16:31:10.088576 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fe2b08d8-ad75-4df5-af1a-33a020c29b76', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107cb9c70>]}
[0m16:31:10.088887 [error] [Thread-1 (]: 2 of 4 ERROR creating sql table model main.rpt_level_progression ............... [[31mERROR[0m in 0.02s]
[0m16:31:10.089218 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.rpt_level_progression
[0m16:31:10.089413 [debug] [Thread-1 (]: Began running node model.quest_kingdom.rpt_session_quality
[0m16:31:10.089611 [debug] [Thread-4 (]: Marking all children of 'model.quest_kingdom.rpt_level_progression' to be skipped because of status 'error'.  Reason: Runtime Error in model rpt_level_progression (models/marts/product/rpt_level_progression.sql)
  Binder Error: Values list "pl" does not have a column named "total_player"
  
  LINE 90:             then pl.total_levels_gained::float / (pl.total_player / 60)
                                                             ^.
[0m16:31:10.089828 [info ] [Thread-1 (]: 3 of 4 START sql table model main.rpt_session_quality .......................... [RUN]
[0m16:31:10.090454 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.quest_kingdom.rpt_level_progression, now model.quest_kingdom.rpt_session_quality)
[0m16:31:10.090642 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.rpt_session_quality
[0m16:31:10.092362 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.rpt_session_quality"
[0m16:31:10.092770 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.rpt_session_quality
[0m16:31:10.094384 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.rpt_session_quality"
[0m16:31:10.094727 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_session_quality"
[0m16:31:10.094885 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_session_quality: BEGIN
[0m16:31:10.095031 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:31:10.095458 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:31:10.095615 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_session_quality"
[0m16:31:10.095842 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_session_quality: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_session_quality"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_session_quality__dbt_tmp"
  
    as (
      

with sessions as (

    select * from "quest_kingdom"."main"."fct_sessions"

),

-- Calculate days between sessions first
session_spacing as (

    select
        player_id,
        session_started_at,
        datediff('day', 
            lag(session_started_at) over (partition by player_id order by session_started_at), 
            session_started_at
        ) as days_since_last_session

    from sessions

),

-- Aggregate session metrics
session_metrics as (

    select
        s.player_id,
        s.attribution_channel,
        s.player_segment,
        s.experiment_variant,
        
        -- Session counts
        count(*) as total_sessions,
        count(case when s.is_quality_session then 1 end) as quality_sessions,
        count(case when s.had_progression then 1 end) as sessions_with_progression,
        
        -- Duration metrics
        avg(s.session_duration_minutes) as avg_session_duration,
        sum(s.session_duration_minutes) as total_play_time,
        max(s.session_duration_minutes) as longest_session,
        
        -- Progression metrics
        sum(s.levels_gained) as total_levels_gained,
        avg(s.levels_gained) as avg_levels_per_session,
        
        -- Time of day patterns
        count(case when s.time_of_day = 'morning' then 1 end) as morning_sessions,
        count(case when s.time_of_day = 'afternoon' then 1 end) as afternoon_sessions,
        count(case when s.time_of_day = 'evening' then 1 end) as evening_sessions,
        count(case when s.time_of_day = 'night' then 1 end) as night_sessions,
        
        -- Weekend vs weekday
        count(case when s.is_weekend then 1 end) as weekend_sessions,
        count(case when not s.is_weekend then 1 end) as weekday_sessions

    from sessions s
    group by s.player_id, s.attribution_channel, s.player_segment, s.experiment_variant

),

-- Calculate average spacing separately
avg_spacing as (

    select
        player_id,
        avg(days_since_last_session) as avg_days_between_sessions

    from session_spacing
    where days_since_last_session is not null
    group by player_id

),

-- Add derived metrics
final as (

    select
        sm.*,
        sp.avg_days_between_sessions,
        
        -- Quality rates
        round(sm.quality_sessions::float / sm.total_sessions * 100, 1) as quality_session_pct,
        round(sm.sessions_with_progression::float / sm.total_sessions * 100, 1) as progression_session_pct,
        
        -- Engagement patterns
        round(sm.weekend_sessions::float / sm.total_sessions * 100, 1) as weekend_session_pct,
        
        -- Preferred time of day
        case
            when sm.evening_sessions > sm.morning_sessions 
                and sm.evening_sessions > sm.afternoon_sessions 
                and sm.evening_sessions > sm.night_sessions 
            then 'Evening'
            when sm.morning_sessions > sm.afternoon_sessions 
                and sm.morning_sessions > sm.night_sessions 
            then 'Morning'
            when sm.afternoon_sessions > sm.night_sessions then 'Afternoon'
            else 'Night'
        end as preferred_play_time,
        
        -- Engagement tier
        case
            when sm.total_sessions >= 20 then 'Power User (20+)'
            when sm.total_sessions >= 10 then 'Engaged (10-19)'
            when sm.total_sessions >= 5 then 'Regular (5-9)'
            else 'Casual (1-4)'
        end as engagement_tier

    from session_metrics sm
    left join avg_spacing sp on sm.player_id = sp.player_id

)

select * from final
    );
  
  
[0m16:31:10.097091 [debug] [Thread-1 (]: DuckDB adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_session_quality"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_session_quality__dbt_tmp"
  
    as (
      

with sessions as (

    select * from "quest_kingdom"."main"."fct_sessions"

),

-- Calculate days between sessions first
session_spacing as (

    select
        player_id,
        session_started_at,
        datediff('day', 
            lag(session_started_at) over (partition by player_id order by session_started_at), 
            session_started_at
        ) as days_since_last_session

    from sessions

),

-- Aggregate session metrics
session_metrics as (

    select
        s.player_id,
        s.attribution_channel,
        s.player_segment,
        s.experiment_variant,
        
        -- Session counts
        count(*) as total_sessions,
        count(case when s.is_quality_session then 1 end) as quality_sessions,
        count(case when s.had_progression then 1 end) as sessions_with_progression,
        
        -- Duration metrics
        avg(s.session_duration_minutes) as avg_session_duration,
        sum(s.session_duration_minutes) as total_play_time,
        max(s.session_duration_minutes) as longest_session,
        
        -- Progression metrics
        sum(s.levels_gained) as total_levels_gained,
        avg(s.levels_gained) as avg_levels_per_session,
        
        -- Time of day patterns
        count(case when s.time_of_day = 'morning' then 1 end) as morning_sessions,
        count(case when s.time_of_day = 'afternoon' then 1 end) as afternoon_sessions,
        count(case when s.time_of_day = 'evening' then 1 end) as evening_sessions,
        count(case when s.time_of_day = 'night' then 1 end) as night_sessions,
        
        -- Weekend vs weekday
        count(case when s.is_weekend then 1 end) as weekend_sessions,
        count(case when not s.is_weekend then 1 end) as weekday_sessions

    from sessions s
    group by s.player_id, s.attribution_channel, s.player_segment, s.experiment_variant

),

-- Calculate average spacing separately
avg_spacing as (

    select
        player_id,
        avg(days_since_last_session) as avg_days_between_sessions

    from session_spacing
    where days_since_last_session is not null
    group by player_id

),

-- Add derived metrics
final as (

    select
        sm.*,
        sp.avg_days_between_sessions,
        
        -- Quality rates
        round(sm.quality_sessions::float / sm.total_sessions * 100, 1) as quality_session_pct,
        round(sm.sessions_with_progression::float / sm.total_sessions * 100, 1) as progression_session_pct,
        
        -- Engagement patterns
        round(sm.weekend_sessions::float / sm.total_sessions * 100, 1) as weekend_session_pct,
        
        -- Preferred time of day
        case
            when sm.evening_sessions > sm.morning_sessions 
                and sm.evening_sessions > sm.afternoon_sessions 
                and sm.evening_sessions > sm.night_sessions 
            then 'Evening'
            when sm.morning_sessions > sm.afternoon_sessions 
                and sm.morning_sessions > sm.night_sessions 
            then 'Morning'
            when sm.afternoon_sessions > sm.night_sessions then 'Afternoon'
            else 'Night'
        end as preferred_play_time,
        
        -- Engagement tier
        case
            when sm.total_sessions >= 20 then 'Power User (20+)'
            when sm.total_sessions >= 10 then 'Engaged (10-19)'
            when sm.total_sessions >= 5 then 'Regular (5-9)'
            else 'Casual (1-4)'
        end as engagement_tier

    from session_metrics sm
    left join avg_spacing sp on sm.player_id = sp.player_id

)

select * from final
    );
  
  
[0m16:31:10.097350 [debug] [Thread-1 (]: DuckDB adapter: Rolling back transaction.
[0m16:31:10.097555 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_session_quality: ROLLBACK
[0m16:31:10.098968 [debug] [Thread-1 (]: Failed to rollback 'model.quest_kingdom.rpt_session_quality'
[0m16:31:10.099123 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_session_quality: Close
[0m16:31:10.100284 [debug] [Thread-1 (]: Runtime Error in model rpt_session_quality (models/marts/product/rpt_session_quality.sql)
  Binder Error: Values list "s" does not have a column named "had_progression"
  
  LINE 46:         count(case when s.had_progression then 1 end) as sessions_with_progression,
                                   ^
[0m16:31:10.100506 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fe2b08d8-ad75-4df5-af1a-33a020c29b76', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107d29190>]}
[0m16:31:10.100795 [error] [Thread-1 (]: 3 of 4 ERROR creating sql table model main.rpt_session_quality ................. [[31mERROR[0m in 0.01s]
[0m16:31:10.101043 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.rpt_session_quality
[0m16:31:10.101225 [debug] [Thread-1 (]: Began running node model.quest_kingdom.rpt_level_funnel
[0m16:31:10.101471 [debug] [Thread-4 (]: Marking all children of 'model.quest_kingdom.rpt_session_quality' to be skipped because of status 'error'.  Reason: Runtime Error in model rpt_session_quality (models/marts/product/rpt_session_quality.sql)
  Binder Error: Values list "s" does not have a column named "had_progression"
  
  LINE 46:         count(case when s.had_progression then 1 end) as sessions_with_progression,
                                   ^.
[0m16:31:10.101665 [info ] [Thread-1 (]: 4 of 4 SKIP relation main.rpt_level_funnel ..................................... [[33mSKIP[0m]
[0m16:31:10.101922 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.rpt_level_funnel
[0m16:31:10.102678 [debug] [MainThread]: Using duckdb connection "master"
[0m16:31:10.102821 [debug] [MainThread]: On master: BEGIN
[0m16:31:10.102941 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m16:31:10.103222 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m16:31:10.103350 [debug] [MainThread]: On master: COMMIT
[0m16:31:10.103472 [debug] [MainThread]: Using duckdb connection "master"
[0m16:31:10.103582 [debug] [MainThread]: On master: COMMIT
[0m16:31:10.103774 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m16:31:10.103898 [debug] [MainThread]: On master: Close
[0m16:31:10.104060 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:31:10.104169 [debug] [MainThread]: Connection 'model.quest_kingdom.rpt_session_quality' was properly closed.
[0m16:31:10.104322 [info ] [MainThread]: 
[0m16:31:10.104461 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 0.19 seconds (0.19s).
[0m16:31:10.104887 [debug] [MainThread]: Command end result
[0m16:31:10.125524 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/manifest.json
[0m16:31:10.132589 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/semantic_manifest.json
[0m16:31:10.136184 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/run_results.json
[0m16:31:10.136358 [info ] [MainThread]: 
[0m16:31:10.136528 [info ] [MainThread]: [31mCompleted with 2 errors, 0 partial successes, and 0 warnings:[0m
[0m16:31:10.136672 [info ] [MainThread]: 
[0m16:31:10.136844 [error] [MainThread]: [31mFailure in model rpt_level_progression (models/marts/product/rpt_level_progression.sql)[0m
[0m16:31:10.137014 [error] [MainThread]:   Runtime Error in model rpt_level_progression (models/marts/product/rpt_level_progression.sql)
  Binder Error: Values list "pl" does not have a column named "total_player"
  
  LINE 90:             then pl.total_levels_gained::float / (pl.total_player / 60)
                                                             ^
[0m16:31:10.137140 [info ] [MainThread]: 
[0m16:31:10.137289 [info ] [MainThread]:   compiled code at target/compiled/quest_kingdom/models/marts/product/rpt_level_progression.sql
[0m16:31:10.137418 [info ] [MainThread]: 
[0m16:31:10.137573 [error] [MainThread]: [31mFailure in model rpt_session_quality (models/marts/product/rpt_session_quality.sql)[0m
[0m16:31:10.137733 [error] [MainThread]:   Runtime Error in model rpt_session_quality (models/marts/product/rpt_session_quality.sql)
  Binder Error: Values list "s" does not have a column named "had_progression"
  
  LINE 46:         count(case when s.had_progression then 1 end) as sessions_with_progression,
                                   ^
[0m16:31:10.137860 [info ] [MainThread]: 
[0m16:31:10.138004 [info ] [MainThread]:   compiled code at target/compiled/quest_kingdom/models/marts/product/rpt_session_quality.sql
[0m16:31:10.138124 [info ] [MainThread]: 
[0m16:31:10.138263 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=2 SKIP=1 NO-OP=0 TOTAL=4
[0m16:31:10.139373 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.86978555, "process_in_blocks": "0", "process_kernel_time": 0.196729, "process_mem_max_rss": "167706624", "process_out_blocks": "0", "process_user_time": 1.308692}
[0m16:31:10.139630 [debug] [MainThread]: Command `dbt run` failed at 16:31:10.139583 after 0.87 seconds
[0m16:31:10.139824 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107085940>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106811760>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107831340>]}
[0m16:31:10.139998 [debug] [MainThread]: Flushing usage events
[0m16:31:10.238207 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m16:33:01.250844 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10424ab70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1048c1a30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1048c1820>]}


============================== 16:33:01.263253 | 55b8875d-9740-42ef-9d31-625f24ba4ee4 ==============================
[0m16:33:01.263253 [info ] [MainThread]: Running with dbt=1.11.4
[0m16:33:01.263577 [debug] [MainThread]: running dbt with arguments {'use_colors': 'True', 'version_check': 'True', 'indirect_selection': 'eager', 'log_format': 'default', 'send_anonymous_usage_stats': 'True', 'profiles_dir': '/Users/hazeldonaldson/.dbt', 'invocation_command': 'dbt run --select path:models/marts/product', 'debug': 'False', 'no_print': 'None', 'fail_fast': 'False', 'printer_width': '80', 'empty': 'False', 'target_path': 'None', 'log_cache_events': 'False', 'log_path': '/Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/logs', 'use_experimental_parser': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'introspect': 'True', 'warn_error': 'None', 'static_parser': 'True', 'quiet': 'False', 'cache_selected_only': 'False', 'write_json': 'True', 'partial_parse': 'True'}
[0m16:33:01.426325 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '55b8875d-9740-42ef-9d31-625f24ba4ee4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x101f6fb60>]}
[0m16:33:01.457164 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '55b8875d-9740-42ef-9d31-625f24ba4ee4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102ae3980>]}
[0m16:33:01.458561 [info ] [MainThread]: Registered adapter: duckdb=1.10.0
[0m16:33:01.510454 [debug] [MainThread]: checksum: 092b177ba87eb6bb3c55954c38aa57900eebac336561eb9ee32218428aa81d43, vars: {}, profile: , target: , version: 1.11.4
[0m16:33:01.580253 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 2 files changed.
[0m16:33:01.580748 [debug] [MainThread]: Partial parsing: updated file: quest_kingdom://models/marts/product/rpt_session_quality.sql
[0m16:33:01.580964 [debug] [MainThread]: Partial parsing: updated file: quest_kingdom://models/marts/product/rpt_level_progression.sql
[0m16:33:01.781680 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '55b8875d-9740-42ef-9d31-625f24ba4ee4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105176ae0>]}
[0m16:33:01.862081 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/manifest.json
[0m16:33:01.863594 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/semantic_manifest.json
[0m16:33:01.879070 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '55b8875d-9740-42ef-9d31-625f24ba4ee4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105068a40>]}
[0m16:33:01.879361 [info ] [MainThread]: Found 19 models, 48 data tests, 5 sources, 472 macros
[0m16:33:01.879530 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '55b8875d-9740-42ef-9d31-625f24ba4ee4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1050497f0>]}
[0m16:33:01.881464 [info ] [MainThread]: 
[0m16:33:01.881644 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m16:33:01.881778 [info ] [MainThread]: 
[0m16:33:01.881999 [debug] [MainThread]: Acquiring new duckdb connection 'master'
[0m16:33:01.884122 [debug] [ThreadPool]: Acquiring new duckdb connection 'list_quest_kingdom'
[0m16:33:01.913361 [debug] [ThreadPool]: Using duckdb connection "list_quest_kingdom"
[0m16:33:01.913610 [debug] [ThreadPool]: On list_quest_kingdom: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "list_quest_kingdom"} */

    
    select schema_name
    from system.information_schema.schemata
    
    where lower(catalog_name) = '"quest_kingdom"'
    
  
  
[0m16:33:01.914185 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:33:01.934020 [debug] [ThreadPool]: SQL status: OK in 0.020 seconds
[0m16:33:01.935338 [debug] [ThreadPool]: On list_quest_kingdom: Close
[0m16:33:01.936258 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_quest_kingdom, now create_quest_kingdom_main)
[0m16:33:01.936607 [debug] [ThreadPool]: Creating schema "database: "quest_kingdom"
schema: "main"
"
[0m16:33:01.940478 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m16:33:01.940738 [debug] [ThreadPool]: On create_quest_kingdom_main: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "create_quest_kingdom_main"} */

    
        select type from duckdb_databases()
        where lower(database_name)='quest_kingdom'
        and type='sqlite'
    
  
[0m16:33:01.940881 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:33:01.941833 [debug] [ThreadPool]: SQL status: OK in 0.001 seconds
[0m16:33:01.942500 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m16:33:01.942634 [debug] [ThreadPool]: On create_quest_kingdom_main: BEGIN
[0m16:33:01.942882 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m16:33:01.943053 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m16:33:01.943192 [debug] [ThreadPool]: On create_quest_kingdom_main: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "create_quest_kingdom_main"} */

    
    
        create schema if not exists "quest_kingdom"."main"
    
[0m16:33:01.943458 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m16:33:01.943884 [debug] [ThreadPool]: On create_quest_kingdom_main: COMMIT
[0m16:33:01.944031 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m16:33:01.944156 [debug] [ThreadPool]: On create_quest_kingdom_main: COMMIT
[0m16:33:01.944373 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m16:33:01.944504 [debug] [ThreadPool]: On create_quest_kingdom_main: Close
[0m16:33:01.945470 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_quest_kingdom_main, now list_quest_kingdom_main)
[0m16:33:01.948122 [debug] [ThreadPool]: Using duckdb connection "list_quest_kingdom_main"
[0m16:33:01.948287 [debug] [ThreadPool]: On list_quest_kingdom_main: BEGIN
[0m16:33:01.948469 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:33:01.948729 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m16:33:01.948865 [debug] [ThreadPool]: Using duckdb connection "list_quest_kingdom_main"
[0m16:33:01.948999 [debug] [ThreadPool]: On list_quest_kingdom_main: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "list_quest_kingdom_main"} */
select
      'quest_kingdom' as database,
      table_name as name,
      table_schema as schema,
      CASE table_type
        WHEN 'BASE TABLE' THEN 'table'
        WHEN 'VIEW' THEN 'view'
        WHEN 'LOCAL TEMPORARY' THEN 'table'
        END as type
    from system.information_schema.tables
    where lower(table_schema) = 'main'
    and lower(table_catalog) = 'quest_kingdom'
  
[0m16:33:01.958690 [debug] [ThreadPool]: SQL status: OK in 0.010 seconds
[0m16:33:01.959545 [debug] [ThreadPool]: On list_quest_kingdom_main: ROLLBACK
[0m16:33:01.960515 [debug] [ThreadPool]: Failed to rollback 'list_quest_kingdom_main'
[0m16:33:01.960677 [debug] [ThreadPool]: On list_quest_kingdom_main: Close
[0m16:33:01.962218 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '55b8875d-9740-42ef-9d31-625f24ba4ee4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104962b10>]}
[0m16:33:01.962453 [debug] [MainThread]: Using duckdb connection "master"
[0m16:33:01.962591 [debug] [MainThread]: On master: BEGIN
[0m16:33:01.962718 [debug] [MainThread]: Opening a new connection, currently in state init
[0m16:33:01.962990 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m16:33:01.963121 [debug] [MainThread]: On master: COMMIT
[0m16:33:01.963242 [debug] [MainThread]: Using duckdb connection "master"
[0m16:33:01.963358 [debug] [MainThread]: On master: COMMIT
[0m16:33:01.963549 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m16:33:01.963671 [debug] [MainThread]: On master: Close
[0m16:33:01.964966 [debug] [Thread-1 (]: Began running node model.quest_kingdom.rpt_feature_engagement
[0m16:33:01.965208 [info ] [Thread-1 (]: 1 of 4 START sql table model main.rpt_feature_engagement ....................... [RUN]
[0m16:33:01.965409 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_quest_kingdom_main, now model.quest_kingdom.rpt_feature_engagement)
[0m16:33:01.965567 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.rpt_feature_engagement
[0m16:33:01.970185 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.rpt_feature_engagement"
[0m16:33:01.970932 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.rpt_feature_engagement
[0m16:33:01.986298 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.rpt_feature_engagement"
[0m16:33:01.987341 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_feature_engagement"
[0m16:33:01.987543 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_feature_engagement: BEGIN
[0m16:33:01.987707 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:33:01.988083 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:33:01.988238 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_feature_engagement"
[0m16:33:01.988445 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_feature_engagement: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_feature_engagement"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_feature_engagement__dbt_tmp"
  
    as (
      

with events as (
    select * from "quest_kingdom"."main"."stg_events"
),

players as (
    select * from "quest_kingdom"."main"."dim_players"
),

--aggregate events per player
player_events as (
    select 
        player_id,

        --event counts
        count(*) as total_events,
        count(distinct event_name) as unique_event_types,

        --specific events
        sum(case when event_name = 'tutorial_completed' then 1 else 0 end) as tutorial_completions,
        sum(case when event_name = 'level_completed' then 1 else 0 end) as level_completions,
        sum(case when event_name = 'boss_defeated' then 1 else 0 end) as boss_defeats,

        --timing
        min(event_at) as first_event_at,
        max(event_at) as last_event_at
    from events 
    group by player_id 

),

--combine with player data
final as (
    select 
        p.player_id,
        p.installed_at,
        p.cohort_week,
        p.attribution_channel,
        p.player_segment,
        p.experiment_variant,
        p.is_payer,

        --events
        coalesce(pe.total_events, 0) as total_events,
        coalesce(pe.unique_event_types, 0) as unique_event_types,
        coalesce(pe.tutorial_completions, 0) as tutorial_completions,
        coalesce(pe.boss_defeats, 0) as boss_defeats,

        --derived
        case 
            when pe.tutorial_completions > 0 then true 
            else false 
        end as completed_tutorial,

        case
            when pe.boss_defeats > 0 then true
            else false 
        end defeated_boss,

        --events per session (if they have sessions)
        case
            when p.total_sessions > 0 
            then coalesce(pe.total_events, 0)::float / p.total_sessions
            else 0
        end events_per_session,

        --engagement level based on events
        case 
            when coalesce(pe.total_events, 0) >= 50 then 'Power User (50+)'
            when coalesce(pe.total_events, 0) >= 20 then 'Engaged (20-49)'
            when coalesce(pe.total_events, 0) >= 5 then 'Active (5-19)'
            when coalesce(pe.total_events, 0) >= 1 then 'Casual (1-4)'
            else 'No Events'
        end as event_engagement_tier
    from players p 
    left join player_events pe on p.player_id = pe.player_id 
 )

 
 select * from final
    );
  
  
[0m16:33:02.005837 [debug] [Thread-1 (]: SQL status: OK in 0.017 seconds
[0m16:33:02.008789 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_feature_engagement"
[0m16:33:02.008991 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_feature_engagement: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_feature_engagement"} */

    SELECT index_name
    FROM duckdb_indexes()
    WHERE schema_name = 'main'
      AND table_name = 'rpt_feature_engagement'
  
[0m16:33:02.009502 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:33:02.010122 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_feature_engagement"
[0m16:33:02.010941 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_feature_engagement: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_feature_engagement"} */

    SELECT COUNT(*) as remaining_indexes
    FROM duckdb_indexes()
    WHERE schema_name = 'main'
      AND table_name = 'rpt_feature_engagement'
  
[0m16:33:02.011526 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:33:02.014747 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_feature_engagement"
[0m16:33:02.014948 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_feature_engagement: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_feature_engagement"} */
alter table "quest_kingdom"."main"."rpt_feature_engagement" rename to "rpt_feature_engagement__dbt_backup"
[0m16:33:02.015744 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m16:33:02.017138 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_feature_engagement"
[0m16:33:02.017308 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_feature_engagement: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_feature_engagement"} */
alter table "quest_kingdom"."main"."rpt_feature_engagement__dbt_tmp" rename to "rpt_feature_engagement"
[0m16:33:02.017606 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:33:02.025578 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_feature_engagement: COMMIT
[0m16:33:02.025831 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_feature_engagement"
[0m16:33:02.025990 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_feature_engagement: COMMIT
[0m16:33:02.029141 [debug] [Thread-1 (]: SQL status: OK in 0.003 seconds
[0m16:33:02.031972 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_feature_engagement"
[0m16:33:02.032161 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_feature_engagement: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_feature_engagement"} */

      drop table if exists "quest_kingdom"."main"."rpt_feature_engagement__dbt_backup" cascade
    
[0m16:33:02.033012 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m16:33:02.034245 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_feature_engagement: Close
[0m16:33:02.035301 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '55b8875d-9740-42ef-9d31-625f24ba4ee4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1050c8230>]}
[0m16:33:02.035625 [info ] [Thread-1 (]: 1 of 4 OK created sql table model main.rpt_feature_engagement .................. [[32mOK[0m in 0.07s]
[0m16:33:02.035896 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.rpt_feature_engagement
[0m16:33:02.036089 [debug] [Thread-1 (]: Began running node model.quest_kingdom.rpt_level_progression
[0m16:33:02.036326 [info ] [Thread-1 (]: 2 of 4 START sql table model main.rpt_level_progression ........................ [RUN]
[0m16:33:02.036528 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.quest_kingdom.rpt_feature_engagement, now model.quest_kingdom.rpt_level_progression)
[0m16:33:02.036688 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.rpt_level_progression
[0m16:33:02.038493 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.rpt_level_progression"
[0m16:33:02.039204 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.rpt_level_progression
[0m16:33:02.040975 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.rpt_level_progression"
[0m16:33:02.041665 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_level_progression"
[0m16:33:02.041835 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_level_progression: BEGIN
[0m16:33:02.041983 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:33:02.042434 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:33:02.042706 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_level_progression"
[0m16:33:02.042980 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_level_progression: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_level_progression"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_level_progression__dbt_tmp"
  
    as (
      

with sessions as (
    select * from "quest_kingdom"."main"."fct_sessions"
),

players as (
    select * from "quest_kingdom"."main"."dim_players"
),

--track level progression per player
player_levels as (
    select 
        player_id,
        min(session_started_at) as first_session_at,
        max(ending_level) as max_level_reached,
        sum(levels_gained) as total_levels_gained,

        --time to reach certain milestones
        min(case when ending_level >= 5 then session_started_at end) as reached_level_5_at,
        min(case when ending_level >= 10 then session_started_at end) as reached_level_10_at,
        min(case when ending_level >= 20 then session_started_at end) as reached_level_20_at,
        min(case when ending_level >= 30 then session_started_at end) as reached_level_30_at,
        min(case when ending_level >= 40 then session_started_at end) as reached_level_40_at,
        min(case when ending_level >= 50 then session_started_at end) as reached_level_50_at,

        --progression metrics
        count(*) as total_sessions,
        sum(session_duration_minutes) as total_play_time,
        avg(session_duration_minutes) as avg_session_duration
    from sessions 
    group by player_id 
),

--combine with player attributes
final as (
    select 
        pl.player_id,
        p.installed_at,
        p.cohort_week,
        p.attribution_channel,
        p.player_segment,
        p.experiment_variant,
        p.is_payer,

        --progression
        pl.max_level_reached,
        pl.total_levels_gained,

        --milestones
        pl.reached_level_5_at,
        pl.reached_level_10_at,
        pl.reached_level_20_at,
        pl.reached_level_30_at,
        pl.reached_level_40_at,
        pl.reached_level_50_at,

        --time to milestones (in hours)
        case 
            when pl.reached_level_5_at is not null 
            then datediff('hour', pl.first_session_at, pl.reached_level_5_at)
        end as hours_to_level_5,
        case 
            when pl.reached_level_10_at is not null 
            then datediff('hour', pl.first_session_at, pl.reached_level_10_at)
        end as hours_to_level_10,
        case 
            when pl.reached_level_20_at is not null 
            then datediff('hour', pl.first_session_at, pl.reached_level_20_at)
        end as hours_to_level_20,
       
       --engagement
       pl.total_sessions,
       pl.total_play_time,
       pl.avg_session_duration,

       --progression velocity (levels per hour player)
       case 
            when pl.total_play_time > 0 
            then pl.total_levels_gained::float / (pl.total_play_time / 60)
            else 0
        end as levels_per_hour,

        --progression tiers
        case 
            when pl.max_level_reached >= 40 then 'End Game (40+)'
            when pl.max_level_reached >= 30 then 'Late Game (30-39)'
            when pl.max_level_reached >= 20 then 'Mid Game (20-29)'
            when pl.max_level_reached >= 10 then 'Early Game (10-19)'
            when pl.max_level_reached >= 5 then 'Tutorial+ (5-9)'
            else 'Tutorial (1-4)'
        end as progression_tier 
    from player_levels pl 
    inner join players p on pl.player_id = p.player_id
)

select * from final
    );
  
  
[0m16:33:02.060598 [debug] [Thread-1 (]: SQL status: OK in 0.017 seconds
[0m16:33:02.062542 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_level_progression"
[0m16:33:02.062749 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_level_progression: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_level_progression"} */
alter table "quest_kingdom"."main"."rpt_level_progression__dbt_tmp" rename to "rpt_level_progression"
[0m16:33:02.063189 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:33:02.063985 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_level_progression: COMMIT
[0m16:33:02.064164 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_level_progression"
[0m16:33:02.064404 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_level_progression: COMMIT
[0m16:33:02.068491 [debug] [Thread-1 (]: SQL status: OK in 0.004 seconds
[0m16:33:02.069795 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_level_progression"
[0m16:33:02.070071 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_level_progression: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_level_progression"} */

      drop table if exists "quest_kingdom"."main"."rpt_level_progression__dbt_backup" cascade
    
[0m16:33:02.070393 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:33:02.071056 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_level_progression: Close
[0m16:33:02.071428 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '55b8875d-9740-42ef-9d31-625f24ba4ee4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1054f0140>]}
[0m16:33:02.071791 [info ] [Thread-1 (]: 2 of 4 OK created sql table model main.rpt_level_progression ................... [[32mOK[0m in 0.03s]
[0m16:33:02.072074 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.rpt_level_progression
[0m16:33:02.072264 [debug] [Thread-1 (]: Began running node model.quest_kingdom.rpt_session_quality
[0m16:33:02.072540 [info ] [Thread-1 (]: 3 of 4 START sql table model main.rpt_session_quality .......................... [RUN]
[0m16:33:02.072812 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.quest_kingdom.rpt_level_progression, now model.quest_kingdom.rpt_session_quality)
[0m16:33:02.072985 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.rpt_session_quality
[0m16:33:02.075772 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.rpt_session_quality"
[0m16:33:02.076418 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.rpt_session_quality
[0m16:33:02.078327 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.rpt_session_quality"
[0m16:33:02.079382 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_session_quality"
[0m16:33:02.079632 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_session_quality: BEGIN
[0m16:33:02.079800 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:33:02.081091 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m16:33:02.082362 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_session_quality"
[0m16:33:02.082654 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_session_quality: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_session_quality"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_session_quality__dbt_tmp"
  
    as (
      

with sessions as (

    select * from "quest_kingdom"."main"."fct_sessions"

),

-- Calculate days between sessions first
session_spacing as (

    select
        player_id,
        session_started_at,
        datediff('day', 
            lag(session_started_at) over (partition by player_id order by session_started_at), 
            session_started_at
        ) as days_since_last_session

    from sessions

),

-- Aggregate session metrics
session_metrics as (

    select
        s.player_id,
        s.attribution_channel,
        s.player_segment,
        s.experiment_variant,
        
        -- Session counts
        count(*) as total_sessions,
        count(case when s.is_quality_session then 1 end) as quality_sessions,
        count(case when s.has_progression then 1 end) as sessions_with_progression,
        
        -- Duration metrics
        avg(s.session_duration_minutes) as avg_session_duration,
        sum(s.session_duration_minutes) as total_play_time,
        max(s.session_duration_minutes) as longest_session,
        
        -- Progression metrics
        sum(s.levels_gained) as total_levels_gained,
        avg(s.levels_gained) as avg_levels_per_session,
        
        -- Time of day patterns
        count(case when s.time_of_day = 'morning' then 1 end) as morning_sessions,
        count(case when s.time_of_day = 'afternoon' then 1 end) as afternoon_sessions,
        count(case when s.time_of_day = 'evening' then 1 end) as evening_sessions,
        count(case when s.time_of_day = 'night' then 1 end) as night_sessions,
        
        -- Weekend vs weekday
        count(case when s.is_weekend then 1 end) as weekend_sessions,
        count(case when not s.is_weekend then 1 end) as weekday_sessions

    from sessions s
    group by s.player_id, s.attribution_channel, s.player_segment, s.experiment_variant

),

-- Calculate average spacing separately
avg_spacing as (

    select
        player_id,
        avg(days_since_last_session) as avg_days_between_sessions

    from session_spacing
    where days_since_last_session is not null
    group by player_id

),

-- Add derived metrics
final as (

    select
        sm.*,
        sp.avg_days_between_sessions,
        
        -- Quality rates
        round(sm.quality_sessions::float / sm.total_sessions * 100, 1) as quality_session_pct,
        round(sm.sessions_with_progression::float / sm.total_sessions * 100, 1) as progression_session_pct,
        
        -- Engagement patterns
        round(sm.weekend_sessions::float / sm.total_sessions * 100, 1) as weekend_session_pct,
        
        -- Preferred time of day
        case
            when sm.evening_sessions > sm.morning_sessions 
                and sm.evening_sessions > sm.afternoon_sessions 
                and sm.evening_sessions > sm.night_sessions 
            then 'Evening'
            when sm.morning_sessions > sm.afternoon_sessions 
                and sm.morning_sessions > sm.night_sessions 
            then 'Morning'
            when sm.afternoon_sessions > sm.night_sessions then 'Afternoon'
            else 'Night'
        end as preferred_play_time,
        
        -- Engagement tier
        case
            when sm.total_sessions >= 20 then 'Power User (20+)'
            when sm.total_sessions >= 10 then 'Engaged (10-19)'
            when sm.total_sessions >= 5 then 'Regular (5-9)'
            else 'Casual (1-4)'
        end as engagement_tier

    from session_metrics sm
    left join avg_spacing sp on sm.player_id = sp.player_id

)

select * from final
    );
  
  
[0m16:33:02.119600 [debug] [Thread-1 (]: SQL status: OK in 0.037 seconds
[0m16:33:02.121393 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_session_quality"
[0m16:33:02.121593 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_session_quality: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_session_quality"} */
alter table "quest_kingdom"."main"."rpt_session_quality__dbt_tmp" rename to "rpt_session_quality"
[0m16:33:02.121998 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:33:02.122711 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_session_quality: COMMIT
[0m16:33:02.122873 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_session_quality"
[0m16:33:02.123018 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_session_quality: COMMIT
[0m16:33:02.126981 [debug] [Thread-1 (]: SQL status: OK in 0.004 seconds
[0m16:33:02.128418 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_session_quality"
[0m16:33:02.128594 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_session_quality: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_session_quality"} */

      drop table if exists "quest_kingdom"."main"."rpt_session_quality__dbt_backup" cascade
    
[0m16:33:02.128925 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:33:02.129742 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_session_quality: Close
[0m16:33:02.130072 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '55b8875d-9740-42ef-9d31-625f24ba4ee4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1054ff4a0>]}
[0m16:33:02.130392 [info ] [Thread-1 (]: 3 of 4 OK created sql table model main.rpt_session_quality ..................... [[32mOK[0m in 0.06s]
[0m16:33:02.130656 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.rpt_session_quality
[0m16:33:02.130844 [debug] [Thread-1 (]: Began running node model.quest_kingdom.rpt_level_funnel
[0m16:33:02.131101 [info ] [Thread-1 (]: 4 of 4 START sql table model main.rpt_level_funnel ............................. [RUN]
[0m16:33:02.131356 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.quest_kingdom.rpt_session_quality, now model.quest_kingdom.rpt_level_funnel)
[0m16:33:02.131537 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.rpt_level_funnel
[0m16:33:02.133302 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.rpt_level_funnel"
[0m16:33:02.133972 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.rpt_level_funnel
[0m16:33:02.135668 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.rpt_level_funnel"
[0m16:33:02.136050 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_level_funnel"
[0m16:33:02.136217 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_level_funnel: BEGIN
[0m16:33:02.136363 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:33:02.136747 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:33:02.136899 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_level_funnel"
[0m16:33:02.137271 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_level_funnel: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_level_funnel"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_level_funnel__dbt_tmp"
  
    as (
      

with progression as (
    select * from "quest_kingdom"."main"."rpt_level_progression"
),

--count players who reached each level threshold
level_funnel as (
    select 
        count(*) as total_players,

        --level milestones
        sum(case when max_level_reached >= 1 then 1 else 0 end) as reached_level_1,
        sum(case when max_level_reached >= 5 then 1 else 0 end) as reached_level_5,
        sum(case when max_level_reached >= 10 then 1 else 0 end) as reached_level_10,
        sum(case when max_level_reached >= 15 then 1 else 0 end) as reached_level_15,
        sum(case when max_level_reached >= 20 then 1 else 0 end) as reached_level_20,
        sum(case when max_level_reached >= 25 then 1 else 0 end) as reached_level_25,
        sum(case when max_level_reached >= 30 then 1 else 0 end) as reached_level_30,
        sum(case when max_level_reached >= 35 then 1 else 0 end) as reached_level_35,
        sum(case when max_level_reached >= 40 then 1 else 0 end) as reached_level_40,
        sum(case when max_level_reached >= 45 then 1 else 0 end) as reached_level_45,
        sum(case when max_level_reached >= 50 then 1 else 0 end) as reached_level_50,

        --average time to each level
        avg(hours_to_leve_5) as avg_hours_to_level_5,
        avg(hours_to_level_10) as avg_hours_to_level_10,
        avg(hours_to_level_20) as avg_hours_to_level_20
    from progression 

),

--unpivot to long format for earier analysis
unpivoted as (
    select 1 as level_threshold, reached_level_1 as player, total_players, null as avg_hours from level_funnel
    union all 
    select 5, reached_level_5, total_players, avg_hours_to_level_5 from level_funnel
    union all 
    select 10, reached_level_10, total_players, avg_hours_to_level_10 from level_funnel,
    union all
    select 15, reached_level_15, total_players, null from level_funnel 
    union all 
    select 20, reached_level_20, total_players, avg_hours_to_level_20 from level_funnel
    union all 
    select 25, reached_level_25, total_players, null from level_funnel
    union all 
    select 30, reached_level_30, total_players, null from level_funnel
    union all 
    select 35, reached_level_35, total_players, null from level_funnel 
    union all 
    select 40, reached_level_40, total_players, null from level_funnel
    union all 
    select 45, reached_level_45, total_players, null from level_funnel 
    union all 
    select 50, reached_level_50, total_players, null from level_funnel
),

--calculate percentages and drop-off
final as (
    select 
        level_threshold,
        players,
        round(players::float / total_players * 100, 2) as completion_pct,

        --drop-off from previous level
        lag(players) over (order by level_threshold) as previous_level_players,

        round((lag(players) over(order by level_threshold) - players)::float / 
              lag(players) over (order by level_threshold) * 100, 2) as drop_off_pct,
        
        avg_hours,
    from unpivoted 
)

select * from final 
order by level_threshold
    );
  
  
[0m16:33:02.142671 [debug] [Thread-1 (]: DuckDB adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_level_funnel"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_level_funnel__dbt_tmp"
  
    as (
      

with progression as (
    select * from "quest_kingdom"."main"."rpt_level_progression"
),

--count players who reached each level threshold
level_funnel as (
    select 
        count(*) as total_players,

        --level milestones
        sum(case when max_level_reached >= 1 then 1 else 0 end) as reached_level_1,
        sum(case when max_level_reached >= 5 then 1 else 0 end) as reached_level_5,
        sum(case when max_level_reached >= 10 then 1 else 0 end) as reached_level_10,
        sum(case when max_level_reached >= 15 then 1 else 0 end) as reached_level_15,
        sum(case when max_level_reached >= 20 then 1 else 0 end) as reached_level_20,
        sum(case when max_level_reached >= 25 then 1 else 0 end) as reached_level_25,
        sum(case when max_level_reached >= 30 then 1 else 0 end) as reached_level_30,
        sum(case when max_level_reached >= 35 then 1 else 0 end) as reached_level_35,
        sum(case when max_level_reached >= 40 then 1 else 0 end) as reached_level_40,
        sum(case when max_level_reached >= 45 then 1 else 0 end) as reached_level_45,
        sum(case when max_level_reached >= 50 then 1 else 0 end) as reached_level_50,

        --average time to each level
        avg(hours_to_leve_5) as avg_hours_to_level_5,
        avg(hours_to_level_10) as avg_hours_to_level_10,
        avg(hours_to_level_20) as avg_hours_to_level_20
    from progression 

),

--unpivot to long format for earier analysis
unpivoted as (
    select 1 as level_threshold, reached_level_1 as player, total_players, null as avg_hours from level_funnel
    union all 
    select 5, reached_level_5, total_players, avg_hours_to_level_5 from level_funnel
    union all 
    select 10, reached_level_10, total_players, avg_hours_to_level_10 from level_funnel,
    union all
    select 15, reached_level_15, total_players, null from level_funnel 
    union all 
    select 20, reached_level_20, total_players, avg_hours_to_level_20 from level_funnel
    union all 
    select 25, reached_level_25, total_players, null from level_funnel
    union all 
    select 30, reached_level_30, total_players, null from level_funnel
    union all 
    select 35, reached_level_35, total_players, null from level_funnel 
    union all 
    select 40, reached_level_40, total_players, null from level_funnel
    union all 
    select 45, reached_level_45, total_players, null from level_funnel 
    union all 
    select 50, reached_level_50, total_players, null from level_funnel
),

--calculate percentages and drop-off
final as (
    select 
        level_threshold,
        players,
        round(players::float / total_players * 100, 2) as completion_pct,

        --drop-off from previous level
        lag(players) over (order by level_threshold) as previous_level_players,

        round((lag(players) over(order by level_threshold) - players)::float / 
              lag(players) over (order by level_threshold) * 100, 2) as drop_off_pct,
        
        avg_hours,
    from unpivoted 
)

select * from final 
order by level_threshold
    );
  
  
[0m16:33:02.143146 [debug] [Thread-1 (]: DuckDB adapter: Rolling back transaction.
[0m16:33:02.143471 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_level_funnel: ROLLBACK
[0m16:33:02.150732 [debug] [Thread-1 (]: Failed to rollback 'model.quest_kingdom.rpt_level_funnel'
[0m16:33:02.151001 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_level_funnel: Close
[0m16:33:02.152348 [debug] [Thread-1 (]: Runtime Error in model rpt_level_funnel (models/marts/product/rpt_level_funnel.sql)
  Binder Error: Referenced column "hours_to_leve_5" not found in FROM clause!
  Candidate bindings: "hours_to_level_5", "hours_to_level_10", "hours_to_level_20", "cohort_week", "reached_level_5_at"
  
  LINE 36:         avg(hours_to_leve_5) as avg_hours_to_level_5,
                       ^
[0m16:33:02.152638 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '55b8875d-9740-42ef-9d31-625f24ba4ee4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105507170>]}
[0m16:33:02.152985 [error] [Thread-1 (]: 4 of 4 ERROR creating sql table model main.rpt_level_funnel .................... [[31mERROR[0m in 0.02s]
[0m16:33:02.153268 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.rpt_level_funnel
[0m16:33:02.153529 [debug] [Thread-4 (]: Marking all children of 'model.quest_kingdom.rpt_level_funnel' to be skipped because of status 'error'.  Reason: Runtime Error in model rpt_level_funnel (models/marts/product/rpt_level_funnel.sql)
  Binder Error: Referenced column "hours_to_leve_5" not found in FROM clause!
  Candidate bindings: "hours_to_level_5", "hours_to_level_10", "hours_to_level_20", "cohort_week", "reached_level_5_at"
  
  LINE 36:         avg(hours_to_leve_5) as avg_hours_to_level_5,
                       ^.
[0m16:33:02.154550 [debug] [MainThread]: Using duckdb connection "master"
[0m16:33:02.154732 [debug] [MainThread]: On master: BEGIN
[0m16:33:02.154862 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m16:33:02.155246 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m16:33:02.155388 [debug] [MainThread]: On master: COMMIT
[0m16:33:02.155521 [debug] [MainThread]: Using duckdb connection "master"
[0m16:33:02.155643 [debug] [MainThread]: On master: COMMIT
[0m16:33:02.155852 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m16:33:02.155992 [debug] [MainThread]: On master: Close
[0m16:33:02.156195 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:33:02.156324 [debug] [MainThread]: Connection 'model.quest_kingdom.rpt_level_funnel' was properly closed.
[0m16:33:02.156512 [info ] [MainThread]: 
[0m16:33:02.156673 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 0.27 seconds (0.27s).
[0m16:33:02.157178 [debug] [MainThread]: Command end result
[0m16:33:02.178735 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/manifest.json
[0m16:33:02.180060 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/semantic_manifest.json
[0m16:33:02.205207 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/run_results.json
[0m16:33:02.205446 [info ] [MainThread]: 
[0m16:33:02.205628 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m16:33:02.205777 [info ] [MainThread]: 
[0m16:33:02.205953 [error] [MainThread]: [31mFailure in model rpt_level_funnel (models/marts/product/rpt_level_funnel.sql)[0m
[0m16:33:02.206121 [error] [MainThread]:   Runtime Error in model rpt_level_funnel (models/marts/product/rpt_level_funnel.sql)
  Binder Error: Referenced column "hours_to_leve_5" not found in FROM clause!
  Candidate bindings: "hours_to_level_5", "hours_to_level_10", "hours_to_level_20", "cohort_week", "reached_level_5_at"
  
  LINE 36:         avg(hours_to_leve_5) as avg_hours_to_level_5,
                       ^
[0m16:33:02.206249 [info ] [MainThread]: 
[0m16:33:02.206394 [info ] [MainThread]:   compiled code at target/compiled/quest_kingdom/models/marts/product/rpt_level_funnel.sql
[0m16:33:02.206520 [info ] [MainThread]: 
[0m16:33:02.206660 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=4
[0m16:33:02.207949 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.9940353, "process_in_blocks": "0", "process_kernel_time": 0.22967, "process_mem_max_rss": "273121280", "process_out_blocks": "0", "process_user_time": 1.454259}
[0m16:33:02.208219 [debug] [MainThread]: Command `dbt run` failed at 16:33:02.208177 after 0.99 seconds
[0m16:33:02.208407 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1048c18e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1050495e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1053e22d0>]}
[0m16:33:02.208587 [debug] [MainThread]: Flushing usage events
[0m16:33:02.324606 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m16:33:33.628712 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104449760>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1051f9a00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1051f97c0>]}


============================== 16:33:33.642431 | 45862e19-7946-4ce3-ab9e-85da8d23d4f0 ==============================
[0m16:33:33.642431 [info ] [MainThread]: Running with dbt=1.11.4
[0m16:33:33.642813 [debug] [MainThread]: running dbt with arguments {'no_print': 'None', 'fail_fast': 'False', 'printer_width': '80', 'target_path': 'None', 'version_check': 'True', 'partial_parse': 'True', 'static_parser': 'True', 'cache_selected_only': 'False', 'use_colors': 'True', 'empty': 'False', 'send_anonymous_usage_stats': 'True', 'log_path': '/Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/logs', 'indirect_selection': 'eager', 'log_format': 'default', 'quiet': 'False', 'debug': 'False', 'warn_error': 'None', 'invocation_command': 'dbt run --select path:models/marts/product', 'introspect': 'True', 'write_json': 'True', 'log_cache_events': 'False', 'profiles_dir': '/Users/hazeldonaldson/.dbt', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'use_experimental_parser': 'False'}
[0m16:33:33.813173 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '45862e19-7946-4ce3-ab9e-85da8d23d4f0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1053965a0>]}
[0m16:33:33.842309 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '45862e19-7946-4ce3-ab9e-85da8d23d4f0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104985880>]}
[0m16:33:33.843841 [info ] [MainThread]: Registered adapter: duckdb=1.10.0
[0m16:33:33.895923 [debug] [MainThread]: checksum: 092b177ba87eb6bb3c55954c38aa57900eebac336561eb9ee32218428aa81d43, vars: {}, profile: , target: , version: 1.11.4
[0m16:33:33.961755 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m16:33:33.962225 [debug] [MainThread]: Partial parsing: updated file: quest_kingdom://models/marts/product/rpt_level_funnel.sql
[0m16:33:34.154813 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '45862e19-7946-4ce3-ab9e-85da8d23d4f0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105a00c20>]}
[0m16:33:34.232086 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/manifest.json
[0m16:33:34.233701 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/semantic_manifest.json
[0m16:33:34.247046 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '45862e19-7946-4ce3-ab9e-85da8d23d4f0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1059cbf50>]}
[0m16:33:34.247333 [info ] [MainThread]: Found 19 models, 48 data tests, 5 sources, 472 macros
[0m16:33:34.247511 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '45862e19-7946-4ce3-ab9e-85da8d23d4f0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105a88fe0>]}
[0m16:33:34.249496 [info ] [MainThread]: 
[0m16:33:34.249682 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m16:33:34.249819 [info ] [MainThread]: 
[0m16:33:34.250044 [debug] [MainThread]: Acquiring new duckdb connection 'master'
[0m16:33:34.252213 [debug] [ThreadPool]: Acquiring new duckdb connection 'list_quest_kingdom'
[0m16:33:34.280842 [debug] [ThreadPool]: Using duckdb connection "list_quest_kingdom"
[0m16:33:34.281083 [debug] [ThreadPool]: On list_quest_kingdom: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "list_quest_kingdom"} */

    
    select schema_name
    from system.information_schema.schemata
    
    where lower(catalog_name) = '"quest_kingdom"'
    
  
  
[0m16:33:34.281229 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:33:34.301606 [debug] [ThreadPool]: SQL status: OK in 0.020 seconds
[0m16:33:34.302428 [debug] [ThreadPool]: On list_quest_kingdom: Close
[0m16:33:34.302790 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_quest_kingdom, now create_quest_kingdom_main)
[0m16:33:34.303046 [debug] [ThreadPool]: Creating schema "database: "quest_kingdom"
schema: "main"
"
[0m16:33:34.308530 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m16:33:34.308856 [debug] [ThreadPool]: On create_quest_kingdom_main: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "create_quest_kingdom_main"} */

    
        select type from duckdb_databases()
        where lower(database_name)='quest_kingdom'
        and type='sqlite'
    
  
[0m16:33:34.309026 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:33:34.310049 [debug] [ThreadPool]: SQL status: OK in 0.001 seconds
[0m16:33:34.310954 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m16:33:34.311114 [debug] [ThreadPool]: On create_quest_kingdom_main: BEGIN
[0m16:33:34.311373 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m16:33:34.311500 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m16:33:34.311628 [debug] [ThreadPool]: On create_quest_kingdom_main: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "create_quest_kingdom_main"} */

    
    
        create schema if not exists "quest_kingdom"."main"
    
[0m16:33:34.311932 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m16:33:34.312330 [debug] [ThreadPool]: On create_quest_kingdom_main: COMMIT
[0m16:33:34.312463 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m16:33:34.312579 [debug] [ThreadPool]: On create_quest_kingdom_main: COMMIT
[0m16:33:34.312772 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m16:33:34.312904 [debug] [ThreadPool]: On create_quest_kingdom_main: Close
[0m16:33:34.313908 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_quest_kingdom_main, now list_quest_kingdom_main)
[0m16:33:34.316720 [debug] [ThreadPool]: Using duckdb connection "list_quest_kingdom_main"
[0m16:33:34.316875 [debug] [ThreadPool]: On list_quest_kingdom_main: BEGIN
[0m16:33:34.317052 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:33:34.317297 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m16:33:34.317428 [debug] [ThreadPool]: Using duckdb connection "list_quest_kingdom_main"
[0m16:33:34.317559 [debug] [ThreadPool]: On list_quest_kingdom_main: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "list_quest_kingdom_main"} */
select
      'quest_kingdom' as database,
      table_name as name,
      table_schema as schema,
      CASE table_type
        WHEN 'BASE TABLE' THEN 'table'
        WHEN 'VIEW' THEN 'view'
        WHEN 'LOCAL TEMPORARY' THEN 'table'
        END as type
    from system.information_schema.tables
    where lower(table_schema) = 'main'
    and lower(table_catalog) = 'quest_kingdom'
  
[0m16:33:34.329147 [debug] [ThreadPool]: SQL status: OK in 0.011 seconds
[0m16:33:34.330287 [debug] [ThreadPool]: On list_quest_kingdom_main: ROLLBACK
[0m16:33:34.331282 [debug] [ThreadPool]: Failed to rollback 'list_quest_kingdom_main'
[0m16:33:34.331444 [debug] [ThreadPool]: On list_quest_kingdom_main: Close
[0m16:33:34.333104 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '45862e19-7946-4ce3-ab9e-85da8d23d4f0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1059baba0>]}
[0m16:33:34.333347 [debug] [MainThread]: Using duckdb connection "master"
[0m16:33:34.333486 [debug] [MainThread]: On master: BEGIN
[0m16:33:34.333606 [debug] [MainThread]: Opening a new connection, currently in state init
[0m16:33:34.333880 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m16:33:34.334015 [debug] [MainThread]: On master: COMMIT
[0m16:33:34.334141 [debug] [MainThread]: Using duckdb connection "master"
[0m16:33:34.334261 [debug] [MainThread]: On master: COMMIT
[0m16:33:34.334460 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m16:33:34.334586 [debug] [MainThread]: On master: Close
[0m16:33:34.335803 [debug] [Thread-1 (]: Began running node model.quest_kingdom.rpt_feature_engagement
[0m16:33:34.336063 [info ] [Thread-1 (]: 1 of 4 START sql table model main.rpt_feature_engagement ....................... [RUN]
[0m16:33:34.336287 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_quest_kingdom_main, now model.quest_kingdom.rpt_feature_engagement)
[0m16:33:34.336452 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.rpt_feature_engagement
[0m16:33:34.340415 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.rpt_feature_engagement"
[0m16:33:34.340910 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.rpt_feature_engagement
[0m16:33:34.357148 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.rpt_feature_engagement"
[0m16:33:34.357769 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_feature_engagement"
[0m16:33:34.357973 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_feature_engagement: BEGIN
[0m16:33:34.358124 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:33:34.358501 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:33:34.358646 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_feature_engagement"
[0m16:33:34.358842 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_feature_engagement: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_feature_engagement"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_feature_engagement__dbt_tmp"
  
    as (
      

with events as (
    select * from "quest_kingdom"."main"."stg_events"
),

players as (
    select * from "quest_kingdom"."main"."dim_players"
),

--aggregate events per player
player_events as (
    select 
        player_id,

        --event counts
        count(*) as total_events,
        count(distinct event_name) as unique_event_types,

        --specific events
        sum(case when event_name = 'tutorial_completed' then 1 else 0 end) as tutorial_completions,
        sum(case when event_name = 'level_completed' then 1 else 0 end) as level_completions,
        sum(case when event_name = 'boss_defeated' then 1 else 0 end) as boss_defeats,

        --timing
        min(event_at) as first_event_at,
        max(event_at) as last_event_at
    from events 
    group by player_id 

),

--combine with player data
final as (
    select 
        p.player_id,
        p.installed_at,
        p.cohort_week,
        p.attribution_channel,
        p.player_segment,
        p.experiment_variant,
        p.is_payer,

        --events
        coalesce(pe.total_events, 0) as total_events,
        coalesce(pe.unique_event_types, 0) as unique_event_types,
        coalesce(pe.tutorial_completions, 0) as tutorial_completions,
        coalesce(pe.boss_defeats, 0) as boss_defeats,

        --derived
        case 
            when pe.tutorial_completions > 0 then true 
            else false 
        end as completed_tutorial,

        case
            when pe.boss_defeats > 0 then true
            else false 
        end defeated_boss,

        --events per session (if they have sessions)
        case
            when p.total_sessions > 0 
            then coalesce(pe.total_events, 0)::float / p.total_sessions
            else 0
        end events_per_session,

        --engagement level based on events
        case 
            when coalesce(pe.total_events, 0) >= 50 then 'Power User (50+)'
            when coalesce(pe.total_events, 0) >= 20 then 'Engaged (20-49)'
            when coalesce(pe.total_events, 0) >= 5 then 'Active (5-19)'
            when coalesce(pe.total_events, 0) >= 1 then 'Casual (1-4)'
            else 'No Events'
        end as event_engagement_tier
    from players p 
    left join player_events pe on p.player_id = pe.player_id 
 )

 
 select * from final
    );
  
  
[0m16:33:34.385732 [debug] [Thread-1 (]: SQL status: OK in 0.027 seconds
[0m16:33:34.388656 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_feature_engagement"
[0m16:33:34.388862 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_feature_engagement: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_feature_engagement"} */

    SELECT index_name
    FROM duckdb_indexes()
    WHERE schema_name = 'main'
      AND table_name = 'rpt_feature_engagement'
  
[0m16:33:34.389380 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:33:34.390002 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_feature_engagement"
[0m16:33:34.390169 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_feature_engagement: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_feature_engagement"} */

    SELECT COUNT(*) as remaining_indexes
    FROM duckdb_indexes()
    WHERE schema_name = 'main'
      AND table_name = 'rpt_feature_engagement'
  
[0m16:33:34.390974 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m16:33:34.394609 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_feature_engagement"
[0m16:33:34.394835 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_feature_engagement: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_feature_engagement"} */
alter table "quest_kingdom"."main"."rpt_feature_engagement" rename to "rpt_feature_engagement__dbt_backup"
[0m16:33:34.395846 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m16:33:34.397302 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_feature_engagement"
[0m16:33:34.397482 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_feature_engagement: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_feature_engagement"} */
alter table "quest_kingdom"."main"."rpt_feature_engagement__dbt_tmp" rename to "rpt_feature_engagement"
[0m16:33:34.397772 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:33:34.404638 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_feature_engagement: COMMIT
[0m16:33:34.405233 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_feature_engagement"
[0m16:33:34.405396 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_feature_engagement: COMMIT
[0m16:33:34.408656 [debug] [Thread-1 (]: SQL status: OK in 0.003 seconds
[0m16:33:34.411402 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_feature_engagement"
[0m16:33:34.411585 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_feature_engagement: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_feature_engagement"} */

      drop table if exists "quest_kingdom"."main"."rpt_feature_engagement__dbt_backup" cascade
    
[0m16:33:34.412365 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m16:33:34.413494 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_feature_engagement: Close
[0m16:33:34.414442 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '45862e19-7946-4ce3-ab9e-85da8d23d4f0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105d62600>]}
[0m16:33:34.414752 [info ] [Thread-1 (]: 1 of 4 OK created sql table model main.rpt_feature_engagement .................. [[32mOK[0m in 0.08s]
[0m16:33:34.415016 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.rpt_feature_engagement
[0m16:33:34.415203 [debug] [Thread-1 (]: Began running node model.quest_kingdom.rpt_level_progression
[0m16:33:34.415433 [info ] [Thread-1 (]: 2 of 4 START sql table model main.rpt_level_progression ........................ [RUN]
[0m16:33:34.415630 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.quest_kingdom.rpt_feature_engagement, now model.quest_kingdom.rpt_level_progression)
[0m16:33:34.415790 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.rpt_level_progression
[0m16:33:34.417454 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.rpt_level_progression"
[0m16:33:34.417993 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.rpt_level_progression
[0m16:33:34.419609 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.rpt_level_progression"
[0m16:33:34.419958 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_level_progression"
[0m16:33:34.420117 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_level_progression: BEGIN
[0m16:33:34.420259 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:33:34.420559 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:33:34.420731 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_level_progression"
[0m16:33:34.421024 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_level_progression: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_level_progression"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_level_progression__dbt_tmp"
  
    as (
      

with sessions as (
    select * from "quest_kingdom"."main"."fct_sessions"
),

players as (
    select * from "quest_kingdom"."main"."dim_players"
),

--track level progression per player
player_levels as (
    select 
        player_id,
        min(session_started_at) as first_session_at,
        max(ending_level) as max_level_reached,
        sum(levels_gained) as total_levels_gained,

        --time to reach certain milestones
        min(case when ending_level >= 5 then session_started_at end) as reached_level_5_at,
        min(case when ending_level >= 10 then session_started_at end) as reached_level_10_at,
        min(case when ending_level >= 20 then session_started_at end) as reached_level_20_at,
        min(case when ending_level >= 30 then session_started_at end) as reached_level_30_at,
        min(case when ending_level >= 40 then session_started_at end) as reached_level_40_at,
        min(case when ending_level >= 50 then session_started_at end) as reached_level_50_at,

        --progression metrics
        count(*) as total_sessions,
        sum(session_duration_minutes) as total_play_time,
        avg(session_duration_minutes) as avg_session_duration
    from sessions 
    group by player_id 
),

--combine with player attributes
final as (
    select 
        pl.player_id,
        p.installed_at,
        p.cohort_week,
        p.attribution_channel,
        p.player_segment,
        p.experiment_variant,
        p.is_payer,

        --progression
        pl.max_level_reached,
        pl.total_levels_gained,

        --milestones
        pl.reached_level_5_at,
        pl.reached_level_10_at,
        pl.reached_level_20_at,
        pl.reached_level_30_at,
        pl.reached_level_40_at,
        pl.reached_level_50_at,

        --time to milestones (in hours)
        case 
            when pl.reached_level_5_at is not null 
            then datediff('hour', pl.first_session_at, pl.reached_level_5_at)
        end as hours_to_level_5,
        case 
            when pl.reached_level_10_at is not null 
            then datediff('hour', pl.first_session_at, pl.reached_level_10_at)
        end as hours_to_level_10,
        case 
            when pl.reached_level_20_at is not null 
            then datediff('hour', pl.first_session_at, pl.reached_level_20_at)
        end as hours_to_level_20,
       
       --engagement
       pl.total_sessions,
       pl.total_play_time,
       pl.avg_session_duration,

       --progression velocity (levels per hour player)
       case 
            when pl.total_play_time > 0 
            then pl.total_levels_gained::float / (pl.total_play_time / 60)
            else 0
        end as levels_per_hour,

        --progression tiers
        case 
            when pl.max_level_reached >= 40 then 'End Game (40+)'
            when pl.max_level_reached >= 30 then 'Late Game (30-39)'
            when pl.max_level_reached >= 20 then 'Mid Game (20-29)'
            when pl.max_level_reached >= 10 then 'Early Game (10-19)'
            when pl.max_level_reached >= 5 then 'Tutorial+ (5-9)'
            else 'Tutorial (1-4)'
        end as progression_tier 
    from player_levels pl 
    inner join players p on pl.player_id = p.player_id
)

select * from final
    );
  
  
[0m16:33:34.438360 [debug] [Thread-1 (]: SQL status: OK in 0.017 seconds
[0m16:33:34.439089 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_level_progression"
[0m16:33:34.439279 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_level_progression: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_level_progression"} */

    SELECT index_name
    FROM duckdb_indexes()
    WHERE schema_name = 'main'
      AND table_name = 'rpt_level_progression'
  
[0m16:33:34.439769 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:33:34.440593 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_level_progression"
[0m16:33:34.440796 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_level_progression: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_level_progression"} */

    SELECT COUNT(*) as remaining_indexes
    FROM duckdb_indexes()
    WHERE schema_name = 'main'
      AND table_name = 'rpt_level_progression'
  
[0m16:33:34.441356 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:33:34.442998 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_level_progression"
[0m16:33:34.443175 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_level_progression: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_level_progression"} */
alter table "quest_kingdom"."main"."rpt_level_progression" rename to "rpt_level_progression__dbt_backup"
[0m16:33:34.443482 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:33:34.444791 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_level_progression"
[0m16:33:34.444951 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_level_progression: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_level_progression"} */
alter table "quest_kingdom"."main"."rpt_level_progression__dbt_tmp" rename to "rpt_level_progression"
[0m16:33:34.445541 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:33:34.446302 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_level_progression: COMMIT
[0m16:33:34.446467 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_level_progression"
[0m16:33:34.446622 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_level_progression: COMMIT
[0m16:33:34.449834 [debug] [Thread-1 (]: SQL status: OK in 0.003 seconds
[0m16:33:34.451720 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_level_progression"
[0m16:33:34.451892 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_level_progression: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_level_progression"} */

      drop table if exists "quest_kingdom"."main"."rpt_level_progression__dbt_backup" cascade
    
[0m16:33:34.452352 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:33:34.453040 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_level_progression: Close
[0m16:33:34.453327 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '45862e19-7946-4ce3-ab9e-85da8d23d4f0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105e42c60>]}
[0m16:33:34.453620 [info ] [Thread-1 (]: 2 of 4 OK created sql table model main.rpt_level_progression ................... [[32mOK[0m in 0.04s]
[0m16:33:34.453888 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.rpt_level_progression
[0m16:33:34.454068 [debug] [Thread-1 (]: Began running node model.quest_kingdom.rpt_session_quality
[0m16:33:34.454294 [info ] [Thread-1 (]: 3 of 4 START sql table model main.rpt_session_quality .......................... [RUN]
[0m16:33:34.454526 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.quest_kingdom.rpt_level_progression, now model.quest_kingdom.rpt_session_quality)
[0m16:33:34.454685 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.rpt_session_quality
[0m16:33:34.456378 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.rpt_session_quality"
[0m16:33:34.456816 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.rpt_session_quality
[0m16:33:34.458686 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.rpt_session_quality"
[0m16:33:34.464871 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_session_quality"
[0m16:33:34.465073 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_session_quality: BEGIN
[0m16:33:34.465470 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:33:34.465882 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:33:34.466093 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_session_quality"
[0m16:33:34.466362 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_session_quality: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_session_quality"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_session_quality__dbt_tmp"
  
    as (
      

with sessions as (

    select * from "quest_kingdom"."main"."fct_sessions"

),

-- Calculate days between sessions first
session_spacing as (

    select
        player_id,
        session_started_at,
        datediff('day', 
            lag(session_started_at) over (partition by player_id order by session_started_at), 
            session_started_at
        ) as days_since_last_session

    from sessions

),

-- Aggregate session metrics
session_metrics as (

    select
        s.player_id,
        s.attribution_channel,
        s.player_segment,
        s.experiment_variant,
        
        -- Session counts
        count(*) as total_sessions,
        count(case when s.is_quality_session then 1 end) as quality_sessions,
        count(case when s.has_progression then 1 end) as sessions_with_progression,
        
        -- Duration metrics
        avg(s.session_duration_minutes) as avg_session_duration,
        sum(s.session_duration_minutes) as total_play_time,
        max(s.session_duration_minutes) as longest_session,
        
        -- Progression metrics
        sum(s.levels_gained) as total_levels_gained,
        avg(s.levels_gained) as avg_levels_per_session,
        
        -- Time of day patterns
        count(case when s.time_of_day = 'morning' then 1 end) as morning_sessions,
        count(case when s.time_of_day = 'afternoon' then 1 end) as afternoon_sessions,
        count(case when s.time_of_day = 'evening' then 1 end) as evening_sessions,
        count(case when s.time_of_day = 'night' then 1 end) as night_sessions,
        
        -- Weekend vs weekday
        count(case when s.is_weekend then 1 end) as weekend_sessions,
        count(case when not s.is_weekend then 1 end) as weekday_sessions

    from sessions s
    group by s.player_id, s.attribution_channel, s.player_segment, s.experiment_variant

),

-- Calculate average spacing separately
avg_spacing as (

    select
        player_id,
        avg(days_since_last_session) as avg_days_between_sessions

    from session_spacing
    where days_since_last_session is not null
    group by player_id

),

-- Add derived metrics
final as (

    select
        sm.*,
        sp.avg_days_between_sessions,
        
        -- Quality rates
        round(sm.quality_sessions::float / sm.total_sessions * 100, 1) as quality_session_pct,
        round(sm.sessions_with_progression::float / sm.total_sessions * 100, 1) as progression_session_pct,
        
        -- Engagement patterns
        round(sm.weekend_sessions::float / sm.total_sessions * 100, 1) as weekend_session_pct,
        
        -- Preferred time of day
        case
            when sm.evening_sessions > sm.morning_sessions 
                and sm.evening_sessions > sm.afternoon_sessions 
                and sm.evening_sessions > sm.night_sessions 
            then 'Evening'
            when sm.morning_sessions > sm.afternoon_sessions 
                and sm.morning_sessions > sm.night_sessions 
            then 'Morning'
            when sm.afternoon_sessions > sm.night_sessions then 'Afternoon'
            else 'Night'
        end as preferred_play_time,
        
        -- Engagement tier
        case
            when sm.total_sessions >= 20 then 'Power User (20+)'
            when sm.total_sessions >= 10 then 'Engaged (10-19)'
            when sm.total_sessions >= 5 then 'Regular (5-9)'
            else 'Casual (1-4)'
        end as engagement_tier

    from session_metrics sm
    left join avg_spacing sp on sm.player_id = sp.player_id

)

select * from final
    );
  
  
[0m16:33:34.512062 [debug] [Thread-1 (]: SQL status: OK in 0.045 seconds
[0m16:33:34.512834 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_session_quality"
[0m16:33:34.513038 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_session_quality: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_session_quality"} */

    SELECT index_name
    FROM duckdb_indexes()
    WHERE schema_name = 'main'
      AND table_name = 'rpt_session_quality'
  
[0m16:33:34.513587 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:33:34.514221 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_session_quality"
[0m16:33:34.514395 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_session_quality: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_session_quality"} */

    SELECT COUNT(*) as remaining_indexes
    FROM duckdb_indexes()
    WHERE schema_name = 'main'
      AND table_name = 'rpt_session_quality'
  
[0m16:33:34.514810 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:33:34.516465 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_session_quality"
[0m16:33:34.516652 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_session_quality: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_session_quality"} */
alter table "quest_kingdom"."main"."rpt_session_quality" rename to "rpt_session_quality__dbt_backup"
[0m16:33:34.516990 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:33:34.518399 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_session_quality"
[0m16:33:34.518571 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_session_quality: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_session_quality"} */
alter table "quest_kingdom"."main"."rpt_session_quality__dbt_tmp" rename to "rpt_session_quality"
[0m16:33:34.518861 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:33:34.519676 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_session_quality: COMMIT
[0m16:33:34.519830 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_session_quality"
[0m16:33:34.519969 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_session_quality: COMMIT
[0m16:33:34.523560 [debug] [Thread-1 (]: SQL status: OK in 0.003 seconds
[0m16:33:34.524845 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_session_quality"
[0m16:33:34.525049 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_session_quality: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_session_quality"} */

      drop table if exists "quest_kingdom"."main"."rpt_session_quality__dbt_backup" cascade
    
[0m16:33:34.525564 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:33:34.526182 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_session_quality: Close
[0m16:33:34.526444 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '45862e19-7946-4ce3-ab9e-85da8d23d4f0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105e42810>]}
[0m16:33:34.526731 [info ] [Thread-1 (]: 3 of 4 OK created sql table model main.rpt_session_quality ..................... [[32mOK[0m in 0.07s]
[0m16:33:34.526974 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.rpt_session_quality
[0m16:33:34.527151 [debug] [Thread-1 (]: Began running node model.quest_kingdom.rpt_level_funnel
[0m16:33:34.527375 [info ] [Thread-1 (]: 4 of 4 START sql table model main.rpt_level_funnel ............................. [RUN]
[0m16:33:34.527563 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.quest_kingdom.rpt_session_quality, now model.quest_kingdom.rpt_level_funnel)
[0m16:33:34.527726 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.rpt_level_funnel
[0m16:33:34.529337 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.rpt_level_funnel"
[0m16:33:34.529769 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.rpt_level_funnel
[0m16:33:34.531308 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.rpt_level_funnel"
[0m16:33:34.531659 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_level_funnel"
[0m16:33:34.531818 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_level_funnel: BEGIN
[0m16:33:34.531964 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:33:34.532397 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:33:34.532576 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_level_funnel"
[0m16:33:34.532816 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_level_funnel: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_level_funnel"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_level_funnel__dbt_tmp"
  
    as (
      

with progression as (
    select * from "quest_kingdom"."main"."rpt_level_progression"
),

--count players who reached each level threshold
level_funnel as (
    select 
        count(*) as total_players,

        --level milestones
        sum(case when max_level_reached >= 1 then 1 else 0 end) as reached_level_1,
        sum(case when max_level_reached >= 5 then 1 else 0 end) as reached_level_5,
        sum(case when max_level_reached >= 10 then 1 else 0 end) as reached_level_10,
        sum(case when max_level_reached >= 15 then 1 else 0 end) as reached_level_15,
        sum(case when max_level_reached >= 20 then 1 else 0 end) as reached_level_20,
        sum(case when max_level_reached >= 25 then 1 else 0 end) as reached_level_25,
        sum(case when max_level_reached >= 30 then 1 else 0 end) as reached_level_30,
        sum(case when max_level_reached >= 35 then 1 else 0 end) as reached_level_35,
        sum(case when max_level_reached >= 40 then 1 else 0 end) as reached_level_40,
        sum(case when max_level_reached >= 45 then 1 else 0 end) as reached_level_45,
        sum(case when max_level_reached >= 50 then 1 else 0 end) as reached_level_50,

        --average time to each level
        avg(hours_to_level_5) as avg_hours_to_level_5,
        avg(hours_to_level_10) as avg_hours_to_level_10,
        avg(hours_to_level_20) as avg_hours_to_level_20
    from progression 

),

--unpivot to long format for earier analysis
unpivoted as (
    select 1 as level_threshold, reached_level_1 as player, total_players, null as avg_hours from level_funnel
    union all 
    select 5, reached_level_5, total_players, avg_hours_to_level_5 from level_funnel
    union all 
    select 10, reached_level_10, total_players, avg_hours_to_level_10 from level_funnel,
    union all
    select 15, reached_level_15, total_players, null from level_funnel 
    union all 
    select 20, reached_level_20, total_players, avg_hours_to_level_20 from level_funnel
    union all 
    select 25, reached_level_25, total_players, null from level_funnel
    union all 
    select 30, reached_level_30, total_players, null from level_funnel
    union all 
    select 35, reached_level_35, total_players, null from level_funnel 
    union all 
    select 40, reached_level_40, total_players, null from level_funnel
    union all 
    select 45, reached_level_45, total_players, null from level_funnel 
    union all 
    select 50, reached_level_50, total_players, null from level_funnel
),

--calculate percentages and drop-off
final as (
    select 
        level_threshold,
        players,
        round(players::float / total_players * 100, 2) as completion_pct,

        --drop-off from previous level
        lag(players) over (order by level_threshold) as previous_level_players,

        round((lag(players) over(order by level_threshold) - players)::float / 
              lag(players) over (order by level_threshold) * 100, 2) as drop_off_pct,
        
        avg_hours,
    from unpivoted 
)

select * from final 
order by level_threshold
    );
  
  
[0m16:33:34.536876 [debug] [Thread-1 (]: DuckDB adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_level_funnel"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_level_funnel__dbt_tmp"
  
    as (
      

with progression as (
    select * from "quest_kingdom"."main"."rpt_level_progression"
),

--count players who reached each level threshold
level_funnel as (
    select 
        count(*) as total_players,

        --level milestones
        sum(case when max_level_reached >= 1 then 1 else 0 end) as reached_level_1,
        sum(case when max_level_reached >= 5 then 1 else 0 end) as reached_level_5,
        sum(case when max_level_reached >= 10 then 1 else 0 end) as reached_level_10,
        sum(case when max_level_reached >= 15 then 1 else 0 end) as reached_level_15,
        sum(case when max_level_reached >= 20 then 1 else 0 end) as reached_level_20,
        sum(case when max_level_reached >= 25 then 1 else 0 end) as reached_level_25,
        sum(case when max_level_reached >= 30 then 1 else 0 end) as reached_level_30,
        sum(case when max_level_reached >= 35 then 1 else 0 end) as reached_level_35,
        sum(case when max_level_reached >= 40 then 1 else 0 end) as reached_level_40,
        sum(case when max_level_reached >= 45 then 1 else 0 end) as reached_level_45,
        sum(case when max_level_reached >= 50 then 1 else 0 end) as reached_level_50,

        --average time to each level
        avg(hours_to_level_5) as avg_hours_to_level_5,
        avg(hours_to_level_10) as avg_hours_to_level_10,
        avg(hours_to_level_20) as avg_hours_to_level_20
    from progression 

),

--unpivot to long format for earier analysis
unpivoted as (
    select 1 as level_threshold, reached_level_1 as player, total_players, null as avg_hours from level_funnel
    union all 
    select 5, reached_level_5, total_players, avg_hours_to_level_5 from level_funnel
    union all 
    select 10, reached_level_10, total_players, avg_hours_to_level_10 from level_funnel,
    union all
    select 15, reached_level_15, total_players, null from level_funnel 
    union all 
    select 20, reached_level_20, total_players, avg_hours_to_level_20 from level_funnel
    union all 
    select 25, reached_level_25, total_players, null from level_funnel
    union all 
    select 30, reached_level_30, total_players, null from level_funnel
    union all 
    select 35, reached_level_35, total_players, null from level_funnel 
    union all 
    select 40, reached_level_40, total_players, null from level_funnel
    union all 
    select 45, reached_level_45, total_players, null from level_funnel 
    union all 
    select 50, reached_level_50, total_players, null from level_funnel
),

--calculate percentages and drop-off
final as (
    select 
        level_threshold,
        players,
        round(players::float / total_players * 100, 2) as completion_pct,

        --drop-off from previous level
        lag(players) over (order by level_threshold) as previous_level_players,

        round((lag(players) over(order by level_threshold) - players)::float / 
              lag(players) over (order by level_threshold) * 100, 2) as drop_off_pct,
        
        avg_hours,
    from unpivoted 
)

select * from final 
order by level_threshold
    );
  
  
[0m16:33:34.537140 [debug] [Thread-1 (]: DuckDB adapter: Rolling back transaction.
[0m16:33:34.537343 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_level_funnel: ROLLBACK
[0m16:33:34.541878 [debug] [Thread-1 (]: Failed to rollback 'model.quest_kingdom.rpt_level_funnel'
[0m16:33:34.542183 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_level_funnel: Close
[0m16:33:34.543677 [debug] [Thread-1 (]: Runtime Error in model rpt_level_funnel (models/marts/product/rpt_level_funnel.sql)
  Binder Error: Referenced column "players" not found in FROM clause!
  Candidate bindings: "player", "level_threshold", "avg_hours"
  
  LINE 72:         players,
                   ^
[0m16:33:34.543993 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '45862e19-7946-4ce3-ab9e-85da8d23d4f0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106827b60>]}
[0m16:33:34.544313 [error] [Thread-1 (]: 4 of 4 ERROR creating sql table model main.rpt_level_funnel .................... [[31mERROR[0m in 0.02s]
[0m16:33:34.544583 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.rpt_level_funnel
[0m16:33:34.544838 [debug] [Thread-4 (]: Marking all children of 'model.quest_kingdom.rpt_level_funnel' to be skipped because of status 'error'.  Reason: Runtime Error in model rpt_level_funnel (models/marts/product/rpt_level_funnel.sql)
  Binder Error: Referenced column "players" not found in FROM clause!
  Candidate bindings: "player", "level_threshold", "avg_hours"
  
  LINE 72:         players,
                   ^.
[0m16:33:34.545745 [debug] [MainThread]: Using duckdb connection "master"
[0m16:33:34.545901 [debug] [MainThread]: On master: BEGIN
[0m16:33:34.546027 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m16:33:34.546347 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m16:33:34.546477 [debug] [MainThread]: On master: COMMIT
[0m16:33:34.546605 [debug] [MainThread]: Using duckdb connection "master"
[0m16:33:34.546729 [debug] [MainThread]: On master: COMMIT
[0m16:33:34.546920 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m16:33:34.547047 [debug] [MainThread]: On master: Close
[0m16:33:34.547213 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:33:34.547340 [debug] [MainThread]: Connection 'model.quest_kingdom.rpt_level_funnel' was properly closed.
[0m16:33:34.547532 [info ] [MainThread]: 
[0m16:33:34.547679 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 0.30 seconds (0.30s).
[0m16:33:34.548906 [debug] [MainThread]: Command end result
[0m16:33:34.571684 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/manifest.json
[0m16:33:34.572780 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/semantic_manifest.json
[0m16:33:34.575917 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/run_results.json
[0m16:33:34.576118 [info ] [MainThread]: 
[0m16:33:34.576299 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m16:33:34.576444 [info ] [MainThread]: 
[0m16:33:34.576626 [error] [MainThread]: [31mFailure in model rpt_level_funnel (models/marts/product/rpt_level_funnel.sql)[0m
[0m16:33:34.576798 [error] [MainThread]:   Runtime Error in model rpt_level_funnel (models/marts/product/rpt_level_funnel.sql)
  Binder Error: Referenced column "players" not found in FROM clause!
  Candidate bindings: "player", "level_threshold", "avg_hours"
  
  LINE 72:         players,
                   ^
[0m16:33:34.576933 [info ] [MainThread]: 
[0m16:33:34.577084 [info ] [MainThread]:   compiled code at target/compiled/quest_kingdom/models/marts/product/rpt_level_funnel.sql
[0m16:33:34.577218 [info ] [MainThread]: 
[0m16:33:34.577363 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=4
[0m16:33:34.578921 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.98727196, "process_in_blocks": "0", "process_kernel_time": 0.242943, "process_mem_max_rss": "279396352", "process_out_blocks": "0", "process_user_time": 1.456172}
[0m16:33:34.579180 [debug] [MainThread]: Command `dbt run` failed at 16:33:34.579131 after 0.99 seconds
[0m16:33:34.579377 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1053977d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1051f99a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105d3d9a0>]}
[0m16:33:34.579555 [debug] [MainThread]: Flushing usage events
[0m16:33:34.688069 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m16:35:30.193487 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1040b3380>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104e05ac0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104e05790>]}


============================== 16:35:30.206534 | 6f12bc2b-6928-4ecb-a699-e17cd1bd7f41 ==============================
[0m16:35:30.206534 [info ] [MainThread]: Running with dbt=1.11.4
[0m16:35:30.206859 [debug] [MainThread]: running dbt with arguments {'invocation_command': 'dbt run --select path:models/marts/product', 'profiles_dir': '/Users/hazeldonaldson/.dbt', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'printer_width': '80', 'fail_fast': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'use_experimental_parser': 'False', 'partial_parse': 'True', 'warn_error': 'None', 'log_path': '/Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/logs', 'quiet': 'False', 'use_colors': 'True', 'target_path': 'None', 'debug': 'False', 'version_check': 'True', 'static_parser': 'True', 'write_json': 'True', 'no_print': 'None', 'log_format': 'default', 'empty': 'False', 'cache_selected_only': 'False', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m16:35:30.379818 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '6f12bc2b-6928-4ecb-a699-e17cd1bd7f41', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104e30a10>]}
[0m16:35:30.408127 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '6f12bc2b-6928-4ecb-a699-e17cd1bd7f41', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1040b33b0>]}
[0m16:35:30.409549 [info ] [MainThread]: Registered adapter: duckdb=1.10.0
[0m16:35:30.461438 [debug] [MainThread]: checksum: 092b177ba87eb6bb3c55954c38aa57900eebac336561eb9ee32218428aa81d43, vars: {}, profile: , target: , version: 1.11.4
[0m16:35:30.537776 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m16:35:30.538390 [debug] [MainThread]: Partial parsing: updated file: quest_kingdom://models/marts/product/rpt_level_funnel.sql
[0m16:35:30.734066 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '6f12bc2b-6928-4ecb-a699-e17cd1bd7f41', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10560f650>]}
[0m16:35:30.818715 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/manifest.json
[0m16:35:30.820274 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/semantic_manifest.json
[0m16:35:30.834718 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '6f12bc2b-6928-4ecb-a699-e17cd1bd7f41', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1055b8050>]}
[0m16:35:30.835000 [info ] [MainThread]: Found 19 models, 48 data tests, 5 sources, 472 macros
[0m16:35:30.835180 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6f12bc2b-6928-4ecb-a699-e17cd1bd7f41', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1055a0e30>]}
[0m16:35:30.837155 [info ] [MainThread]: 
[0m16:35:30.837337 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m16:35:30.837477 [info ] [MainThread]: 
[0m16:35:30.837712 [debug] [MainThread]: Acquiring new duckdb connection 'master'
[0m16:35:30.839936 [debug] [ThreadPool]: Acquiring new duckdb connection 'list_quest_kingdom'
[0m16:35:30.869392 [debug] [ThreadPool]: Using duckdb connection "list_quest_kingdom"
[0m16:35:30.869640 [debug] [ThreadPool]: On list_quest_kingdom: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "list_quest_kingdom"} */

    
    select schema_name
    from system.information_schema.schemata
    
    where lower(catalog_name) = '"quest_kingdom"'
    
  
  
[0m16:35:30.869785 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:35:30.888935 [debug] [ThreadPool]: SQL status: OK in 0.019 seconds
[0m16:35:30.889886 [debug] [ThreadPool]: On list_quest_kingdom: Close
[0m16:35:30.890239 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_quest_kingdom, now create_quest_kingdom_main)
[0m16:35:30.890488 [debug] [ThreadPool]: Creating schema "database: "quest_kingdom"
schema: "main"
"
[0m16:35:30.894121 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m16:35:30.894319 [debug] [ThreadPool]: On create_quest_kingdom_main: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "create_quest_kingdom_main"} */

    
        select type from duckdb_databases()
        where lower(database_name)='quest_kingdom'
        and type='sqlite'
    
  
[0m16:35:30.894449 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:35:30.895218 [debug] [ThreadPool]: SQL status: OK in 0.001 seconds
[0m16:35:30.896021 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m16:35:30.896156 [debug] [ThreadPool]: On create_quest_kingdom_main: BEGIN
[0m16:35:30.896377 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m16:35:30.896503 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m16:35:30.896625 [debug] [ThreadPool]: On create_quest_kingdom_main: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "create_quest_kingdom_main"} */

    
    
        create schema if not exists "quest_kingdom"."main"
    
[0m16:35:30.896873 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m16:35:30.897247 [debug] [ThreadPool]: On create_quest_kingdom_main: COMMIT
[0m16:35:30.897380 [debug] [ThreadPool]: Using duckdb connection "create_quest_kingdom_main"
[0m16:35:30.897494 [debug] [ThreadPool]: On create_quest_kingdom_main: COMMIT
[0m16:35:30.897687 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m16:35:30.897817 [debug] [ThreadPool]: On create_quest_kingdom_main: Close
[0m16:35:30.898784 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_quest_kingdom_main, now list_quest_kingdom_main)
[0m16:35:30.901472 [debug] [ThreadPool]: Using duckdb connection "list_quest_kingdom_main"
[0m16:35:30.901636 [debug] [ThreadPool]: On list_quest_kingdom_main: BEGIN
[0m16:35:30.901815 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:35:30.902071 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m16:35:30.902203 [debug] [ThreadPool]: Using duckdb connection "list_quest_kingdom_main"
[0m16:35:30.902337 [debug] [ThreadPool]: On list_quest_kingdom_main: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "list_quest_kingdom_main"} */
select
      'quest_kingdom' as database,
      table_name as name,
      table_schema as schema,
      CASE table_type
        WHEN 'BASE TABLE' THEN 'table'
        WHEN 'VIEW' THEN 'view'
        WHEN 'LOCAL TEMPORARY' THEN 'table'
        END as type
    from system.information_schema.tables
    where lower(table_schema) = 'main'
    and lower(table_catalog) = 'quest_kingdom'
  
[0m16:35:30.912189 [debug] [ThreadPool]: SQL status: OK in 0.010 seconds
[0m16:35:30.913040 [debug] [ThreadPool]: On list_quest_kingdom_main: ROLLBACK
[0m16:35:30.914021 [debug] [ThreadPool]: Failed to rollback 'list_quest_kingdom_main'
[0m16:35:30.914179 [debug] [ThreadPool]: On list_quest_kingdom_main: Close
[0m16:35:30.915548 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6f12bc2b-6928-4ecb-a699-e17cd1bd7f41', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1055c7dd0>]}
[0m16:35:30.915803 [debug] [MainThread]: Using duckdb connection "master"
[0m16:35:30.915953 [debug] [MainThread]: On master: BEGIN
[0m16:35:30.916085 [debug] [MainThread]: Opening a new connection, currently in state init
[0m16:35:30.916352 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m16:35:30.916488 [debug] [MainThread]: On master: COMMIT
[0m16:35:30.916616 [debug] [MainThread]: Using duckdb connection "master"
[0m16:35:30.916738 [debug] [MainThread]: On master: COMMIT
[0m16:35:30.916961 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m16:35:30.917103 [debug] [MainThread]: On master: Close
[0m16:35:30.918458 [debug] [Thread-1 (]: Began running node model.quest_kingdom.rpt_feature_engagement
[0m16:35:30.918711 [info ] [Thread-1 (]: 1 of 4 START sql table model main.rpt_feature_engagement ....................... [RUN]
[0m16:35:30.918918 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_quest_kingdom_main, now model.quest_kingdom.rpt_feature_engagement)
[0m16:35:30.919076 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.rpt_feature_engagement
[0m16:35:30.922937 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.rpt_feature_engagement"
[0m16:35:30.923773 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.rpt_feature_engagement
[0m16:35:30.940027 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.rpt_feature_engagement"
[0m16:35:30.940841 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_feature_engagement"
[0m16:35:30.941040 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_feature_engagement: BEGIN
[0m16:35:30.941190 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:35:30.941544 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:35:30.941692 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_feature_engagement"
[0m16:35:30.941893 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_feature_engagement: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_feature_engagement"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_feature_engagement__dbt_tmp"
  
    as (
      

with events as (
    select * from "quest_kingdom"."main"."stg_events"
),

players as (
    select * from "quest_kingdom"."main"."dim_players"
),

--aggregate events per player
player_events as (
    select 
        player_id,

        --event counts
        count(*) as total_events,
        count(distinct event_name) as unique_event_types,

        --specific events
        sum(case when event_name = 'tutorial_completed' then 1 else 0 end) as tutorial_completions,
        sum(case when event_name = 'level_completed' then 1 else 0 end) as level_completions,
        sum(case when event_name = 'boss_defeated' then 1 else 0 end) as boss_defeats,

        --timing
        min(event_at) as first_event_at,
        max(event_at) as last_event_at
    from events 
    group by player_id 

),

--combine with player data
final as (
    select 
        p.player_id,
        p.installed_at,
        p.cohort_week,
        p.attribution_channel,
        p.player_segment,
        p.experiment_variant,
        p.is_payer,

        --events
        coalesce(pe.total_events, 0) as total_events,
        coalesce(pe.unique_event_types, 0) as unique_event_types,
        coalesce(pe.tutorial_completions, 0) as tutorial_completions,
        coalesce(pe.boss_defeats, 0) as boss_defeats,

        --derived
        case 
            when pe.tutorial_completions > 0 then true 
            else false 
        end as completed_tutorial,

        case
            when pe.boss_defeats > 0 then true
            else false 
        end defeated_boss,

        --events per session (if they have sessions)
        case
            when p.total_sessions > 0 
            then coalesce(pe.total_events, 0)::float / p.total_sessions
            else 0
        end events_per_session,

        --engagement level based on events
        case 
            when coalesce(pe.total_events, 0) >= 50 then 'Power User (50+)'
            when coalesce(pe.total_events, 0) >= 20 then 'Engaged (20-49)'
            when coalesce(pe.total_events, 0) >= 5 then 'Active (5-19)'
            when coalesce(pe.total_events, 0) >= 1 then 'Casual (1-4)'
            else 'No Events'
        end as event_engagement_tier
    from players p 
    left join player_events pe on p.player_id = pe.player_id 
 )

 
 select * from final
    );
  
  
[0m16:35:30.958946 [debug] [Thread-1 (]: SQL status: OK in 0.017 seconds
[0m16:35:30.961877 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_feature_engagement"
[0m16:35:30.962087 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_feature_engagement: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_feature_engagement"} */

    SELECT index_name
    FROM duckdb_indexes()
    WHERE schema_name = 'main'
      AND table_name = 'rpt_feature_engagement'
  
[0m16:35:30.962591 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:35:30.963203 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_feature_engagement"
[0m16:35:30.963367 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_feature_engagement: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_feature_engagement"} */

    SELECT COUNT(*) as remaining_indexes
    FROM duckdb_indexes()
    WHERE schema_name = 'main'
      AND table_name = 'rpt_feature_engagement'
  
[0m16:35:30.963797 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:35:30.966814 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_feature_engagement"
[0m16:35:30.966996 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_feature_engagement: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_feature_engagement"} */
alter table "quest_kingdom"."main"."rpt_feature_engagement" rename to "rpt_feature_engagement__dbt_backup"
[0m16:35:30.967781 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m16:35:30.969224 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_feature_engagement"
[0m16:35:30.969392 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_feature_engagement: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_feature_engagement"} */
alter table "quest_kingdom"."main"."rpt_feature_engagement__dbt_tmp" rename to "rpt_feature_engagement"
[0m16:35:30.969679 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:35:30.977350 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_feature_engagement: COMMIT
[0m16:35:30.977592 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_feature_engagement"
[0m16:35:30.977751 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_feature_engagement: COMMIT
[0m16:35:30.980741 [debug] [Thread-1 (]: SQL status: OK in 0.003 seconds
[0m16:35:30.983522 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_feature_engagement"
[0m16:35:30.983704 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_feature_engagement: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_feature_engagement"} */

      drop table if exists "quest_kingdom"."main"."rpt_feature_engagement__dbt_backup" cascade
    
[0m16:35:30.984212 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:35:30.985410 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_feature_engagement: Close
[0m16:35:30.986378 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6f12bc2b-6928-4ecb-a699-e17cd1bd7f41', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1059ec680>]}
[0m16:35:30.986708 [info ] [Thread-1 (]: 1 of 4 OK created sql table model main.rpt_feature_engagement .................. [[32mOK[0m in 0.07s]
[0m16:35:30.986984 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.rpt_feature_engagement
[0m16:35:30.987177 [debug] [Thread-1 (]: Began running node model.quest_kingdom.rpt_level_progression
[0m16:35:30.987420 [info ] [Thread-1 (]: 2 of 4 START sql table model main.rpt_level_progression ........................ [RUN]
[0m16:35:30.987623 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.quest_kingdom.rpt_feature_engagement, now model.quest_kingdom.rpt_level_progression)
[0m16:35:30.987793 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.rpt_level_progression
[0m16:35:30.989521 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.rpt_level_progression"
[0m16:35:30.990072 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.rpt_level_progression
[0m16:35:30.991730 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.rpt_level_progression"
[0m16:35:30.993206 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_level_progression"
[0m16:35:30.993499 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_level_progression: BEGIN
[0m16:35:30.993687 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:35:30.994100 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:35:30.994544 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_level_progression"
[0m16:35:30.994905 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_level_progression: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_level_progression"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_level_progression__dbt_tmp"
  
    as (
      

with sessions as (
    select * from "quest_kingdom"."main"."fct_sessions"
),

players as (
    select * from "quest_kingdom"."main"."dim_players"
),

--track level progression per player
player_levels as (
    select 
        player_id,
        min(session_started_at) as first_session_at,
        max(ending_level) as max_level_reached,
        sum(levels_gained) as total_levels_gained,

        --time to reach certain milestones
        min(case when ending_level >= 5 then session_started_at end) as reached_level_5_at,
        min(case when ending_level >= 10 then session_started_at end) as reached_level_10_at,
        min(case when ending_level >= 20 then session_started_at end) as reached_level_20_at,
        min(case when ending_level >= 30 then session_started_at end) as reached_level_30_at,
        min(case when ending_level >= 40 then session_started_at end) as reached_level_40_at,
        min(case when ending_level >= 50 then session_started_at end) as reached_level_50_at,

        --progression metrics
        count(*) as total_sessions,
        sum(session_duration_minutes) as total_play_time,
        avg(session_duration_minutes) as avg_session_duration
    from sessions 
    group by player_id 
),

--combine with player attributes
final as (
    select 
        pl.player_id,
        p.installed_at,
        p.cohort_week,
        p.attribution_channel,
        p.player_segment,
        p.experiment_variant,
        p.is_payer,

        --progression
        pl.max_level_reached,
        pl.total_levels_gained,

        --milestones
        pl.reached_level_5_at,
        pl.reached_level_10_at,
        pl.reached_level_20_at,
        pl.reached_level_30_at,
        pl.reached_level_40_at,
        pl.reached_level_50_at,

        --time to milestones (in hours)
        case 
            when pl.reached_level_5_at is not null 
            then datediff('hour', pl.first_session_at, pl.reached_level_5_at)
        end as hours_to_level_5,
        case 
            when pl.reached_level_10_at is not null 
            then datediff('hour', pl.first_session_at, pl.reached_level_10_at)
        end as hours_to_level_10,
        case 
            when pl.reached_level_20_at is not null 
            then datediff('hour', pl.first_session_at, pl.reached_level_20_at)
        end as hours_to_level_20,
       
       --engagement
       pl.total_sessions,
       pl.total_play_time,
       pl.avg_session_duration,

       --progression velocity (levels per hour player)
       case 
            when pl.total_play_time > 0 
            then pl.total_levels_gained::float / (pl.total_play_time / 60)
            else 0
        end as levels_per_hour,

        --progression tiers
        case 
            when pl.max_level_reached >= 40 then 'End Game (40+)'
            when pl.max_level_reached >= 30 then 'Late Game (30-39)'
            when pl.max_level_reached >= 20 then 'Mid Game (20-29)'
            when pl.max_level_reached >= 10 then 'Early Game (10-19)'
            when pl.max_level_reached >= 5 then 'Tutorial+ (5-9)'
            else 'Tutorial (1-4)'
        end as progression_tier 
    from player_levels pl 
    inner join players p on pl.player_id = p.player_id
)

select * from final
    );
  
  
[0m16:35:31.017842 [debug] [Thread-1 (]: SQL status: OK in 0.022 seconds
[0m16:35:31.018559 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_level_progression"
[0m16:35:31.018775 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_level_progression: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_level_progression"} */

    SELECT index_name
    FROM duckdb_indexes()
    WHERE schema_name = 'main'
      AND table_name = 'rpt_level_progression'
  
[0m16:35:31.019263 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:35:31.019932 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_level_progression"
[0m16:35:31.020101 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_level_progression: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_level_progression"} */

    SELECT COUNT(*) as remaining_indexes
    FROM duckdb_indexes()
    WHERE schema_name = 'main'
      AND table_name = 'rpt_level_progression'
  
[0m16:35:31.020510 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:35:31.022114 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_level_progression"
[0m16:35:31.022288 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_level_progression: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_level_progression"} */
alter table "quest_kingdom"."main"."rpt_level_progression" rename to "rpt_level_progression__dbt_backup"
[0m16:35:31.022597 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:35:31.023878 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_level_progression"
[0m16:35:31.024042 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_level_progression: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_level_progression"} */
alter table "quest_kingdom"."main"."rpt_level_progression__dbt_tmp" rename to "rpt_level_progression"
[0m16:35:31.024314 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:35:31.025052 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_level_progression: COMMIT
[0m16:35:31.025220 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_level_progression"
[0m16:35:31.025364 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_level_progression: COMMIT
[0m16:35:31.029232 [debug] [Thread-1 (]: SQL status: OK in 0.004 seconds
[0m16:35:31.031365 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_level_progression"
[0m16:35:31.031543 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_level_progression: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_level_progression"} */

      drop table if exists "quest_kingdom"."main"."rpt_level_progression__dbt_backup" cascade
    
[0m16:35:31.032085 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:35:31.032789 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_level_progression: Close
[0m16:35:31.033069 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6f12bc2b-6928-4ecb-a699-e17cd1bd7f41', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105a4cd10>]}
[0m16:35:31.033366 [info ] [Thread-1 (]: 2 of 4 OK created sql table model main.rpt_level_progression ................... [[32mOK[0m in 0.05s]
[0m16:35:31.033623 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.rpt_level_progression
[0m16:35:31.033807 [debug] [Thread-1 (]: Began running node model.quest_kingdom.rpt_session_quality
[0m16:35:31.034043 [info ] [Thread-1 (]: 3 of 4 START sql table model main.rpt_session_quality .......................... [RUN]
[0m16:35:31.034288 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.quest_kingdom.rpt_level_progression, now model.quest_kingdom.rpt_session_quality)
[0m16:35:31.034460 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.rpt_session_quality
[0m16:35:31.036158 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.rpt_session_quality"
[0m16:35:31.036858 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.rpt_session_quality
[0m16:35:31.038421 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.rpt_session_quality"
[0m16:35:31.039122 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_session_quality"
[0m16:35:31.039291 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_session_quality: BEGIN
[0m16:35:31.039472 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:35:31.039829 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:35:31.039987 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_session_quality"
[0m16:35:31.040230 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_session_quality: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_session_quality"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_session_quality__dbt_tmp"
  
    as (
      

with sessions as (

    select * from "quest_kingdom"."main"."fct_sessions"

),

-- Calculate days between sessions first
session_spacing as (

    select
        player_id,
        session_started_at,
        datediff('day', 
            lag(session_started_at) over (partition by player_id order by session_started_at), 
            session_started_at
        ) as days_since_last_session

    from sessions

),

-- Aggregate session metrics
session_metrics as (

    select
        s.player_id,
        s.attribution_channel,
        s.player_segment,
        s.experiment_variant,
        
        -- Session counts
        count(*) as total_sessions,
        count(case when s.is_quality_session then 1 end) as quality_sessions,
        count(case when s.has_progression then 1 end) as sessions_with_progression,
        
        -- Duration metrics
        avg(s.session_duration_minutes) as avg_session_duration,
        sum(s.session_duration_minutes) as total_play_time,
        max(s.session_duration_minutes) as longest_session,
        
        -- Progression metrics
        sum(s.levels_gained) as total_levels_gained,
        avg(s.levels_gained) as avg_levels_per_session,
        
        -- Time of day patterns
        count(case when s.time_of_day = 'morning' then 1 end) as morning_sessions,
        count(case when s.time_of_day = 'afternoon' then 1 end) as afternoon_sessions,
        count(case when s.time_of_day = 'evening' then 1 end) as evening_sessions,
        count(case when s.time_of_day = 'night' then 1 end) as night_sessions,
        
        -- Weekend vs weekday
        count(case when s.is_weekend then 1 end) as weekend_sessions,
        count(case when not s.is_weekend then 1 end) as weekday_sessions

    from sessions s
    group by s.player_id, s.attribution_channel, s.player_segment, s.experiment_variant

),

-- Calculate average spacing separately
avg_spacing as (

    select
        player_id,
        avg(days_since_last_session) as avg_days_between_sessions

    from session_spacing
    where days_since_last_session is not null
    group by player_id

),

-- Add derived metrics
final as (

    select
        sm.*,
        sp.avg_days_between_sessions,
        
        -- Quality rates
        round(sm.quality_sessions::float / sm.total_sessions * 100, 1) as quality_session_pct,
        round(sm.sessions_with_progression::float / sm.total_sessions * 100, 1) as progression_session_pct,
        
        -- Engagement patterns
        round(sm.weekend_sessions::float / sm.total_sessions * 100, 1) as weekend_session_pct,
        
        -- Preferred time of day
        case
            when sm.evening_sessions > sm.morning_sessions 
                and sm.evening_sessions > sm.afternoon_sessions 
                and sm.evening_sessions > sm.night_sessions 
            then 'Evening'
            when sm.morning_sessions > sm.afternoon_sessions 
                and sm.morning_sessions > sm.night_sessions 
            then 'Morning'
            when sm.afternoon_sessions > sm.night_sessions then 'Afternoon'
            else 'Night'
        end as preferred_play_time,
        
        -- Engagement tier
        case
            when sm.total_sessions >= 20 then 'Power User (20+)'
            when sm.total_sessions >= 10 then 'Engaged (10-19)'
            when sm.total_sessions >= 5 then 'Regular (5-9)'
            else 'Casual (1-4)'
        end as engagement_tier

    from session_metrics sm
    left join avg_spacing sp on sm.player_id = sp.player_id

)

select * from final
    );
  
  
[0m16:35:31.069262 [debug] [Thread-1 (]: SQL status: OK in 0.029 seconds
[0m16:35:31.069946 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_session_quality"
[0m16:35:31.070127 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_session_quality: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_session_quality"} */

    SELECT index_name
    FROM duckdb_indexes()
    WHERE schema_name = 'main'
      AND table_name = 'rpt_session_quality'
  
[0m16:35:31.070600 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:35:31.071184 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_session_quality"
[0m16:35:31.071358 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_session_quality: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_session_quality"} */

    SELECT COUNT(*) as remaining_indexes
    FROM duckdb_indexes()
    WHERE schema_name = 'main'
      AND table_name = 'rpt_session_quality'
  
[0m16:35:31.071765 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:35:31.073306 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_session_quality"
[0m16:35:31.073471 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_session_quality: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_session_quality"} */
alter table "quest_kingdom"."main"."rpt_session_quality" rename to "rpt_session_quality__dbt_backup"
[0m16:35:31.073767 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:35:31.075066 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_session_quality"
[0m16:35:31.075220 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_session_quality: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_session_quality"} */
alter table "quest_kingdom"."main"."rpt_session_quality__dbt_tmp" rename to "rpt_session_quality"
[0m16:35:31.075526 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:35:31.076466 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_session_quality: COMMIT
[0m16:35:31.076647 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_session_quality"
[0m16:35:31.076797 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_session_quality: COMMIT
[0m16:35:31.080327 [debug] [Thread-1 (]: SQL status: OK in 0.003 seconds
[0m16:35:31.081508 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_session_quality"
[0m16:35:31.081700 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_session_quality: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_session_quality"} */

      drop table if exists "quest_kingdom"."main"."rpt_session_quality__dbt_backup" cascade
    
[0m16:35:31.082181 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:35:31.082824 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_session_quality: Close
[0m16:35:31.083087 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6f12bc2b-6928-4ecb-a699-e17cd1bd7f41', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105a35eb0>]}
[0m16:35:31.083375 [info ] [Thread-1 (]: 3 of 4 OK created sql table model main.rpt_session_quality ..................... [[32mOK[0m in 0.05s]
[0m16:35:31.083623 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.rpt_session_quality
[0m16:35:31.083808 [debug] [Thread-1 (]: Began running node model.quest_kingdom.rpt_level_funnel
[0m16:35:31.084033 [info ] [Thread-1 (]: 4 of 4 START sql table model main.rpt_level_funnel ............................. [RUN]
[0m16:35:31.084219 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.quest_kingdom.rpt_session_quality, now model.quest_kingdom.rpt_level_funnel)
[0m16:35:31.084381 [debug] [Thread-1 (]: Began compiling node model.quest_kingdom.rpt_level_funnel
[0m16:35:31.086002 [debug] [Thread-1 (]: Writing injected SQL for node "model.quest_kingdom.rpt_level_funnel"
[0m16:35:31.086850 [debug] [Thread-1 (]: Began executing node model.quest_kingdom.rpt_level_funnel
[0m16:35:31.088387 [debug] [Thread-1 (]: Writing runtime sql for node "model.quest_kingdom.rpt_level_funnel"
[0m16:35:31.088900 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_level_funnel"
[0m16:35:31.089065 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_level_funnel: BEGIN
[0m16:35:31.089212 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:35:31.089524 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:35:31.089672 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_level_funnel"
[0m16:35:31.089893 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_level_funnel: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_level_funnel"} */

  
    
    

    create  table
      "quest_kingdom"."main"."rpt_level_funnel__dbt_tmp"
  
    as (
      

with progression as (
    select * from "quest_kingdom"."main"."rpt_level_progression"
),

--count players who reached each level threshold
level_funnel as (
    select 
        count(*) as total_players,

        --level milestones
        sum(case when max_level_reached >= 1 then 1 else 0 end) as reached_level_1,
        sum(case when max_level_reached >= 5 then 1 else 0 end) as reached_level_5,
        sum(case when max_level_reached >= 10 then 1 else 0 end) as reached_level_10,
        sum(case when max_level_reached >= 15 then 1 else 0 end) as reached_level_15,
        sum(case when max_level_reached >= 20 then 1 else 0 end) as reached_level_20,
        sum(case when max_level_reached >= 25 then 1 else 0 end) as reached_level_25,
        sum(case when max_level_reached >= 30 then 1 else 0 end) as reached_level_30,
        sum(case when max_level_reached >= 35 then 1 else 0 end) as reached_level_35,
        sum(case when max_level_reached >= 40 then 1 else 0 end) as reached_level_40,
        sum(case when max_level_reached >= 45 then 1 else 0 end) as reached_level_45,
        sum(case when max_level_reached >= 50 then 1 else 0 end) as reached_level_50,

        --average time to each level
        avg(hours_to_level_5) as avg_hours_to_level_5,
        avg(hours_to_level_10) as avg_hours_to_level_10,
        avg(hours_to_level_20) as avg_hours_to_level_20
    from progression 

),

--unpivot to long format for earier analysis
unpivoted as (
    select 1 as level_threshold, reached_level_1 as players, total_players, null as avg_hours from level_funnel
    union all 
    select 5, reached_level_5, total_players, avg_hours_to_level_5 from level_funnel
    union all 
    select 10, reached_level_10, total_players, avg_hours_to_level_10 from level_funnel,
    union all
    select 15, reached_level_15, total_players, null from level_funnel 
    union all 
    select 20, reached_level_20, total_players, avg_hours_to_level_20 from level_funnel
    union all 
    select 25, reached_level_25, total_players, null from level_funnel
    union all 
    select 30, reached_level_30, total_players, null from level_funnel
    union all 
    select 35, reached_level_35, total_players, null from level_funnel 
    union all 
    select 40, reached_level_40, total_players, null from level_funnel
    union all 
    select 45, reached_level_45, total_players, null from level_funnel 
    union all 
    select 50, reached_level_50, total_players, null from level_funnel
),

--calculate percentages and drop-off
final as (
    select 
        level_threshold,
        players,
        round(players::float / total_players * 100, 2) as completion_pct,

        --drop-off from previous level
        lag(players) over (order by level_threshold) as previous_level_players,

        round((lag(players) over(order by level_threshold) - players)::float / 
              lag(players) over (order by level_threshold) * 100, 2) as drop_off_pct,
        
        avg_hours,
    from unpivoted 
)

select * from final 
order by level_threshold
    );
  
  
[0m16:35:31.093785 [debug] [Thread-1 (]: SQL status: OK in 0.004 seconds
[0m16:35:31.095566 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_level_funnel"
[0m16:35:31.095769 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_level_funnel: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_level_funnel"} */
alter table "quest_kingdom"."main"."rpt_level_funnel__dbt_tmp" rename to "rpt_level_funnel"
[0m16:35:31.096158 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:35:31.096852 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_level_funnel: COMMIT
[0m16:35:31.097004 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_level_funnel"
[0m16:35:31.097139 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_level_funnel: COMMIT
[0m16:35:31.097559 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:35:31.098679 [debug] [Thread-1 (]: Using duckdb connection "model.quest_kingdom.rpt_level_funnel"
[0m16:35:31.098850 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_level_funnel: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "model.quest_kingdom.rpt_level_funnel"} */

      drop table if exists "quest_kingdom"."main"."rpt_level_funnel__dbt_backup" cascade
    
[0m16:35:31.099126 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:35:31.099799 [debug] [Thread-1 (]: On model.quest_kingdom.rpt_level_funnel: Close
[0m16:35:31.100062 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6f12bc2b-6928-4ecb-a699-e17cd1bd7f41', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105a73f20>]}
[0m16:35:31.100341 [info ] [Thread-1 (]: 4 of 4 OK created sql table model main.rpt_level_funnel ........................ [[32mOK[0m in 0.02s]
[0m16:35:31.100585 [debug] [Thread-1 (]: Finished running node model.quest_kingdom.rpt_level_funnel
[0m16:35:31.101116 [debug] [MainThread]: Using duckdb connection "master"
[0m16:35:31.101264 [debug] [MainThread]: On master: BEGIN
[0m16:35:31.101390 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m16:35:31.101653 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m16:35:31.101783 [debug] [MainThread]: On master: COMMIT
[0m16:35:31.101909 [debug] [MainThread]: Using duckdb connection "master"
[0m16:35:31.102029 [debug] [MainThread]: On master: COMMIT
[0m16:35:31.102226 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m16:35:31.102352 [debug] [MainThread]: On master: Close
[0m16:35:31.102511 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:35:31.102635 [debug] [MainThread]: Connection 'model.quest_kingdom.rpt_level_funnel' was properly closed.
[0m16:35:31.102785 [info ] [MainThread]: 
[0m16:35:31.102926 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 0.27 seconds (0.27s).
[0m16:35:31.103368 [debug] [MainThread]: Command end result
[0m16:35:31.121092 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/manifest.json
[0m16:35:31.122154 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/semantic_manifest.json
[0m16:35:31.125408 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/run_results.json
[0m16:35:31.125609 [info ] [MainThread]: 
[0m16:35:31.125894 [info ] [MainThread]: [32mCompleted successfully[0m
[0m16:35:31.126102 [info ] [MainThread]: 
[0m16:35:31.126273 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=4
[0m16:35:31.127346 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 0.97118294, "process_in_blocks": "0", "process_kernel_time": 0.221862, "process_mem_max_rss": "279838720", "process_out_blocks": "0", "process_user_time": 1.458268}
[0m16:35:31.127587 [debug] [MainThread]: Command `dbt run` succeeded at 16:35:31.127542 after 0.97 seconds
[0m16:35:31.127770 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1040b1610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104e05970>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105a5ff80>]}
[0m16:35:31.127940 [debug] [MainThread]: Flushing usage events
[0m16:35:31.240547 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m16:35:53.666737 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1069b0950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107329b80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107329910>]}


============================== 16:35:53.671370 | fb9fb32a-6a74-4bfb-ac14-41d3ea8004eb ==============================
[0m16:35:53.671370 [info ] [MainThread]: Running with dbt=1.11.4
[0m16:35:53.671719 [debug] [MainThread]: running dbt with arguments {'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'profiles_dir': '/Users/hazeldonaldson/.dbt', 'use_experimental_parser': 'False', 'fail_fast': 'False', 'log_path': '/Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/logs', 'write_json': 'True', 'use_colors': 'True', 'invocation_command': 'dbt test --select path:models/marts/product', 'warn_error': 'None', 'empty': 'None', 'cache_selected_only': 'False', 'version_check': 'True', 'partial_parse': 'True', 'static_parser': 'True', 'target_path': 'None', 'printer_width': '80', 'debug': 'False', 'log_cache_events': 'False', 'quiet': 'False', 'log_format': 'default', 'no_print': 'None', 'send_anonymous_usage_stats': 'True', 'introspect': 'True', 'indirect_selection': 'eager'}
[0m16:35:53.845241 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'fb9fb32a-6a74-4bfb-ac14-41d3ea8004eb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1049f4110>]}
[0m16:35:53.874717 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'fb9fb32a-6a74-4bfb-ac14-41d3ea8004eb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106e28f80>]}
[0m16:35:53.876262 [info ] [MainThread]: Registered adapter: duckdb=1.10.0
[0m16:35:53.928520 [debug] [MainThread]: checksum: 092b177ba87eb6bb3c55954c38aa57900eebac336561eb9ee32218428aa81d43, vars: {}, profile: , target: , version: 1.11.4
[0m16:35:53.995132 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m16:35:53.995374 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m16:35:53.995512 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m16:35:54.017974 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'fb9fb32a-6a74-4bfb-ac14-41d3ea8004eb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1079bbfe0>]}
[0m16:35:54.064731 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/manifest.json
[0m16:35:54.066213 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/semantic_manifest.json
[0m16:35:54.087363 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'fb9fb32a-6a74-4bfb-ac14-41d3ea8004eb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1075eb1d0>]}
[0m16:35:54.087865 [info ] [MainThread]: Found 19 models, 48 data tests, 5 sources, 472 macros
[0m16:35:54.088314 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fb9fb32a-6a74-4bfb-ac14-41d3ea8004eb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107456450>]}
[0m16:35:54.090985 [info ] [MainThread]: 
[0m16:35:54.091258 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m16:35:54.091407 [info ] [MainThread]: 
[0m16:35:54.091663 [debug] [MainThread]: Acquiring new duckdb connection 'master'
[0m16:35:54.094715 [debug] [ThreadPool]: Acquiring new duckdb connection 'list_quest_kingdom_main'
[0m16:35:54.123578 [debug] [ThreadPool]: Using duckdb connection "list_quest_kingdom_main"
[0m16:35:54.123809 [debug] [ThreadPool]: On list_quest_kingdom_main: BEGIN
[0m16:35:54.123951 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:35:54.140127 [debug] [ThreadPool]: SQL status: OK in 0.016 seconds
[0m16:35:54.140383 [debug] [ThreadPool]: Using duckdb connection "list_quest_kingdom_main"
[0m16:35:54.140533 [debug] [ThreadPool]: On list_quest_kingdom_main: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "connection_name": "list_quest_kingdom_main"} */
select
      'quest_kingdom' as database,
      table_name as name,
      table_schema as schema,
      CASE table_type
        WHEN 'BASE TABLE' THEN 'table'
        WHEN 'VIEW' THEN 'view'
        WHEN 'LOCAL TEMPORARY' THEN 'table'
        END as type
    from system.information_schema.tables
    where lower(table_schema) = 'main'
    and lower(table_catalog) = 'quest_kingdom'
  
[0m16:35:54.157920 [debug] [ThreadPool]: SQL status: OK in 0.017 seconds
[0m16:35:54.159312 [debug] [ThreadPool]: On list_quest_kingdom_main: ROLLBACK
[0m16:35:54.160346 [debug] [ThreadPool]: Failed to rollback 'list_quest_kingdom_main'
[0m16:35:54.160517 [debug] [ThreadPool]: On list_quest_kingdom_main: Close
[0m16:35:54.162233 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fb9fb32a-6a74-4bfb-ac14-41d3ea8004eb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1075b5100>]}
[0m16:35:54.162473 [debug] [MainThread]: Using duckdb connection "master"
[0m16:35:54.162609 [debug] [MainThread]: On master: BEGIN
[0m16:35:54.162732 [debug] [MainThread]: Opening a new connection, currently in state init
[0m16:35:54.163021 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m16:35:54.163151 [debug] [MainThread]: On master: COMMIT
[0m16:35:54.163276 [debug] [MainThread]: Using duckdb connection "master"
[0m16:35:54.163396 [debug] [MainThread]: On master: COMMIT
[0m16:35:54.163588 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m16:35:54.163717 [debug] [MainThread]: On master: Close
[0m16:35:54.165105 [debug] [Thread-1 (]: Began running node test.quest_kingdom.not_null_rpt_feature_engagement_player_id.0c9810fea9
[0m16:35:54.165312 [info ] [Thread-1 (]: 1 of 8 START test not_null_rpt_feature_engagement_player_id .................... [RUN]
[0m16:35:54.165527 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_quest_kingdom_main, now test.quest_kingdom.not_null_rpt_feature_engagement_player_id.0c9810fea9)
[0m16:35:54.165698 [debug] [Thread-1 (]: Began compiling node test.quest_kingdom.not_null_rpt_feature_engagement_player_id.0c9810fea9
[0m16:35:54.173628 [debug] [Thread-1 (]: Writing injected SQL for node "test.quest_kingdom.not_null_rpt_feature_engagement_player_id.0c9810fea9"
[0m16:35:54.174225 [debug] [Thread-1 (]: Began executing node test.quest_kingdom.not_null_rpt_feature_engagement_player_id.0c9810fea9
[0m16:35:54.182982 [debug] [Thread-1 (]: Writing runtime sql for node "test.quest_kingdom.not_null_rpt_feature_engagement_player_id.0c9810fea9"
[0m16:35:54.183595 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.not_null_rpt_feature_engagement_player_id.0c9810fea9"
[0m16:35:54.183782 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_rpt_feature_engagement_player_id.0c9810fea9: BEGIN
[0m16:35:54.183941 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:35:54.184295 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:35:54.184449 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.not_null_rpt_feature_engagement_player_id.0c9810fea9"
[0m16:35:54.184605 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_rpt_feature_engagement_player_id.0c9810fea9: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "test.quest_kingdom.not_null_rpt_feature_engagement_player_id.0c9810fea9"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select player_id
from "quest_kingdom"."main"."rpt_feature_engagement"
where player_id is null



  
  
      
    ) dbt_internal_test
[0m16:35:54.186403 [debug] [Thread-1 (]: SQL status: OK in 0.002 seconds
[0m16:35:54.188452 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_rpt_feature_engagement_player_id.0c9810fea9: ROLLBACK
[0m16:35:54.188942 [debug] [Thread-1 (]: Failed to rollback 'test.quest_kingdom.not_null_rpt_feature_engagement_player_id.0c9810fea9'
[0m16:35:54.189108 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_rpt_feature_engagement_player_id.0c9810fea9: Close
[0m16:35:54.189398 [info ] [Thread-1 (]: 1 of 8 PASS not_null_rpt_feature_engagement_player_id .......................... [[32mPASS[0m in 0.02s]
[0m16:35:54.189660 [debug] [Thread-1 (]: Finished running node test.quest_kingdom.not_null_rpt_feature_engagement_player_id.0c9810fea9
[0m16:35:54.189846 [debug] [Thread-1 (]: Began running node test.quest_kingdom.not_null_rpt_level_funnel_level_threshold.e7af394403
[0m16:35:54.190043 [info ] [Thread-1 (]: 2 of 8 START test not_null_rpt_level_funnel_level_threshold .................... [RUN]
[0m16:35:54.190237 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.quest_kingdom.not_null_rpt_feature_engagement_player_id.0c9810fea9, now test.quest_kingdom.not_null_rpt_level_funnel_level_threshold.e7af394403)
[0m16:35:54.190399 [debug] [Thread-1 (]: Began compiling node test.quest_kingdom.not_null_rpt_level_funnel_level_threshold.e7af394403
[0m16:35:54.192363 [debug] [Thread-1 (]: Writing injected SQL for node "test.quest_kingdom.not_null_rpt_level_funnel_level_threshold.e7af394403"
[0m16:35:54.192755 [debug] [Thread-1 (]: Began executing node test.quest_kingdom.not_null_rpt_level_funnel_level_threshold.e7af394403
[0m16:35:54.193925 [debug] [Thread-1 (]: Writing runtime sql for node "test.quest_kingdom.not_null_rpt_level_funnel_level_threshold.e7af394403"
[0m16:35:54.194251 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.not_null_rpt_level_funnel_level_threshold.e7af394403"
[0m16:35:54.194409 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_rpt_level_funnel_level_threshold.e7af394403: BEGIN
[0m16:35:54.194550 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:35:54.194944 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:35:54.195105 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.not_null_rpt_level_funnel_level_threshold.e7af394403"
[0m16:35:54.195265 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_rpt_level_funnel_level_threshold.e7af394403: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "test.quest_kingdom.not_null_rpt_level_funnel_level_threshold.e7af394403"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select level_threshold
from "quest_kingdom"."main"."rpt_level_funnel"
where level_threshold is null



  
  
      
    ) dbt_internal_test
[0m16:35:54.195787 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:35:54.196619 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_rpt_level_funnel_level_threshold.e7af394403: ROLLBACK
[0m16:35:54.197124 [debug] [Thread-1 (]: Failed to rollback 'test.quest_kingdom.not_null_rpt_level_funnel_level_threshold.e7af394403'
[0m16:35:54.197284 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_rpt_level_funnel_level_threshold.e7af394403: Close
[0m16:35:54.197568 [info ] [Thread-1 (]: 2 of 8 PASS not_null_rpt_level_funnel_level_threshold .......................... [[32mPASS[0m in 0.01s]
[0m16:35:54.197817 [debug] [Thread-1 (]: Finished running node test.quest_kingdom.not_null_rpt_level_funnel_level_threshold.e7af394403
[0m16:35:54.197995 [debug] [Thread-1 (]: Began running node test.quest_kingdom.not_null_rpt_level_progression_player_id.ec68d30580
[0m16:35:54.198354 [info ] [Thread-1 (]: 3 of 8 START test not_null_rpt_level_progression_player_id ..................... [RUN]
[0m16:35:54.198627 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.quest_kingdom.not_null_rpt_level_funnel_level_threshold.e7af394403, now test.quest_kingdom.not_null_rpt_level_progression_player_id.ec68d30580)
[0m16:35:54.198834 [debug] [Thread-1 (]: Began compiling node test.quest_kingdom.not_null_rpt_level_progression_player_id.ec68d30580
[0m16:35:54.232530 [debug] [Thread-1 (]: Writing injected SQL for node "test.quest_kingdom.not_null_rpt_level_progression_player_id.ec68d30580"
[0m16:35:54.233066 [debug] [Thread-1 (]: Began executing node test.quest_kingdom.not_null_rpt_level_progression_player_id.ec68d30580
[0m16:35:54.234271 [debug] [Thread-1 (]: Writing runtime sql for node "test.quest_kingdom.not_null_rpt_level_progression_player_id.ec68d30580"
[0m16:35:54.234622 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.not_null_rpt_level_progression_player_id.ec68d30580"
[0m16:35:54.234781 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_rpt_level_progression_player_id.ec68d30580: BEGIN
[0m16:35:54.234921 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:35:54.235278 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:35:54.235418 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.not_null_rpt_level_progression_player_id.ec68d30580"
[0m16:35:54.235577 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_rpt_level_progression_player_id.ec68d30580: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "test.quest_kingdom.not_null_rpt_level_progression_player_id.ec68d30580"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select player_id
from "quest_kingdom"."main"."rpt_level_progression"
where player_id is null



  
  
      
    ) dbt_internal_test
[0m16:35:54.236094 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:35:54.236805 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_rpt_level_progression_player_id.ec68d30580: ROLLBACK
[0m16:35:54.237252 [debug] [Thread-1 (]: Failed to rollback 'test.quest_kingdom.not_null_rpt_level_progression_player_id.ec68d30580'
[0m16:35:54.237398 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_rpt_level_progression_player_id.ec68d30580: Close
[0m16:35:54.237644 [info ] [Thread-1 (]: 3 of 8 PASS not_null_rpt_level_progression_player_id ........................... [[32mPASS[0m in 0.04s]
[0m16:35:54.237883 [debug] [Thread-1 (]: Finished running node test.quest_kingdom.not_null_rpt_level_progression_player_id.ec68d30580
[0m16:35:54.238056 [debug] [Thread-1 (]: Began running node test.quest_kingdom.not_null_rpt_session_quality_player_id.1cc4ea034d
[0m16:35:54.238237 [info ] [Thread-1 (]: 4 of 8 START test not_null_rpt_session_quality_player_id ....................... [RUN]
[0m16:35:54.238411 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.quest_kingdom.not_null_rpt_level_progression_player_id.ec68d30580, now test.quest_kingdom.not_null_rpt_session_quality_player_id.1cc4ea034d)
[0m16:35:54.238561 [debug] [Thread-1 (]: Began compiling node test.quest_kingdom.not_null_rpt_session_quality_player_id.1cc4ea034d
[0m16:35:54.240435 [debug] [Thread-1 (]: Writing injected SQL for node "test.quest_kingdom.not_null_rpt_session_quality_player_id.1cc4ea034d"
[0m16:35:54.240764 [debug] [Thread-1 (]: Began executing node test.quest_kingdom.not_null_rpt_session_quality_player_id.1cc4ea034d
[0m16:35:54.241870 [debug] [Thread-1 (]: Writing runtime sql for node "test.quest_kingdom.not_null_rpt_session_quality_player_id.1cc4ea034d"
[0m16:35:54.242179 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.not_null_rpt_session_quality_player_id.1cc4ea034d"
[0m16:35:54.242332 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_rpt_session_quality_player_id.1cc4ea034d: BEGIN
[0m16:35:54.242472 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:35:54.242766 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:35:54.242912 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.not_null_rpt_session_quality_player_id.1cc4ea034d"
[0m16:35:54.243067 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_rpt_session_quality_player_id.1cc4ea034d: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "test.quest_kingdom.not_null_rpt_session_quality_player_id.1cc4ea034d"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select player_id
from "quest_kingdom"."main"."rpt_session_quality"
where player_id is null



  
  
      
    ) dbt_internal_test
[0m16:35:54.243594 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:35:54.244465 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_rpt_session_quality_player_id.1cc4ea034d: ROLLBACK
[0m16:35:54.244999 [debug] [Thread-1 (]: Failed to rollback 'test.quest_kingdom.not_null_rpt_session_quality_player_id.1cc4ea034d'
[0m16:35:54.245177 [debug] [Thread-1 (]: On test.quest_kingdom.not_null_rpt_session_quality_player_id.1cc4ea034d: Close
[0m16:35:54.245476 [info ] [Thread-1 (]: 4 of 8 PASS not_null_rpt_session_quality_player_id ............................. [[32mPASS[0m in 0.01s]
[0m16:35:54.245742 [debug] [Thread-1 (]: Finished running node test.quest_kingdom.not_null_rpt_session_quality_player_id.1cc4ea034d
[0m16:35:54.246039 [debug] [Thread-1 (]: Began running node test.quest_kingdom.unique_rpt_feature_engagement_player_id.64afbfc5a6
[0m16:35:54.246233 [info ] [Thread-1 (]: 5 of 8 START test unique_rpt_feature_engagement_player_id ...................... [RUN]
[0m16:35:54.246443 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.quest_kingdom.not_null_rpt_session_quality_player_id.1cc4ea034d, now test.quest_kingdom.unique_rpt_feature_engagement_player_id.64afbfc5a6)
[0m16:35:54.246609 [debug] [Thread-1 (]: Began compiling node test.quest_kingdom.unique_rpt_feature_engagement_player_id.64afbfc5a6
[0m16:35:54.249822 [debug] [Thread-1 (]: Writing injected SQL for node "test.quest_kingdom.unique_rpt_feature_engagement_player_id.64afbfc5a6"
[0m16:35:54.250270 [debug] [Thread-1 (]: Began executing node test.quest_kingdom.unique_rpt_feature_engagement_player_id.64afbfc5a6
[0m16:35:54.251406 [debug] [Thread-1 (]: Writing runtime sql for node "test.quest_kingdom.unique_rpt_feature_engagement_player_id.64afbfc5a6"
[0m16:35:54.251813 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.unique_rpt_feature_engagement_player_id.64afbfc5a6"
[0m16:35:54.252010 [debug] [Thread-1 (]: On test.quest_kingdom.unique_rpt_feature_engagement_player_id.64afbfc5a6: BEGIN
[0m16:35:54.252167 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:35:54.252521 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:35:54.252675 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.unique_rpt_feature_engagement_player_id.64afbfc5a6"
[0m16:35:54.252836 [debug] [Thread-1 (]: On test.quest_kingdom.unique_rpt_feature_engagement_player_id.64afbfc5a6: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "test.quest_kingdom.unique_rpt_feature_engagement_player_id.64afbfc5a6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    player_id as unique_field,
    count(*) as n_records

from "quest_kingdom"."main"."rpt_feature_engagement"
where player_id is not null
group by player_id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m16:35:54.260071 [debug] [Thread-1 (]: SQL status: OK in 0.007 seconds
[0m16:35:54.261027 [debug] [Thread-1 (]: On test.quest_kingdom.unique_rpt_feature_engagement_player_id.64afbfc5a6: ROLLBACK
[0m16:35:54.261646 [debug] [Thread-1 (]: Failed to rollback 'test.quest_kingdom.unique_rpt_feature_engagement_player_id.64afbfc5a6'
[0m16:35:54.261826 [debug] [Thread-1 (]: On test.quest_kingdom.unique_rpt_feature_engagement_player_id.64afbfc5a6: Close
[0m16:35:54.262164 [info ] [Thread-1 (]: 5 of 8 PASS unique_rpt_feature_engagement_player_id ............................ [[32mPASS[0m in 0.02s]
[0m16:35:54.262425 [debug] [Thread-1 (]: Finished running node test.quest_kingdom.unique_rpt_feature_engagement_player_id.64afbfc5a6
[0m16:35:54.262607 [debug] [Thread-1 (]: Began running node test.quest_kingdom.unique_rpt_level_funnel_level_threshold.5d9ab87bd8
[0m16:35:54.262797 [info ] [Thread-1 (]: 6 of 8 START test unique_rpt_level_funnel_level_threshold ...................... [RUN]
[0m16:35:54.262987 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.quest_kingdom.unique_rpt_feature_engagement_player_id.64afbfc5a6, now test.quest_kingdom.unique_rpt_level_funnel_level_threshold.5d9ab87bd8)
[0m16:35:54.263150 [debug] [Thread-1 (]: Began compiling node test.quest_kingdom.unique_rpt_level_funnel_level_threshold.5d9ab87bd8
[0m16:35:54.265237 [debug] [Thread-1 (]: Writing injected SQL for node "test.quest_kingdom.unique_rpt_level_funnel_level_threshold.5d9ab87bd8"
[0m16:35:54.265627 [debug] [Thread-1 (]: Began executing node test.quest_kingdom.unique_rpt_level_funnel_level_threshold.5d9ab87bd8
[0m16:35:54.266737 [debug] [Thread-1 (]: Writing runtime sql for node "test.quest_kingdom.unique_rpt_level_funnel_level_threshold.5d9ab87bd8"
[0m16:35:54.267128 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.unique_rpt_level_funnel_level_threshold.5d9ab87bd8"
[0m16:35:54.267360 [debug] [Thread-1 (]: On test.quest_kingdom.unique_rpt_level_funnel_level_threshold.5d9ab87bd8: BEGIN
[0m16:35:54.267527 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:35:54.267890 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:35:54.268052 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.unique_rpt_level_funnel_level_threshold.5d9ab87bd8"
[0m16:35:54.268216 [debug] [Thread-1 (]: On test.quest_kingdom.unique_rpt_level_funnel_level_threshold.5d9ab87bd8: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "test.quest_kingdom.unique_rpt_level_funnel_level_threshold.5d9ab87bd8"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    level_threshold as unique_field,
    count(*) as n_records

from "quest_kingdom"."main"."rpt_level_funnel"
where level_threshold is not null
group by level_threshold
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m16:35:54.270686 [debug] [Thread-1 (]: SQL status: OK in 0.002 seconds
[0m16:35:54.271463 [debug] [Thread-1 (]: On test.quest_kingdom.unique_rpt_level_funnel_level_threshold.5d9ab87bd8: ROLLBACK
[0m16:35:54.271922 [debug] [Thread-1 (]: Failed to rollback 'test.quest_kingdom.unique_rpt_level_funnel_level_threshold.5d9ab87bd8'
[0m16:35:54.272083 [debug] [Thread-1 (]: On test.quest_kingdom.unique_rpt_level_funnel_level_threshold.5d9ab87bd8: Close
[0m16:35:54.272340 [info ] [Thread-1 (]: 6 of 8 PASS unique_rpt_level_funnel_level_threshold ............................ [[32mPASS[0m in 0.01s]
[0m16:35:54.272582 [debug] [Thread-1 (]: Finished running node test.quest_kingdom.unique_rpt_level_funnel_level_threshold.5d9ab87bd8
[0m16:35:54.272756 [debug] [Thread-1 (]: Began running node test.quest_kingdom.unique_rpt_level_progression_player_id.c238fc76dd
[0m16:35:54.272946 [info ] [Thread-1 (]: 7 of 8 START test unique_rpt_level_progression_player_id ....................... [RUN]
[0m16:35:54.273154 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.quest_kingdom.unique_rpt_level_funnel_level_threshold.5d9ab87bd8, now test.quest_kingdom.unique_rpt_level_progression_player_id.c238fc76dd)
[0m16:35:54.273320 [debug] [Thread-1 (]: Began compiling node test.quest_kingdom.unique_rpt_level_progression_player_id.c238fc76dd
[0m16:35:54.275341 [debug] [Thread-1 (]: Writing injected SQL for node "test.quest_kingdom.unique_rpt_level_progression_player_id.c238fc76dd"
[0m16:35:54.275798 [debug] [Thread-1 (]: Began executing node test.quest_kingdom.unique_rpt_level_progression_player_id.c238fc76dd
[0m16:35:54.277217 [debug] [Thread-1 (]: Writing runtime sql for node "test.quest_kingdom.unique_rpt_level_progression_player_id.c238fc76dd"
[0m16:35:54.277941 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.unique_rpt_level_progression_player_id.c238fc76dd"
[0m16:35:54.278146 [debug] [Thread-1 (]: On test.quest_kingdom.unique_rpt_level_progression_player_id.c238fc76dd: BEGIN
[0m16:35:54.278349 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:35:54.278765 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:35:54.278935 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.unique_rpt_level_progression_player_id.c238fc76dd"
[0m16:35:54.279101 [debug] [Thread-1 (]: On test.quest_kingdom.unique_rpt_level_progression_player_id.c238fc76dd: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "test.quest_kingdom.unique_rpt_level_progression_player_id.c238fc76dd"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    player_id as unique_field,
    count(*) as n_records

from "quest_kingdom"."main"."rpt_level_progression"
where player_id is not null
group by player_id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m16:35:54.280923 [debug] [Thread-1 (]: SQL status: OK in 0.002 seconds
[0m16:35:54.281779 [debug] [Thread-1 (]: On test.quest_kingdom.unique_rpt_level_progression_player_id.c238fc76dd: ROLLBACK
[0m16:35:54.282279 [debug] [Thread-1 (]: Failed to rollback 'test.quest_kingdom.unique_rpt_level_progression_player_id.c238fc76dd'
[0m16:35:54.282442 [debug] [Thread-1 (]: On test.quest_kingdom.unique_rpt_level_progression_player_id.c238fc76dd: Close
[0m16:35:54.282712 [info ] [Thread-1 (]: 7 of 8 PASS unique_rpt_level_progression_player_id ............................. [[32mPASS[0m in 0.01s]
[0m16:35:54.282953 [debug] [Thread-1 (]: Finished running node test.quest_kingdom.unique_rpt_level_progression_player_id.c238fc76dd
[0m16:35:54.283133 [debug] [Thread-1 (]: Began running node test.quest_kingdom.unique_rpt_session_quality_player_id.bcdd64a607
[0m16:35:54.283333 [info ] [Thread-1 (]: 8 of 8 START test unique_rpt_session_quality_player_id ......................... [RUN]
[0m16:35:54.283558 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.quest_kingdom.unique_rpt_level_progression_player_id.c238fc76dd, now test.quest_kingdom.unique_rpt_session_quality_player_id.bcdd64a607)
[0m16:35:54.283730 [debug] [Thread-1 (]: Began compiling node test.quest_kingdom.unique_rpt_session_quality_player_id.bcdd64a607
[0m16:35:54.285854 [debug] [Thread-1 (]: Writing injected SQL for node "test.quest_kingdom.unique_rpt_session_quality_player_id.bcdd64a607"
[0m16:35:54.286286 [debug] [Thread-1 (]: Began executing node test.quest_kingdom.unique_rpt_session_quality_player_id.bcdd64a607
[0m16:35:54.288553 [debug] [Thread-1 (]: Writing runtime sql for node "test.quest_kingdom.unique_rpt_session_quality_player_id.bcdd64a607"
[0m16:35:54.289003 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.unique_rpt_session_quality_player_id.bcdd64a607"
[0m16:35:54.289168 [debug] [Thread-1 (]: On test.quest_kingdom.unique_rpt_session_quality_player_id.bcdd64a607: BEGIN
[0m16:35:54.289318 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:35:54.289679 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m16:35:54.289834 [debug] [Thread-1 (]: Using duckdb connection "test.quest_kingdom.unique_rpt_session_quality_player_id.bcdd64a607"
[0m16:35:54.290002 [debug] [Thread-1 (]: On test.quest_kingdom.unique_rpt_session_quality_player_id.bcdd64a607: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "quest_kingdom", "target_name": "dev", "node_id": "test.quest_kingdom.unique_rpt_session_quality_player_id.bcdd64a607"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    player_id as unique_field,
    count(*) as n_records

from "quest_kingdom"."main"."rpt_session_quality"
where player_id is not null
group by player_id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m16:35:54.291724 [debug] [Thread-1 (]: SQL status: OK in 0.002 seconds
[0m16:35:54.292602 [debug] [Thread-1 (]: On test.quest_kingdom.unique_rpt_session_quality_player_id.bcdd64a607: ROLLBACK
[0m16:35:54.293122 [debug] [Thread-1 (]: Failed to rollback 'test.quest_kingdom.unique_rpt_session_quality_player_id.bcdd64a607'
[0m16:35:54.293299 [debug] [Thread-1 (]: On test.quest_kingdom.unique_rpt_session_quality_player_id.bcdd64a607: Close
[0m16:35:54.293627 [info ] [Thread-1 (]: 8 of 8 PASS unique_rpt_session_quality_player_id ............................... [[32mPASS[0m in 0.01s]
[0m16:35:54.293892 [debug] [Thread-1 (]: Finished running node test.quest_kingdom.unique_rpt_session_quality_player_id.bcdd64a607
[0m16:35:54.294478 [debug] [MainThread]: Using duckdb connection "master"
[0m16:35:54.294868 [debug] [MainThread]: On master: BEGIN
[0m16:35:54.295035 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m16:35:54.295541 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m16:35:54.295700 [debug] [MainThread]: On master: COMMIT
[0m16:35:54.295835 [debug] [MainThread]: Using duckdb connection "master"
[0m16:35:54.295961 [debug] [MainThread]: On master: COMMIT
[0m16:35:54.296196 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m16:35:54.296332 [debug] [MainThread]: On master: Close
[0m16:35:54.296526 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:35:54.296810 [debug] [MainThread]: Connection 'test.quest_kingdom.unique_rpt_session_quality_player_id.bcdd64a607' was properly closed.
[0m16:35:54.296984 [info ] [MainThread]: 
[0m16:35:54.297142 [info ] [MainThread]: Finished running 8 data tests in 0 hours 0 minutes and 0.21 seconds (0.21s).
[0m16:35:54.297790 [debug] [MainThread]: Command end result
[0m16:35:54.317859 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/manifest.json
[0m16:35:54.319012 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/semantic_manifest.json
[0m16:35:54.323039 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/hazeldonaldson/Documents/quest_kingdom_analytics_platform/quest_kingdom_dbt/target/run_results.json
[0m16:35:54.323249 [info ] [MainThread]: 
[0m16:35:54.323431 [info ] [MainThread]: [32mCompleted successfully[0m
[0m16:35:54.323569 [info ] [MainThread]: 
[0m16:35:54.323764 [info ] [MainThread]: Done. PASS=8 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=8
[0m16:35:54.325320 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 0.6942237, "process_in_blocks": "0", "process_kernel_time": 0.184267, "process_mem_max_rss": "155189248", "process_out_blocks": "0", "process_user_time": 1.148311}
[0m16:35:54.325537 [debug] [MainThread]: Command `dbt test` succeeded at 16:35:54.325499 after 0.69 seconds
[0m16:35:54.325717 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106f67da0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106fdbbc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107f26e40>]}
[0m16:35:54.325922 [debug] [MainThread]: Flushing usage events
[0m16:35:54.426631 [debug] [MainThread]: An error was encountered while trying to flush usage events
